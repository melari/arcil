/*! For license information please see main.min.js.LICENSE.txt */
(()=>{var __webpack_modules__={3203:(t,e)=>{"use strict";function n(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function r(...t){const e=(t,e)=>n=>t(e(n));return{encode:Array.from(t).reverse().reduce(((t,n)=>t?e(t,n.encode):n.encode),void 0),decode:t.reduce(((t,n)=>t?e(t,n.decode):n.decode),void 0)}}function i(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("alphabet.encode input should be an array of numbers");return e.map((e=>{if(n(e),e<0||e>=t.length)throw new Error(`Digit index outside alphabet: ${e} (alphabet: ${t.length})`);return t[e]}))},decode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("alphabet.decode input should be array of strings");return e.map((e=>{if("string"!=typeof e)throw new Error(`alphabet.decode: not string element=${e}`);const n=t.indexOf(e);if(-1===n)throw new Error(`Unknown letter: "${e}". Allowed: ${t}`);return n}))}}}function s(t=""){if("string"!=typeof t)throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("join.encode input should be array of strings");for(let t of e)if("string"!=typeof t)throw new Error(`join.encode: non-string input=${t}`);return e.join(t)},decode:e=>{if("string"!=typeof e)throw new Error("join.decode input should be string");return e.split(t)}}}function o(t,e="="){if(n(t),"string"!=typeof e)throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let t of n)if("string"!=typeof t)throw new Error(`padding.encode: non-string input=${t}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let t of n)if("string"!=typeof t)throw new Error(`padding.decode: non-string input=${t}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function a(t){if("function"!=typeof t)throw new Error("normalize fn should be function");return{encode:t=>t,decode:e=>t(e)}}function c(t,e,r){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: wrong to=${r}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let i=0;const s=[],o=Array.from(t);for(o.forEach((t=>{if(n(t),t<0||t>=e)throw new Error(`Wrong integer: ${t}`)}));;){let t=0,n=!0;for(let s=i;s<o.length;s++){const a=o[s],c=e*t+a;if(!Number.isSafeInteger(c)||e*t/e!==t||c-a!=e*t)throw new Error("convertRadix: carry overflow");if(t=c%r,o[s]=Math.floor(c/r),!Number.isSafeInteger(o[s])||o[s]*r+t!==c)throw new Error("convertRadix: carry overflow");n&&(o[s]?n=!1:i=s)}if(s.push(t),n)break}for(let e=0;e<t.length-1&&0===t[e];e++)s.push(0);return s.reverse()}Object.defineProperty(e,"__esModule",{value:!0}),e.bytes=e.stringToBytes=e.str=e.bytesToString=e.hex=e.utf8=e.bech32m=e.bech32=e.base58check=e.base58xmr=e.base58xrp=e.base58flickr=e.base58=e.base64url=e.base64=e.base32crockford=e.base32hex=e.base32=e.base16=e.utils=e.assertNumber=void 0,e.assertNumber=n;const h=(t,e)=>e?h(e,t%e):t,l=(t,e)=>t+(e-h(t,e));function u(t,e,r,i){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(l(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${l(e,r)}`);let s=0,o=0;const a=2**r-1,c=[];for(const i of t){if(n(i),i>=2**e)throw new Error(`convertRadix2: invalid data word=${i} from=${e}`);if(s=s<<e|i,o+e>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${e}`);for(o+=e;o>=r;o-=r)c.push((s>>o-r&a)>>>0);s&=2**o-1}if(s=s<<r-o&a,!i&&o>=e)throw new Error("Excess padding");if(!i&&s)throw new Error(`Non-zero padding: ${s}`);return i&&o>0&&c.push(s>>>0),c}function d(t){return n(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return c(Array.from(e),256,t)},decode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("radix.decode input should be array of strings");return Uint8Array.from(c(e,t,256))}}}function f(t,e=!1){if(n(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(l(8,t)>32||l(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return u(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(u(n,t,8,e))}}}function p(t){if("function"!=typeof t)throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch(t){}}}function g(t,e){if(n(t),"function"!=typeof e)throw new Error("checksum fn should be function");return{encode(n){if(!(n instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const r=e(n).slice(0,t),i=new Uint8Array(n.length+t);return i.set(n),i.set(r,n.length),i},decode(n){if(!(n instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const r=n.slice(0,-t),i=e(r).slice(0,t),s=n.slice(-t);for(let e=0;e<t;e++)if(i[e]!==s[e])throw new Error("Invalid checksum");return r}}}e.utils={alphabet:i,chain:r,checksum:g,radix:d,radix2:f,join:s,padding:o},e.base16=r(f(4),i("0123456789ABCDEF"),s("")),e.base32=r(f(5),i("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),o(5),s("")),e.base32hex=r(f(5),i("0123456789ABCDEFGHIJKLMNOPQRSTUV"),o(5),s("")),e.base32crockford=r(f(5),i("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),s(""),a((t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),e.base64=r(f(6),i("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),o(6),s("")),e.base64url=r(f(6),i("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),o(6),s(""));const y=t=>r(d(58),i(t),s(""));e.base58=y("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),e.base58flickr=y("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),e.base58xrp=y("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const w=[0,2,3,5,6,7,9,10,11];e.base58xmr={encode(t){let n="";for(let r=0;r<t.length;r+=8){const i=t.subarray(r,r+8);n+=e.base58.encode(i).padStart(w[i.length],"1")}return n},decode(t){let n=[];for(let r=0;r<t.length;r+=11){const i=t.slice(r,r+11),s=w.indexOf(i.length),o=e.base58.decode(i);for(let t=0;t<o.length-s;t++)if(0!==o[t])throw new Error("base58xmr: wrong padding");n=n.concat(Array.from(o.slice(o.length-s)))}return Uint8Array.from(n)}},e.base58check=t=>r(g(4,(e=>t(t(e)))),e.base58);const b=r(i("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),s("")),m=[996825010,642813549,513874426,1027748829,705979059];function v(t){const e=t>>25;let n=(33554431&t)<<5;for(let t=0;t<m.length;t++)1==(e>>t&1)&&(n^=m[t]);return n}function E(t,e,n=1){const r=t.length;let i=1;for(let e=0;e<r;e++){const n=t.charCodeAt(e);if(n<33||n>126)throw new Error(`Invalid prefix (${t})`);i=v(i)^n>>5}i=v(i);for(let e=0;e<r;e++)i=v(i)^31&t.charCodeAt(e);for(let t of e)i=v(i)^t;for(let t=0;t<6;t++)i=v(i);return i^=n,b.encode(u([i%2**30],30,5,!1))}function k(t){const e="bech32"===t?1:734539939,n=f(5),r=n.decode,i=n.encode,s=p(r);function o(t,n=90){if("string"!=typeof t)throw new Error("bech32.decode input should be string, not "+typeof t);if(t.length<8||!1!==n&&t.length>n)throw new TypeError(`Wrong string length: ${t.length} (${t}). Expected (8..${n})`);const r=t.toLowerCase();if(t!==r&&t!==t.toUpperCase())throw new Error("String must be lowercase or uppercase");const i=(t=r).lastIndexOf("1");if(0===i||-1===i)throw new Error('Letter "1" must be present between prefix and data only');const s=t.slice(0,i),o=t.slice(i+1);if(o.length<6)throw new Error("Data must be at least 6 characters long");const a=b.decode(o).slice(0,-6),c=E(s,a,e);if(!o.endsWith(c))throw new Error(`Invalid checksum in ${t}: expected "${c}"`);return{prefix:s,words:a}}return{encode:function(t,n,r=90){if("string"!=typeof t)throw new Error("bech32.encode prefix should be string, not "+typeof t);if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof n);const i=t.length+7+n.length;if(!1!==r&&i>r)throw new TypeError(`Length ${i} exceeds limit ${r}`);return`${t=t.toLowerCase()}1${b.encode(n)}${E(t,n,e)}`},decode:o,decodeToBytes:function(t){const{prefix:e,words:n}=o(t,!1);return{prefix:e,words:n,bytes:r(n)}},decodeUnsafe:p(o),fromWords:r,fromWordsUnsafe:s,toWords:i}}e.bech32=k("bech32"),e.bech32m=k("bech32m"),e.utf8={encode:t=>(new TextDecoder).decode(t),decode:t=>(new TextEncoder).encode(t)},e.hex=r(f(4),i("0123456789abcdef"),s(""),a((t=>{if("string"!=typeof t||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})));const _={utf8:e.utf8,hex:e.hex,base16:e.base16,base32:e.base32,base64:e.base64,base64url:e.base64url,base58:e.base58,base58xmr:e.base58xmr},A=`Invalid encoding type. Available types: ${Object.keys(_).join(", ")}`;e.bytesToString=(t,e)=>{if("string"!=typeof t||!_.hasOwnProperty(t))throw new TypeError(A);if(!(e instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return _[t].encode(e)},e.str=e.bytesToString,e.stringToBytes=(t,e)=>{if(!_.hasOwnProperty(t))throw new TypeError(A);if("string"!=typeof e)throw new TypeError("stringToBytes() expects string");return _[t].decode(e)},e.bytes=e.stringToBytes},7526:(t,e)=>{"use strict";e.byteLength=function(t){var e=a(t),n=e[0],r=e[1];return 3*(n+r)/4-r},e.toByteArray=function(t){var e,n,s=a(t),o=s[0],c=s[1],h=new i(function(t,e,n){return 3*(e+n)/4-n}(0,o,c)),l=0,u=c>0?o-4:o;for(n=0;n<u;n+=4)e=r[t.charCodeAt(n)]<<18|r[t.charCodeAt(n+1)]<<12|r[t.charCodeAt(n+2)]<<6|r[t.charCodeAt(n+3)],h[l++]=e>>16&255,h[l++]=e>>8&255,h[l++]=255&e;return 2===c&&(e=r[t.charCodeAt(n)]<<2|r[t.charCodeAt(n+1)]>>4,h[l++]=255&e),1===c&&(e=r[t.charCodeAt(n)]<<10|r[t.charCodeAt(n+1)]<<4|r[t.charCodeAt(n+2)]>>2,h[l++]=e>>8&255,h[l++]=255&e),h},e.fromByteArray=function(t){for(var e,r=t.length,i=r%3,s=[],o=16383,a=0,h=r-i;a<h;a+=o)s.push(c(t,a,a+o>h?h:a+o));return 1===i?(e=t[r-1],s.push(n[e>>2]+n[e<<4&63]+"==")):2===i&&(e=(t[r-2]<<8)+t[r-1],s.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"=")),s.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0;o<64;++o)n[o]=s[o],r[s.charCodeAt(o)]=o;function a(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function c(t,e,r){for(var i,s,o=[],a=e;a<r;a+=3)i=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]),o.push(n[(s=i)>>18&63]+n[s>>12&63]+n[s>>6&63]+n[63&s]);return o.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},8287:(t,e,n)=>{"use strict";const r=n(7526),i=n(251),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;e.hp=c,e.IS=50;const o=2147483647;function a(t){if(t>o)throw new RangeError('The value "'+t+'" is invalid for option "size"');const e=new Uint8Array(t);return Object.setPrototypeOf(e,c.prototype),e}function c(t,e,n){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return u(t)}return h(t,e,n)}function h(t,e,n){if("string"==typeof t)return function(t,e){if("string"==typeof e&&""!==e||(e="utf8"),!c.isEncoding(e))throw new TypeError("Unknown encoding: "+e);const n=0|g(t,e);let r=a(n);const i=r.write(t,e);return i!==n&&(r=r.slice(0,i)),r}(t,e);if(ArrayBuffer.isView(t))return function(t){if(Z(t,Uint8Array)){const e=new Uint8Array(t);return f(e.buffer,e.byteOffset,e.byteLength)}return d(t)}(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(Z(t,ArrayBuffer)||t&&Z(t.buffer,ArrayBuffer))return f(t,e,n);if("undefined"!=typeof SharedArrayBuffer&&(Z(t,SharedArrayBuffer)||t&&Z(t.buffer,SharedArrayBuffer)))return f(t,e,n);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=t.valueOf&&t.valueOf();if(null!=r&&r!==t)return c.from(r,e,n);const i=function(t){if(c.isBuffer(t)){const e=0|p(t.length),n=a(e);return 0===n.length||t.copy(n,0,0,e),n}return void 0!==t.length?"number"!=typeof t.length||Y(t.length)?a(0):d(t):"Buffer"===t.type&&Array.isArray(t.data)?d(t.data):void 0}(t);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return c.from(t[Symbol.toPrimitive]("string"),e,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function l(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function u(t){return l(t),a(t<0?0:0|p(t))}function d(t){const e=t.length<0?0:0|p(t.length),n=a(e);for(let r=0;r<e;r+=1)n[r]=255&t[r];return n}function f(t,e,n){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(n||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===e&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,e):new Uint8Array(t,e,n),Object.setPrototypeOf(r,c.prototype),r}function p(t){if(t>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|t}function g(t,e){if(c.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||Z(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);const n=t.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let i=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return W(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return V(t).length;default:if(i)return r?-1:W(t).length;e=(""+e).toLowerCase(),i=!0}}function y(t,e,n){let r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return I(this,e,n);case"utf8":case"utf-8":return S(this,e,n);case"ascii":return C(this,e,n);case"latin1":case"binary":return N(this,e,n);case"base64":return x(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function w(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function b(t,e,n,r,i){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),Y(n=+n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof e&&(e=c.from(e,r)),c.isBuffer(e))return 0===e.length?-1:m(t,e,n,r,i);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):m(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function m(t,e,n,r,i){let s,o=1,a=t.length,c=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;o=2,a/=2,c/=2,n/=2}function h(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(i){let r=-1;for(s=n;s<a;s++)if(h(t,s)===h(e,-1===r?0:s-r)){if(-1===r&&(r=s),s-r+1===c)return r*o}else-1!==r&&(s-=s-r),r=-1}else for(n+c>a&&(n=a-c),s=n;s>=0;s--){let n=!0;for(let r=0;r<c;r++)if(h(t,s+r)!==h(e,r)){n=!1;break}if(n)return s}return-1}function v(t,e,n,r){n=Number(n)||0;const i=t.length-n;r?(r=Number(r))>i&&(r=i):r=i;const s=e.length;let o;for(r>s/2&&(r=s/2),o=0;o<r;++o){const r=parseInt(e.substr(2*o,2),16);if(Y(r))return o;t[n+o]=r}return o}function E(t,e,n,r){return G(W(e,t.length-n),t,n,r)}function k(t,e,n,r){return G(function(t){const e=[];for(let n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function _(t,e,n,r){return G(V(e),t,n,r)}function A(t,e,n,r){return G(function(t,e){let n,r,i;const s=[];for(let o=0;o<t.length&&!((e-=2)<0);++o)n=t.charCodeAt(o),r=n>>8,i=n%256,s.push(i),s.push(r);return s}(e,t.length-n),t,n,r)}function x(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function S(t,e,n){n=Math.min(t.length,n);const r=[];let i=e;for(;i<n;){const e=t[i];let s=null,o=e>239?4:e>223?3:e>191?2:1;if(i+o<=n){let n,r,a,c;switch(o){case 1:e<128&&(s=e);break;case 2:n=t[i+1],128==(192&n)&&(c=(31&e)<<6|63&n,c>127&&(s=c));break;case 3:n=t[i+1],r=t[i+2],128==(192&n)&&128==(192&r)&&(c=(15&e)<<12|(63&n)<<6|63&r,c>2047&&(c<55296||c>57343)&&(s=c));break;case 4:n=t[i+1],r=t[i+2],a=t[i+3],128==(192&n)&&128==(192&r)&&128==(192&a)&&(c=(15&e)<<18|(63&n)<<12|(63&r)<<6|63&a,c>65535&&c<1114112&&(s=c))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s),i+=o}return function(t){const e=t.length;if(e<=R)return String.fromCharCode.apply(String,t);let n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=R));return n}(r)}c.TYPED_ARRAY_SUPPORT=function(){try{const t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),c.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),c.poolSize=8192,c.from=function(t,e,n){return h(t,e,n)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array),c.alloc=function(t,e,n){return function(t,e,n){return l(t),t<=0?a(t):void 0!==e?"string"==typeof n?a(t).fill(e,n):a(t).fill(e):a(t)}(t,e,n)},c.allocUnsafe=function(t){return u(t)},c.allocUnsafeSlow=function(t){return u(t)},c.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==c.prototype},c.compare=function(t,e){if(Z(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),Z(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(t)||!c.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let n=t.length,r=e.length;for(let i=0,s=Math.min(n,r);i<s;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return c.alloc(0);let n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;const r=c.allocUnsafe(e);let i=0;for(n=0;n<t.length;++n){let e=t[n];if(Z(e,Uint8Array))i+e.length>r.length?(c.isBuffer(e)||(e=c.from(e)),e.copy(r,i)):Uint8Array.prototype.set.call(r,e,i);else{if(!c.isBuffer(e))throw new TypeError('"list" argument must be an Array of Buffers');e.copy(r,i)}i+=e.length}return r},c.byteLength=g,c.prototype._isBuffer=!0,c.prototype.swap16=function(){const t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)w(this,e,e+1);return this},c.prototype.swap32=function(){const t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)w(this,e,e+3),w(this,e+1,e+2);return this},c.prototype.swap64=function(){const t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)w(this,e,e+7),w(this,e+1,e+6),w(this,e+2,e+5),w(this,e+3,e+4);return this},c.prototype.toString=function(){const t=this.length;return 0===t?"":0===arguments.length?S(this,0,t):y.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(t){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===c.compare(this,t)},c.prototype.inspect=function(){let t="";const n=e.IS;return t=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(t+=" ... "),"<Buffer "+t+">"},s&&(c.prototype[s]=c.prototype.inspect),c.prototype.compare=function(t,e,n,r,i){if(Z(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),!c.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(this===t)return 0;let s=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(e>>>=0);const a=Math.min(s,o),h=this.slice(r,i),l=t.slice(e,n);for(let t=0;t<a;++t)if(h[t]!==l[t]){s=h[t],o=l[t];break}return s<o?-1:o<s?1:0},c.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},c.prototype.indexOf=function(t,e,n){return b(this,t,e,n,!0)},c.prototype.lastIndexOf=function(t,e,n){return b(this,t,e,n,!1)},c.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}const i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let s=!1;for(;;)switch(r){case"hex":return v(this,t,e,n);case"utf8":case"utf-8":return E(this,t,e,n);case"ascii":case"latin1":case"binary":return k(this,t,e,n);case"base64":return _(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,e,n);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const R=4096;function C(t,e,n){let r="";n=Math.min(t.length,n);for(let i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function N(t,e,n){let r="";n=Math.min(t.length,n);for(let i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function I(t,e,n){const r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);let i="";for(let r=e;r<n;++r)i+=J[t[r]];return i}function B(t,e,n){const r=t.slice(e,n);let i="";for(let t=0;t<r.length-1;t+=2)i+=String.fromCharCode(r[t]+256*r[t+1]);return i}function T(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function U(t,e,n,r,i,s){if(!c.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function P(t,e,n,r,i){H(e,r,i,t,n,7);let s=Number(e&BigInt(4294967295));t[n++]=s,s>>=8,t[n++]=s,s>>=8,t[n++]=s,s>>=8,t[n++]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[n++]=o,o>>=8,t[n++]=o,o>>=8,t[n++]=o,o>>=8,t[n++]=o,n}function L(t,e,n,r,i){H(e,r,i,t,n,7);let s=Number(e&BigInt(4294967295));t[n+7]=s,s>>=8,t[n+6]=s,s>>=8,t[n+5]=s,s>>=8,t[n+4]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[n+3]=o,o>>=8,t[n+2]=o,o>>=8,t[n+1]=o,o>>=8,t[n]=o,n+8}function O(t,e,n,r,i,s){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function D(t,e,n,r,s){return e=+e,n>>>=0,s||O(t,0,n,4),i.write(t,e,n,r,23,4),n+4}function $(t,e,n,r,s){return e=+e,n>>>=0,s||O(t,0,n,8),i.write(t,e,n,r,52,8),n+8}c.prototype.slice=function(t,e){const n=this.length;(t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t);const r=this.subarray(t,e);return Object.setPrototypeOf(r,c.prototype),r},c.prototype.readUintLE=c.prototype.readUIntLE=function(t,e,n){t>>>=0,e>>>=0,n||T(t,e,this.length);let r=this[t],i=1,s=0;for(;++s<e&&(i*=256);)r+=this[t+s]*i;return r},c.prototype.readUintBE=c.prototype.readUIntBE=function(t,e,n){t>>>=0,e>>>=0,n||T(t,e,this.length);let r=this[t+--e],i=1;for(;e>0&&(i*=256);)r+=this[t+--e]*i;return r},c.prototype.readUint8=c.prototype.readUInt8=function(t,e){return t>>>=0,e||T(t,1,this.length),this[t]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(t,e){return t>>>=0,e||T(t,2,this.length),this[t]|this[t+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(t,e){return t>>>=0,e||T(t,2,this.length),this[t]<<8|this[t+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(t,e){return t>>>=0,e||T(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(t,e){return t>>>=0,e||T(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},c.prototype.readBigUInt64LE=Q((function(t){K(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||q(t,this.length-8);const r=e+256*this[++t]+65536*this[++t]+this[++t]*2**24,i=this[++t]+256*this[++t]+65536*this[++t]+n*2**24;return BigInt(r)+(BigInt(i)<<BigInt(32))})),c.prototype.readBigUInt64BE=Q((function(t){K(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||q(t,this.length-8);const r=e*2**24+65536*this[++t]+256*this[++t]+this[++t],i=this[++t]*2**24+65536*this[++t]+256*this[++t]+n;return(BigInt(r)<<BigInt(32))+BigInt(i)})),c.prototype.readIntLE=function(t,e,n){t>>>=0,e>>>=0,n||T(t,e,this.length);let r=this[t],i=1,s=0;for(;++s<e&&(i*=256);)r+=this[t+s]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*e)),r},c.prototype.readIntBE=function(t,e,n){t>>>=0,e>>>=0,n||T(t,e,this.length);let r=e,i=1,s=this[t+--r];for(;r>0&&(i*=256);)s+=this[t+--r]*i;return i*=128,s>=i&&(s-=Math.pow(2,8*e)),s},c.prototype.readInt8=function(t,e){return t>>>=0,e||T(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},c.prototype.readInt16LE=function(t,e){t>>>=0,e||T(t,2,this.length);const n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(t,e){t>>>=0,e||T(t,2,this.length);const n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(t,e){return t>>>=0,e||T(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},c.prototype.readInt32BE=function(t,e){return t>>>=0,e||T(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},c.prototype.readBigInt64LE=Q((function(t){K(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||q(t,this.length-8);const r=this[t+4]+256*this[t+5]+65536*this[t+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+this[++t]*2**24)})),c.prototype.readBigInt64BE=Q((function(t){K(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||q(t,this.length-8);const r=(e<<24)+65536*this[++t]+256*this[++t]+this[++t];return(BigInt(r)<<BigInt(32))+BigInt(this[++t]*2**24+65536*this[++t]+256*this[++t]+n)})),c.prototype.readFloatLE=function(t,e){return t>>>=0,e||T(t,4,this.length),i.read(this,t,!0,23,4)},c.prototype.readFloatBE=function(t,e){return t>>>=0,e||T(t,4,this.length),i.read(this,t,!1,23,4)},c.prototype.readDoubleLE=function(t,e){return t>>>=0,e||T(t,8,this.length),i.read(this,t,!0,52,8)},c.prototype.readDoubleBE=function(t,e){return t>>>=0,e||T(t,8,this.length),i.read(this,t,!1,52,8)},c.prototype.writeUintLE=c.prototype.writeUIntLE=function(t,e,n,r){t=+t,e>>>=0,n>>>=0,r||U(this,t,e,n,Math.pow(2,8*n)-1,0);let i=1,s=0;for(this[e]=255&t;++s<n&&(i*=256);)this[e+s]=t/i&255;return e+n},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(t,e,n,r){t=+t,e>>>=0,n>>>=0,r||U(this,t,e,n,Math.pow(2,8*n)-1,0);let i=n-1,s=1;for(this[e+i]=255&t;--i>=0&&(s*=256);)this[e+i]=t/s&255;return e+n},c.prototype.writeUint8=c.prototype.writeUInt8=function(t,e,n){return t=+t,e>>>=0,n||U(this,t,e,1,255,0),this[e]=255&t,e+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(t,e,n){return t=+t,e>>>=0,n||U(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(t,e,n){return t=+t,e>>>=0,n||U(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(t,e,n){return t=+t,e>>>=0,n||U(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(t,e,n){return t=+t,e>>>=0,n||U(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},c.prototype.writeBigUInt64LE=Q((function(t,e=0){return P(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeBigUInt64BE=Q((function(t,e=0){return L(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e>>>=0,!r){const r=Math.pow(2,8*n-1);U(this,t,e,n,r-1,-r)}let i=0,s=1,o=0;for(this[e]=255&t;++i<n&&(s*=256);)t<0&&0===o&&0!==this[e+i-1]&&(o=1),this[e+i]=(t/s|0)-o&255;return e+n},c.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e>>>=0,!r){const r=Math.pow(2,8*n-1);U(this,t,e,n,r-1,-r)}let i=n-1,s=1,o=0;for(this[e+i]=255&t;--i>=0&&(s*=256);)t<0&&0===o&&0!==this[e+i+1]&&(o=1),this[e+i]=(t/s|0)-o&255;return e+n},c.prototype.writeInt8=function(t,e,n){return t=+t,e>>>=0,n||U(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},c.prototype.writeInt16LE=function(t,e,n){return t=+t,e>>>=0,n||U(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},c.prototype.writeInt16BE=function(t,e,n){return t=+t,e>>>=0,n||U(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},c.prototype.writeInt32LE=function(t,e,n){return t=+t,e>>>=0,n||U(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},c.prototype.writeInt32BE=function(t,e,n){return t=+t,e>>>=0,n||U(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},c.prototype.writeBigInt64LE=Q((function(t,e=0){return P(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeBigInt64BE=Q((function(t,e=0){return L(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeFloatLE=function(t,e,n){return D(this,t,e,!0,n)},c.prototype.writeFloatBE=function(t,e,n){return D(this,t,e,!1,n)},c.prototype.writeDoubleLE=function(t,e,n){return $(this,t,e,!0,n)},c.prototype.writeDoubleBE=function(t,e,n){return $(this,t,e,!1,n)},c.prototype.copy=function(t,e,n,r){if(!c.isBuffer(t))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);const i=r-n;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,n,r):Uint8Array.prototype.set.call(t,this.subarray(n,r),e),i},c.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===t.length){const e=t.charCodeAt(0);("utf8"===r&&e<128||"latin1"===r)&&(t=e)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;let i;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(i=e;i<n;++i)this[i]=t;else{const s=c.isBuffer(t)?t:c.from(t,r),o=s.length;if(0===o)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(i=0;i<n-e;++i)this[i+e]=s[i%o]}return this};const F={};function M(t,e,n){F[t]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function z(t){let e="",n=t.length;const r="-"===t[0]?1:0;for(;n>=r+4;n-=3)e=`_${t.slice(n-3,n)}${e}`;return`${t.slice(0,n)}${e}`}function H(t,e,n,r,i,s){if(t>n||t<e){const r="bigint"==typeof e?"n":"";let i;throw i=s>3?0===e||e===BigInt(0)?`>= 0${r} and < 2${r} ** ${8*(s+1)}${r}`:`>= -(2${r} ** ${8*(s+1)-1}${r}) and < 2 ** ${8*(s+1)-1}${r}`:`>= ${e}${r} and <= ${n}${r}`,new F.ERR_OUT_OF_RANGE("value",i,t)}!function(t,e,n){K(e,"offset"),void 0!==t[e]&&void 0!==t[e+n]||q(e,t.length-(n+1))}(r,i,s)}function K(t,e){if("number"!=typeof t)throw new F.ERR_INVALID_ARG_TYPE(e,"number",t)}function q(t,e,n){if(Math.floor(t)!==t)throw K(t,n),new F.ERR_OUT_OF_RANGE(n||"offset","an integer",t);if(e<0)throw new F.ERR_BUFFER_OUT_OF_BOUNDS;throw new F.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${e}`,t)}M("ERR_BUFFER_OUT_OF_BOUNDS",(function(t){return t?`${t} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),M("ERR_INVALID_ARG_TYPE",(function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`}),TypeError),M("ERR_OUT_OF_RANGE",(function(t,e,n){let r=`The value of "${t}" is out of range.`,i=n;return Number.isInteger(n)&&Math.abs(n)>2**32?i=z(String(n)):"bigint"==typeof n&&(i=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(i=z(i)),i+="n"),r+=` It must be ${e}. Received ${i}`,r}),RangeError);const j=/[^+/0-9A-Za-z-_]/g;function W(t,e){let n;e=e||1/0;const r=t.length;let i=null;const s=[];for(let o=0;o<r;++o){if(n=t.charCodeAt(o),n>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(e-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&s.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;s.push(n)}else if(n<2048){if((e-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function V(t){return r.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(j,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function G(t,e,n,r){let i;for(i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}function Z(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function Y(t){return t!=t}const J=function(){const t="0123456789abcdef",e=new Array(256);for(let n=0;n<16;++n){const r=16*n;for(let i=0;i<16;++i)e[r+i]=t[n]+t[i]}return e}();function Q(t){return"undefined"==typeof BigInt?X:t}function X(){throw new Error("BigInt not supported")}},955:function(t,e,n){var r;t.exports=(r=n(9021),n(754),n(4636),n(9506),n(7165),function(){var t=r,e=t.lib.BlockCipher,n=t.algo,i=[],s=[],o=[],a=[],c=[],h=[],l=[],u=[],d=[],f=[];!function(){for(var t=[],e=0;e<256;e++)t[e]=e<128?e<<1:e<<1^283;var n=0,r=0;for(e=0;e<256;e++){var p=r^r<<1^r<<2^r<<3^r<<4;p=p>>>8^255&p^99,i[n]=p,s[p]=n;var g=t[n],y=t[g],w=t[y],b=257*t[p]^16843008*p;o[n]=b<<24|b>>>8,a[n]=b<<16|b>>>16,c[n]=b<<8|b>>>24,h[n]=b,b=16843009*w^65537*y^257*g^16843008*n,l[p]=b<<24|b>>>8,u[p]=b<<16|b>>>16,d[p]=b<<8|b>>>24,f[p]=b,n?(n=g^t[t[t[w^g]]],r^=t[t[r]]):n=r=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],g=n.AES=e.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var t=this._keyPriorReset=this._key,e=t.words,n=t.sigBytes/4,r=4*((this._nRounds=n+6)+1),s=this._keySchedule=[],o=0;o<r;o++)o<n?s[o]=e[o]:(h=s[o-1],o%n?n>6&&o%n==4&&(h=i[h>>>24]<<24|i[h>>>16&255]<<16|i[h>>>8&255]<<8|i[255&h]):(h=i[(h=h<<8|h>>>24)>>>24]<<24|i[h>>>16&255]<<16|i[h>>>8&255]<<8|i[255&h],h^=p[o/n|0]<<24),s[o]=s[o-n]^h);for(var a=this._invKeySchedule=[],c=0;c<r;c++){if(o=r-c,c%4)var h=s[o];else h=s[o-4];a[c]=c<4||o<=4?h:l[i[h>>>24]]^u[i[h>>>16&255]]^d[i[h>>>8&255]]^f[i[255&h]]}}},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,o,a,c,h,i)},decryptBlock:function(t,e){var n=t[e+1];t[e+1]=t[e+3],t[e+3]=n,this._doCryptBlock(t,e,this._invKeySchedule,l,u,d,f,s),n=t[e+1],t[e+1]=t[e+3],t[e+3]=n},_doCryptBlock:function(t,e,n,r,i,s,o,a){for(var c=this._nRounds,h=t[e]^n[0],l=t[e+1]^n[1],u=t[e+2]^n[2],d=t[e+3]^n[3],f=4,p=1;p<c;p++){var g=r[h>>>24]^i[l>>>16&255]^s[u>>>8&255]^o[255&d]^n[f++],y=r[l>>>24]^i[u>>>16&255]^s[d>>>8&255]^o[255&h]^n[f++],w=r[u>>>24]^i[d>>>16&255]^s[h>>>8&255]^o[255&l]^n[f++],b=r[d>>>24]^i[h>>>16&255]^s[l>>>8&255]^o[255&u]^n[f++];h=g,l=y,u=w,d=b}g=(a[h>>>24]<<24|a[l>>>16&255]<<16|a[u>>>8&255]<<8|a[255&d])^n[f++],y=(a[l>>>24]<<24|a[u>>>16&255]<<16|a[d>>>8&255]<<8|a[255&h])^n[f++],w=(a[u>>>24]<<24|a[d>>>16&255]<<16|a[h>>>8&255]<<8|a[255&l])^n[f++],b=(a[d>>>24]<<24|a[h>>>16&255]<<16|a[l>>>8&255]<<8|a[255&u])^n[f++],t[e]=g,t[e+1]=y,t[e+2]=w,t[e+3]=b},keySize:8});t.AES=e._createHelper(g)}(),r.AES)},3128:function(t,e,n){var r;t.exports=(r=n(9021),n(754),n(4636),n(9506),n(7165),function(){var t=r,e=t.lib.BlockCipher,n=t.algo;const i=16,s=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],o=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var a={pbox:[],sbox:[]};function c(t,e){let n=e>>24&255,r=e>>16&255,i=e>>8&255,s=255&e,o=t.sbox[0][n]+t.sbox[1][r];return o^=t.sbox[2][i],o+=t.sbox[3][s],o}function h(t,e,n){let r,s=e,o=n;for(let e=0;e<i;++e)s^=t.pbox[e],o=c(t,s)^o,r=s,s=o,o=r;return r=s,s=o,o=r,o^=t.pbox[i],s^=t.pbox[17],{left:s,right:o}}var l=n.Blowfish=e.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var t=this._keyPriorReset=this._key,e=t.words,n=t.sigBytes/4;!function(t,e,n){for(let e=0;e<4;e++){t.sbox[e]=[];for(let n=0;n<256;n++)t.sbox[e][n]=o[e][n]}let r=0;for(let i=0;i<18;i++)t.pbox[i]=s[i]^e[r],r++,r>=n&&(r=0);let i=0,a=0,c=0;for(let e=0;e<18;e+=2)c=h(t,i,a),i=c.left,a=c.right,t.pbox[e]=i,t.pbox[e+1]=a;for(let e=0;e<4;e++)for(let n=0;n<256;n+=2)c=h(t,i,a),i=c.left,a=c.right,t.sbox[e][n]=i,t.sbox[e][n+1]=a}(a,e,n)}},encryptBlock:function(t,e){var n=h(a,t[e],t[e+1]);t[e]=n.left,t[e+1]=n.right},decryptBlock:function(t,e){var n=function(t,e,n){let r,i=e,s=n;for(let e=17;e>1;--e)i^=t.pbox[e],s=c(t,i)^s,r=i,i=s,s=r;return r=i,i=s,s=r,s^=t.pbox[1],i^=t.pbox[0],{left:i,right:s}}(a,t[e],t[e+1]);t[e]=n.left,t[e+1]=n.right},blockSize:2,keySize:4,ivSize:2});t.Blowfish=e._createHelper(l)}(),r.Blowfish)},7165:function(t,e,n){var r,i,s,o,a,c,h,l,u,d,f,p,g,y,w,b,m,v,E;t.exports=(r=n(9021),n(9506),void(r.lib.Cipher||(i=r,s=i.lib,o=s.Base,a=s.WordArray,c=s.BufferedBlockAlgorithm,h=i.enc,h.Utf8,l=h.Base64,u=i.algo.EvpKDF,d=s.Cipher=c.extend({cfg:o.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,n){this.cfg=this.cfg.extend(n),this._xformMode=t,this._key=e,this.reset()},reset:function(){c.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function t(t){return"string"==typeof t?E:m}return function(e){return{encrypt:function(n,r,i){return t(r).encrypt(e,n,r,i)},decrypt:function(n,r,i){return t(r).decrypt(e,n,r,i)}}}}()}),s.StreamCipher=d.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),f=i.mode={},p=s.BlockCipherMode=o.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}}),g=f.CBC=function(){var t=p.extend();function e(t,e,n){var r,i=this._iv;i?(r=i,this._iv=void 0):r=this._prevBlock;for(var s=0;s<n;s++)t[e+s]^=r[s]}return t.Encryptor=t.extend({processBlock:function(t,n){var r=this._cipher,i=r.blockSize;e.call(this,t,n,i),r.encryptBlock(t,n),this._prevBlock=t.slice(n,n+i)}}),t.Decryptor=t.extend({processBlock:function(t,n){var r=this._cipher,i=r.blockSize,s=t.slice(n,n+i);r.decryptBlock(t,n),e.call(this,t,n,i),this._prevBlock=s}}),t}(),y=(i.pad={}).Pkcs7={pad:function(t,e){for(var n=4*e,r=n-t.sigBytes%n,i=r<<24|r<<16|r<<8|r,s=[],o=0;o<r;o+=4)s.push(i);var c=a.create(s,r);t.concat(c)},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},s.BlockCipher=d.extend({cfg:d.cfg.extend({mode:g,padding:y}),reset:function(){var t;d.reset.call(this);var e=this.cfg,n=e.iv,r=e.mode;this._xformMode==this._ENC_XFORM_MODE?t=r.createEncryptor:(t=r.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==t?this._mode.init(this,n&&n.words):(this._mode=t.call(r,this,n&&n.words),this._mode.__creator=t)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t,e=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(e.pad(this._data,this.blockSize),t=this._process(!0)):(t=this._process(!0),e.unpad(t)),t},blockSize:4}),w=s.CipherParams=o.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}}),b=(i.format={}).OpenSSL={stringify:function(t){var e=t.ciphertext,n=t.salt;return(n?a.create([1398893684,1701076831]).concat(n).concat(e):e).toString(l)},parse:function(t){var e,n=l.parse(t),r=n.words;return 1398893684==r[0]&&1701076831==r[1]&&(e=a.create(r.slice(2,4)),r.splice(0,4),n.sigBytes-=16),w.create({ciphertext:n,salt:e})}},m=s.SerializableCipher=o.extend({cfg:o.extend({format:b}),encrypt:function(t,e,n,r){r=this.cfg.extend(r);var i=t.createEncryptor(n,r),s=i.finalize(e),o=i.cfg;return w.create({ciphertext:s,key:n,iv:o.iv,algorithm:t,mode:o.mode,padding:o.padding,blockSize:t.blockSize,formatter:r.format})},decrypt:function(t,e,n,r){return r=this.cfg.extend(r),e=this._parse(e,r.format),t.createDecryptor(n,r).finalize(e.ciphertext)},_parse:function(t,e){return"string"==typeof t?e.parse(t,this):t}}),v=(i.kdf={}).OpenSSL={execute:function(t,e,n,r,i){if(r||(r=a.random(8)),i)s=u.create({keySize:e+n,hasher:i}).compute(t,r);else var s=u.create({keySize:e+n}).compute(t,r);var o=a.create(s.words.slice(e),4*n);return s.sigBytes=4*e,w.create({key:s,iv:o,salt:r})}},E=s.PasswordBasedCipher=m.extend({cfg:m.cfg.extend({kdf:v}),encrypt:function(t,e,n,r){var i=(r=this.cfg.extend(r)).kdf.execute(n,t.keySize,t.ivSize,r.salt,r.hasher);r.iv=i.iv;var s=m.encrypt.call(this,t,e,i.key,r);return s.mixIn(i),s},decrypt:function(t,e,n,r){r=this.cfg.extend(r),e=this._parse(e,r.format);var i=r.kdf.execute(n,t.keySize,t.ivSize,e.salt,r.hasher);return r.iv=i.iv,m.decrypt.call(this,t,e,i.key,r)}}))))},9021:function(t,e,n){var r;t.exports=(r=r||function(t){var e;if("undefined"!=typeof window&&window.crypto&&(e=window.crypto),"undefined"!=typeof self&&self.crypto&&(e=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(e=globalThis.crypto),!e&&"undefined"!=typeof window&&window.msCrypto&&(e=window.msCrypto),!e&&void 0!==n.g&&n.g.crypto&&(e=n.g.crypto),!e)try{e=n(477)}catch(t){}var r=function(){if(e){if("function"==typeof e.getRandomValues)try{return e.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof e.randomBytes)try{return e.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")},i=Object.create||function(){function t(){}return function(e){var n;return t.prototype=e,n=new t,t.prototype=null,n}}(),s={},o=s.lib={},a=o.Base={extend:function(t){var e=i(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},c=o.WordArray=a.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var e=this.words,n=t.words,r=this.sigBytes,i=t.sigBytes;if(this.clamp(),r%4)for(var s=0;s<i;s++){var o=n[s>>>2]>>>24-s%4*8&255;e[r+s>>>2]|=o<<24-(r+s)%4*8}else for(var a=0;a<i;a+=4)e[r+a>>>2]=n[a>>>2];return this.sigBytes+=i,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var t=a.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e=[],n=0;n<t;n+=4)e.push(r());return new c.init(e,t)}}),h=s.enc={},l=h.Hex={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],i=0;i<n;i++){var s=e[i>>>2]>>>24-i%4*8&255;r.push((s>>>4).toString(16)),r.push((15&s).toString(16))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r+=2)n[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new c.init(n,e/2)}},u=h.Latin1={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],i=0;i<n;i++){var s=e[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(s))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r++)n[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new c.init(n,e)}},d=h.Utf8={stringify:function(t){try{return decodeURIComponent(escape(u.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return u.parse(unescape(encodeURIComponent(t)))}},f=o.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=d.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n,r=this._data,i=r.words,s=r.sigBytes,o=this.blockSize,a=s/(4*o),h=(a=e?t.ceil(a):t.max((0|a)-this._minBufferSize,0))*o,l=t.min(4*h,s);if(h){for(var u=0;u<h;u+=o)this._doProcessBlock(i,u);n=i.splice(0,h),r.sigBytes-=l}return new c.init(n,l)},clone:function(){var t=a.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),p=(o.Hasher=f.extend({cfg:a.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new p.HMAC.init(t,n).finalize(e)}}}),s.algo={});return s}(Math),r)},754:function(t,e,n){var r,i,s;t.exports=(r=n(9021),s=(i=r).lib.WordArray,i.enc.Base64={stringify:function(t){var e=t.words,n=t.sigBytes,r=this._map;t.clamp();for(var i=[],s=0;s<n;s+=3)for(var o=(e[s>>>2]>>>24-s%4*8&255)<<16|(e[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|e[s+2>>>2]>>>24-(s+2)%4*8&255,a=0;a<4&&s+.75*a<n;a++)i.push(r.charAt(o>>>6*(3-a)&63));var c=r.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(t){var e=t.length,n=this._map,r=this._reverseMap;if(!r){r=this._reverseMap=[];for(var i=0;i<n.length;i++)r[n.charCodeAt(i)]=i}var o=n.charAt(64);if(o){var a=t.indexOf(o);-1!==a&&(e=a)}return function(t,e,n){for(var r=[],i=0,o=0;o<e;o++)if(o%4){var a=n[t.charCodeAt(o-1)]<<o%4*2|n[t.charCodeAt(o)]>>>6-o%4*2;r[i>>>2]|=a<<24-i%4*8,i++}return s.create(r,i)}(t,e,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},r.enc.Base64)},4725:function(t,e,n){var r,i,s;t.exports=(r=n(9021),s=(i=r).lib.WordArray,i.enc.Base64url={stringify:function(t,e){void 0===e&&(e=!0);var n=t.words,r=t.sigBytes,i=e?this._safe_map:this._map;t.clamp();for(var s=[],o=0;o<r;o+=3)for(var a=(n[o>>>2]>>>24-o%4*8&255)<<16|(n[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|n[o+2>>>2]>>>24-(o+2)%4*8&255,c=0;c<4&&o+.75*c<r;c++)s.push(i.charAt(a>>>6*(3-c)&63));var h=i.charAt(64);if(h)for(;s.length%4;)s.push(h);return s.join("")},parse:function(t,e){void 0===e&&(e=!0);var n=t.length,r=e?this._safe_map:this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var o=0;o<r.length;o++)i[r.charCodeAt(o)]=o}var a=r.charAt(64);if(a){var c=t.indexOf(a);-1!==c&&(n=c)}return function(t,e,n){for(var r=[],i=0,o=0;o<e;o++)if(o%4){var a=n[t.charCodeAt(o-1)]<<o%4*2|n[t.charCodeAt(o)]>>>6-o%4*2;r[i>>>2]|=a<<24-i%4*8,i++}return s.create(r,i)}(t,n,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"},r.enc.Base64url)},5503:function(t,e,n){var r;t.exports=(r=n(9021),function(){var t=r,e=t.lib.WordArray,n=t.enc;function i(t){return t<<8&4278255360|t>>>8&16711935}n.Utf16=n.Utf16BE={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],i=0;i<n;i+=2){var s=e[i>>>2]>>>16-i%4*8&65535;r.push(String.fromCharCode(s))}return r.join("")},parse:function(t){for(var n=t.length,r=[],i=0;i<n;i++)r[i>>>1]|=t.charCodeAt(i)<<16-i%2*16;return e.create(r,2*n)}},n.Utf16LE={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],s=0;s<n;s+=2){var o=i(e[s>>>2]>>>16-s%4*8&65535);r.push(String.fromCharCode(o))}return r.join("")},parse:function(t){for(var n=t.length,r=[],s=0;s<n;s++)r[s>>>1]|=i(t.charCodeAt(s)<<16-s%2*16);return e.create(r,2*n)}}}(),r.enc.Utf16)},9506:function(t,e,n){var r,i,s,o,a,c,h,l;t.exports=(l=n(9021),n(5471),n(1025),s=(i=(r=l).lib).Base,o=i.WordArray,c=(a=r.algo).MD5,h=a.EvpKDF=s.extend({cfg:s.extend({keySize:4,hasher:c,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var n,r=this.cfg,i=r.hasher.create(),s=o.create(),a=s.words,c=r.keySize,h=r.iterations;a.length<c;){n&&i.update(n),n=i.update(t).finalize(e),i.reset();for(var l=1;l<h;l++)n=i.finalize(n),i.reset();s.concat(n)}return s.sigBytes=4*c,s}}),r.EvpKDF=function(t,e,n){return h.create(n).compute(t,e)},l.EvpKDF)},25:function(t,e,n){var r,i,s,o;t.exports=(o=n(9021),n(7165),i=(r=o).lib.CipherParams,s=r.enc.Hex,r.format.Hex={stringify:function(t){return t.ciphertext.toString(s)},parse:function(t){var e=s.parse(t);return i.create({ciphertext:e})}},o.format.Hex)},1025:function(t,e,n){var r,i,s;t.exports=(i=(r=n(9021)).lib.Base,s=r.enc.Utf8,void(r.algo.HMAC=i.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=s.parse(e));var n=t.blockSize,r=4*n;e.sigBytes>r&&(e=t.finalize(e)),e.clamp();for(var i=this._oKey=e.clone(),o=this._iKey=e.clone(),a=i.words,c=o.words,h=0;h<n;h++)a[h]^=1549556828,c[h]^=909522486;i.sigBytes=o.sigBytes=r,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher,n=e.finalize(t);return e.reset(),e.finalize(this._oKey.clone().concat(n))}})))},1396:function(t,e,n){var r;t.exports=(r=n(9021),n(3240),n(6440),n(5503),n(754),n(4725),n(4636),n(5471),n(3009),n(6308),n(1380),n(9557),n(5953),n(8056),n(1025),n(19),n(9506),n(7165),n(2169),n(6939),n(6372),n(3797),n(8454),n(2073),n(4905),n(482),n(2155),n(8124),n(25),n(955),n(7628),n(7193),n(6298),n(2696),n(3128),r)},6440:function(t,e,n){var r;t.exports=(r=n(9021),function(){if("function"==typeof ArrayBuffer){var t=r.lib.WordArray,e=t.init,n=t.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var n=t.byteLength,r=[],i=0;i<n;i++)r[i>>>2]|=t[i]<<24-i%4*8;e.call(this,r,n)}else e.apply(this,arguments)};n.prototype=t}}(),r.lib.WordArray)},4636:function(t,e,n){var r;t.exports=(r=n(9021),function(t){var e=r,n=e.lib,i=n.WordArray,s=n.Hasher,o=e.algo,a=[];!function(){for(var e=0;e<64;e++)a[e]=4294967296*t.abs(t.sin(e+1))|0}();var c=o.MD5=s.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,e){for(var n=0;n<16;n++){var r=e+n,i=t[r];t[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var s=this._hash.words,o=t[e+0],c=t[e+1],f=t[e+2],p=t[e+3],g=t[e+4],y=t[e+5],w=t[e+6],b=t[e+7],m=t[e+8],v=t[e+9],E=t[e+10],k=t[e+11],_=t[e+12],A=t[e+13],x=t[e+14],S=t[e+15],R=s[0],C=s[1],N=s[2],I=s[3];R=h(R,C,N,I,o,7,a[0]),I=h(I,R,C,N,c,12,a[1]),N=h(N,I,R,C,f,17,a[2]),C=h(C,N,I,R,p,22,a[3]),R=h(R,C,N,I,g,7,a[4]),I=h(I,R,C,N,y,12,a[5]),N=h(N,I,R,C,w,17,a[6]),C=h(C,N,I,R,b,22,a[7]),R=h(R,C,N,I,m,7,a[8]),I=h(I,R,C,N,v,12,a[9]),N=h(N,I,R,C,E,17,a[10]),C=h(C,N,I,R,k,22,a[11]),R=h(R,C,N,I,_,7,a[12]),I=h(I,R,C,N,A,12,a[13]),N=h(N,I,R,C,x,17,a[14]),R=l(R,C=h(C,N,I,R,S,22,a[15]),N,I,c,5,a[16]),I=l(I,R,C,N,w,9,a[17]),N=l(N,I,R,C,k,14,a[18]),C=l(C,N,I,R,o,20,a[19]),R=l(R,C,N,I,y,5,a[20]),I=l(I,R,C,N,E,9,a[21]),N=l(N,I,R,C,S,14,a[22]),C=l(C,N,I,R,g,20,a[23]),R=l(R,C,N,I,v,5,a[24]),I=l(I,R,C,N,x,9,a[25]),N=l(N,I,R,C,p,14,a[26]),C=l(C,N,I,R,m,20,a[27]),R=l(R,C,N,I,A,5,a[28]),I=l(I,R,C,N,f,9,a[29]),N=l(N,I,R,C,b,14,a[30]),R=u(R,C=l(C,N,I,R,_,20,a[31]),N,I,y,4,a[32]),I=u(I,R,C,N,m,11,a[33]),N=u(N,I,R,C,k,16,a[34]),C=u(C,N,I,R,x,23,a[35]),R=u(R,C,N,I,c,4,a[36]),I=u(I,R,C,N,g,11,a[37]),N=u(N,I,R,C,b,16,a[38]),C=u(C,N,I,R,E,23,a[39]),R=u(R,C,N,I,A,4,a[40]),I=u(I,R,C,N,o,11,a[41]),N=u(N,I,R,C,p,16,a[42]),C=u(C,N,I,R,w,23,a[43]),R=u(R,C,N,I,v,4,a[44]),I=u(I,R,C,N,_,11,a[45]),N=u(N,I,R,C,S,16,a[46]),R=d(R,C=u(C,N,I,R,f,23,a[47]),N,I,o,6,a[48]),I=d(I,R,C,N,b,10,a[49]),N=d(N,I,R,C,x,15,a[50]),C=d(C,N,I,R,y,21,a[51]),R=d(R,C,N,I,_,6,a[52]),I=d(I,R,C,N,p,10,a[53]),N=d(N,I,R,C,E,15,a[54]),C=d(C,N,I,R,c,21,a[55]),R=d(R,C,N,I,m,6,a[56]),I=d(I,R,C,N,S,10,a[57]),N=d(N,I,R,C,w,15,a[58]),C=d(C,N,I,R,A,21,a[59]),R=d(R,C,N,I,g,6,a[60]),I=d(I,R,C,N,k,10,a[61]),N=d(N,I,R,C,f,15,a[62]),C=d(C,N,I,R,v,21,a[63]),s[0]=s[0]+R|0,s[1]=s[1]+C|0,s[2]=s[2]+N|0,s[3]=s[3]+I|0},_doFinalize:function(){var e=this._data,n=e.words,r=8*this._nDataBytes,i=8*e.sigBytes;n[i>>>5]|=128<<24-i%32;var s=t.floor(r/4294967296),o=r;n[15+(i+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),n[14+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),e.sigBytes=4*(n.length+1),this._process();for(var a=this._hash,c=a.words,h=0;h<4;h++){var l=c[h];c[h]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return a},clone:function(){var t=s.clone.call(this);return t._hash=this._hash.clone(),t}});function h(t,e,n,r,i,s,o){var a=t+(e&n|~e&r)+i+o;return(a<<s|a>>>32-s)+e}function l(t,e,n,r,i,s,o){var a=t+(e&r|n&~r)+i+o;return(a<<s|a>>>32-s)+e}function u(t,e,n,r,i,s,o){var a=t+(e^n^r)+i+o;return(a<<s|a>>>32-s)+e}function d(t,e,n,r,i,s,o){var a=t+(n^(e|~r))+i+o;return(a<<s|a>>>32-s)+e}e.MD5=s._createHelper(c),e.HmacMD5=s._createHmacHelper(c)}(Math),r.MD5)},2169:function(t,e,n){var r;t.exports=(r=n(9021),n(7165),r.mode.CFB=function(){var t=r.lib.BlockCipherMode.extend();function e(t,e,n,r){var i,s=this._iv;s?(i=s.slice(0),this._iv=void 0):i=this._prevBlock,r.encryptBlock(i,0);for(var o=0;o<n;o++)t[e+o]^=i[o]}return t.Encryptor=t.extend({processBlock:function(t,n){var r=this._cipher,i=r.blockSize;e.call(this,t,n,i,r),this._prevBlock=t.slice(n,n+i)}}),t.Decryptor=t.extend({processBlock:function(t,n){var r=this._cipher,i=r.blockSize,s=t.slice(n,n+i);e.call(this,t,n,i,r),this._prevBlock=s}}),t}(),r.mode.CFB)},6372:function(t,e,n){var r;t.exports=(r=n(9021),n(7165),r.mode.CTRGladman=function(){var t=r.lib.BlockCipherMode.extend();function e(t){if(255&~(t>>24))t+=1<<24;else{var e=t>>16&255,n=t>>8&255,r=255&t;255===e?(e=0,255===n?(n=0,255===r?r=0:++r):++n):++e,t=0,t+=e<<16,t+=n<<8,t+=r}return t}var n=t.Encryptor=t.extend({processBlock:function(t,n){var r=this._cipher,i=r.blockSize,s=this._iv,o=this._counter;s&&(o=this._counter=s.slice(0),this._iv=void 0),function(t){0===(t[0]=e(t[0]))&&(t[1]=e(t[1]))}(o);var a=o.slice(0);r.encryptBlock(a,0);for(var c=0;c<i;c++)t[n+c]^=a[c]}});return t.Decryptor=n,t}(),r.mode.CTRGladman)},6939:function(t,e,n){var r,i,s;t.exports=(s=n(9021),n(7165),s.mode.CTR=(i=(r=s.lib.BlockCipherMode.extend()).Encryptor=r.extend({processBlock:function(t,e){var n=this._cipher,r=n.blockSize,i=this._iv,s=this._counter;i&&(s=this._counter=i.slice(0),this._iv=void 0);var o=s.slice(0);n.encryptBlock(o,0),s[r-1]=s[r-1]+1|0;for(var a=0;a<r;a++)t[e+a]^=o[a]}}),r.Decryptor=i,r),s.mode.CTR)},8454:function(t,e,n){var r,i;t.exports=(i=n(9021),n(7165),i.mode.ECB=((r=i.lib.BlockCipherMode.extend()).Encryptor=r.extend({processBlock:function(t,e){this._cipher.encryptBlock(t,e)}}),r.Decryptor=r.extend({processBlock:function(t,e){this._cipher.decryptBlock(t,e)}}),r),i.mode.ECB)},3797:function(t,e,n){var r,i,s;t.exports=(s=n(9021),n(7165),s.mode.OFB=(i=(r=s.lib.BlockCipherMode.extend()).Encryptor=r.extend({processBlock:function(t,e){var n=this._cipher,r=n.blockSize,i=this._iv,s=this._keystream;i&&(s=this._keystream=i.slice(0),this._iv=void 0),n.encryptBlock(s,0);for(var o=0;o<r;o++)t[e+o]^=s[o]}}),r.Decryptor=i,r),s.mode.OFB)},2073:function(t,e,n){var r;t.exports=(r=n(9021),n(7165),r.pad.AnsiX923={pad:function(t,e){var n=t.sigBytes,r=4*e,i=r-n%r,s=n+i-1;t.clamp(),t.words[s>>>2]|=i<<24-s%4*8,t.sigBytes+=i},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},r.pad.Ansix923)},4905:function(t,e,n){var r;t.exports=(r=n(9021),n(7165),r.pad.Iso10126={pad:function(t,e){var n=4*e,i=n-t.sigBytes%n;t.concat(r.lib.WordArray.random(i-1)).concat(r.lib.WordArray.create([i<<24],1))},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},r.pad.Iso10126)},482:function(t,e,n){var r;t.exports=(r=n(9021),n(7165),r.pad.Iso97971={pad:function(t,e){t.concat(r.lib.WordArray.create([2147483648],1)),r.pad.ZeroPadding.pad(t,e)},unpad:function(t){r.pad.ZeroPadding.unpad(t),t.sigBytes--}},r.pad.Iso97971)},8124:function(t,e,n){var r;t.exports=(r=n(9021),n(7165),r.pad.NoPadding={pad:function(){},unpad:function(){}},r.pad.NoPadding)},2155:function(t,e,n){var r;t.exports=(r=n(9021),n(7165),r.pad.ZeroPadding={pad:function(t,e){var n=4*e;t.clamp(),t.sigBytes+=n-(t.sigBytes%n||n)},unpad:function(t){var e=t.words,n=t.sigBytes-1;for(n=t.sigBytes-1;n>=0;n--)if(e[n>>>2]>>>24-n%4*8&255){t.sigBytes=n+1;break}}},r.pad.ZeroPadding)},19:function(t,e,n){var r,i,s,o,a,c,h,l,u;t.exports=(u=n(9021),n(3009),n(1025),s=(i=(r=u).lib).Base,o=i.WordArray,c=(a=r.algo).SHA256,h=a.HMAC,l=a.PBKDF2=s.extend({cfg:s.extend({keySize:4,hasher:c,iterations:25e4}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var n=this.cfg,r=h.create(n.hasher,t),i=o.create(),s=o.create([1]),a=i.words,c=s.words,l=n.keySize,u=n.iterations;a.length<l;){var d=r.update(e).finalize(s);r.reset();for(var f=d.words,p=f.length,g=d,y=1;y<u;y++){g=r.finalize(g),r.reset();for(var w=g.words,b=0;b<p;b++)f[b]^=w[b]}i.concat(d),c[0]++}return i.sigBytes=4*l,i}}),r.PBKDF2=function(t,e,n){return l.create(n).compute(t,e)},u.PBKDF2)},2696:function(t,e,n){var r;t.exports=(r=n(9021),n(754),n(4636),n(9506),n(7165),function(){var t=r,e=t.lib.StreamCipher,n=t.algo,i=[],s=[],o=[],a=n.RabbitLegacy=e.extend({_doReset:function(){var t=this._key.words,e=this.cfg.iv,n=this._X=[t[0],t[3]<<16|t[2]>>>16,t[1],t[0]<<16|t[3]>>>16,t[2],t[1]<<16|t[0]>>>16,t[3],t[2]<<16|t[1]>>>16],r=this._C=[t[2]<<16|t[2]>>>16,4294901760&t[0]|65535&t[1],t[3]<<16|t[3]>>>16,4294901760&t[1]|65535&t[2],t[0]<<16|t[0]>>>16,4294901760&t[2]|65535&t[3],t[1]<<16|t[1]>>>16,4294901760&t[3]|65535&t[0]];this._b=0;for(var i=0;i<4;i++)c.call(this);for(i=0;i<8;i++)r[i]^=n[i+4&7];if(e){var s=e.words,o=s[0],a=s[1],h=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),l=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),u=h>>>16|4294901760&l,d=l<<16|65535&h;for(r[0]^=h,r[1]^=u,r[2]^=l,r[3]^=d,r[4]^=h,r[5]^=u,r[6]^=l,r[7]^=d,i=0;i<4;i++)c.call(this)}},_doProcessBlock:function(t,e){var n=this._X;c.call(this),i[0]=n[0]^n[5]>>>16^n[3]<<16,i[1]=n[2]^n[7]>>>16^n[5]<<16,i[2]=n[4]^n[1]>>>16^n[7]<<16,i[3]=n[6]^n[3]>>>16^n[1]<<16;for(var r=0;r<4;r++)i[r]=16711935&(i[r]<<8|i[r]>>>24)|4278255360&(i[r]<<24|i[r]>>>8),t[e+r]^=i[r]},blockSize:4,ivSize:2});function c(){for(var t=this._X,e=this._C,n=0;n<8;n++)s[n]=e[n];for(e[0]=e[0]+1295307597+this._b|0,e[1]=e[1]+3545052371+(e[0]>>>0<s[0]>>>0?1:0)|0,e[2]=e[2]+886263092+(e[1]>>>0<s[1]>>>0?1:0)|0,e[3]=e[3]+1295307597+(e[2]>>>0<s[2]>>>0?1:0)|0,e[4]=e[4]+3545052371+(e[3]>>>0<s[3]>>>0?1:0)|0,e[5]=e[5]+886263092+(e[4]>>>0<s[4]>>>0?1:0)|0,e[6]=e[6]+1295307597+(e[5]>>>0<s[5]>>>0?1:0)|0,e[7]=e[7]+3545052371+(e[6]>>>0<s[6]>>>0?1:0)|0,this._b=e[7]>>>0<s[7]>>>0?1:0,n=0;n<8;n++){var r=t[n]+e[n],i=65535&r,a=r>>>16,c=((i*i>>>17)+i*a>>>15)+a*a,h=((4294901760&r)*r|0)+((65535&r)*r|0);o[n]=c^h}t[0]=o[0]+(o[7]<<16|o[7]>>>16)+(o[6]<<16|o[6]>>>16)|0,t[1]=o[1]+(o[0]<<8|o[0]>>>24)+o[7]|0,t[2]=o[2]+(o[1]<<16|o[1]>>>16)+(o[0]<<16|o[0]>>>16)|0,t[3]=o[3]+(o[2]<<8|o[2]>>>24)+o[1]|0,t[4]=o[4]+(o[3]<<16|o[3]>>>16)+(o[2]<<16|o[2]>>>16)|0,t[5]=o[5]+(o[4]<<8|o[4]>>>24)+o[3]|0,t[6]=o[6]+(o[5]<<16|o[5]>>>16)+(o[4]<<16|o[4]>>>16)|0,t[7]=o[7]+(o[6]<<8|o[6]>>>24)+o[5]|0}t.RabbitLegacy=e._createHelper(a)}(),r.RabbitLegacy)},6298:function(t,e,n){var r;t.exports=(r=n(9021),n(754),n(4636),n(9506),n(7165),function(){var t=r,e=t.lib.StreamCipher,n=t.algo,i=[],s=[],o=[],a=n.Rabbit=e.extend({_doReset:function(){for(var t=this._key.words,e=this.cfg.iv,n=0;n<4;n++)t[n]=16711935&(t[n]<<8|t[n]>>>24)|4278255360&(t[n]<<24|t[n]>>>8);var r=this._X=[t[0],t[3]<<16|t[2]>>>16,t[1],t[0]<<16|t[3]>>>16,t[2],t[1]<<16|t[0]>>>16,t[3],t[2]<<16|t[1]>>>16],i=this._C=[t[2]<<16|t[2]>>>16,4294901760&t[0]|65535&t[1],t[3]<<16|t[3]>>>16,4294901760&t[1]|65535&t[2],t[0]<<16|t[0]>>>16,4294901760&t[2]|65535&t[3],t[1]<<16|t[1]>>>16,4294901760&t[3]|65535&t[0]];for(this._b=0,n=0;n<4;n++)c.call(this);for(n=0;n<8;n++)i[n]^=r[n+4&7];if(e){var s=e.words,o=s[0],a=s[1],h=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),l=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),u=h>>>16|4294901760&l,d=l<<16|65535&h;for(i[0]^=h,i[1]^=u,i[2]^=l,i[3]^=d,i[4]^=h,i[5]^=u,i[6]^=l,i[7]^=d,n=0;n<4;n++)c.call(this)}},_doProcessBlock:function(t,e){var n=this._X;c.call(this),i[0]=n[0]^n[5]>>>16^n[3]<<16,i[1]=n[2]^n[7]>>>16^n[5]<<16,i[2]=n[4]^n[1]>>>16^n[7]<<16,i[3]=n[6]^n[3]>>>16^n[1]<<16;for(var r=0;r<4;r++)i[r]=16711935&(i[r]<<8|i[r]>>>24)|4278255360&(i[r]<<24|i[r]>>>8),t[e+r]^=i[r]},blockSize:4,ivSize:2});function c(){for(var t=this._X,e=this._C,n=0;n<8;n++)s[n]=e[n];for(e[0]=e[0]+1295307597+this._b|0,e[1]=e[1]+3545052371+(e[0]>>>0<s[0]>>>0?1:0)|0,e[2]=e[2]+886263092+(e[1]>>>0<s[1]>>>0?1:0)|0,e[3]=e[3]+1295307597+(e[2]>>>0<s[2]>>>0?1:0)|0,e[4]=e[4]+3545052371+(e[3]>>>0<s[3]>>>0?1:0)|0,e[5]=e[5]+886263092+(e[4]>>>0<s[4]>>>0?1:0)|0,e[6]=e[6]+1295307597+(e[5]>>>0<s[5]>>>0?1:0)|0,e[7]=e[7]+3545052371+(e[6]>>>0<s[6]>>>0?1:0)|0,this._b=e[7]>>>0<s[7]>>>0?1:0,n=0;n<8;n++){var r=t[n]+e[n],i=65535&r,a=r>>>16,c=((i*i>>>17)+i*a>>>15)+a*a,h=((4294901760&r)*r|0)+((65535&r)*r|0);o[n]=c^h}t[0]=o[0]+(o[7]<<16|o[7]>>>16)+(o[6]<<16|o[6]>>>16)|0,t[1]=o[1]+(o[0]<<8|o[0]>>>24)+o[7]|0,t[2]=o[2]+(o[1]<<16|o[1]>>>16)+(o[0]<<16|o[0]>>>16)|0,t[3]=o[3]+(o[2]<<8|o[2]>>>24)+o[1]|0,t[4]=o[4]+(o[3]<<16|o[3]>>>16)+(o[2]<<16|o[2]>>>16)|0,t[5]=o[5]+(o[4]<<8|o[4]>>>24)+o[3]|0,t[6]=o[6]+(o[5]<<16|o[5]>>>16)+(o[4]<<16|o[4]>>>16)|0,t[7]=o[7]+(o[6]<<8|o[6]>>>24)+o[5]|0}t.Rabbit=e._createHelper(a)}(),r.Rabbit)},7193:function(t,e,n){var r;t.exports=(r=n(9021),n(754),n(4636),n(9506),n(7165),function(){var t=r,e=t.lib.StreamCipher,n=t.algo,i=n.RC4=e.extend({_doReset:function(){for(var t=this._key,e=t.words,n=t.sigBytes,r=this._S=[],i=0;i<256;i++)r[i]=i;i=0;for(var s=0;i<256;i++){var o=i%n,a=e[o>>>2]>>>24-o%4*8&255;s=(s+r[i]+a)%256;var c=r[i];r[i]=r[s],r[s]=c}this._i=this._j=0},_doProcessBlock:function(t,e){t[e]^=s.call(this)},keySize:8,ivSize:0});function s(){for(var t=this._S,e=this._i,n=this._j,r=0,i=0;i<4;i++){n=(n+t[e=(e+1)%256])%256;var s=t[e];t[e]=t[n],t[n]=s,r|=t[(t[e]+t[n])%256]<<24-8*i}return this._i=e,this._j=n,r}t.RC4=e._createHelper(i);var o=n.RC4Drop=i.extend({cfg:i.cfg.extend({drop:192}),_doReset:function(){i._doReset.call(this);for(var t=this.cfg.drop;t>0;t--)s.call(this)}});t.RC4Drop=e._createHelper(o)}(),r.RC4)},8056:function(t,e,n){var r;t.exports=(r=n(9021),function(){var t=r,e=t.lib,n=e.WordArray,i=e.Hasher,s=t.algo,o=n.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),a=n.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),c=n.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),h=n.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),l=n.create([0,1518500249,1859775393,2400959708,2840853838]),u=n.create([1352829926,1548603684,1836072691,2053994217,0]),d=s.RIPEMD160=i.extend({_doReset:function(){this._hash=n.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var n=0;n<16;n++){var r=e+n,i=t[r];t[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var s,d,m,v,E,k,_,A,x,S,R,C=this._hash.words,N=l.words,I=u.words,B=o.words,T=a.words,U=c.words,P=h.words;for(k=s=C[0],_=d=C[1],A=m=C[2],x=v=C[3],S=E=C[4],n=0;n<80;n+=1)R=s+t[e+B[n]]|0,R+=n<16?f(d,m,v)+N[0]:n<32?p(d,m,v)+N[1]:n<48?g(d,m,v)+N[2]:n<64?y(d,m,v)+N[3]:w(d,m,v)+N[4],R=(R=b(R|=0,U[n]))+E|0,s=E,E=v,v=b(m,10),m=d,d=R,R=k+t[e+T[n]]|0,R+=n<16?w(_,A,x)+I[0]:n<32?y(_,A,x)+I[1]:n<48?g(_,A,x)+I[2]:n<64?p(_,A,x)+I[3]:f(_,A,x)+I[4],R=(R=b(R|=0,P[n]))+S|0,k=S,S=x,x=b(A,10),A=_,_=R;R=C[1]+m+x|0,C[1]=C[2]+v+S|0,C[2]=C[3]+E+k|0,C[3]=C[4]+s+_|0,C[4]=C[0]+d+A|0,C[0]=R},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,r=8*t.sigBytes;e[r>>>5]|=128<<24-r%32,e[14+(r+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),t.sigBytes=4*(e.length+1),this._process();for(var i=this._hash,s=i.words,o=0;o<5;o++){var a=s[o];s[o]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}return i},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});function f(t,e,n){return t^e^n}function p(t,e,n){return t&e|~t&n}function g(t,e,n){return(t|~e)^n}function y(t,e,n){return t&n|e&~n}function w(t,e,n){return t^(e|~n)}function b(t,e){return t<<e|t>>>32-e}t.RIPEMD160=i._createHelper(d),t.HmacRIPEMD160=i._createHmacHelper(d)}(Math),r.RIPEMD160)},5471:function(t,e,n){var r,i,s,o,a,c,h,l;t.exports=(i=(r=l=n(9021)).lib,s=i.WordArray,o=i.Hasher,a=r.algo,c=[],h=a.SHA1=o.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var n=this._hash.words,r=n[0],i=n[1],s=n[2],o=n[3],a=n[4],h=0;h<80;h++){if(h<16)c[h]=0|t[e+h];else{var l=c[h-3]^c[h-8]^c[h-14]^c[h-16];c[h]=l<<1|l>>>31}var u=(r<<5|r>>>27)+a+c[h];u+=h<20?1518500249+(i&s|~i&o):h<40?1859775393+(i^s^o):h<60?(i&s|i&o|s&o)-1894007588:(i^s^o)-899497514,a=o,o=s,s=i<<30|i>>>2,i=r,r=u}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+a|0},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,r=8*t.sigBytes;return e[r>>>5]|=128<<24-r%32,e[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),e[15+(r+64>>>9<<4)]=n,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}}),r.SHA1=o._createHelper(h),r.HmacSHA1=o._createHmacHelper(h),l.SHA1)},6308:function(t,e,n){var r,i,s,o,a,c;t.exports=(c=n(9021),n(3009),i=(r=c).lib.WordArray,s=r.algo,o=s.SHA256,a=s.SHA224=o.extend({_doReset:function(){this._hash=new i.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var t=o._doFinalize.call(this);return t.sigBytes-=4,t}}),r.SHA224=o._createHelper(a),r.HmacSHA224=o._createHmacHelper(a),c.SHA224)},3009:function(t,e,n){var r;t.exports=(r=n(9021),function(t){var e=r,n=e.lib,i=n.WordArray,s=n.Hasher,o=e.algo,a=[],c=[];!function(){function e(e){for(var n=t.sqrt(e),r=2;r<=n;r++)if(!(e%r))return!1;return!0}function n(t){return 4294967296*(t-(0|t))|0}for(var r=2,i=0;i<64;)e(r)&&(i<8&&(a[i]=n(t.pow(r,.5))),c[i]=n(t.pow(r,1/3)),i++),r++}();var h=[],l=o.SHA256=s.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(t,e){for(var n=this._hash.words,r=n[0],i=n[1],s=n[2],o=n[3],a=n[4],l=n[5],u=n[6],d=n[7],f=0;f<64;f++){if(f<16)h[f]=0|t[e+f];else{var p=h[f-15],g=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,y=h[f-2],w=(y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10;h[f]=g+h[f-7]+w+h[f-16]}var b=r&i^r&s^i&s,m=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),v=d+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&l^~a&u)+c[f]+h[f];d=u,u=l,l=a,a=o+v|0,o=s,s=i,i=r,r=v+(m+b)|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+a|0,n[5]=n[5]+l|0,n[6]=n[6]+u|0,n[7]=n[7]+d|0},_doFinalize:function(){var e=this._data,n=e.words,r=8*this._nDataBytes,i=8*e.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=t.floor(r/4294967296),n[15+(i+64>>>9<<4)]=r,e.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var t=s.clone.call(this);return t._hash=this._hash.clone(),t}});e.SHA256=s._createHelper(l),e.HmacSHA256=s._createHmacHelper(l)}(Math),r.SHA256)},5953:function(t,e,n){var r;t.exports=(r=n(9021),n(3240),function(t){var e=r,n=e.lib,i=n.WordArray,s=n.Hasher,o=e.x64.Word,a=e.algo,c=[],h=[],l=[];!function(){for(var t=1,e=0,n=0;n<24;n++){c[t+5*e]=(n+1)*(n+2)/2%64;var r=(2*t+3*e)%5;t=e%5,e=r}for(t=0;t<5;t++)for(e=0;e<5;e++)h[t+5*e]=e+(2*t+3*e)%5*5;for(var i=1,s=0;s<24;s++){for(var a=0,u=0,d=0;d<7;d++){if(1&i){var f=(1<<d)-1;f<32?u^=1<<f:a^=1<<f-32}128&i?i=i<<1^113:i<<=1}l[s]=o.create(a,u)}}();var u=[];!function(){for(var t=0;t<25;t++)u[t]=o.create()}();var d=a.SHA3=s.extend({cfg:s.cfg.extend({outputLength:512}),_doReset:function(){for(var t=this._state=[],e=0;e<25;e++)t[e]=new o.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(t,e){for(var n=this._state,r=this.blockSize/2,i=0;i<r;i++){var s=t[e+2*i],o=t[e+2*i+1];s=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),o=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),(C=n[i]).high^=o,C.low^=s}for(var a=0;a<24;a++){for(var d=0;d<5;d++){for(var f=0,p=0,g=0;g<5;g++)f^=(C=n[d+5*g]).high,p^=C.low;var y=u[d];y.high=f,y.low=p}for(d=0;d<5;d++){var w=u[(d+4)%5],b=u[(d+1)%5],m=b.high,v=b.low;for(f=w.high^(m<<1|v>>>31),p=w.low^(v<<1|m>>>31),g=0;g<5;g++)(C=n[d+5*g]).high^=f,C.low^=p}for(var E=1;E<25;E++){var k=(C=n[E]).high,_=C.low,A=c[E];A<32?(f=k<<A|_>>>32-A,p=_<<A|k>>>32-A):(f=_<<A-32|k>>>64-A,p=k<<A-32|_>>>64-A);var x=u[h[E]];x.high=f,x.low=p}var S=u[0],R=n[0];for(S.high=R.high,S.low=R.low,d=0;d<5;d++)for(g=0;g<5;g++){var C=n[E=d+5*g],N=u[E],I=u[(d+1)%5+5*g],B=u[(d+2)%5+5*g];C.high=N.high^~I.high&B.high,C.low=N.low^~I.low&B.low}C=n[0];var T=l[a];C.high^=T.high,C.low^=T.low}},_doFinalize:function(){var e=this._data,n=e.words,r=(this._nDataBytes,8*e.sigBytes),s=32*this.blockSize;n[r>>>5]|=1<<24-r%32,n[(t.ceil((r+1)/s)*s>>>5)-1]|=128,e.sigBytes=4*n.length,this._process();for(var o=this._state,a=this.cfg.outputLength/8,c=a/8,h=[],l=0;l<c;l++){var u=o[l],d=u.high,f=u.low;d=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8),f=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),h.push(f),h.push(d)}return new i.init(h,a)},clone:function(){for(var t=s.clone.call(this),e=t._state=this._state.slice(0),n=0;n<25;n++)e[n]=e[n].clone();return t}});e.SHA3=s._createHelper(d),e.HmacSHA3=s._createHmacHelper(d)}(Math),r.SHA3)},9557:function(t,e,n){var r,i,s,o,a,c,h,l;t.exports=(l=n(9021),n(3240),n(1380),i=(r=l).x64,s=i.Word,o=i.WordArray,a=r.algo,c=a.SHA512,h=a.SHA384=c.extend({_doReset:function(){this._hash=new o.init([new s.init(3418070365,3238371032),new s.init(1654270250,914150663),new s.init(2438529370,812702999),new s.init(355462360,4144912697),new s.init(1731405415,4290775857),new s.init(2394180231,1750603025),new s.init(3675008525,1694076839),new s.init(1203062813,3204075428)])},_doFinalize:function(){var t=c._doFinalize.call(this);return t.sigBytes-=16,t}}),r.SHA384=c._createHelper(h),r.HmacSHA384=c._createHmacHelper(h),l.SHA384)},1380:function(t,e,n){var r;t.exports=(r=n(9021),n(3240),function(){var t=r,e=t.lib.Hasher,n=t.x64,i=n.Word,s=n.WordArray,o=t.algo;function a(){return i.create.apply(i,arguments)}var c=[a(1116352408,3609767458),a(1899447441,602891725),a(3049323471,3964484399),a(3921009573,2173295548),a(961987163,4081628472),a(1508970993,3053834265),a(2453635748,2937671579),a(2870763221,3664609560),a(3624381080,2734883394),a(310598401,1164996542),a(607225278,1323610764),a(1426881987,3590304994),a(1925078388,4068182383),a(2162078206,991336113),a(2614888103,633803317),a(3248222580,3479774868),a(3835390401,2666613458),a(4022224774,944711139),a(264347078,2341262773),a(604807628,2007800933),a(770255983,1495990901),a(1249150122,1856431235),a(1555081692,3175218132),a(1996064986,2198950837),a(2554220882,3999719339),a(2821834349,766784016),a(2952996808,2566594879),a(3210313671,3203337956),a(3336571891,1034457026),a(3584528711,2466948901),a(113926993,3758326383),a(338241895,168717936),a(666307205,1188179964),a(773529912,1546045734),a(1294757372,1522805485),a(1396182291,2643833823),a(1695183700,2343527390),a(1986661051,1014477480),a(2177026350,1206759142),a(2456956037,344077627),a(2730485921,1290863460),a(2820302411,3158454273),a(3259730800,3505952657),a(3345764771,106217008),a(3516065817,3606008344),a(3600352804,1432725776),a(4094571909,1467031594),a(275423344,851169720),a(430227734,3100823752),a(506948616,1363258195),a(659060556,3750685593),a(883997877,3785050280),a(958139571,3318307427),a(1322822218,3812723403),a(1537002063,2003034995),a(1747873779,3602036899),a(1955562222,1575990012),a(2024104815,1125592928),a(2227730452,2716904306),a(2361852424,442776044),a(2428436474,593698344),a(2756734187,3733110249),a(3204031479,2999351573),a(3329325298,3815920427),a(3391569614,3928383900),a(3515267271,566280711),a(3940187606,3454069534),a(4118630271,4000239992),a(116418474,1914138554),a(174292421,2731055270),a(289380356,3203993006),a(460393269,320620315),a(685471733,587496836),a(852142971,1086792851),a(1017036298,365543100),a(1126000580,2618297676),a(1288033470,3409855158),a(1501505948,4234509866),a(1607167915,987167468),a(1816402316,1246189591)],h=[];!function(){for(var t=0;t<80;t++)h[t]=a()}();var l=o.SHA512=e.extend({_doReset:function(){this._hash=new s.init([new i.init(1779033703,4089235720),new i.init(3144134277,2227873595),new i.init(1013904242,4271175723),new i.init(2773480762,1595750129),new i.init(1359893119,2917565137),new i.init(2600822924,725511199),new i.init(528734635,4215389547),new i.init(1541459225,327033209)])},_doProcessBlock:function(t,e){for(var n=this._hash.words,r=n[0],i=n[1],s=n[2],o=n[3],a=n[4],l=n[5],u=n[6],d=n[7],f=r.high,p=r.low,g=i.high,y=i.low,w=s.high,b=s.low,m=o.high,v=o.low,E=a.high,k=a.low,_=l.high,A=l.low,x=u.high,S=u.low,R=d.high,C=d.low,N=f,I=p,B=g,T=y,U=w,P=b,L=m,O=v,D=E,$=k,F=_,M=A,z=x,H=S,K=R,q=C,j=0;j<80;j++){var W,V,G=h[j];if(j<16)V=G.high=0|t[e+2*j],W=G.low=0|t[e+2*j+1];else{var Z=h[j-15],Y=Z.high,J=Z.low,Q=(Y>>>1|J<<31)^(Y>>>8|J<<24)^Y>>>7,X=(J>>>1|Y<<31)^(J>>>8|Y<<24)^(J>>>7|Y<<25),tt=h[j-2],et=tt.high,nt=tt.low,rt=(et>>>19|nt<<13)^(et<<3|nt>>>29)^et>>>6,it=(nt>>>19|et<<13)^(nt<<3|et>>>29)^(nt>>>6|et<<26),st=h[j-7],ot=st.high,at=st.low,ct=h[j-16],ht=ct.high,lt=ct.low;V=(V=(V=Q+ot+((W=X+at)>>>0<X>>>0?1:0))+rt+((W+=it)>>>0<it>>>0?1:0))+ht+((W+=lt)>>>0<lt>>>0?1:0),G.high=V,G.low=W}var ut,dt=D&F^~D&z,ft=$&M^~$&H,pt=N&B^N&U^B&U,gt=I&T^I&P^T&P,yt=(N>>>28|I<<4)^(N<<30|I>>>2)^(N<<25|I>>>7),wt=(I>>>28|N<<4)^(I<<30|N>>>2)^(I<<25|N>>>7),bt=(D>>>14|$<<18)^(D>>>18|$<<14)^(D<<23|$>>>9),mt=($>>>14|D<<18)^($>>>18|D<<14)^($<<23|D>>>9),vt=c[j],Et=vt.high,kt=vt.low,_t=K+bt+((ut=q+mt)>>>0<q>>>0?1:0),At=wt+gt;K=z,q=H,z=F,H=M,F=D,M=$,D=L+(_t=(_t=(_t=_t+dt+((ut+=ft)>>>0<ft>>>0?1:0))+Et+((ut+=kt)>>>0<kt>>>0?1:0))+V+((ut+=W)>>>0<W>>>0?1:0))+(($=O+ut|0)>>>0<O>>>0?1:0)|0,L=U,O=P,U=B,P=T,B=N,T=I,N=_t+(yt+pt+(At>>>0<wt>>>0?1:0))+((I=ut+At|0)>>>0<ut>>>0?1:0)|0}p=r.low=p+I,r.high=f+N+(p>>>0<I>>>0?1:0),y=i.low=y+T,i.high=g+B+(y>>>0<T>>>0?1:0),b=s.low=b+P,s.high=w+U+(b>>>0<P>>>0?1:0),v=o.low=v+O,o.high=m+L+(v>>>0<O>>>0?1:0),k=a.low=k+$,a.high=E+D+(k>>>0<$>>>0?1:0),A=l.low=A+M,l.high=_+F+(A>>>0<M>>>0?1:0),S=u.low=S+H,u.high=x+z+(S>>>0<H>>>0?1:0),C=d.low=C+q,d.high=R+K+(C>>>0<q>>>0?1:0)},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,r=8*t.sigBytes;return e[r>>>5]|=128<<24-r%32,e[30+(r+128>>>10<<5)]=Math.floor(n/4294967296),e[31+(r+128>>>10<<5)]=n,t.sigBytes=4*e.length,this._process(),this._hash.toX32()},clone:function(){var t=e.clone.call(this);return t._hash=this._hash.clone(),t},blockSize:32});t.SHA512=e._createHelper(l),t.HmacSHA512=e._createHmacHelper(l)}(),r.SHA512)},7628:function(t,e,n){var r;t.exports=(r=n(9021),n(754),n(4636),n(9506),n(7165),function(){var t=r,e=t.lib,n=e.WordArray,i=e.BlockCipher,s=t.algo,o=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],a=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],h=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],l=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],u=s.DES=i.extend({_doReset:function(){for(var t=this._key.words,e=[],n=0;n<56;n++){var r=o[n]-1;e[n]=t[r>>>5]>>>31-r%32&1}for(var i=this._subKeys=[],s=0;s<16;s++){var h=i[s]=[],l=c[s];for(n=0;n<24;n++)h[n/6|0]|=e[(a[n]-1+l)%28]<<31-n%6,h[4+(n/6|0)]|=e[28+(a[n+24]-1+l)%28]<<31-n%6;for(h[0]=h[0]<<1|h[0]>>>31,n=1;n<7;n++)h[n]=h[n]>>>4*(n-1)+3;h[7]=h[7]<<5|h[7]>>>27}var u=this._invSubKeys=[];for(n=0;n<16;n++)u[n]=i[15-n]},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._subKeys)},decryptBlock:function(t,e){this._doCryptBlock(t,e,this._invSubKeys)},_doCryptBlock:function(t,e,n){this._lBlock=t[e],this._rBlock=t[e+1],d.call(this,4,252645135),d.call(this,16,65535),f.call(this,2,858993459),f.call(this,8,16711935),d.call(this,1,1431655765);for(var r=0;r<16;r++){for(var i=n[r],s=this._lBlock,o=this._rBlock,a=0,c=0;c<8;c++)a|=h[c][((o^i[c])&l[c])>>>0];this._lBlock=o,this._rBlock=s^a}var u=this._lBlock;this._lBlock=this._rBlock,this._rBlock=u,d.call(this,1,1431655765),f.call(this,8,16711935),f.call(this,2,858993459),d.call(this,16,65535),d.call(this,4,252645135),t[e]=this._lBlock,t[e+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function d(t,e){var n=(this._lBlock>>>t^this._rBlock)&e;this._rBlock^=n,this._lBlock^=n<<t}function f(t,e){var n=(this._rBlock>>>t^this._lBlock)&e;this._lBlock^=n,this._rBlock^=n<<t}t.DES=i._createHelper(u);var p=s.TripleDES=i.extend({_doReset:function(){var t=this._key.words;if(2!==t.length&&4!==t.length&&t.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var e=t.slice(0,2),r=t.length<4?t.slice(0,2):t.slice(2,4),i=t.length<6?t.slice(0,2):t.slice(4,6);this._des1=u.createEncryptor(n.create(e)),this._des2=u.createEncryptor(n.create(r)),this._des3=u.createEncryptor(n.create(i))},encryptBlock:function(t,e){this._des1.encryptBlock(t,e),this._des2.decryptBlock(t,e),this._des3.encryptBlock(t,e)},decryptBlock:function(t,e){this._des3.decryptBlock(t,e),this._des2.encryptBlock(t,e),this._des1.decryptBlock(t,e)},keySize:6,ivSize:2,blockSize:2});t.TripleDES=i._createHelper(p)}(),r.TripleDES)},3240:function(t,e,n){var r,i,s,o,a,c;t.exports=(r=n(9021),s=(i=r).lib,o=s.Base,a=s.WordArray,(c=i.x64={}).Word=o.extend({init:function(t,e){this.high=t,this.low=e}}),c.WordArray=o.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:8*t.length},toX32:function(){for(var t=this.words,e=t.length,n=[],r=0;r<e;r++){var i=t[r];n.push(i.high),n.push(i.low)}return a.create(n,this.sigBytes)},clone:function(){for(var t=o.clone.call(this),e=t.words=this.words.slice(0),n=e.length,r=0;r<n;r++)e[r]=e[r].clone();return t}}),r)},7833:(t,e,n)=>{e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;e.splice(1,0,n,"color: inherit");let r=0,i=0;e[0].replace(/%[a-zA-Z%]/g,(t=>{"%%"!==t&&(r++,"%c"===t&&(i=r))})),e.splice(i,0,n)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){let t;try{t=e.storage.getItem("debug")}catch(t){}return!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG),t},e.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let t;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(t=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(t[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch(t){}}(),e.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.log=console.debug||console.log||(()=>{}),t.exports=n(736)(e);const{formatters:r}=t.exports;r.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}},736:(t,e,n)=>{t.exports=function(t){function e(t){let n,i,s,o=null;function a(...t){if(!a.enabled)return;const r=a,i=Number(new Date),s=i-(n||i);r.diff=s,r.prev=n,r.curr=i,n=i,t[0]=e.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let o=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,((n,i)=>{if("%%"===n)return"%";o++;const s=e.formatters[i];if("function"==typeof s){const e=t[o];n=s.call(r,e),t.splice(o,1),o--}return n})),e.formatArgs.call(r,t),(r.log||e.log).apply(r,t)}return a.namespace=t,a.useColors=e.useColors(),a.color=e.selectColor(t),a.extend=r,a.destroy=e.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==e.namespaces&&(i=e.namespaces,s=e.enabled(t)),s),set:t=>{o=t}}),"function"==typeof e.init&&e.init(a),a}function r(t,n){const r=e(this.namespace+(void 0===n?":":n)+t);return r.log=this.log,r}function i(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){const t=[...e.names.map(i),...e.skips.map(i).map((t=>"-"+t))].join(",");return e.enable(""),t},e.enable=function(t){let n;e.save(t),e.namespaces=t,e.names=[],e.skips=[];const r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(t=r[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.slice(1)+"$")):e.names.push(new RegExp("^"+t+"$")))},e.enabled=function(t){if("*"===t[t.length-1])return!0;let n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=n(6585),e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach((n=>{e[n]=t[n]})),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(t){let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return e.colors[Math.abs(n)%e.colors.length]},e.enable(e.load()),e}},251:(t,e)=>{e.read=function(t,e,n,r,i){var s,o,a=8*i-r-1,c=(1<<a)-1,h=c>>1,l=-7,u=n?i-1:0,d=n?-1:1,f=t[e+u];for(u+=d,s=f&(1<<-l)-1,f>>=-l,l+=a;l>0;s=256*s+t[e+u],u+=d,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=r;l>0;o=256*o+t[e+u],u+=d,l-=8);if(0===s)s=1-h;else{if(s===c)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),s-=h}return(f?-1:1)*o*Math.pow(2,s-r)},e.write=function(t,e,n,r,i,s){var o,a,c,h=8*s-i-1,l=(1<<h)-1,u=l>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:s-1,p=r?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=l):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),(e+=o+u>=1?d/c:d*Math.pow(2,1-u))*c>=2&&(o++,c/=2),o+u>=l?(a=0,o=l):o+u>=1?(a=(e*c-1)*Math.pow(2,i),o+=u):(a=e*Math.pow(2,u-1)*Math.pow(2,i),o=0));i>=8;t[n+f]=255&a,f+=p,a/=256,i-=8);for(o=o<<i|a,h+=i;h>0;t[n+f]=255&o,f+=p,o/=256,h-=8);t[n+f-p]|=128*g}},6705:(t,e,n)=>{const{bech32:r,hex:i,utf8:s}=n(3203),o={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},a={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},c={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},h={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},l={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},u=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],d={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},f=BigInt("2100000000000000000"),p=BigInt(1e11),g={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},y={};for(let t=0,e=Object.keys(g);t<e.length;t++){const n=e[t],r=g[e[t]].toString();y[r]=n}const w={1:t=>i.encode(r.fromWordsUnsafe(t)),16:t=>i.encode(r.fromWordsUnsafe(t)),13:t=>s.encode(r.fromWordsUnsafe(t)),19:t=>i.encode(r.fromWordsUnsafe(t)),23:t=>i.encode(r.fromWordsUnsafe(t)),27:t=>i.encode(r.fromWordsUnsafe(t)),6:m,24:m,3:function(t){const e=[];let n,s,o,a,c,h=r.fromWordsUnsafe(t);for(;h.length>0;)n=i.encode(h.slice(0,33)),s=i.encode(h.slice(33,41)),o=parseInt(i.encode(h.slice(41,45)),16),a=parseInt(i.encode(h.slice(45,49)),16),c=parseInt(i.encode(h.slice(49,51)),16),h=h.slice(51),e.push({pubkey:n,short_channel_id:s,fee_base_msat:o,fee_proportional_millionths:a,cltv_expiry_delta:c});return e},5:function(t){const e=t.slice().reverse().map((t=>[!!(1&t),!!(2&t),!!(4&t),!!(8&t),!!(16&t)])).reduce(((t,e)=>t.concat(e)),[]);for(;e.length<2*u.length;)e.push(!1);const n={};u.forEach(((t,r)=>{let i;i=e[2*r]?"required":e[2*r+1]?"supported":"unsupported",n[t]=i}));const r=e.slice(2*u.length);return n.extra_bits={start_bit:2*u.length,bits:r,has_required:r.reduce(((t,e,n)=>n%2!=0?t||!1:t||e),!1)},n}};function b(t){return e=>({tagCode:parseInt(t),words:r.encode("unknown",e,Number.MAX_SAFE_INTEGER)})}function m(t){return t.reverse().reduce(((t,e,n)=>t+e*Math.pow(32,n)),0)}function v(t,e){let n,r;if(t.slice(-1).match(/^[munp]$/))n=t.slice(-1),r=t.slice(0,-1);else{if(t.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");r=t}if(!r.match(/^\d+$/))throw new Error("Not a valid human readable amount");const i=BigInt(r),s=n?i*p/d[n]:i*p;if("p"===n&&i%BigInt(10)!==BigInt(0)||s>f)throw new Error("Amount is outside of valid range");return e?s.toString():s}t.exports={decode:function(t,e){if("string"!=typeof t)throw new Error("Lightning Payment Request must be string");if("ln"!==t.slice(0,2).toLowerCase())throw new Error("Not a proper lightning payment request");const n=[],s=r.decode(t,Number.MAX_SAFE_INTEGER);t=t.toLowerCase();const u=s.prefix;let d=s.words,f=t.slice(u.length+1),p=d.slice(-104);d=d.slice(0,-104);let E=u.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(E&&!E[2]&&(E=u.match(/^ln(\S+)$/)),!E)throw new Error("Not a proper lightning payment request");n.push({name:"lightning_network",letters:"ln"});const k=E[1];let _;if(e){if(void 0===e.bech32||void 0===e.pubKeyHash||void 0===e.scriptHash||!Array.isArray(e.validWitnessVersions))throw new Error("Invalid network");_=e}else switch(k){case o.bech32:_=o;break;case a.bech32:_=a;break;case c.bech32:_=c;break;case h.bech32:_=h;break;case l.bech32:_=l}if(!_||_.bech32!==k)throw new Error("Unknown coin bech32 prefix");n.push({name:"coin_network",letters:k,value:_});const A=E[2];let x;A?(x=v(A+E[3],!0),n.push({name:"amount",letters:E[2]+E[3],value:x})):x=null,n.push({name:"separator",letters:"1"});const S=m(d.slice(0,7));let R,C,N,I;for(d=d.slice(7),n.push({name:"timestamp",letters:f.slice(0,7),value:S}),f=f.slice(7);d.length>0;){const t=d[0].toString();R=y[t]||"unknown_tag",C=w[t]||b(t),d=d.slice(1),N=m(d.slice(0,2)),d=d.slice(2),I=d.slice(0,N),d=d.slice(N),n.push({name:R,tag:f[0],letters:f.slice(0,3+N),value:C(I)}),f=f.slice(3+N)}n.push({name:"signature",letters:f.slice(0,104),value:i.encode(r.fromWordsUnsafe(p))}),f=f.slice(104),n.push({name:"checksum",letters:f});let B={paymentRequest:t,sections:n,get expiry(){let t=n.find((t=>"expiry"===t.name));if(t)return T("timestamp")+t.value},get route_hints(){return n.filter((t=>"route_hint"===t.name)).map((t=>t.value))}};for(let t in g)"route_hint"!==t&&Object.defineProperty(B,t,{get:()=>T(t)});return B;function T(t){let e=n.find((e=>e.name===t));return e?e.value:void 0}},hrpToMillisat:v}},6585:t=>{var e=1e3,n=60*e,r=60*n,i=24*r,s=7*i;function o(t,e,n,r){var i=e>=1.5*n;return Math.round(t/n)+" "+r+(i?"s":"")}t.exports=function(t,a){a=a||{};var c,h,l=typeof t;if("string"===l&&t.length>0)return function(t){if(!((t=String(t)).length>100)){var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(o){var a=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return a*s;case"days":case"day":case"d":return a*i;case"hours":case"hour":case"hrs":case"hr":case"h":return a*r;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(t);if("number"===l&&isFinite(t))return a.long?(c=t,(h=Math.abs(c))>=i?o(c,h,i,"day"):h>=r?o(c,h,r,"hour"):h>=n?o(c,h,n,"minute"):h>=e?o(c,h,e,"second"):c+" ms"):function(t){var s=Math.abs(t);return s>=i?Math.round(t/i)+"d":s>=r?Math.round(t/r)+"h":s>=n?Math.round(t/n)+"m":s>=e?Math.round(t/e)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},7970:t=>{class e{constructor(){return this._childPaths={},this._data=[],this}add(t,n){const r=(t||"").split(""),i=r.length-1;let s=this;for(let t=i;t>=0;t--){const n=r[i-t];s=s._childPaths[n]?s._childPaths[n]:s._childPaths[n]=new e}return s._data.push(n),s}getNode(t){const e=(t||"").split(""),n=e.length-1;let r=this;for(let t=n;t>=0;t--)if(r=r._childPaths[e[n-t]]||null,null===r)return null;return r}getData(t){const e=this.getNode(t);if(!e)return null;const n=[e],r=[];for(let t=0;t<n.length;t++){const e=n[t];e._data.length&&r.push.apply(r,e._data);const i=Object.values(e._childPaths);i.length&&n.push.apply(n,i)}return r}}t.exports=e},5030:function(t,e,n){"use strict";var r=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.EventEmitter=void 0;var i=n(9857),s=n(5372),o=n(4547);function a(t,e,n,r,i,s){var o=this.events[t];if(o){if(0===o.length)return!1;if(o.argsNum<6)o.call(e,n,r,i,s);else{for(var a=new Array(o.argsNum),c=0,h=a.length;c<h;++c)a[c]=arguments[c+1];o.call.apply(void 0,a)}return!0}return!1}function c(t,e,n,r,i,s){var o,a=this.events[t];if(void 0!==a){if(0===a.length)return!1;if(a.argsNum<6)a.call(e,n,r,i,s);else{for(var c=0,h=(o=new Array(a.argsNum)).length;c<h;++c)o[c]=arguments[c+1];a.call.apply(void 0,o)}}var l=this.onceEvents[t];if(l){if("function"==typeof l)if(this.onceEvents[t]=void 0,arguments.length<6)l(e,n,r,i,s);else{if(void 0===o)for(c=0,h=(o=new Array(arguments.length-1)).length;c<h;++c)o[c]=arguments[c+1];l.apply(void 0,o)}else{var u=l;if(this.onceEvents[t]=void 0,arguments.length<6)for(c=0;c<u.length;++c)u[c](e,n,r,i,s);else{if(void 0===o)for(c=0,h=(o=new Array(arguments.length-1)).length;c<h;++c)o[c]=arguments[c+1];for(c=0;c<u.length;++c)u[c].apply(void 0,o)}}return!0}return void 0!==a}var h=function(){function t(){this.events=(0,o.nullObj)(),this.onceEvents=(0,o.nullObj)(),this._symbolKeys=new Set,this.maxListeners=1/0}return Object.defineProperty(t.prototype,"_eventsCount",{get:function(){return this.eventNames().length},enumerable:!1,configurable:!0}),t}();function l(t,e,n){if(void 0===n&&(n=e.length),"function"!=typeof e)throw new TypeError("The listener must be a function");var r=this.events[t];return r?(r.push(e),r.growArgsNum(n),this.maxListeners!==1/0&&this.maxListeners<=r.length&&console.warn('Maximum event listeners for "'.concat(String(t),'" event!'))):(this.events[t]=new i.TaskCollection(n,!0,e,!1),"symbol"==typeof t&&this._symbolKeys.add(t)),this}function u(t,e){var n=this.events[t];n&&n.removeLast(e);var r=this.onceEvents[t];return r&&("function"==typeof r?this.onceEvents[t]=void 0:"object"==typeof r&&(1===r.length&&r[0]===e?this.onceEvents[t]=void 0:(0,s._fast_remove_single)(r,r.lastIndexOf(e)))),this}e.EventEmitter=h,h.prototype.emit=a,h.prototype.on=l,h.prototype.once=function(t,e){switch(this.emit===a&&(this.emit=c),typeof this.onceEvents[t]){case"undefined":this.onceEvents[t]=e,"symbol"==typeof t&&this._symbolKeys.add(t);break;case"function":this.onceEvents[t]=[this.onceEvents[t],e];break;case"object":this.onceEvents[t].push(e)}return this},h.prototype.addListener=l,h.prototype.removeListener=u,h.prototype.addListenerBound=function(t,e,n,r){void 0===n&&(n=this),void 0===r&&(r=e.length),this.boundFuncs||(this.boundFuncs=new Map);var i=e.bind(n);return this.boundFuncs.set(e,i),this.addListener(t,i,r)},h.prototype.removeListenerBound=function(t,e){var n,r,i=null===(n=this.boundFuncs)||void 0===n?void 0:n.get(e);return null===(r=this.boundFuncs)||void 0===r||r.delete(e),this.removeListener(t,i)},h.prototype.hasListeners=function(t){return this.events[t]&&!!this.events[t].length},h.prototype.prependListener=function(t,e,n){if(void 0===n&&(n=e.length),"function"!=typeof e)throw new TypeError("The listener must be a function");var r=this.events[t];return r&&r instanceof i.TaskCollection?(r.insert(0,e),r.growArgsNum(n),this.maxListeners!==1/0&&this.maxListeners<=r.length&&console.warn('Maximum event listeners for "'.concat(String(t),'" event!'))):(r=this.events[t]=new i.TaskCollection(n,!0,e,!1),"symbol"==typeof t&&this._symbolKeys.add(t)),this},h.prototype.prependOnceListener=function(t,e){this.emit===a&&(this.emit=c);var n=this.onceEvents[t];return n?"object"!=typeof n?(this.onceEvents[t]=[e,n],"symbol"==typeof t&&this._symbolKeys.add(t)):(n.unshift(e),this.maxListeners!==1/0&&this.maxListeners<=n.length&&console.warn('Maximum event listeners for "'.concat(String(t),'" once event!'))):(this.onceEvents[t]=[e],"symbol"==typeof t&&this._symbolKeys.add(t)),this},h.prototype.off=u,h.prototype.removeAllListeners=function(t){return void 0===t?(this.events=(0,o.nullObj)(),this.onceEvents=(0,o.nullObj)(),this._symbolKeys=new Set):(this.events[t]=void 0,this.onceEvents[t]=void 0,"symbol"==typeof t&&this._symbolKeys.delete(t)),this},h.prototype.setMaxListeners=function(t){return this.maxListeners=t,this},h.prototype.getMaxListeners=function(){return this.maxListeners},h.prototype.listeners=function(t){return this.emit===a?this.events[t]?this.events[t].tasksAsArray().slice():[]:this.events[t]&&this.onceEvents[t]?r(r([],this.events[t].tasksAsArray(),!0),"function"==typeof this.onceEvents[t]?[this.onceEvents[t]]:this.onceEvents[t],!0):this.events[t]?this.events[t].tasksAsArray():this.onceEvents[t]?"function"==typeof this.onceEvents[t]?[this.onceEvents[t]]:this.onceEvents[t]:[]},h.prototype.eventNames=function(){var t=this;if(this.emit===a){var e=Object.keys(this.events);return r(r([],e,!0),Array.from(this._symbolKeys),!0).filter((function(e){return e in t.events&&t.events[e]&&t.events[e].length}))}e=Object.keys(this.events).filter((function(e){return t.events[e]&&t.events[e].length}));var n=Object.keys(this.onceEvents).filter((function(e){return t.onceEvents[e]&&t.onceEvents[e].length}));return r(r(r([],e,!0),n,!0),Array.from(this._symbolKeys).filter((function(e){return e in t.events&&t.events[e]&&t.events[e].length||e in t.onceEvents&&t.onceEvents[e]&&t.onceEvents[e].length})),!0)},h.prototype.listenerCount=function(t){return this.emit===a?this.events[t]&&this.events[t].length||0:(this.events[t]&&this.events[t].length||0)+(this.onceEvents[t]&&this.onceEvents[t].length||0)}},706:function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),i=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),i(n(335),e),i(n(5030),e)},1665:(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bakeCollectionVariadic=exports.bakeCollectionAwait=exports.bakeCollection=exports.BAKED_EMPTY_FUNC=void 0,exports.BAKED_EMPTY_FUNC=function(){};var FORLOOP_FALLBACK=1500;function generateArgsDefCode(t){var e="";if(0===t)return e;for(var n=0;n<t-1;++n)e+="arg"+String(n)+", ";return e+"arg"+String(t-1)}function generateBodyPartsCode(t,e){for(var n="",r="",i=0;i<e;++i)n+="var f".concat(i," = collection[").concat(i,"];\n"),r+="f".concat(i,"(").concat(t,")\n");return{funcDefCode:n,funcCallCode:r}}function generateBodyPartsVariadicCode(t){for(var e="",n="",r=0;r<t;++r)e+="var f".concat(r," = collection[").concat(r,"];\n"),n+="f".concat(r,".apply(undefined, arguments)\n");return{funcDefCode:e,funcCallCode:n}}function bakeCollection(collection,fixedArgsNum){if(0===collection.length)return exports.BAKED_EMPTY_FUNC;if(1===collection.length)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode="(function(collection) {\n            ".concat(funcDefCode,"\n            collection = undefined;\n            return (function(").concat(argsDefCode,") {\n                ").concat(funcCallCode,"\n            });\n        })")}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);funcFactoryCode=collection.length%10==0?"(function(collection) {\n                return (function(".concat(argsDefCode,") {\n                    for (var i = 0; i < collection.length; i += 10) {\n                        collection[i](").concat(argsDefCode,");\n                        collection[i+1](").concat(argsDefCode,");\n                        collection[i+2](").concat(argsDefCode,");\n                        collection[i+3](").concat(argsDefCode,");\n                        collection[i+4](").concat(argsDefCode,");\n                        collection[i+5](").concat(argsDefCode,");\n                        collection[i+6](").concat(argsDefCode,");\n                        collection[i+7](").concat(argsDefCode,");\n                        collection[i+8](").concat(argsDefCode,");\n                        collection[i+9](").concat(argsDefCode,");\n                    }\n                });\n            })"):collection.length%4==0?"(function(collection) {\n                return (function(".concat(argsDefCode,") {\n                    for (var i = 0; i < collection.length; i += 4) {\n                        collection[i](").concat(argsDefCode,");\n                        collection[i+1](").concat(argsDefCode,");\n                        collection[i+2](").concat(argsDefCode,");\n                        collection[i+3](").concat(argsDefCode,");\n                    }\n                });\n            })"):collection.length%3==0?"(function(collection) {\n                return (function(".concat(argsDefCode,") {\n                    for (var i = 0; i < collection.length; i += 3) {\n                        collection[i](").concat(argsDefCode,");\n                        collection[i+1](").concat(argsDefCode,");\n                        collection[i+2](").concat(argsDefCode,");\n                    }\n                });\n            })"):"(function(collection) {\n                return (function(".concat(argsDefCode,") {\n                    for (var i = 0; i < collection.length; ++i) {\n                        collection[i](").concat(argsDefCode,");\n                    }\n                });\n            })")}var bakeCollection_1=void 0,fixedArgsNum_1=void 0,bakeCollectionVariadic_1=void 0,bakeCollectionAwait_1=void 0,funcFactory=eval(funcFactoryCode);return funcFactory(collection)}function bakeCollectionAwait(collection,fixedArgsNum){if(0===collection.length)return exports.BAKED_EMPTY_FUNC;if(1===collection.length)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode="(function(collection) {\n            ".concat(funcDefCode,"\n            collection = undefined;\n            return (function(").concat(argsDefCode,") {\n                return Promise.all([ ").concat(funcCallCode," ]);\n            });\n        })")}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);funcFactoryCode="(function(collection) {\n            return (function(".concat(argsDefCode,") {\n                var promises = Array(collection.length);\n                for (var i = 0; i < collection.length; ++i) {\n                    promises[i] = collection[i](").concat(argsDefCode,");\n                }\n                return Promise.all(promises);\n            });\n        })")}var bakeCollection_2=void 0,fixedArgsNum_2=void 0,bakeCollectionVariadic_2=void 0,bakeCollectionAwait_2=void 0,funcFactory=eval(funcFactoryCode);return funcFactory(collection)}function bakeCollectionVariadic(collection){if(0===collection.length)return exports.BAKED_EMPTY_FUNC;if(1===collection.length)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var _a=generateBodyPartsVariadicCode(collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode="(function(collection) {\n            ".concat(funcDefCode,"\n            collection = undefined;\n            return (function() {\n                ").concat(funcCallCode,"\n            });\n        })")}else funcFactoryCode="(function(collection) {\n            return (function() {\n                for (var i = 0; i < collection.length; ++i) {\n                    collection[i].apply(undefined, arguments);\n                }\n            });\n        })";var bakeCollection_3=void 0,fixedArgsNum=void 0,bakeCollectionVariadic_3=void 0,bakeCollectionAwait_3=void 0,funcFactory=eval(funcFactoryCode);return funcFactory(collection)}exports.bakeCollection=bakeCollection,exports.bakeCollectionAwait=bakeCollectionAwait,exports.bakeCollectionVariadic=bakeCollectionVariadic},9857:function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),i=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),i(n(9369),e)},9369:function(t,e,n){"use strict";var r=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.TaskCollection=void 0;var i=n(5372),s=n(1665);function o(t,e){var n,r=this.length;if(r>1)e?((n=this._tasks).push.apply(n,arguments),this.length+=arguments.length):(this._tasks.push(t),this.length++);else if(e){var i;1===r?((i=Array(1+arguments.length)).push(i),i.push.apply(i,arguments),this._tasks=i):((i=Array(arguments.length)).push.apply(i,arguments),this._tasks=i),this.length+=arguments.length}else this._tasks=1===r?[this._tasks,t]:t,this.length++}function a(t,e){var n,r=this.length;if(r>1)e?((n=this._tasks).push.apply(n,arguments),this.length+=arguments.length):(this._tasks.push(t),this.length++);else if(e){var i;1===r?((i=Array(1+arguments.length)).push(i),i.push.apply(i,arguments),this._tasks=i):((i=Array(arguments.length)).push.apply(i,arguments),this._tasks=i),this.length+=arguments.length}else this._tasks=1===r?[this._tasks,t]:t,this.length++;this.firstEmitBuildStrategy?this.call=p:this.rebuild()}function c(t){0!==this.length&&(1===this.length?this._tasks===t&&(this.length=0):((0,i._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(t)),1===this._tasks.length?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length))}function h(t){if(0!==this.length){if(1===this.length)return this._tasks===t&&(this.length=0),this.firstEmitBuildStrategy?void(this.call=s.BAKED_EMPTY_FUNC):void this.rebuild();(0,i._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(t)),1===this._tasks.length?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length,this.firstEmitBuildStrategy?this.call=p:this.rebuild()}}function l(t){for(var e,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];0===this.length?(this._tasks=n,this.length=1):1===this.length?(n.unshift(this._tasks),this._tasks=n,this.length=this._tasks.length):((e=this._tasks).splice.apply(e,r([t,0],n,!1)),this.length=this._tasks.length)}function u(t){for(var e,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];0===this.length?(this._tasks=n,this.length=1):1===this.length?(n.unshift(this._tasks),this._tasks=n,this.length=this._tasks.length):((e=this._tasks).splice.apply(e,r([t,0],n,!1)),this.length=this._tasks.length),this.firstEmitBuildStrategy?this.call=p:this.rebuild()}function d(){0===this.length?this.call=s.BAKED_EMPTY_FUNC:1===this.length?this.call=this._tasks:this.call=(0,s.bakeCollection)(this._tasks,this.argsNum)}function f(){0===this.length?this.call=s.BAKED_EMPTY_FUNC:1===this.length?this.call=this._tasks:this.call=(0,s.bakeCollectionAwait)(this._tasks,this.argsNum)}function p(){this.rebuild(),this.call.apply(void 0,arguments)}var g=function(t,e,n,r){void 0===e&&(e=!0),void 0===n&&(n=null),void 0===r&&(r=!1),this.awaitTasks=r,this.call=s.BAKED_EMPTY_FUNC,this.argsNum=t,this.firstEmitBuildStrategy=!0,this.rebuild=r?f.bind(this):d.bind(this),this.setAutoRebuild(e),n?"function"==typeof n?(this._tasks=n,this.length=1):(this._tasks=n,this.length=n.length):(this._tasks=null,this.length=0),e&&this.rebuild()};e.TaskCollection=g,g.prototype.fastClear=function(){this._tasks=null,this.length=0,this.call=s.BAKED_EMPTY_FUNC},g.prototype.clear=function(){this._tasks=null,this.length=0,this.call=s.BAKED_EMPTY_FUNC},g.prototype.growArgsNum=function(t){this.argsNum<t&&(this.argsNum=t,this.firstEmitBuildStrategy?this.call=p:this.rebuild())},g.prototype.setAutoRebuild=function(t){t?(this.push=a.bind(this),this.insert=u.bind(this),this.removeLast=h.bind(this)):(this.push=o.bind(this),this.insert=l.bind(this),this.removeLast=c.bind(this))},g.prototype.tasksAsArray=function(){return 0===this.length?[]:1===this.length?[this._tasks]:this._tasks},g.prototype.setTasks=function(t){0===t.length?(this.length=0,this.call=s.BAKED_EMPTY_FUNC):1===t.length?(this.length=1,this.call=t[0],this._tasks=t[0]):(this.length=t.length,this._tasks=t,this.firstEmitBuildStrategy?this.call=p:this.rebuild())}},5372:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e._fast_remove_single=void 0,e._fast_remove_single=function(t,e){-1!==e&&(0===e?t.shift():e===t.length-1?t.length=t.length-1:t.splice(e,1))}},335:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0})},4547:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.nullObj=void 0,e.nullObj=function(){return{__proto__:null}}},6145:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LRUCache=void 0;const r=n(5397);class i{constructor(t){this.lookupTable=new Map,this.head=null,this.tail=null;const{maxSize:e=25,entryExpirationTimeInMS:n=null,onEntryEvicted:r,onEntryMarkedAsMostRecentlyUsed:i,cloneFn:s,clone:o}=null!=t?t:{};if(Number.isNaN(e)||e<=0)throw new Error("maxSize must be greater than 0.");if("number"==typeof n&&(n<=0||Number.isNaN(n)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.maxSizeInternal=e,this.entryExpirationTimeInMS=n,this.onEntryEvicted=r,this.onEntryMarkedAsMostRecentlyUsed=i,this.clone=o,this.cloneFn=s}get size(){return this.cleanCache(),this.lookupTable.size}get remainingSize(){return this.maxSizeInternal-this.size}get newest(){return this.head?this.head.isExpired?(this.removeNodeFromListAndLookupTable(this.head),this.newest):this.mapNodeToEntry(this.head):null}get oldest(){return this.tail?this.tail.isExpired?(this.removeNodeFromListAndLookupTable(this.tail),this.oldest):this.mapNodeToEntry(this.tail):null}get maxSize(){return this.maxSizeInternal}set maxSize(t){if(Number.isNaN(t)||t<=0)throw new Error("maxSize must be greater than 0.");this.maxSizeInternal=t,this.enforceSizeLimit()}set(t,e,n){const i=this.lookupTable.get(t);i&&this.removeNodeFromListAndLookupTable(i);const s=new r.LRUCacheNode(t,e,{entryExpirationTimeInMS:this.entryExpirationTimeInMS,onEntryEvicted:this.onEntryEvicted,onEntryMarkedAsMostRecentlyUsed:this.onEntryMarkedAsMostRecentlyUsed,clone:this.clone,cloneFn:this.cloneFn,...n});return this.setNodeAsHead(s),this.lookupTable.set(t,s),this.enforceSizeLimit(),this}get(t){const e=this.lookupTable.get(t);return e?e.isExpired?(this.removeNodeFromListAndLookupTable(e),null):(this.setNodeAsHead(e),e.value):null}peek(t){const e=this.lookupTable.get(t);return e?e.isExpired?(this.removeNodeFromListAndLookupTable(e),null):e.value:null}delete(t){const e=this.lookupTable.get(t);return!!e&&this.removeNodeFromListAndLookupTable(e)}has(t){const e=this.lookupTable.get(t);return!(!e||e.isExpired&&(this.removeNodeFromListAndLookupTable(e),1))}clear(){this.head=null,this.tail=null,this.lookupTable.clear()}find(t){let e=this.head;for(;e;){if(e.isExpired){const t=e.next;this.removeNodeFromListAndLookupTable(e),e=t;continue}const n=this.mapNodeToEntry(e);if(t(n))return this.setNodeAsHead(e),n;e=e.next}return null}forEach(t){let e=this.head,n=0;for(;e;)if(e.isExpired){const t=e.next;this.removeNodeFromListAndLookupTable(e),e=t}else t(e.value,e.key,n),e=e.next,n++}*values(){let t=this.head;for(;t;)if(t.isExpired){const e=t.next;this.removeNodeFromListAndLookupTable(t),t=e}else yield t.value,t=t.next}*keys(){let t=this.head;for(;t;)if(t.isExpired){const e=t.next;this.removeNodeFromListAndLookupTable(t),t=e}else yield t.key,t=t.next}*entries(){let t=this.head;for(;t;)if(t.isExpired){const e=t.next;this.removeNodeFromListAndLookupTable(t),t=e}else yield this.mapNodeToEntry(t),t=t.next}*[Symbol.iterator](){let t=this.head;for(;t;)if(t.isExpired){const e=t.next;this.removeNodeFromListAndLookupTable(t),t=e}else yield this.mapNodeToEntry(t),t=t.next}enforceSizeLimit(){let t=this.tail;for(;null!==t&&this.size>this.maxSizeInternal;){const e=t.prev;this.removeNodeFromListAndLookupTable(t),t=e}}mapNodeToEntry({key:t,value:e}){return{key:t,value:e}}setNodeAsHead(t){this.removeNodeFromList(t),this.head?(t.next=this.head,this.head.prev=t,this.head=t):(this.head=t,this.tail=t),t.invokeOnEntryMarkedAsMostRecentlyUsed()}removeNodeFromList(t){null!==t.prev&&(t.prev.next=t.next),null!==t.next&&(t.next.prev=t.prev),this.head===t&&(this.head=t.next),this.tail===t&&(this.tail=t.prev),t.next=null,t.prev=null}removeNodeFromListAndLookupTable(t){return t.invokeOnEvicted(),this.removeNodeFromList(t),this.lookupTable.delete(t.key)}cleanCache(){if(!this.entryExpirationTimeInMS)return;const t=[];for(const e of this.lookupTable.values())e.isExpired&&t.push(e);t.forEach((t=>this.removeNodeFromListAndLookupTable(t)))}}e.LRUCache=i},5397:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LRUCacheNode=void 0,e.LRUCacheNode=class{constructor(t,e,n){const{entryExpirationTimeInMS:r=null,next:i=null,prev:s=null,onEntryEvicted:o,onEntryMarkedAsMostRecentlyUsed:a,clone:c,cloneFn:h}=null!=n?n:{};if("number"==typeof r&&(r<=0||Number.isNaN(r)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.clone=null!=c&&c,this.cloneFn=null!=h?h:this.defaultClone,this.key=t,this.internalValue=this.clone?this.cloneFn(e):e,this.created=Date.now(),this.entryExpirationTimeInMS=r,this.next=i,this.prev=s,this.onEntryEvicted=o,this.onEntryMarkedAsMostRecentlyUsed=a}get value(){return this.clone?this.cloneFn(this.internalValue):this.internalValue}get isExpired(){return"number"==typeof this.entryExpirationTimeInMS&&Date.now()-this.created>this.entryExpirationTimeInMS}invokeOnEvicted(){if(this.onEntryEvicted){const{key:t,value:e,isExpired:n}=this;this.onEntryEvicted({key:t,value:e,isExpired:n})}}invokeOnEntryMarkedAsMostRecentlyUsed(){if(this.onEntryMarkedAsMostRecentlyUsed){const{key:t,value:e}=this;this.onEntryMarkedAsMostRecentlyUsed({key:t,value:e})}}defaultClone(t){return"boolean"==typeof t||"string"==typeof t||"number"==typeof t?t:JSON.parse(JSON.stringify(t))}}},6654:function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),i=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),i(n(6145),e)},3437:(t,e,n)=>{"use strict";n.r(e),n.d(e,{Blossom:()=>o}),n(2161);var r=n(4504),i=n(2258);const s=n(1396);class o{static SERVER_HINT_EVENT_KIND=10063;static AUTH_EVENT_KIND=24242;userServers=new Set;hexpubkey=null;static instance=new o;constructor(){if(o.instance)throw new Error("Use singleton instance")}async getServerStatus(t){let e;try{e=await fetch(new URL("/list/ping",t).toString())}catch{return!1}return!!e.ok}async fetchFile(t,e){const n=await this.urlsForFile(t,e);for(const e of n){let n;try{n=await fetch(e)}catch{continue}if(!n.ok)continue;const r=await n.blob(),i=await new Response(r).arrayBuffer(),o=s.lib.WordArray.create(i),a=s.SHA256(o).toString(s.enc.Hex);if(a===t)return URL.createObjectURL(r);console.warn(`File received from ${e} has a mismatched hash. Discarding.`,{expected:t,received:a})}throw new Error(`[404] blossom://${t} was not found on any known servers`)}async uploadFile(t,e){const n=await new Response(t).arrayBuffer(),r=s.lib.WordArray.create(n),i=s.SHA256(r).toString(s.enc.Hex),o=t.size,a=await this._nostrUploadAuth(o,i),c=new Headers;c.append("Authorization",a);const h={method:"PUT",headers:c,body:t},l=await this.uploadUrls(e),u=(await Promise.allSettled(l.map((t=>new Promise(((e,n)=>{fetch(t,h).then((async t=>{const r=await t.json();r.sha256===i?e(r.url):n("return hash did not match expected. Discarding")})).catch((t=>n(t)))})))))).filter((t=>"fulfilled"===t.status)).map((t=>t.value));return 0===u.length&&Promise.reject("failed to upload file to any blossom servers"),Promise.resolve({hash:i,downloadUrls:u})}async _nostrUploadAuth(t,e){const n=Math.floor(Date.now()/1e3)+300,i=new r.QB(window.ndk);return i.kind=o.AUTH_EVENT_KIND,i.content="File Upload",i.tags=[["t","upload"],["x",e],["size",t],["expiration",n]],await i.sign(),`Nostr ${btoa(JSON.stringify(i.rawEvent()))}`}async urlsForFile(t,e){return(await this.serverList(e)).map((e=>{try{return new URL(t,e).href}catch{return null}})).filter((t=>!!t))}async uploadUrls(t){return(await this.serverList(t)).map((t=>{try{return new URL("/upload",t).href}catch{return null}})).filter((t=>!!t))}async serverList(t){return i.W.forBlossom(t).getRelayUrls()}}window.Blossom=o},4080:(t,e,n)=>{"use strict";n.r(e);var r=n(6727),i=n(58),s=n(2161);async function o(){c(PageContext.instance.noteIdentifierFromUrl())}async function a(t){const e=window.router.urlFor(Router.BROWSER,t),n={identifier:t};history.pushState(n,"",e),await window.router.route(),c(t)}async function c(t){await(0,r.wN)();const e=(0,r.QL)(t);$("#note-content").html("<h2>🌱 loading...</h2>"),s.W.instance.fetchEvent(e).then((async t=>{if(t){if(t.tags.find((t=>"private"===t[0]))&&t.pubkey!==window.nostrUser?.hexpubkey)return void PageContext.instance.setNote(i.Note.fromContent("private","403","### ❌ This note is private and cannot be decrypted."));await PageContext.instance.setNoteByNostrEvent(t);const e=t.tags.filter((t=>"a"===t[0])).map((t=>t[1])),n={authors:[t.pubkey],kinds:i.Note.ALL_KINDS,"#d":e.map((t=>t.split(":")[2]))};s.W.instance.fetchEvents(n)}else{const t=PageContext.instance.noteTitleFromUrl();PageContext.instance.noteIdentifierFromUrl()?t?PageContext.instance.setNote(i.Note.fromContent("topic",t,`# ${t}\n\n⚠️ This note is a stub and does not exist yet.`)):PageContext.instance.setNote(i.Note.fromContent("topic","404","# Note Not Found!\n\nEither this version of the note no longer exists or it's on a different nostr relay.")):PageContext.instance.setNote(i.Note.fromContent("topic","homepage",`# ${window.location.hostname}\n\nTo create a homepage for your digital garden, create a note with the title \`homepage\`.`))}}))}window.browseNoteFromUrl=o,window.navigateToNote=a,window.browseNote=c,window.openNoteInEditor=function(){PageContext.instance.noteIdentifierFromUrl()?window.location.href=window.router.urlFor(Router.EDITOR,`${PageContext.instance.noteIdentifierFromUrl()}`):window.location.href=window.router.urlFor(Router.EDITOR)},window.renderDynamicContent=function(){window.router.pageName===Router.BROWSER&&($("a[href='#tagayasu-prefetch']").off("click.navigate"),$("a[href='#tagayasu-prefetch']").on("click.navigate",(t=>(a(t.target.title),!1))),$("[title^='blossom://']").each((async(t,e)=>{let n=e.title.match(/blossom:\/\/(.*)/);if(!n)return;const r=n[1];e.title="loading";const i=await Blossom.instance.fetchFile(r,PageContext.instance.note.authorPubkey);e.src=i})))},window.addEventListener("popstate",(async t=>{await window.router.route(),o()}))},6727:(t,e,n)=>{"use strict";n.d(e,{E1:()=>x,GY:()=>_,Hp:()=>l,PS:()=>k,QL:()=>S,cb:()=>c,ck:()=>d,eC:()=>b,f:()=>m,mz:()=>v,nZ:()=>E,sB:()=>A,wN:()=>f});var r=n(4504),i=n(5778),s=n(8150),o=n(58);window.buffer=n(8287).hp;const a=n(1396);async function c(t){return new Promise((e=>{setTimeout(e,t)}))}function h(t,e=64){return a.SHA256(t).toString(a.enc.Hex).slice(0,e)}async function l(){return window.nip07signer?(await async function(){for(const t of window.ndk.pool.relays.values())t.disconnect();await c(100),window.ndk=null,window.nip07signer=null,window.nostrUser=null,delete window.sessionStorage.privateKey,delete window.sessionStorage.lastKeyProvider,window.MDEditor.value(""),localStorage.removeItem("autosave"),location.reload()}(),f().then((()=>{window.dispatchEvent(new Event(Wallet.WALLET_DISCONNECTED_EVENT))}))):d()}async function u(){return window.nip07signer&&p()?Promise.resolve("already connected"):"nip07"==window.sessionStorage.lastKeyProvider&&window.nostr?y():"private-key"==window.sessionStorage.lastKeyProvider&&window.sessionStorage.privateKey?w(window.sessionStorage.privateKey):Promise.reject("no seamless connection possible")}async function d(){return u().catch((()=>window.nostr?y():window.ethereum?async function(){const t=(await window.ethereum.request({method:"eth_requestAccounts"}).catch((t=>{4001===t.code?(0,s.Qg)("User rejected the connection request"):(0,s.Qg)(t.message)})))[0],e=`0x${window.buffer.from("Sign this message to approve the current website *unlimited* access to your Tagayasu account.\n\nPlease be very careful to make sure you are on the correct website (tagayasu.xyz) to prevent phising attacks!","utf8").toString("hex")}`;return await ethereum.request({method:"personal_sign",params:[e,t]}).then((t=>w(h(t)))).catch((t=>{4001===t.code?(0,s.Qg)("User rejected the signature request"):(0,s.Qg)(t.message)}))}():new Promise(((t,e)=>{const n=new bootstrap.Modal("#keyEntryModal",{});n.show(),n._element.addEventListener("hidden.bs.modal",(function t(){n._element.removeEventListener("hidden.bs.modal",t),e("no suitable key store found")}));const r=document.getElementById("connectWithPassPhraseButton");r.addEventListener("click",(function e(){r.removeEventListener("click",e),n.hide(),w(h($("#pass-phrase").val())).then(t("user logged in with passphrase"))}))}))))}async function f(){return p()||(window.ndk=new r.Ay({explicitRelayUrls:window.relays.active}),window.ndk.connect()),Promise.resolve("connected")}function p(){if(!window.ndk)return!1;const t=window.ndk.pool.stats();return t.connected/t.total>=.5}async function g(t){return window.nip07signer=t,window.ndk=new r.Ay({signer:window.nip07signer,explicitRelayUrls:window.relays.active}),await t.user().then((async t=>{t.npub&&(window.nostrUser=t,window.ndk.connect(),window.dispatchEvent(new Event(Wallet.WALLET_CONNECTED_EVENT)))}))}async function y(){return window.sessionStorage.lastKeyProvider="nip07",g(new r.uk)}async function w(t){return window.sessionStorage.privateKey=t,window.sessionStorage.lastKeyProvider="private-key",g(new r.YX(window.sessionStorage.privateKey))}function b(t){return t.toLowerCase().replace(/\W/g,"-")}function m(t){return h(b(t))}function v(t,e,n){return PageContext.instance.dnslinkHexpubkey()===n?b(e):E(t,e,n)}function E(t,e,n){const i=new r.QB(window.ndk);return i.kind=t,i.pubkey=n,i.tags=[["d",b(e)]],i.encode()}function k(t,e,n){return`${t}:${n}:${b(e)}`}async function _(t){return window.nostr?.nip44?window.nostr.nip44.encrypt(window.nostrUser.hexpubkey,t):window.nostr?.nip04?window.nostr.nip04.encrypt(window.nostrUser.hexpubkey,t):window.sessionStorage.privateKey?Promise.resolve(a.AES.encrypt(t,window.sessionStorage.privateKey).toString()):Promise.reject("Did not find any encryption compatible wallet")}async function A(t){return window.nostr?.nip44?window.nostr.nip44.decrypt(window.nostrUser.hexpubkey,t):window.nostr?.nip04?window.nostr.nip04.decrypt(window.nostrUser.hexpubkey,t):window.sessionStorage.privateKey?Promise.resolve(a.AES.decrypt(t,window.sessionStorage.privateKey).toString(a.enc.Utf8)):Promise.reject("Did not find any encryption compatible wallet")}function x(t){const e=i.Qe.decode(t);if("npub"!==e.type)throw new Error("Invalid npub");return e.data}function S(t){const e=PageContext.instance.dnslinkHexpubkey();if(!t&&!e)return null;if(!t)return{authors:[e],kinds:o.Note.ALL_KINDS,"#d":[b("homepage")]};const n=function(t){let e;if(t.match(R)){const[e,n,r]=t.split(":"),i={authors:[n],kinds:[parseInt(e)]};return r&&(i["#d"]=[r]),i}try{switch(e=i.Qe.decode(t),e.type){case"nevent":return{ids:[e.data.id]};case"note":return{ids:[e.data]};case"naddr":return{authors:[e.data.pubkey],"#d":[e.data.identifier],kinds:[e.data.kind]}}}catch(t){}return{ids:[t]}}(t);if(n.kinds&&!o.Note.ALL_KINDS.includes(n.kinds[0])||(n.kinds=o.Note.ALL_KINDS),n["#d"])return n;if(!e)return null;const r=n.ids[0].replace(/-/g," ");return{authors:[e],kinds:o.Note.ALL_KINDS,"#d":[b(r),m(r)]}}window.relays={default:["wss://relay.tagayasu.xyz/","wss://relay.damus.io/","wss://nos.lol/","wss://nostr.mom/","wss://nostr.oxtr.dev/","wss://relay.nostr.band/","wss://offchain.pub/","wss://purplerelay.com/","wss://nostr.bitcoiner.social/","wss://thecitadel.nostr1.com/","wss://nostr.wine/"],active:[],recommended:["wss://relay.tagayasu.xyz/","wss://relay.damus.io/","wss://thecitadel.nostr1.com/","wss://nos.lol/","wss://nostr.wine/"]},window.relays.active=window.relays.default,window.trySeamlessConnection=u;const R=/^(\d+):([0-9A-Fa-f]+)(?::(.*))?$/},5228:()=>{class t{_baseUrl="https://1.1.1.1/dns-query?type=TXT&name=";_headers={accept:"application/dns-json"};static instance=new t;constructor(){if(t.instance)throw new Error("Use singleton instance")}async txt(t){return fetch(this._baseUrl+t,{headers:this._headers}).then((t=>t.json())).then((t=>t.Answer?t.Answer[0].data.replace(/[^a-zA-Z0-9]/g,""):"")).catch((t=>(console.error("Error:",t),null)))}_npubs={};async npub(t){if(this._npubs[t])return this._npubs[t];const e=await this.txt(`npub.${t}`);return this._npubs[t]=e,this._npubs[t]}}window.DnsClient=t},8150:(t,e,n)=>{"use strict";n.d(e,{An:()=>a,Qg:()=>o,Xg:()=>c,Zt:()=>i,qR:()=>r,rS:()=>s});const r="error-event",i="notice-event",s="pending-event";function o(t){console.error(t),window.dispatchEvent(new CustomEvent(r,{detail:{message:t}}))}function a(t){console.log(t),window.dispatchEvent(new CustomEvent(i,{detail:{message:t}}))}function c(t){console.log(t),window.dispatchEvent(new CustomEvent(s,{detail:{message:t}}))}},1372:(t,e,n)=>{"use strict";n.r(e);var r=n(58),i=n(6727);class s{static instance=new s;constructor(){if(s.instance)throw new Error("Use singleton instance")}renderHtml(t){return self.MarkdownRenderer.instance.parse(t).html}parse(t){const e={link(t){const e=t.match(/^\[\[([^\]\n]+)\]\]/);if(e){this.lexer.state.inLink=!0;const t=(0,i.mz)(r.Note.SOME_KIND,e[1],PageContext.instance.note.authorPubkey),n={type:"link",raw:e[0],href:"#tagayasu-prefetch",title:t,text:e[1],tokens:this.lexer.inlineTokens(e[1])};return this.lexer.state.inLink=!1,window._backrefs.push((0,i.PS)(r.Note.ARTICLE_KIND,e[1],PageContext.instance.note.authorPubkey)),window._backrefs.push((0,i.PS)(r.Note.TOPIC_KIND,e[1],PageContext.instance.note.authorPubkey)),n}return!1}};return window._backrefs=[],marked.use({tokenizer:e}),marked.use(markedKatex({throwOnError:!0})),{html:DOMPurify.sanitize(marked.parse(t)),backrefs:window._backrefs}}}window.MarkdownRenderer=s},7226:(t,e,n)=>{"use strict";function r(){setInterval(i,100),i()}function i(){!function(){let t=`relays connected: ${window.ndk?.pool?.stats()?.connected??0}/${window.ndk?.pool?.stats()?.total??window.relays.default.length}`;$(".autosave").css("float","left"),$(".autosave").html(t)}()}n.r(e),n.d(e,{startNostrMonitoring:()=>r})},58:(t,e,n)=>{"use strict";n.r(e),n.d(e,{Note:()=>a,NoteValidationError:()=>o});var r=n(6727),i=n(2161);function s(){return Math.floor(Date.now()/1e3)}class o extends Error{constructor(t){super(t),this.name="NoteValidationError"}}class a{static TOPIC="topic";static ARTICLE="article";static PRIVATE="private";static DRAFT_KIND=31234;static ARTICLE_KIND=30023;static TOPIC_KIND=30818;static ALL_KINDS=[a.DRAFT_KIND,a.ARTICLE_KIND,a.TOPIC_KIND];static SOME_KIND=a.ARTICLE_KIND;static async fromNostrEvent(t){const e=t.kind===a.DRAFT_KIND?JSON.parse(await(0,r.sB)(t.content)):t.rawEvent(),n=new a;n.id=e.id,n.altIds=[e.id],n.nostrEvent=e,n.title=e.tags.find((t=>"title"==t[0]))[1],n.content=e.content,n.authorPubkey=e.pubkey,n.createdAt=e.created_at??t.created_at,n.ndkEvent=t;const i=!!e.tags.find((t=>"private"==t[0]))?.[1];return n.draft=t.kind===a.DRAFT_KIND,n.private=t.kind===a.DRAFT_KIND&&i,n.kind=e.kind,n.validate(),n}static fromContent(t,e,n,r){const i=new a;return i.altIds=[],i.authorPubkey=r,i.createdAt=s(),i.title=e,i.content=n,i.draft=!1,i.private=!1,t===a.ARTICLE?i.kind=a.ARTICLE_KIND:t===a.TOPIC?i.kind=a.TOPIC_KIND:t===a.PRIVATE&&(i.kind=a.ARTICLE_KIND,i.private=!0,i.draft=!0),i.validate(),i}get onRelays(){return[...new Set(this.ndkEvent?.onRelays??[])]}get type(){return this.validate(),this.kind===a.TOPIC_KIND?a.TOPIC:this.private?a.PRIVATE:a.ARTICLE}validate(){if(!this.title||""===this.title)throw new o("Must have a title");if(![a.TOPIC_KIND,a.ARTICLE_KIND].includes(this.kind))throw new o("Note must be one of TOPIC or ARTICLE");if(this.kind===a.TOPIC_KIND&&this.private)throw new o("Note may not be TOPIC and PRIVATE");if(this.private&&!this.draft)throw new o("Private notes may only be drafts")}update(t){this.title=t.title??this.title,this.private=t.private??this.private,this.draft=t.draft??this.draft,this.kind=t.kind??this.kind,this.content=t.content??this.content,this.createdAt=s(),this.validate()}get handle(){return(0,r.mz)(this.kind,this.title,this.authorPubkey)}get databaseId(){return`${this.type}:${this.dtag}`}get dtag(){return(0,r.eC)(this.title)}get draftDtag(){return(0,r.f)(this.title)}toPlain(){return{id:this.id,private:this.private,draft:this.draft,kind:this.kind,title:this.title,content:this.content,pubkey:this.authorPubkey,createdAt:this.createdAt}}static async fromPlain(t){const e=new a;return e.id=t.id,e.private=t.private,e.draft=t.draft,e.kind=t.kind,e.authorPubkey=t.pubkey,e.content=t.content,e.title=t.title,e.createdAt=t.createdAt,e.altIds=[],e.validate(),e}async toNostrEvent(t=[]){this.validate();const e=[["d",this.dtag],["title",this.title],["published_at",this.createdAt.toString()],...this.private?[["private","true"]]:[],...t],n=i.W.instance.buildEvent(this.kind,this.content,e,this.authorPubkey);if(this.private||this.draft){const t=await(0,r.GY)(JSON.stringify(n.rawEvent())),e=[["d",this.draftDtag],["k",this.kind.toString()]];return i.W.instance.buildEvent(a.DRAFT_KIND,t,e,this.authorPubkey)}return n}}},9446:(t,e,n)=>{"use strict";n.r(e);var r=n(6727),i=n(58);class s{static NOTE_IN_FOCUS_CHANGED="note-in-focus-changed";static NADDR_PARAM_NAME="n";static instance=new s;constructor(){if(s.instance)throw new Error("Use singleton instance")}get note(){return this._note}setNote(t){this._note=t,window.dispatchEvent(new Event(s.NOTE_IN_FOCUS_CHANGED))}async setNoteByNostrEvent(t){this.setNote(await i.Note.fromNostrEvent(t))}_dnslinkNpub=null;dnslinkNpub(){if(null!==this._dnslinkNpub)return this._dnslinkNpub;const t=window.router.dnslinkNpub;return null!==t&&t.startsWith("npub")?this._dnslinkNpub=t:this._dnslinkNpub="",this._dnslinkNpub}dnslinkHexpubkey(){const t=this.dnslinkNpub();return t&&(0,r.E1)(t)}noteFilterFromUrl(){return(0,r.QL)(this.noteIdentifierFromUrl())}noteIdentifierFromUrl(){return this._urlParam(s.NADDR_PARAM_NAME)}noteTitleFromUrl(){return this._urlParam("title")}_urlParam(t){if(window.router.inlineParams[t])return window.router.inlineParams[t];var e=new RegExp("[?&]"+t+"=([^&#]*)").exec(window.location.href);return null==e?null:decodeURI(e[1])||0}}window.PageContext=s},4042:(t,e,n)=>{"use strict";n.r(e);var r=n(6727),i=n(8150),s=n(2161);class o{static PREFERENCES_CHANGED_EVENT="preferences-changed";static D_TAG="tagayasu/preferences";static KIND=30078;static DEFAULTS={spellCheckEnabled:!1,aggressiveDelete:!1};current=o.DEFAULTS;static instance=new o;constructor(){if(o.instance)throw new Error("Use singleton instance")}async set(t){this.current=Object.assign(this.current,t),window.dispatchEvent(new Event(o.PREFERENCES_CHANGED_EVENT)),await this.saveToNostr()}async setFromNostr(){const t={authors:[window.nostrUser.hexpubkey],kinds:[o.KIND],"#d":[o.D_TAG]};s.W.instance.fetchEvent(t).then((async t=>{if(t){const e=JSON.parse(await(0,r.sB)(t.content));this.current=Object.assign({...o.DEFAULTS},e)}window.dispatchEvent(new Event(o.PREFERENCES_CHANGED_EVENT))}))}async saveToNostr(){await(0,r.ck)().then((async()=>{const t=[["d",o.D_TAG],["published_at",Math.floor(Date.now()/1e3).toString()]],e=await(0,r.GY)(JSON.stringify(this.current));s.W.instance.buildAndPublish(o.KIND,e,t).then((t=>{(0,i.An)("Your preferences have been saved.")}))}))}}window.Preferences=o,window.addEventListener(Wallet.WALLET_CONNECTED_EVENT,(async function(t){o.instance.setFromNostr()}))},2161:(t,e,n)=>{"use strict";n.d(e,{W:()=>s});var r=n(4504),i=n(6727);class s{static INDEXED_TAGS=["a"];static DELETE_EVENT_KIND=5;primaryIndex={};tagIndex={};static instance=new s;constructor(){if(s.instance)throw new Error("Use singletone instance")}async fetchEvent(t){return new Promise(((e,n)=>{const r=this.readByFilter(t);r.size>0?e(this.latest(r)):window.ndk.fetchEvent(t).then((t=>{this.write(t),e(t)}))}))}async fetchEvents(t){return new Promise(((e,n)=>{const r=this.readByFilter(t);r.size>0?e(r):window.ndk.fetchEvents(t).then((t=>{t.forEach((t=>this.write(t))),e(t)}))}))}async subscribe(t,e,n=!0){const r=await window.ndk.subscribe(t,{closeOnEose:n});return r.on("event",(async t=>{this.write(t),e(t)})),[...this.readByFilter(t)].forEach((t=>e(t))),r}async buildAndPublish(t,e,n,r){const i=this.buildEvent(t,e,n,r);return await this.publish(i)}async publish(t){return t.kind!==s.DELETE_EVENT_KIND&&this.write(t),t.publish().then((e=>t))}buildEvent(t,e,n,i){if(i&&i!==window.ndk.activeUser?.hexpubkey)throw new Error("NDK is configured with an unexpected pubkey");const s=new r.QB(window.ndk);return s.kind=t,s.content=e,s.tags=n,s.pubkey=window.ndk.activeUser?.hexpubkey,s.id=s.getEventHash(),s}async del(t){Object.keys(this.primaryIndex).forEach((e=>{t.includes(this.primaryIndex[e].id)&&(delete this.primaryIndex[e],Object.keys(this.tagIndex).forEach((t=>{this.tagIndex[t].delete(e)})))}));const e=[];return t.forEach((t=>e.push(["e",t]))),this.buildAndPublish(s.DELETE_EVENT_KIND,"This note has been deleted",e)}write(t){if(!t)return;const e=this.primaryIndexKey(t.kind,t.pubkey,t.dTag);if(t.dTag){const n=this.primaryIndex[e];(!n||n.created_at<t.created_at)&&(this.primaryIndex[e]=t)}t.tags.filter((t=>s.INDEXED_TAGS.includes(t[0]))).forEach((([n,r])=>{const i=this.tagIndexKey(t.kind,t.pubkey,n,r);this.tagIndex[i]||(this.tagIndex[i]=new Set),this.tagIndex[i].has(e)||this.tagIndex[i].add(e)}))}async getRelayStatus(t,e=1e4){window.ndk.pool.addRelay(new r.vd(t,void 0,window.ndk),!1);const n=window.ndk.pool.relays.get(t);try{await n.connect(e,!1)}catch(t){}for(let t=0;t<e/10;t++)if(await(0,i.cb)(10),n.connectivity.status>=r.jI.CONNECTED)return!0;return!1}readByFilter(t){const e=["#d",...s.INDEXED_TAGS.map((t=>`#${t}`))].filter((e=>!!t[e]));if(!t.authors||!t.kinds||1!==e.length)return new Set;const n=e[0];if(t.authors.length>1)return new Set;const r=t.authors[0],i=n.slice(1),o=t[n],a=t.kinds;return o.flatMap((t=>a.map((e=>({tagValue:t,kind:e}))))).reduce(((t,{tagValue:e,kind:s})=>{const o="#d"===n?this.readPrimaryIndex(s,r,e):this.readTagIndex(s,r,i,e);for(const e of o)t.add(e);return t}),new Set)}readPrimaryIndex(t,e,n){const r=this.primaryIndex[this.primaryIndexKey(t,e,n)];return r?new Set([r]):new Set}readTagIndex(t,e,n,r){const i=this.tagIndex[this.tagIndexKey(t,e,n,r)];return i?new Set([...i].map((t=>this.primaryIndex[t]))):new Set}primaryIndexKey(t,e,n){return`${t}:${e}:${n}`}tagIndexKey(t,e,n,r){return`${t}:${e}:${n}/${r}`}latest(t){let e;for(const n of t)(!e||n.created_at>e.created_at)&&(e=n);return e}}window.Relay=s},2258:(t,e,n)=>{"use strict";n.d(e,{W:()=>r});class r{static RELAY_LIST_KIND=10002;static BLOSSOM_LIST_KIND=10063;static RELAY_TAG="r";static BLOSSOM_TAG="server";constructor(t,e,n){this.hexpubkey=t,this.kind=e,this.tag=n}static forRelays(t){return new r(t,r.RELAY_LIST_KIND,r.RELAY_TAG)}static forBlossom(t){return new r(t,r.BLOSSOM_LIST_KIND,r.BLOSSOM_TAG)}async getRelayList(){const t={authors:[this.hexpubkey],kinds:[this.kind]};return Relay.instance.fetchEvent(t).then((async t=>t?t.tags.filter((t=>t[0]===this.tag)).map((t=>({url:t[1],mode:t[2]??"both"}))):[]))}async getRelayUrls(){return this.getRelayList().then((t=>t.map((t=>t.url))))}async addRelay(t){const e=await this.getRelayList();if(e.some((e=>e.url===t)))return Promise.resolve(!0);const n=[...e,{url:t,mode:"both"}];return this.saveRelays(n)}async removeRelay(t){const e=await this.getRelayList(),n=e.filter((e=>e.url!==t));return e==n?Promise.resolve(!0):this.saveRelays(n)}async saveRelays(t){const e=t.map((t=>"both"===t.mode?[this.tag,t.url]:[this.tag,t.url,t.mode]));return Relay.instance.buildAndPublish(this.kind,"",e,this.hexpubkey)}}},6455:()=>{class t{editorDomains=["app.tagayasu.xyz"];static EDITOR="editor";static BROWSER="browser";static DNSLINK_HELP="dnslinkHelp";static ALL_PAGES=[t.EDITOR,t.BROWSER,t.DNSLINK_HELP];_pageName=null;get pageName(){if(null!==this._pageName)return this._pageName;throw new Error("Call route() first")}_defaultPageName=null;get defaultPageName(){if(null!==this._defaultPageName)return this._defaultPageName;throw new Error("call route() first")}_inlineParams=null;get inlineParams(){if(null!==this._inlineParams)return this._inlineParams;throw new Error("call route() first")}_dnslinkNpub=null;get dnslinkNpub(){if(null!==this._dnslinkNpub)return this._dnslinkNpub;throw new Error("call route() first")}get isEditorDomain(){return this.editorDomains.includes(window.location.hostname)}async route(){this._dnslinkNpub||(this._dnslinkNpub=await DnsClient.instance.npub(window.location.hostname)),this.isEditorDomain?this._defaultPageName=t.EDITOR:this._dnslinkNpub?this._defaultPageName=t.BROWSER:this._defaultPageName=t.DNSLINK_HELP;const e=window.location.pathname.split("/").filter((t=>t));return t.ALL_PAGES.includes(e[0])?(this._pageName=e[0],this._parseInlineParams(e.slice(1)),this):(this._pageName=this._defaultPageName,this._parseInlineParams(e),this)}urlFor(e,n){if(!t.ALL_PAGES.includes(e))throw new Error(e+" is not a valid page");const r=n.startsWith("/")?n:"/"+n;return e==this.defaultPageName?window.location.origin+r:window.location.origin+"/"+e+r}_parseInlineParams(t){this._inlineParams={},this._inlineParams[PageContext.NADDR_PARAM_NAME]=t[0]}}window.Router=t},5384:(t,e,n)=>{"use strict";var r=n(6727),i=n(8150),s=n(7226),o=n(58),a=n(5919);const c=n(7970);class h{notes={};noteTitleTrie=new c;nostrIdMap={};static instance=new h;constructor(){if(h.instance)throw new Error("Use singleton instance")}getNoteByPrimaryId(t){return this.notes[t]}getNoteByNostrId(t){return this.notes[this.nostrIdMap[t]]}clear(){this.notes={},this.noteTitleTrie=new c}hasSearchableEntries(){return 0!==Object.keys(this.noteTitleTrie._childPaths).length}search(t){const e=new Set;return(t.length>0?t:[""]).forEach((t=>{const n=this.noteTitleTrie.getData(t);n&&n.forEach((t=>e.add(t)))})),Array.from(e).filter((t=>""!=this.notes[t]?.content)).sort(((t,e)=>(this.notes[e]?.createdAt??0)-(this.notes[t]?.createdAt??0)))}async addFromNostrEvent(t){try{const e=await o.Note.fromNostrEvent(t);return t.id!==e.id&&(this.nostrIdMap[t.id]=e.databaseId),e.altIds.includes(t.id)||e.altIds.push(t.id),this.addNote(e),this.pushStateToLocalStorage(window.nostrUser.npub),e}catch(e){if(e instanceof o.NoteValidationError)return console.warn("Discarding event because it failed validation",{reason:e.message,event:t}),null;if("Malformed UTF-8 data"===e.message)return console.warn("Discarding event because it could not be decrypted (malformed)"),null;throw e}}deleteNote(t){this.notes[t]&&(delete this.notes[t],this.pushStateToLocalStorage(window.nostrUser.npub))}addNote(t){t.id&&(this.nostrIdMap[t.id]=t.databaseId);const e=this.notes[t.databaseId];e||t.title.split(" ").forEach((e=>this.noteTitleTrie.add(e.toLowerCase(),t.databaseId))),(!e||t.createdAt>=e.createdAt)&&(this.notes[t.databaseId]=t)}pushStateToLocalStorage(t){const e={notes:Object.values(this.notes).map((t=>t.toPlain()))};localStorage.setItem(`database-${t}`,JSON.stringify(e))}async pullStateFromLocalStorage(t){const e=JSON.parse(localStorage.getItem(`database-${t}`));if(e)return Promise.all(e.notes.map((async t=>this.addNote(await o.Note.fromPlain(t)))))}}window.Database=h,window.addEventListener(a.Wallet.WALLET_DISCONNECTED_EVENT,(function(t){h.instance.clear()})),window.addEventListener(a.Wallet.WALLET_CONNECTED_EVENT,(function(t){h.instance.pullStateFromLocalStorage(window.nostrUser.npub)}));var l=n(2161),u=n(2258);function d(){const t=localStorage.getItem("autosave");if(t)return JSON.parse(t)}let f;async function p(){if(f?.stop(),h.instance.clear(),y(),!window.nostrUser?.hexpubkey)return;let t,e;const n=()=>{y(),e=null,Date.now()-t<1e4&&(e=setTimeout((()=>{n()}),500))},r={authors:[window.nostrUser.hexpubkey],kinds:o.Note.ALL_KINDS};f=await l.W.instance.subscribe(r,(async r=>{await h.instance.addFromNostrEvent(r),t=Date.now(),e||(e=setTimeout((()=>{n()}),1))}),!1)}async function g(){if(!PageContext.instance.noteIdentifierFromUrl())return d()?.content?function(){const t=d();v(t.type,t.title,t.content)}():v("topic","homepage","# Welcome to Tagayasu\n\nThis is the note editor, where you can create and edit your content.\n\nTo publish a note, make sure to enter a title below, then click `Publish`!");(0,r.ck)().then((async()=>{const t=PageContext.instance.noteFilterFromUrl();l.W.instance.fetchEvent(t).then((async e=>{if(e)e.pubkey==window.nostrUser.hexpubkey&&b((await h.instance.addFromNostrEvent(e)).databaseId);else if(t["#d"]&&t["#d"][0].startsWith("tagayasu-")){const t=PageContext.instance.noteTitleFromUrl();t&&v("topic",t,`# ${t}`)}}))}))}function y(){if(!h.instance.hasSearchableEntries())return;let t="";h.instance.search($("#note-search-box").val().toLowerCase().split(" ").filter((t=>!!t))).forEach((function(e){const n=h.instance.getNoteByPrimaryId(e);if(!n)return;const r=n.onRelays.length,i=r>=4?"health-good":r>=2?"health-med":"health-bad",s=n.type,a="homepage"===n.title?"<i class='fa fa-solid fa-home'></i>":s===o.Note.PRIVATE?"<i class='fa fa-solid fa-eye-slash'></i>":s===o.Note.TOPIC?"<i class='fa fa-leaf'></i>":s===o.Note.ARTICLE?"<i class='fa fa-bullhorn'></i>":"<i class='fa fa-cookie' style='width:16px'></i>",c=n.draft&&!n.private,l=c?"<i>draft: ":"",u=c?"</i>":"";t+=`\n            <div class='${i} list-group-item list-group-item-action note-list-button' onclick="editNote('${n.databaseId}')">\n                <div class='note-list-title'>${a}&nbsp;${l}${n.title}${u}</div>\n                <i id='note-more-${n.databaseId}' class='fa fa-solid fa-gears note-more' onclick="showNoteOptions(event, '${n.databaseId}'); return true;"></i>\n                </div>\n            </div>\n        `})),$("#notes-list").html(t)}function w(t,e){const n=h.instance.getNoteByPrimaryId(e);$("#noteDetailsTitle").text(n.title);const i=n.id,s=i?i.slice(0,4)+"…"+i.slice(i.length-4,i.length)+" <i class='fa fa-copy'></i>":"(none - not saved)";$("#noteDetailsId").html(s),$("#noteDetailsId").data("id",i),$("#openRawEventLink").data("id",n.databaseId);const a=(0,r.nZ)(n.kind,n.title,window.nostrUser.hexpubkey),c=a.slice(0,10)+"…"+a.slice(a.length-5,a.length)+" <i class='fa fa-copy'></i>";$("#noteDetailsNaddr").html(c),$("#noteDetailsNaddr").data("naddr",a),$("#noteDetailsOpenInTagayasu a").attr("href",window.router.urlFor(Router.BROWSER,n.handle)),$("#noteDetailsOpenInHabla").hide(),$("#noteDetailsOpenInHighlighter").hide(),$("#noteDetailsOpenInWikifreedia").hide();const l=n.type;l===o.Note.ARTICLE?($("#noteDetailsOpenInHabla a").attr("href",`https://habla.news/a/${a}`),$("#noteDetailsOpenInHighlighter a").attr("href",`https://highlighter.com/a/${a}`),$("#noteDetailsOpenInHabla").show(),$("#noteDetailsOpenInHighlighter").show()):l===o.Note.TOPIC&&($("#noteDetailsOpenInWikifreedia a").attr("href",`https://wikifreedia.xyz/${n.dtag}/${window.nostrUser.npub}`),$("#noteDetailsOpenInWikifreedia").show()),$("#noteDetailsDelete").data("note-id",e);let u="<ul>";n.onRelays.forEach((t=>{u+=`<li>${t.url}</li>`})),u+="</ul>",$("#noteDetailsRelays").html(u);const d=new Date(1e3*n.createdAt).toLocaleString();$("#noteDetailsDate").text(d),window.noteDetailsModal=new bootstrap.Modal("#note-details-modal",{}),window.noteDetailsModal.show(),t&&t.stopPropagation()}async function b(t){const e=h.instance.getNoteByPrimaryId(t),n=window.router.urlFor(Router.EDITOR,e.handle);history.replaceState({identifier:e.handle},"",n),PageContext.instance.setNote(e)}$(window).on("DOMContentLoaded",(async function(){_(),(0,s.startNostrMonitoring)(),window.router=await(new Router).route(),window.router.isEditorDomain?$("#browser-navbar").show():($("#custom-domain-row").show(),$("#custom-domain").html(window.location.hostname)),$("#page-"+window.router.pageName).show(),await window.trySeamlessConnection().catch((()=>{})),"editor"==window.router.pageName?(g(),p()):"browser"==window.router.pageName&&window.browseNoteFromUrl(),setInterval((()=>{PageContext.instance.note&&localStorage.setItem("autosave",JSON.stringify({type:PageContext.instance.note.type,title:PageContext.instance.note.title,content:window.MDEditor.value()}))}),1e3)})),window.connectWallet=function(){(0,r.Hp)().then((()=>{window.nip07signer&&window.router.pageName===Router.EDITOR&&p()}))},window.showSettings=function(){window.settingsModal=new bootstrap.Modal("#settingsModal",{}),window.settingsModal.show(),R()},window.openSettings=function(t){$(".settings-list-item").removeClass("active"),$(`#settings-${t}`).addClass("active"),$(".settings-page").hide(),$(`#settings-page-${t}`).show()},window.showPublishModal=function(){window.publishModal=new bootstrap.Modal("#publish-modal",{}),window.publishModal.show()},window.fetchNotes=p,window.loadNote=g,window.searchNotes=y,window.showNoteOptions=w,window.openRawEventModal=function(){window.noteDetailsModal&&window.noteDetailsModal.hide();const t=$("#openRawEventLink").data("id"),e=h.instance.getNoteByPrimaryId(t);$("#raw-event").val(JSON.stringify(e.nostrEvent,null,4)),window.rawEventModal=new bootstrap.Modal("#raw-event-modal",{}),window.rawEventModal.show()},window.showCurrentNoteOptions=function(){const t=PageContext.instance.note.databaseId;t&&w(void 0,t)},window.copyNaddr=function(){navigator.clipboard.writeText($("#noteDetailsNaddr").data("naddr")),(0,i.An)("copied naddr to clipboard")},window.copyNoteId=function(){navigator.clipboard.writeText($("#noteDetailsId").data("id")),(0,i.An)("copied ID to clipboard")},window.editNote=b;let m=!0;function v(t,e="",n=""){window.notesModal&&window.notesModal.hide(),PageContext.instance.setNote(o.Note.fromContent(t,e,n))}async function E(t){return(0,r.ck)().then((async()=>{const e=await k(!1);return l.W.instance.publish(e).then((async e=>{(0,i.An)(t),await PageContext.instance.setNoteByNostrEvent(e)}))}))}async function k(t){const e=window.MDEditor.value(),n=[];return MarkdownRenderer.instance.parse(window.MDEditor.value()).backrefs.forEach((function(t){n.push(["a",t])})),PageContext.instance.note.update({content:e,draft:t}),await PageContext.instance.note.toNostrEvent(n)}function _(){window.MDEditor&&window.MDEditor.toTextArea();const t={name:"imageUpload",className:"fa fa-upload",title:"Upload image",action:async t=>{const e=await async function(){const t=document.createElement("input");return t.type="file",t.style.display="none",document.body.appendChild(t),new Promise(((e,n)=>{(0,r.ck)().then((()=>{t.addEventListener("change",(t=>{const r=t.target.files[0],i=new FileReader;i.onloadend=async()=>{const t=new Blob([i.result],{type:r.type}),n=await Blossom.instance.uploadFile(t,window.nostrUser.hexpubkey);e(n)},r?i.readAsArrayBuffer(r):n("no file selected")})),t.click()}))}))}();e.downloadUrls.length>0?t.codemirror.replaceSelection(`![](${e.downloadUrls[0]} "blossom://${e.hash}")`):(0,i.Qg)("No file servers accepted your upload")}};window.MDEditor=new SimpleMDE({toolbar:$(window).width()>=750?["bold","italic","strikethrough","heading","|","code","quote","unordered-list","ordered-list","|","link","image","table","horizontal-rule","|","preview","side-by-side","fullscreen","|","guide",t]:["bold","italic","heading","|","link","image","|","preview","guide"],spellChecker:Preferences.instance.current.spellCheckEnabled,renderingConfig:{codeSyntaxHighlighting:!0},tabSize:2,previewRender:MarkdownRenderer.instance.renderHtml,styleSelectedText:!1}),$(".editor-toolbar").append("\n        <div class='btn-group publish-button-group' role='group' id='standard-publish-buttons'>\n          <button class='btn btn-sm' onclick=\"saveNote()\">Publish</button>\n          <button class='btn btn-sm save-draft-button' onclick=\"saveDraftNote()\">Draft</button>\n        </div>\n        <button style=\"display:none\" class='btn btn-sm publish-button-group' onclick=\"saveDraftNote()\" id=\"draft-only-buttons\">Save Privately</button>\n    ")}function A(){PageContext.instance.note?.authorPubkey&&PageContext.instance.note?.authorPubkey!=window.nostrUser?.hexpubkey?$(".owner-only").hide():$(".owner-only").show()}function x(t){$("#toast-content").html(t),window.toast=bootstrap.Toast.getOrCreateInstance(document.getElementById("toast")),toast.show()}function S(t,e=""){return new Promise(((n,r)=>{const i=new bootstrap.Modal("#confirmActionModal",{});$("#confirmActionTitle").text(t),$("#confirmActionDetails").text(e),i.show();const s=document.getElementById("confirmActionYes");s.addEventListener("click",(function t(){s.removeEventListener("click",t),i.hide(),n("user confirmed the action")})),i._element.addEventListener("hidden.bs.modal",(function t(){i._element.removeEventListener("hidden.bs.modal",t),r("user cancelled the action")}))}))}function R(){u.W.forRelays(window.nostrUser.hexpubkey).getRelayUrls().then((t=>{C("my-relays",t,"trash","removeRelay")})),C("recommended-relays",window.relays.recommended,"plus","addRelay"),u.W.forBlossom(window.nostrUser.hexpubkey).getRelayUrls().then((t=>{C("my-file-servers",t,"trash","removeBlossomServer")}))}function C(t,e,n,r){let i="",s=0;i+="\n      <table class='table table-sm relay-table'>\n        <thead>\n          <tr>\n            <th scope='col'>Address</th>\n            <th scope='col'>Status</th>\n            <th scope='col'>&nbsp;</th>\n          </tr>\n        </thead>\n        <tbody>\n    ",e.forEach((e=>{(async(e,n)=>{const r=n.startsWith("wss")?l.W.instance.getRelayStatus:Blossom.instance.getServerStatus,i=await r(n)?"online":"offline";$(`#relay-status-${t}-${e}`).html(`<div class='${i}'></div> ${i}`)})(s,e);const o=new URL(e).host;i+=`\n          <tr>\n            <td>${o}</td>\n            <td id='relay-status-${t}-${s}'><div class="unknown"></div> connecting...</td>\n            <td><i class="fa fa-${n}" style="cursor:pointer" onclick="${r}('${e}')"></i></td>\n          </tr>\n        `,s+=1})),i+="\n        </tbody>\n      </table>\n    ",$(`#${t}`).html(i)}async function N(t){(0,i.Xg)("adding relay..."),u.W.forRelays(window.nostrUser.hexpubkey).addRelay(t).then((()=>{(0,i.An)("relays updated"),R()}))}window.toggleSidebar=async function(){if(null===m)return;const t=!m;m=null,t?($("#sidebar").width("revert-layer"),$(".notes-editor").width("revert-layer"),$("#notes-list").width("revert-layer"),$("#notes-list").css("opacity","revert-layer"),$("#search-bar").width("revert-layer"),$("#search-bar").css("opacity","revert-layer"),$(".notes-header").css("flex-direction","revert-layer"),$("#show-current-note-options").hide(),$("#refresh-notes-list").show()):($("#sidebar").width("38px"),$(".notes-editor").width("calc(100% - 50px)"),$("#notes-list").css("opacity","0"),$("#search-bar").css("opacity","0"),setTimeout((()=>{$(".notes-header").css("flex-direction","column"),$("#notes-list").width("0px"),$("#search-bar").width("0px"),$("#show-current-note-options").show(),$("#refresh-notes-list").hide()}),250)),setTimeout((()=>{m=t}),300)},window.newNote=v,window.deleteNote=function(){const t=$("#noteDetailsDelete").data("note-id");if(!t)return void(0,i.An)("Nothing to do! Note was never published.");const e=h.instance.getNoteByPrimaryId(t);window.noteDetailsModal&&window.noteDetailsModal.hide(),S("Are you sure you want to delete this note?",`Title: ${e.title}`).then((async()=>{if((0,i.Xg)("Deleting..."),t===PageContext.instance.note.databaseId&&window.MDEditor.value(""),Preferences.instance.current.aggressiveDelete){e.update({content:""});const t=await e.toNostrEvent();await l.W.instance.publish(t)}await l.W.instance.del(e.altIds),h.instance.deleteNote(t),(0,i.An)("Note has been deleted"),y()}))},window.saveNote=function(){window.publishModal&&window.publishModal.hide(),PageContext.instance.note.private?S("This note is private. Are you sure you want to publish it?").then((()=>{(0,i.Xg)("Publishing..."),E("Your draft has been converted to a public note!")})):((0,i.Xg)("Publishing..."),E("Your note has been published!"))},window.saveDraftNote=function(){(0,i.Xg)("Encrypting and saving..."),window.publishModal&&window.publishModal.hide(),(0,r.ck)().then((async()=>{const t=await k(!0);l.W.instance.publish(t).then((async t=>{(0,i.An)("Your note has been saved privately."),await PageContext.instance.setNoteByNostrEvent(t)}))}))},window.viewPublishedNote=async function(){window.location.href=window.router.urlFor(Router.BROWSER,PageContext.instance.note.handle)},window.addEventListener(Wallet.WALLET_CONNECTED_EVENT,(function(t){!async function(){$(".connect-wallet").each((function(t,e){$(this).hide()})),$(".avatar").each((function(t,e){$(this).show(),$(this).html('<i class="fa fa-user"></i>')})),$(".npub").each((function(t,e){$(this).text(window.nostrUser.npub)}));const t=await window.ndk.activeUser.fetchProfile(),e=t?.image;e&&$(".avatar").each((function(t,n){$(this).html(`<img src='${e}' />`)}));const n=t?.name;n&&$(".username").each((function(t,e){$(this).text(n)}))}()})),window.addEventListener(Wallet.WALLET_CONNECTION_CHANGED,(function(t){A()})),window.addEventListener(PageContext.NOTE_IN_FOCUS_CHANGED,(async function(t){A();const e=PageContext.instance.note,n=MarkdownRenderer.instance.renderHtml(e.content),i=e.private?`<div style="font-weight:bold; text-align: center; color: #aa0000">⚠️ This note is private and cannot be viewed by others.</div>${n}`:e.draft?`<div style="font-weight:bold; text-align: center; color: #aa0000">⚠️ This version of the note is a draft and cannot be viewed by others.</div>${n}`:n;$("#note-content").html(i),renderDynamicContent(),async function(){if(window.router.pageName!==Router.BROWSER)return;await(0,r.wN)(),$("#backref-container").hide(),$("#backref-content").empty();const t=PageContext.instance.note,e=t.nostrEvent?.pubkey??PageContext.instance.dnslinkHexpubkey(),n=t.nostrEvent?.tags.find((t=>"title"===t[0]))[1]??PageContext.instance.note.title;if(!e||!n)return;const i={authors:[e],kinds:o.Note.ALL_KINDS,"#a":[(0,r.PS)(t.kind,n,e)]};l.W.instance.fetchEvents(i).then((t=>{t.forEach((function(t){const e=t.tags.find((t=>"title"==t[0]))[1],n=(0,r.mz)(t.kind,e,t.pubkey);$("#backref-content").append(`<li><a title='${n}' href='#tagayasu-prefetch'>${e}</a></li>`),$("#backref-container").show()})),renderDynamicContent()}))}(),window.MDEditor.value(e.content),window.notesModal&&window.notesModal.hide(),e.private?($("#standard-publish-buttons").hide(),$("#draft-only-buttons").show()):($("#standard-publish-buttons").show(),$("#draft-only-buttons").hide())})),$("#myNotesModal").on("shown.bs.modal",(function(){$("#note-search-box").focus()})),window.addEventListener(i.qR,(function(t){$("#toast").removeClass("text-bg-success"),$("#toast").removeClass("text-bg-secondary"),$("#toast").addClass("text-bg-danger"),x(t.detail.message)})),window.addEventListener(i.Zt,(function(t){$("#toast").removeClass("text-bg-danger"),$("#toast").removeClass("text-bg-secondary"),$("#toast").addClass("text-bg-success"),x(t.detail.message)})),window.addEventListener(i.rS,(function(t){$("#toast").removeClass("text-bg-danger"),$("#toast").removeClass("text-bg-success"),$("#toast").addClass("text-bg-secondary"),x(t.detail.message)})),$("#toast").on("click",(function(){window.toast&&window.toast.hide()})),window.addEventListener(Preferences.PREFERENCES_CHANGED_EVENT,(function(t){_();const e=Preferences.instance.current;$("#editor-prefs-spellcheck")[0].checked=e.spellCheckEnabled,$("#editor-prefs-aggressive-delete")[0].checked=e.aggressiveDelete})),window.confirmAction=S,window.savePreferences=function(){Preferences.instance.set({spellCheckEnabled:$("#editor-prefs-spellcheck")[0].checked,aggressiveDelete:$("#editor-prefs-aggressive-delete")[0].checked})},window.addRelay=N,window.addRelayFromInput=function(){try{const t=new URL($("#new-relay-url")[0].value);if("wss:"!==t.protocol)return(0,i.Qg)("URL must start with wss://");N(t.toString())}catch{(0,i.Qg)("invalid URL")}},window.removeRelay=function(t){(0,i.Xg)("removing relay..."),u.W.forRelays(window.nostrUser.hexpubkey).removeRelay(t).then((()=>{(0,i.An)("relays updated"),R()}))},window.addBlossomServerFromInput=function(){try{const t=new URL($("#new-file-server-url")[0].value);if("https:"!==t.protocol)return(0,i.Qg)("URL must start with https://");(0,i.Xg)("adding blossom server..."),u.W.forBlossom(window.nostrUser.hexpubkey).addRelay(t.toString()).then((()=>{(0,i.An)("blossom servers updated"),R()}))}catch{(0,i.Qg)("invalid URL")}},window.removeBlossomServer=function(t){(0,i.Xg)("removing blossom server..."),u.W.forBlossom(window.nostrUser.hexpubkey).removeRelay(t).then((()=>{(0,i.An)("blossom servers updated"),R()}))},window.showNewNoteModal=function(){window.newNoteModal=new bootstrap.Modal("#new-note-modal",{}),window.newNoteModal.show(),$("#new-note-title").val(""),setTimeout((()=>$("#new-note-title").focus()),500)},window.newNoteFromUi=function(t){window.newNoteModal.hide();const e=$("#new-note-title").val(),n=`# ${e}\n`,r=window.nostrUser.hexpubkey,i=o.Note.fromContent(t,e,n,r),s=window.router.urlFor(Router.EDITOR,i.handle);history.replaceState({identifier:i.handle},"",s),h.instance.addNote(i),PageContext.instance.setNote(i),window.notesModal&&window.notesModal.hide(),window.MDEditor.codemirror.focus(),window.MDEditor.codemirror.setCursor({line:1,ch:0}),y()}},5919:(t,e,n)=>{"use strict";n.r(e),n.d(e,{Wallet:()=>r});class r{static WALLET_CONNECTED_EVENT="wallet-connected-event";static WALLET_DISCONNECTED_EVENT="wallet-disconnected-event";static WALLET_CONNECTION_CHANGED="wallet-connection-changed";static instance=new r;constructor(){if(r.instance)throw new Error("Use singleton instance")}}window.Wallet=r,window.addEventListener(r.WALLET_CONNECTED_EVENT,(function(t){window.dispatchEvent(new Event(r.WALLET_CONNECTION_CHANGED))})),window.addEventListener(r.WALLET_DISCONNECTED_EVENT,(function(t){window.dispatchEvent(new Event(r.WALLET_CONNECTION_CHANGED))}))},477:()=>{},4504:(t,e,n)=>{"use strict";n.d(e,{QB:()=>gn,uk:()=>Kn,YX:()=>$n,vd:()=>ze,jI:()=>Me,Ay:()=>dr});var r={};n.r(r),n.d(r,{aK:()=>J,e8:()=>L,DO:()=>P,dJ:()=>Q,OG:()=>X,My:()=>D,Ph:()=>K,lX:()=>q,Id:()=>G,fg:()=>nt,qj:()=>V,aT:()=>H,r4:()=>Y,aY:()=>U,x:()=>st,lq:()=>j,z:()=>W,zW:()=>$,Q5:()=>it});var i=n(5778),s=n(706),o=n(7833);function a(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function c(t,...e){if(!((n=t)instanceof Uint8Array||null!=n&&"object"==typeof n&&"Uint8Array"===n.constructor.name))throw new Error("Uint8Array expected");var n;if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function h(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}const l="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,u=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),d=(t,e)=>t<<32-e|t>>>e;new Uint8Array(new Uint32Array([287454020]).buffer)[0];const f=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function p(t){c(t);let e="";for(let n=0;n<t.length;n++)e+=f[t[n]];return e}function g(t){return t>=48&&t<=57?t-48:t>=65&&t<=70?t-55:t>=97&&t<=102?t-87:void 0}function y(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let e=0,i=0;e<n;e++,i+=2){const n=g(t.charCodeAt(i)),s=g(t.charCodeAt(i+1));if(void 0===n||void 0===s){const e=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+e+'" at index '+i)}r[e]=16*n+s}return r}function w(t){return"string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t)),c(t),t}class b{clone(){return this._cloneInto()}}function m(t){const e=e=>t().update(w(e)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function v(t=32){if(l&&"function"==typeof l.getRandomValues)return l.getRandomValues(new Uint8Array(t));if(l&&"function"==typeof l.randomBytes)return l.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const E=(t,e,n)=>t&e^t&n^e&n;class k extends b{constructor(t,e,n,r){super(),this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=u(this.buffer)}update(t){h(this);const{view:e,buffer:n,blockLen:r}=this,i=(t=w(t)).length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o!==r)n.set(t.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(e,0),this.pos=0);else{const e=u(t);for(;r<=i-s;s+=r)this.process(e,s)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){h(this),function(t,e){c(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}(t,this),this.finished=!0;const{buffer:e,view:n,blockLen:r,isLE:i}=this;let{pos:s}=this;e[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let t=s;t<r;t++)e[t]=0;!function(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,h=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+h,a,r)}(n,r-8,BigInt(8*this.length),i),this.process(n,0);const o=u(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=a/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<l;t++)o.setUint32(4*t,d[t],i)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:n,length:r,finished:i,destroyed:s,pos:o}=this;return t.length=r,t.pos=o,t.finished=i,t.destroyed=s,r%e&&t.buffer.set(n),t}}const _=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),A=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),x=new Uint32Array(64);class S extends k{constructor(){super(64,32,8,!1),this.A=0|A[0],this.B=0|A[1],this.C=0|A[2],this.D=0|A[3],this.E=0|A[4],this.F=0|A[5],this.G=0|A[6],this.H=0|A[7]}get(){const{A:t,B:e,C:n,D:r,E:i,F:s,G:o,H:a}=this;return[t,e,n,r,i,s,o,a]}set(t,e,n,r,i,s,o,a){this.A=0|t,this.B=0|e,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|s,this.G=0|o,this.H=0|a}process(t,e){for(let n=0;n<16;n++,e+=4)x[n]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=x[t-15],n=x[t-2],r=d(e,7)^d(e,18)^e>>>3,i=d(n,17)^d(n,19)^n>>>10;x[t]=i+x[t-7]+r+x[t-16]|0}let{A:n,B:r,C:i,D:s,E:o,F:a,G:c,H:h}=this;for(let t=0;t<64;t++){const e=h+(d(o,6)^d(o,11)^d(o,25))+((l=o)&a^~l&c)+_[t]+x[t]|0,u=(d(n,2)^d(n,13)^d(n,22))+E(n,r,i)|0;h=c,c=a,a=o,o=s+e|0,s=i,i=r,r=n,n=e+u|0}var l;n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,s=s+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(n,r,i,s,o,a,c,h)}roundClean(){x.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const R=m((()=>new S));class C extends b{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,function(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");a(t.outputLen),a(t.blockLen)}(t);const n=w(e);if(this.iHash=t.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?t.create().update(n).digest():n);for(let t=0;t<i.length;t++)i[t]^=54;this.iHash.update(i),this.oHash=t.create();for(let t=0;t<i.length;t++)i[t]^=106;this.oHash.update(i),i.fill(0)}update(t){return h(this),this.iHash.update(t),this}digestInto(t){h(this),c(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:n,finished:r,destroyed:i,blockLen:s,outputLen:o}=this;return t.finished=r,t.destroyed=i,t.blockLen=s,t.outputLen=o,t.oHash=e._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const N=(t,e,n)=>new C(t,e).update(n).digest();N.create=(t,e)=>new C(t,e);const I=BigInt(0),B=BigInt(1),T=BigInt(2);function U(t){return t instanceof Uint8Array||null!=t&&"object"==typeof t&&"Uint8Array"===t.constructor.name}function P(t){if(!U(t))throw new Error("Uint8Array expected")}function L(t,e){if("boolean"!=typeof e)throw new Error(`${t} must be valid boolean, got "${e}".`)}const O=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function D(t){P(t);let e="";for(let n=0;n<t.length;n++)e+=O[t[n]];return e}function $(t){const e=t.toString(16);return 1&e.length?`0${e}`:e}function F(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);return BigInt(""===t?"0":`0x${t}`)}const M={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function z(t){return t>=M._0&&t<=M._9?t-M._0:t>=M._A&&t<=M._F?t-(M._A-10):t>=M._a&&t<=M._f?t-(M._a-10):void 0}function H(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let e=0,i=0;e<n;e++,i+=2){const n=z(t.charCodeAt(i)),s=z(t.charCodeAt(i+1));if(void 0===n||void 0===s){const e=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+e+'" at index '+i)}r[e]=16*n+s}return r}function K(t){return F(D(t))}function q(t){return P(t),F(D(Uint8Array.from(t).reverse()))}function j(t,e){return H(t.toString(16).padStart(2*e,"0"))}function W(t,e){return j(t,e).reverse()}function V(t,e,n){let r;if("string"==typeof e)try{r=H(e)}catch(n){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${n}`)}else{if(!U(e))throw new Error(`${t} must be hex string or Uint8Array`);r=Uint8Array.from(e)}const i=r.length;if("number"==typeof n&&i!==n)throw new Error(`${t} expected ${n} bytes, got ${i}`);return r}function G(...t){let e=0;for(let n=0;n<t.length;n++){const r=t[n];P(r),e+=r.length}const n=new Uint8Array(e);for(let e=0,r=0;e<t.length;e++){const i=t[e];n.set(i,r),r+=i.length}return n}const Z=t=>"bigint"==typeof t&&I<=t;function Y(t,e,n){return Z(t)&&Z(e)&&Z(n)&&e<=t&&t<n}function J(t,e,n,r){if(!Y(e,n,r))throw new Error(`expected valid ${t}: ${n} <= n < ${r}, got ${typeof e} ${e}`)}function Q(t){let e;for(e=0;t>I;t>>=B,e+=1);return e}const X=t=>(T<<BigInt(t-1))-B,tt=t=>new Uint8Array(t),et=t=>Uint8Array.from(t);function nt(t,e,n){if("number"!=typeof t||t<2)throw new Error("hashLen must be a number");if("number"!=typeof e||e<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");let r=tt(t),i=tt(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...t)=>n(i,r,...t),c=(t=tt())=>{i=a(et([0]),t),r=a(),0!==t.length&&(i=a(et([1]),t),r=a())},h=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let t=0;const n=[];for(;t<e;){r=a();const e=r.slice();n.push(e),t+=r.length}return G(...n)};return(t,e)=>{let n;for(o(),c(t);!(n=e(h()));)c();return o(),n}}const rt={bigint:t=>"bigint"==typeof t,function:t=>"function"==typeof t,boolean:t=>"boolean"==typeof t,string:t=>"string"==typeof t,stringOrUint8Array:t=>"string"==typeof t||U(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>"function"==typeof t&&Number.isSafeInteger(t.outputLen)};function it(t,e,n={}){const r=(e,n,r)=>{const i=rt[n];if("function"!=typeof i)throw new Error(`Invalid validator "${n}", expected function`);const s=t[e];if(!(r&&void 0===s||i(s,t)))throw new Error(`Invalid param ${String(e)}=${s} (${typeof s}), expected ${n}`)};for(const[t,n]of Object.entries(e))r(t,n,!1);for(const[t,e]of Object.entries(n))r(t,e,!0);return t}function st(t){const e=new WeakMap;return(n,...r)=>{const i=e.get(n);if(void 0!==i)return i;const s=t(n,...r);return e.set(n,s),s}}const ot=BigInt(0),at=BigInt(1),ct=BigInt(2),ht=BigInt(3),lt=BigInt(4),ut=BigInt(5),dt=BigInt(8);function ft(t,e){const n=t%e;return n>=ot?n:e+n}function pt(t,e,n){if(n<=ot||e<ot)throw new Error("Expected power/modulo > 0");if(n===at)return ot;let r=at;for(;e>ot;)e&at&&(r=r*t%n),t=t*t%n,e>>=at;return r}function gt(t,e,n){let r=t;for(;e-- >ot;)r*=r,r%=n;return r}function yt(t,e){if(t===ot||e<=ot)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=ft(t,e),r=e,i=ot,s=at,o=at,a=ot;for(;n!==ot;){const t=r/n,e=r%n,c=i-o*t,h=s-a*t;r=n,n=e,i=o,s=a,o=c,a=h}if(r!==at)throw new Error("invert: does not exist");return ft(i,e)}BigInt(9),BigInt(16);const wt=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function bt(t,e){const n=void 0!==e?e:t.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function mt(t,e,n=!1,r={}){if(t<=ot)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:i,nByteLength:s}=bt(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=function(t){if(t%lt===ht){const e=(t+at)/lt;return function(t,n){const r=t.pow(n,e);if(!t.eql(t.sqr(r),n))throw new Error("Cannot find square root");return r}}if(t%dt===ut){const e=(t-ut)/dt;return function(t,n){const r=t.mul(n,ct),i=t.pow(r,e),s=t.mul(n,i),o=t.mul(t.mul(s,ct),i),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),n))throw new Error("Cannot find square root");return a}}return function(t){const e=(t-at)/ct;let n,r,i;for(n=t-at,r=0;n%ct===ot;n/=ct,r++);for(i=ct;i<t&&pt(i,e,t)!==t-at;i++);if(1===r){const e=(t+at)/lt;return function(t,n){const r=t.pow(n,e);if(!t.eql(t.sqr(r),n))throw new Error("Cannot find square root");return r}}const s=(n+at)/ct;return function(t,o){if(t.pow(o,e)===t.neg(t.ONE))throw new Error("Cannot find square root");let a=r,c=t.pow(t.mul(t.ONE,i),n),h=t.pow(o,s),l=t.pow(o,n);for(;!t.eql(l,t.ONE);){if(t.eql(l,t.ZERO))return t.ZERO;let e=1;for(let n=t.sqr(l);e<a&&!t.eql(n,t.ONE);e++)n=t.sqr(n);const n=t.pow(c,at<<BigInt(a-e-1));c=t.sqr(n),h=t.mul(h,n),l=t.mul(l,c),a=e}return h}}(t)}(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:s,MASK:X(i),ZERO:ot,ONE:at,create:e=>ft(e,t),isValid:e=>{if("bigint"!=typeof e)throw new Error("Invalid field element: expected bigint, got "+typeof e);return ot<=e&&e<t},is0:t=>t===ot,isOdd:t=>(t&at)===at,neg:e=>ft(-e,t),eql:(t,e)=>t===e,sqr:e=>ft(e*e,t),add:(e,n)=>ft(e+n,t),sub:(e,n)=>ft(e-n,t),mul:(e,n)=>ft(e*n,t),pow:(t,e)=>function(t,e,n){if(n<ot)throw new Error("Expected power > 0");if(n===ot)return t.ONE;if(n===at)return e;let r=t.ONE,i=e;for(;n>ot;)n&at&&(r=t.mul(r,i)),i=t.sqr(i),n>>=at;return r}(a,t,e),div:(e,n)=>ft(e*yt(n,t),t),sqrN:t=>t*t,addN:(t,e)=>t+e,subN:(t,e)=>t-e,mulN:(t,e)=>t*e,inv:e=>yt(e,t),sqrt:r.sqrt||(t=>o(a,t)),invertBatch:t=>function(t,e){const n=new Array(e.length),r=e.reduce(((e,r,i)=>t.is0(r)?e:(n[i]=e,t.mul(e,r))),t.ONE),i=t.inv(r);return e.reduceRight(((e,r,i)=>t.is0(r)?e:(n[i]=t.mul(e,n[i]),t.mul(e,r))),i),n}(a,t),cmov:(t,e,n)=>n?e:t,toBytes:t=>n?W(t,s):j(t,s),fromBytes:t=>{if(t.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${t.length}`);return n?q(t):K(t)}});return Object.freeze(a)}function vt(t){if("bigint"!=typeof t)throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Et(t){const e=vt(t);return e+Math.ceil(e/2)}const kt=BigInt(0),_t=BigInt(1),At=new WeakMap,xt=new WeakMap;function St(t){return it(t.Fp,wt.reduce(((t,e)=>(t[e]="function",t)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),it(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...bt(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function Rt(t){void 0!==t.lowS&&L("lowS",t.lowS),void 0!==t.prehash&&L("prehash",t.prehash)}const{Ph:Ct,aT:Nt}=r,It={Err:class extends Error{constructor(t=""){super(t)}},_tlv:{encode:(t,e)=>{const{Err:n}=It;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(1&e.length)throw new n("tlv.encode: unpadded data");const r=e.length/2,i=$(r);if(i.length/2&128)throw new n("tlv.encode: long form length too big");const s=r>127?$(i.length/2|128):"";return`${$(t)}${s}${i}${e}`},decode(t,e){const{Err:n}=It;let r=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new n("tlv.decode: wrong tlv");const i=e[r++];let s=0;if(128&i){const t=127&i;if(!t)throw new n("tlv.decode(long): indefinite length not supported");if(t>4)throw new n("tlv.decode(long): byte length is too big");const o=e.subarray(r,r+t);if(o.length!==t)throw new n("tlv.decode: length bytes not complete");if(0===o[0])throw new n("tlv.decode(long): zero leftmost byte");for(const t of o)s=s<<8|t;if(r+=t,s<128)throw new n("tlv.decode(long): not minimal encoding")}else s=i;const o=e.subarray(r,r+s);if(o.length!==s)throw new n("tlv.decode: wrong value length");return{v:o,l:e.subarray(r+s)}}},_int:{encode(t){const{Err:e}=It;if(t<Bt)throw new e("integer: negative integers are not allowed");let n=$(t);if(8&Number.parseInt(n[0],16)&&(n="00"+n),1&n.length)throw new e("unexpected assertion");return n},decode(t){const{Err:e}=It;if(128&t[0])throw new e("Invalid signature integer: negative");if(0===t[0]&&!(128&t[1]))throw new e("Invalid signature integer: unnecessary leading zero");return Ct(t)}},toSig(t){const{Err:e,_int:n,_tlv:r}=It,i="string"==typeof t?Nt(t):t;P(i);const{v:s,l:o}=r.decode(48,i);if(o.length)throw new e("Invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,s),{v:h,l}=r.decode(2,c);if(l.length)throw new e("Invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(h)}},hexFromSig(t){const{_tlv:e,_int:n}=It,r=`${e.encode(2,n.encode(t.r))}${e.encode(2,n.encode(t.s))}`;return e.encode(48,r)}},Bt=BigInt(0),Tt=BigInt(1),Ut=(BigInt(2),BigInt(3));function Pt(t){const e=function(t){const e=St(t);return it(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(t){return ft(t,r)}function a(t){return yt(t,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:h,weierstrassEquation:l,isWithinCurveOrder:u}=function(t){const e=function(t){const e=St(t);it(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=e;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof n||"bigint"!=typeof n.beta||"function"!=typeof n.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}(t),{Fp:n}=e,r=mt(e.n,e.nBitLength),i=e.toBytes||((t,e,r)=>{const i=e.toAffine();return G(Uint8Array.from([4]),n.toBytes(i.x),n.toBytes(i.y))}),s=e.fromBytes||(t=>{const e=t.subarray(1);return{x:n.fromBytes(e.subarray(0,n.BYTES)),y:n.fromBytes(e.subarray(n.BYTES,2*n.BYTES))}});function o(t){const{a:r,b:i}=e,s=n.sqr(t),o=n.mul(s,t);return n.add(n.add(o,n.mul(t,r)),i)}if(!n.eql(n.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(t){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:i,n:s}=e;if(n&&"bigint"!=typeof t){if(U(t)&&(t=D(t)),"string"!=typeof t||!n.includes(t.length))throw new Error("Invalid key");t=t.padStart(2*r,"0")}let o;try{o="bigint"==typeof t?t:K(V("private key",t,r))}catch(e){throw new Error(`private key must be ${r} bytes, hex or bigint, not ${typeof t}`)}return i&&(o=ft(o,s)),J("private key",o,Tt,s),o}function c(t){if(!(t instanceof u))throw new Error("ProjectivePoint expected")}const h=st(((t,e)=>{const{px:r,py:i,pz:s}=t;if(n.eql(s,n.ONE))return{x:r,y:i};const o=t.is0();null==e&&(e=o?n.ONE:n.inv(s));const a=n.mul(r,e),c=n.mul(i,e),h=n.mul(s,e);if(o)return{x:n.ZERO,y:n.ZERO};if(!n.eql(h,n.ONE))throw new Error("invZ was invalid");return{x:a,y:c}})),l=st((t=>{if(t.is0()){if(e.allowInfinityPoint&&!n.is0(t.py))return;throw new Error("bad point: ZERO")}const{x:r,y:i}=t.toAffine();if(!n.isValid(r)||!n.isValid(i))throw new Error("bad point: x or y not FE");const s=n.sqr(i),a=o(r);if(!n.eql(s,a))throw new Error("bad point: equation left != right");if(!t.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0}));class u{constructor(t,e,r){if(this.px=t,this.py=e,this.pz=r,null==t||!n.isValid(t))throw new Error("x required");if(null==e||!n.isValid(e))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required");Object.freeze(this)}static fromAffine(t){const{x:e,y:r}=t||{};if(!t||!n.isValid(e)||!n.isValid(r))throw new Error("invalid affine point");if(t instanceof u)throw new Error("projective point not allowed");const i=t=>n.eql(t,n.ZERO);return i(e)&&i(r)?u.ZERO:new u(e,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(t){const e=n.invertBatch(t.map((t=>t.pz)));return t.map(((t,n)=>t.toAffine(e[n]))).map(u.fromAffine)}static fromHex(t){const e=u.fromAffine(s(V("pointHex",t)));return e.assertValidity(),e}static fromPrivateKey(t){return u.BASE.multiply(a(t))}static msm(t,e){return function(t,e,n,r){if(!Array.isArray(n)||!Array.isArray(r)||r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");r.forEach(((t,n)=>{if(!e.isValid(t))throw new Error(`wrong scalar at index ${n}`)})),n.forEach(((e,n)=>{if(!(e instanceof t))throw new Error(`wrong point at index ${n}`)}));const i=Q(BigInt(n.length)),s=i>12?i-3:i>4?i-2:i?2:1,o=(1<<s)-1,a=new Array(o+1).fill(t.ZERO),c=Math.floor((e.BITS-1)/s)*s;let h=t.ZERO;for(let e=c;e>=0;e-=s){a.fill(t.ZERO);for(let t=0;t<r.length;t++){const i=r[t],s=Number(i>>BigInt(e)&BigInt(o));a[s]=a[s].add(n[t])}let i=t.ZERO;for(let e=a.length-1,n=t.ZERO;e>0;e--)n=n.add(a[e]),i=i.add(n);if(h=h.add(i),0!==e)for(let t=0;t<s;t++)h=h.double()}return h}(u,r,t,e)}_setWindowSize(t){f.setWindowSize(this,t)}assertValidity(){l(this)}hasEvenY(){const{y:t}=this.toAffine();if(n.isOdd)return!n.isOdd(t);throw new Error("Field doesn't support isOdd")}equals(t){c(t);const{px:e,py:r,pz:i}=this,{px:s,py:o,pz:a}=t,h=n.eql(n.mul(e,a),n.mul(s,i)),l=n.eql(n.mul(r,a),n.mul(o,i));return h&&l}negate(){return new u(this.px,n.neg(this.py),this.pz)}double(){const{a:t,b:r}=e,i=n.mul(r,Ut),{px:s,py:o,pz:a}=this;let c=n.ZERO,h=n.ZERO,l=n.ZERO,d=n.mul(s,s),f=n.mul(o,o),p=n.mul(a,a),g=n.mul(s,o);return g=n.add(g,g),l=n.mul(s,a),l=n.add(l,l),c=n.mul(t,l),h=n.mul(i,p),h=n.add(c,h),c=n.sub(f,h),h=n.add(f,h),h=n.mul(c,h),c=n.mul(g,c),l=n.mul(i,l),p=n.mul(t,p),g=n.sub(d,p),g=n.mul(t,g),g=n.add(g,l),l=n.add(d,d),d=n.add(l,d),d=n.add(d,p),d=n.mul(d,g),h=n.add(h,d),p=n.mul(o,a),p=n.add(p,p),d=n.mul(p,g),c=n.sub(c,d),l=n.mul(p,f),l=n.add(l,l),l=n.add(l,l),new u(c,h,l)}add(t){c(t);const{px:r,py:i,pz:s}=this,{px:o,py:a,pz:h}=t;let l=n.ZERO,d=n.ZERO,f=n.ZERO;const p=e.a,g=n.mul(e.b,Ut);let y=n.mul(r,o),w=n.mul(i,a),b=n.mul(s,h),m=n.add(r,i),v=n.add(o,a);m=n.mul(m,v),v=n.add(y,w),m=n.sub(m,v),v=n.add(r,s);let E=n.add(o,h);return v=n.mul(v,E),E=n.add(y,b),v=n.sub(v,E),E=n.add(i,s),l=n.add(a,h),E=n.mul(E,l),l=n.add(w,b),E=n.sub(E,l),f=n.mul(p,v),l=n.mul(g,b),f=n.add(l,f),l=n.sub(w,f),f=n.add(w,f),d=n.mul(l,f),w=n.add(y,y),w=n.add(w,y),b=n.mul(p,b),v=n.mul(g,v),w=n.add(w,b),b=n.sub(y,b),b=n.mul(p,b),v=n.add(v,b),y=n.mul(w,v),d=n.add(d,y),y=n.mul(E,v),l=n.mul(m,l),l=n.sub(l,y),y=n.mul(m,w),f=n.mul(E,f),f=n.add(f,y),new u(l,d,f)}subtract(t){return this.add(t.negate())}is0(){return this.equals(u.ZERO)}wNAF(t){return f.wNAFCached(this,t,u.normalizeZ)}multiplyUnsafe(t){J("scalar",t,Bt,e.n);const r=u.ZERO;if(t===Bt)return r;if(t===Tt)return this;const{endo:i}=e;if(!i)return f.unsafeLadder(this,t);let{k1neg:s,k1:o,k2neg:a,k2:c}=i.splitScalar(t),h=r,l=r,d=this;for(;o>Bt||c>Bt;)o&Tt&&(h=h.add(d)),c&Tt&&(l=l.add(d)),d=d.double(),o>>=Tt,c>>=Tt;return s&&(h=h.negate()),a&&(l=l.negate()),l=new u(n.mul(l.px,i.beta),l.py,l.pz),h.add(l)}multiply(t){const{endo:r,n:i}=e;let s,o;if(J("scalar",t,Tt,i),r){const{k1neg:e,k1:i,k2neg:a,k2:c}=r.splitScalar(t);let{p:h,f:l}=this.wNAF(i),{p:d,f:p}=this.wNAF(c);h=f.constTimeNegate(e,h),d=f.constTimeNegate(a,d),d=new u(n.mul(d.px,r.beta),d.py,d.pz),s=h.add(d),o=l.add(p)}else{const{p:e,f:n}=this.wNAF(t);s=e,o=n}return u.normalizeZ([s,o])[0]}multiplyAndAddUnsafe(t,e,n){const r=u.BASE,i=(t,e)=>e!==Bt&&e!==Tt&&t.equals(r)?t.multiply(e):t.multiplyUnsafe(e),s=i(this,e).add(i(t,n));return s.is0()?void 0:s}toAffine(t){return h(this,t)}isTorsionFree(){const{h:t,isTorsionFree:n}=e;if(t===Tt)return!0;if(n)return n(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:t,clearCofactor:n}=e;return t===Tt?this:n?n(u,this):this.multiplyUnsafe(e.h)}toRawBytes(t=!0){return L("isCompressed",t),this.assertValidity(),i(u,this,t)}toHex(t=!0){return L("isCompressed",t),D(this.toRawBytes(t))}}u.BASE=new u(e.Gx,e.Gy,n.ONE),u.ZERO=new u(n.ZERO,n.ONE,n.ZERO);const d=e.nBitLength,f=function(t,e){const n=(t,e)=>{const n=e.negate();return t?n:e},r=t=>{if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error(`Wrong window size=${t}, should be [1..${e}]`)},i=t=>(r(t),{windows:Math.ceil(e/t)+1,windowSize:2**(t-1)});return{constTimeNegate:n,unsafeLadder(e,n){let r=t.ZERO,i=e;for(;n>kt;)n&_t&&(r=r.add(i)),i=i.double(),n>>=_t;return r},precomputeWindow(t,e){const{windows:n,windowSize:r}=i(e),s=[];let o=t,a=o;for(let t=0;t<n;t++){a=o,s.push(a);for(let t=1;t<r;t++)a=a.add(o),s.push(a);o=a.double()}return s},wNAF(e,r,s){const{windows:o,windowSize:a}=i(e);let c=t.ZERO,h=t.BASE;const l=BigInt(2**e-1),u=2**e,d=BigInt(e);for(let t=0;t<o;t++){const e=t*a;let i=Number(s&l);s>>=d,i>a&&(i-=u,s+=_t);const o=e,f=e+Math.abs(i)-1,p=t%2!=0,g=i<0;0===i?h=h.add(n(p,r[o])):c=c.add(n(g,r[f]))}return{p:c,f:h}},wNAFCached(t,e,n){const r=xt.get(t)||1;let i=At.get(t);return i||(i=this.precomputeWindow(t,r),1!==r&&At.set(t,n(i))),this.wNAF(r,i,e)},setWindowSize(t,e){r(e),xt.set(t,e),At.delete(t)}}}(u,e.endo?Math.ceil(d/2):d);return{CURVE:e,ProjectivePoint:u,normPrivateKeyToScalar:a,weierstrassEquation:o,isWithinCurveOrder:function(t){return Y(t,Tt,e.n)}}}({...e,toBytes(t,e,r){const i=e.toAffine(),s=n.toBytes(i.x),o=G;return L("isCompressed",r),r?o(Uint8Array.from([e.hasEvenY()?2:3]),s):o(Uint8Array.from([4]),s,n.toBytes(i.y))},fromBytes(t){const e=t.length,r=t[0],o=t.subarray(1);if(e!==i||2!==r&&3!==r){if(e===s&&4===r)return{x:n.fromBytes(o.subarray(0,n.BYTES)),y:n.fromBytes(o.subarray(n.BYTES,2*n.BYTES))};throw new Error(`Point of length ${e} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}{const t=K(o);if(!Y(t,Tt,n.ORDER))throw new Error("Point is not on curve");const e=l(t);let i;try{i=n.sqrt(e)}catch(t){const e=t instanceof Error?": "+t.message:"";throw new Error("Point is not on curve"+e)}return!(1&~r)!=((i&Tt)===Tt)&&(i=n.neg(i)),{x:t,y:i}}}}),d=t=>D(j(t,e.nByteLength));function f(t){return t>r>>Tt}const p=(t,e,n)=>K(t.slice(e,n));class g{constructor(t,e,n){this.r=t,this.s=e,this.recovery=n,this.assertValidity()}static fromCompact(t){const n=e.nByteLength;return t=V("compactSignature",t,2*n),new g(p(t,0,n),p(t,n,2*n))}static fromDER(t){const{r:e,s:n}=It.toSig(V("DER",t));return new g(e,n)}assertValidity(){J("r",this.r,Tt,r),J("s",this.s,Tt,r)}addRecoveryBit(t){return new g(this.r,this.s,t)}recoverPublicKey(t){const{r,s:i,recovery:s}=this,h=m(V("msgHash",t));if(null==s||![0,1,2,3].includes(s))throw new Error("recovery id invalid");const l=2===s||3===s?r+e.n:r;if(l>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const u=1&s?"03":"02",f=c.fromHex(u+d(l)),p=a(l),g=o(-h*p),y=o(i*p),w=c.BASE.multiplyAndAddUnsafe(f,g,y);if(!w)throw new Error("point at infinify");return w.assertValidity(),w}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return H(this.toDERHex())}toDERHex(){return It.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return H(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const y={isValidPrivateKey(t){try{return h(t),!0}catch(t){return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const t=Et(e.n);return function(t,e,n=!1){const r=t.length,i=vt(e),s=Et(e);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const o=ft(n?K(t):q(t),e-at)+at;return n?W(o,i):j(o,i)}(e.randomBytes(t),e.n)},precompute:(t=8,e=c.BASE)=>(e._setWindowSize(t),e.multiply(BigInt(3)),e)};function w(t){const e=U(t),n="string"==typeof t,r=(e||n)&&t.length;return e?r===i||r===s:n?r===2*i||r===2*s:t instanceof c}const b=e.bits2int||function(t){const n=K(t),r=8*t.length-e.nBitLength;return r>0?n>>BigInt(r):n},m=e.bits2int_modN||function(t){return o(b(t))},v=X(e.nBitLength);function E(t){return J(`num < 2^${e.nBitLength}`,t,Bt,v),j(t,e.nByteLength)}const k={lowS:e.lowS,prehash:!1},_={lowS:e.lowS,prehash:!1};return c.BASE._setWindowSize(8),{CURVE:e,getPublicKey:function(t,e=!0){return c.fromPrivateKey(t).toRawBytes(e)},getSharedSecret:function(t,e,n=!0){if(w(t))throw new Error("first arg must be private key");if(!w(e))throw new Error("second arg must be public key");return c.fromHex(e).multiply(h(t)).toRawBytes(n)},sign:function(t,r,i=k){const{seed:s,k2sig:l}=function(t,r,i=k){if(["recovered","canonical"].some((t=>t in i)))throw new Error("sign() legacy options not supported");const{hash:s,randomBytes:l}=e;let{lowS:d,prehash:p,extraEntropy:y}=i;null==d&&(d=!0),t=V("msgHash",t),Rt(i),p&&(t=V("prehashed msgHash",s(t)));const w=m(t),v=h(r),_=[E(v),E(w)];if(null!=y&&!1!==y){const t=!0===y?l(n.BYTES):y;_.push(V("extraEntropy",t))}const A=G(..._),x=w;return{seed:A,k2sig:function(t){const e=b(t);if(!u(e))return;const n=a(e),r=c.BASE.multiply(e).toAffine(),i=o(r.x);if(i===Bt)return;const s=o(n*o(x+i*v));if(s===Bt)return;let h=(r.x===i?0:2)|Number(r.y&Tt),l=s;return d&&f(s)&&(l=function(t){return f(t)?o(-t):t}(s),h^=1),new g(i,l,h)}}}(t,r,i),d=e;return nt(d.hash.outputLen,d.nByteLength,d.hmac)(s,l)},verify:function(t,n,r,i=_){const s=t;if(n=V("msgHash",n),r=V("publicKey",r),"strict"in i)throw new Error("options.strict was renamed to lowS");Rt(i);const{lowS:h,prehash:l}=i;let u,d;try{if("string"==typeof s||U(s))try{u=g.fromDER(s)}catch(t){if(!(t instanceof It.Err))throw t;u=g.fromCompact(s)}else{if("object"!=typeof s||"bigint"!=typeof s.r||"bigint"!=typeof s.s)throw new Error("PARSE");{const{r:t,s:e}=s;u=new g(t,e)}}d=c.fromHex(r)}catch(t){if("PARSE"===t.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(h&&u.hasHighS())return!1;l&&(n=e.hash(n));const{r:f,s:p}=u,y=m(n),w=a(p),b=o(y*w),v=o(f*w),E=c.BASE.multiplyAndAddUnsafe(d,b,v)?.toAffine();return!!E&&o(E.x)===f},ProjectivePoint:c,Signature:g,utils:y}}function Lt(t){return{hash:t,hmac:(e,...n)=>N(t,e,function(...t){let e=0;for(let n=0;n<t.length;n++){const r=t[n];c(r),e+=r.length}const n=new Uint8Array(e);for(let e=0,r=0;e<t.length;e++){const i=t[e];n.set(i,r),r+=i.length}return n}(...n)),randomBytes:v}}BigInt(4);const Ot=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Dt=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),$t=BigInt(1),Ft=BigInt(2),Mt=(t,e)=>(t+e/Ft)/e;function zt(t){const e=Ot,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),h=t*t*t%e,l=h*h*t%e,u=gt(l,n,e)*l%e,d=gt(u,n,e)*l%e,f=gt(d,Ft,e)*h%e,p=gt(f,i,e)*f%e,g=gt(p,s,e)*p%e,y=gt(g,a,e)*g%e,w=gt(y,c,e)*y%e,b=gt(w,a,e)*g%e,m=gt(b,n,e)*l%e,v=gt(m,o,e)*p%e,E=gt(v,r,e)*h%e,k=gt(E,Ft,e);if(!Ht.eql(Ht.sqr(k),t))throw new Error("Cannot find square root");return k}const Ht=mt(Ot,void 0,void 0,{sqrt:zt}),Kt=function(t,e){const n=e=>Pt({...t,...Lt(e)});return Object.freeze({...n(e),create:n})}({a:BigInt(0),b:BigInt(7),Fp:Ht,n:Dt,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Dt,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-$t*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=Mt(s*t,e),c=Mt(-r*t,e);let h=ft(t-a*n-c*i,e),l=ft(-a*r-c*s,e);const u=h>o,d=l>o;if(u&&(h=e-h),d&&(l=e-l),h>o||l>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:u,k1:h,k2neg:d,k2:l}}}},R),qt=BigInt(0),jt={};function Wt(t,...e){let n=jt[t];if(void 0===n){const e=R(Uint8Array.from(t,(t=>t.charCodeAt(0))));n=G(e,e),jt[t]=n}return R(G(n,...e))}const Vt=t=>t.toRawBytes(!0).slice(1),Gt=t=>j(t,32),Zt=t=>ft(t,Ot),Yt=t=>ft(t,Dt),Jt=Kt.ProjectivePoint;function Qt(t){let e=Kt.utils.normPrivateKeyToScalar(t),n=Jt.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:Yt(-e),bytes:Vt(n)}}function Xt(t){J("x",t,$t,Ot);const e=Zt(t*t);let n=zt(Zt(e*t+BigInt(7)));n%Ft!==qt&&(n=Zt(-n));const r=new Jt(t,n,$t);return r.assertValidity(),r}const te=K;function ee(...t){return Yt(te(Wt("BIP0340/challenge",...t)))}function ne(t){return Qt(t).bytes}function re(t,e,n=v(32)){const r=V("message",t),{bytes:i,scalar:s}=Qt(e),o=V("auxRand",n,32),a=Gt(s^te(Wt("BIP0340/aux",o))),c=Wt("BIP0340/nonce",a,i,r),h=Yt(te(c));if(h===qt)throw new Error("sign failed: k is zero");const{bytes:l,scalar:u}=Qt(h),d=ee(l,i,r),f=new Uint8Array(64);if(f.set(l,0),f.set(Gt(Yt(u+d*s)),32),!ie(f,r,i))throw new Error("sign: Invalid signature produced");return f}function ie(t,e,n){const r=V("signature",t,64),i=V("message",e),s=V("publicKey",n,32);try{const t=Xt(te(s)),e=te(r.subarray(0,32));if(!Y(e,$t,Ot))return!1;const n=te(r.subarray(32,64));if(!Y(n,$t,Dt))return!1;const h=ee(Gt(e),Vt(t),i),l=(o=t,a=n,c=Yt(-h),Jt.BASE.multiplyAndAddUnsafe(o,a,c));return!(!l||!l.hasEvenY()||l.toAffine().x!==e)}catch(t){return!1}var o,a,c}const se=(()=>({getPublicKey:ne,sign:re,verify:ie,utils:{randomPrivateKey:Kt.utils.randomPrivateKey,lift_x:Xt,pointToBytes:Vt,numberToBytesBE:j,bytesToNumberBE:K,taggedHash:Wt,mod:ft}}))();var oe=n(6654);function ae(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function ce(t){return t instanceof Uint8Array||null!=t&&"object"==typeof t&&"Uint8Array"===t.constructor.name}function he(...t){const e=t=>t,n=(t,e)=>n=>t(e(n));return{encode:t.map((t=>t.encode)).reduceRight(n,e),decode:t.map((t=>t.decode)).reduce(n,e)}}function le(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("alphabet.encode input should be an array of numbers");return e.map((e=>{if(ae(e),e<0||e>=t.length)throw new Error(`Digit index outside alphabet: ${e} (alphabet: ${t.length})`);return t[e]}))},decode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("alphabet.decode input should be array of strings");return e.map((e=>{if("string"!=typeof e)throw new Error(`alphabet.decode: not string element=${e}`);const n=t.indexOf(e);if(-1===n)throw new Error(`Unknown letter: "${e}". Allowed: ${t}`);return n}))}}}function ue(t=""){if("string"!=typeof t)throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("join.encode input should be array of strings");for(let t of e)if("string"!=typeof t)throw new Error(`join.encode: non-string input=${t}`);return e.join(t)},decode:e=>{if("string"!=typeof e)throw new Error("join.decode input should be string");return e.split(t)}}}function de(t,e="="){if(ae(t),"string"!=typeof e)throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let t of n)if("string"!=typeof t)throw new Error(`padding.encode: non-string input=${t}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let t of n)if("string"!=typeof t)throw new Error(`padding.decode: non-string input=${t}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function fe(t){if("function"!=typeof t)throw new Error("normalize fn should be function");return{encode:t=>t,decode:e=>t(e)}}function pe(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const i=[],s=Array.from(t);for(s.forEach((t=>{if(ae(t),t<0||t>=e)throw new Error(`Wrong integer: ${t}`)}));;){let t=0,o=!0;for(let i=r;i<s.length;i++){const a=s[i],c=e*t+a;if(!Number.isSafeInteger(c)||e*t/e!==t||c-a!=e*t)throw new Error("convertRadix: carry overflow");t=c%n;const h=Math.floor(c/n);if(s[i]=h,!Number.isSafeInteger(h)||h*n+t!==c)throw new Error("convertRadix: carry overflow");o&&(h?o=!1:r=i)}if(i.push(t),o)break}for(let e=0;e<t.length-1&&0===t[e];e++)i.push(0);return i.reverse()}const ge=(t,e)=>e?ge(e,t%e):t,ye=(t,e)=>t+(e-ge(t,e));function we(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(ye(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${ye(e,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const r of t){if(ae(r),r>=2**e)throw new Error(`convertRadix2: invalid data word=${r} from=${e}`);if(i=i<<e|r,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=e)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function be(t,e=!1){if(ae(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(ye(8,t)>32||ye(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!ce(n))throw new Error("radix2.encode input should be Uint8Array");return we(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("radix2.decode input should be array of numbers");return Uint8Array.from(we(n,t,8,e))}}}function me(t){if("function"!=typeof t)throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch(t){}}}be(4),le("0123456789ABCDEF"),ue(""),be(5),le("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),de(5),ue(""),be(5),le("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),ue(""),be(5),le("0123456789ABCDEFGHIJKLMNOPQRSTUV"),de(5),ue(""),be(5),le("0123456789ABCDEFGHIJKLMNOPQRSTUV"),ue(""),be(5),le("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),ue(""),fe((t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),be(6),le("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),de(6),ue(""),be(6),le("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),ue(""),be(6),le("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),de(6),ue(""),be(6),le("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),ue("");const ve=he(le("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),ue("")),Ee=[996825010,642813549,513874426,1027748829,705979059];function ke(t){const e=t>>25;let n=(33554431&t)<<5;for(let t=0;t<Ee.length;t++)1==(e>>t&1)&&(n^=Ee[t]);return n}function _e(t,e,n=1){const r=t.length;let i=1;for(let e=0;e<r;e++){const n=t.charCodeAt(e);if(n<33||n>126)throw new Error(`Invalid prefix (${t})`);i=ke(i)^n>>5}i=ke(i);for(let e=0;e<r;e++)i=ke(i)^31&t.charCodeAt(e);for(let t of e)i=ke(i)^t;for(let t=0;t<6;t++)i=ke(i);return i^=n,ve.encode(we([i%2**30],30,5,!1))}function Ae(t){const e="bech32"===t?1:734539939,n=be(5),r=n.decode,i=n.encode,s=me(r);function o(t,n,r=90){if("string"!=typeof t)throw new Error("bech32.encode prefix should be string, not "+typeof t);if(n instanceof Uint8Array&&(n=Array.from(n)),!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof n);if(0===t.length)throw new TypeError(`Invalid prefix length ${t.length}`);const i=t.length+7+n.length;if(!1!==r&&i>r)throw new TypeError(`Length ${i} exceeds limit ${r}`);const s=t.toLowerCase(),o=_e(s,n,e);return`${s}1${ve.encode(n)}${o}`}function a(t,n=90){if("string"!=typeof t)throw new Error("bech32.decode input should be string, not "+typeof t);if(t.length<8||!1!==n&&t.length>n)throw new TypeError(`Wrong string length: ${t.length} (${t}). Expected (8..${n})`);const r=t.toLowerCase();if(t!==r&&t!==t.toUpperCase())throw new Error("String must be lowercase or uppercase");const i=r.lastIndexOf("1");if(0===i||-1===i)throw new Error('Letter "1" must be present between prefix and data only');const s=r.slice(0,i),o=r.slice(i+1);if(o.length<6)throw new Error("Data must be at least 6 characters long");const a=ve.decode(o).slice(0,-6),c=_e(s,a,e);if(!o.endsWith(c))throw new Error(`Invalid checksum in ${t}: expected "${c}"`);return{prefix:s,words:a}}return{encode:o,decode:a,encodeFromBytes:function(t,e){return o(t,i(e))},decodeToBytes:function(t){const{prefix:e,words:n}=a(t,!1);return{prefix:e,words:n,bytes:r(n)}},decodeUnsafe:me(a),fromWords:r,fromWordsUnsafe:s,toWords:i}}const xe=Ae("bech32");function Se(t,e,n="write"){if(!t.outboxTracker)return;const r=t.outboxTracker.data.get(e);return r?"write"===n?r.writeRelays:r.readRelays:void 0}function Re(t,e,n,{count:r,preferredRelays:i}={}){r??=2,i??=new Set;const s=t.pool,o=s.connectedRelays();o.forEach((t=>{i.add(t.url)}));const a=new Map,{pubkeysToRelays:c,authorsMissingRelays:h}=function(t,e,n="read"){const r=new Map,i=new Set;return e.forEach((e=>{const s=Se(t,e,n);s&&s.size>0?(s.forEach((t=>{(r.get(t)||new Set).add(e)})),r.set(e,s)):i.add(e)})),{pubkeysToRelays:r,authorsMissingRelays:i}}(t,e,n),l=function(t,e){const n=new Map;return e.forEach((e=>{const r=Se(t,e);r&&r.forEach((t=>{const e=n.get(t)||0;n.set(t,e+1)}))})),Array.from(n.entries()).sort(((t,e)=>e[1]-t[1])).map((t=>t[0]))}(t,e),u=(t,e)=>{const n=a.get(e)||[];n.push(t),a.set(e,n)};for(const[t,e]of c.entries()){let n=r;for(const r of o)e.has(r.url)&&(u(t,r.url),n--);for(const r of e)a.has(r)&&(u(t,r),n--);if(!(n<=0))for(const r of l){if(n<=0)break;e.has(r)&&(u(t,r),n--)}}for(const t of h)s.permanentAndConnectedRelays().forEach((e=>{const n=a.get(e.url)||[];n.push(t),a.set(e.url,n)}));return a}function Ce(t){try{return Ne(t)}catch{return}}function Ne(t){let e=function(t,e){if("string"!=typeof(e={defaultProtocol:"http",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,removeExplicitPort:!1,sortQueryParameters:!0,...e}).defaultProtocol||e.defaultProtocol.endsWith(":")||(e.defaultProtocol=`${e.defaultProtocol}:`),t=t.trim(),/^data:/i.test(t))return Pe(t,e);if(Ue(t))return t;const n=t.startsWith("//");!n&&/^\.*\//.test(t)||(t=t.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,e.defaultProtocol));const r=new URL(t);if(e.forceHttp&&e.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(e.forceHttp&&"https:"===r.protocol&&(r.protocol="http:"),e.forceHttps&&"http:"===r.protocol&&(r.protocol="https:"),e.stripAuthentication&&(r.username="",r.password=""),e.stripHash?r.hash="":e.stripTextFragment&&(r.hash=r.hash.replace(/#?:~:text.*?$/i,"")),r.pathname){const t=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g;let e=0,n="";for(;;){const i=t.exec(r.pathname);if(!i)break;const s=i[0],o=i.index;n+=r.pathname.slice(e,o).replace(/\/{2,}/g,"/"),n+=s,e=o+s.length}n+=r.pathname.slice(e,r.pathname.length).replace(/\/{2,}/g,"/"),r.pathname=n}if(r.pathname)try{r.pathname=decodeURI(r.pathname)}catch{}if(!0===e.removeDirectoryIndex&&(e.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(e.removeDirectoryIndex)&&e.removeDirectoryIndex.length>0){let t=r.pathname.split("/");const n=t[t.length-1];Be(n,e.removeDirectoryIndex)&&(t=t.slice(0,-1),r.pathname=t.slice(1).join("/")+"/")}if(r.hostname&&(r.hostname=r.hostname.replace(/\.$/,""),e.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(r.hostname)&&(r.hostname=r.hostname.replace(/^www\./,""))),Array.isArray(e.removeQueryParameters))for(const t of[...r.searchParams.keys()])Be(t,e.removeQueryParameters)&&r.searchParams.delete(t);if(Array.isArray(e.keepQueryParameters)||!0!==e.removeQueryParameters||(r.search=""),Array.isArray(e.keepQueryParameters)&&e.keepQueryParameters.length>0)for(const t of[...r.searchParams.keys()])Be(t,e.keepQueryParameters)||r.searchParams.delete(t);if(e.sortQueryParameters){r.searchParams.sort();try{r.search=decodeURIComponent(r.search)}catch{}}e.removeTrailingSlash&&(r.pathname=r.pathname.replace(/\/$/,"")),e.removeExplicitPort&&r.port&&(r.port="");const i=t;return t=r.toString(),e.removeSingleSlash||"/"!==r.pathname||i.endsWith("/")||""!==r.hash||(t=t.replace(/\/$/,"")),(e.removeTrailingSlash||"/"===r.pathname)&&""===r.hash&&e.removeSingleSlash&&(t=t.replace(/\/$/,"")),n&&!e.normalizeProtocol&&(t=t.replace(/^http:\/\//,"//")),e.stripProtocol&&(t=t.replace(/^(?:https?:)?\/\//,"")),t}(t.toLowerCase(),{stripAuthentication:!1,stripWWW:!1,stripHash:!0});return e.endsWith("/")||(e+="/"),e}function Ie(t){const e=new Set;for(const n of t)try{e.add(Ne(n))}catch{}return Array.from(e)}be(4),le("0123456789abcdef"),ue(""),fe((t=>{if("string"!=typeof t||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})),n(6705);var Be=(t,e)=>e.some((e=>e instanceof RegExp?e.test(t):e===t)),Te=new Set(["https:","http:","file:"]),Ue=t=>{try{const{protocol:e}=new URL(t);return e.endsWith(":")&&!e.includes(".")&&!Te.has(e)}catch{return!1}},Pe=(t,{stripHash:e})=>{const n=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(t);if(!n)throw new Error(`Invalid URL: ${t}`);let r=n.groups?.type??"",i=n.groups?.data??"",s=n.groups?.hash??"";const o=r.split(";");s=e?"":s;let a=!1;"base64"===o[o.length-1]&&(o.pop(),a=!0);const c=o.shift()?.toLowerCase()??"",h=[...o.map((t=>{let[e,n=""]=t.split("=").map((t=>t.trim()));return"charset"===e&&(n=n.toLowerCase(),"us-ascii"===n)?"":`${e}${n?`=${n}`:""}`})).filter(Boolean)];return a&&h.push("base64"),(h.length>0||c&&"text/plain"!==c)&&h.unshift(c),`data:${h.join(";")},${a?i.trim():i}${s?`#${s}`:""}`},Le=class{ndkRelay;ws;_status;timeoutMs;connectedAt;_connectionStats={attempts:0,success:0,durations:[]};debug;netDebug;connectTimeout;reconnectTimeout;ndk;openSubs=new Map;openCountRequests=new Map;openEventPublishes=new Map;serial=0;baseEoseTimeout=4400;constructor(t,e){this.ndkRelay=t,this._status=1;const n=Math.floor(1e3*Math.random());this.debug=this.ndkRelay.debug.extend("connectivity"+n),this.ndk=e}async connect(t,e=!0){if(1!==this._status||this.reconnectTimeout)this.debug("Relay requested to be connected but was in state %s or it had a reconnect timeout",this._status);else{this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),t??=this.timeoutMs,!this.timeoutMs&&t&&(this.timeoutMs=t),this.timeoutMs&&(this.connectTimeout=setTimeout((()=>this.onConnectionError(e)),this.timeoutMs));try{this.updateConnectionStats.attempt(),1===this._status?this._status=4:this._status=2,this.ws=new WebSocket(this.ndkRelay.url),this.ws.onopen=this.onConnect.bind(this),this.ws.onclose=this.onDisconnect.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onerror=this.onError.bind(this)}catch(t){throw this.debug(`Failed to connect to ${this.ndkRelay.url}`,t),this._status=1,e?this.handleReconnection():this.ndkRelay.emit("delayed-connect",1728e5),t}}}disconnect(){this._status=0;try{this.ws?.close()}catch(t){this.debug("Failed to disconnect",t),this._status=1}}onConnectionError(t){this.debug(`Error connecting to ${this.ndkRelay.url}`,this.timeoutMs),t&&!this.reconnectTimeout&&this.handleReconnection()}onConnect(){this.netDebug?.("connected",this.ndkRelay),this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),this.updateConnectionStats.connected(),this._status=5,this.ndkRelay.emit("connect"),this.ndkRelay.emit("ready")}onDisconnect(){this.netDebug?.("disconnected",this.ndkRelay),this.updateConnectionStats.disconnected(),5===this._status&&this.handleReconnection(),this.ndkRelay.emit("disconnect"),this._status=1}onMessage(t){this.netDebug?.(t.data,this.ndkRelay,"recv");try{const e=JSON.parse(t.data),[n,r,...i]=e;switch(n){case"EVENT":{const t=this.openSubs.get(r),n=e[2];return t?void t.onevent(n):void this.debug(`Received event for unknown subscription ${r}`)}case"COUNT":{const t=e[2],n=this.openCountRequests.get(r);return void(n&&(n.resolve(t.count),this.openCountRequests.delete(r)))}case"EOSE":{const t=this.openSubs.get(r);if(!t)return;return void t.oneose(r)}case"OK":{const t=e[2],n=e[3],i=this.openEventPublishes.get(r),s=i?.pop();return i&&s?(t?s.resolve(n):s.reject(new Error(n)),void(0===i.length?this.openEventPublishes.delete(r):this.openEventPublishes.set(r,i))):void this.debug("Received OK for unknown event publish",r)}case"CLOSED":{const t=this.openSubs.get(r);if(!t)return;return void t.onclosed(e[2])}case"NOTICE":return void this.onNotice(e[1]);case"AUTH":return void this.onAuthRequested(e[1])}}catch(t){return void this.debug(`Error parsing message from ${this.ndkRelay.url}: ${t.message}`,t?.stack)}}async onAuthRequested(t){const e=this.ndkRelay.authPolicy??this.ndk?.relayAuthDefaultPolicy;if(this.debug("Relay requested authentication",{havePolicy:!!e}),7!==this._status)if(this._status=6,e){if(this._status>=5){let n;this._status=7;try{n=await e(this.ndkRelay,t)}catch(t){this.debug("Authentication policy threw an error",t),n=!1}if(this.debug("Authentication policy returned",!!n),n instanceof gn||!0===n){n instanceof gn&&await this.auth(n);const e=async()=>{if(this._status>=5&&this._status<8){const e=new gn(this.ndk);e.kind=22242,e.tags=[["relay",this.ndkRelay.url],["challenge",t]],await e.sign(),this.auth(e).then((()=>{this._status=8,this.ndkRelay.emit("authed"),this.debug("Authentication successful")})).catch((t=>{this._status=6,this.ndkRelay.emit("auth:failed",t),this.debug("Authentication failed",t)}))}else this.debug("Authentication failed, it changed status, status is %d",this._status)};!0===n&&(this.ndk?.signer?e().catch((t=>{console.error("Error authenticating",t)})):(this.debug("No signer available for authentication localhost"),this.ndk?.once("signer:ready",e))),this._status=5,this.ndkRelay.emit("authed")}}}else this.ndkRelay.emit("auth",t);else this.debug("Already authenticating, ignoring")}onError(t){this.debug(`WebSocket error on ${this.ndkRelay.url}:`,t)}get status(){return this._status}isAvailable(){return 5===this._status}isFlapping(){const t=this._connectionStats.durations;if(t.length%3!=0)return!1;const e=t.reduce(((t,e)=>t+e),0)/t.length,n=t.map((t=>Math.pow(t-e,2))).reduce(((t,e)=>t+e),0)/t.length;return Math.sqrt(n)<1e3}async onNotice(t){this.ndkRelay.emit("notice",t)}handleReconnection(t=0){if(this.reconnectTimeout)return;if(this.isFlapping())return this.ndkRelay.emit("flapping",this._connectionStats),void(this._status=3);const e=this.connectedAt?Math.max(0,6e4-(Date.now()-this.connectedAt)):5e3*(this._connectionStats.attempts+1);this.reconnectTimeout=setTimeout((()=>{this.reconnectTimeout=void 0,this._status=2,this.connect().catch((e=>{t<5?setTimeout((()=>{this.handleReconnection(t+1)}),1e3*(t+1)^4):this.debug("Reconnect failed")}))}),e),this.ndkRelay.emit("delayed-connect",e),this.debug("Reconnecting in",e),this._connectionStats.nextReconnectAt=Date.now()+e}async send(t){this._status>=5&&this.ws?.readyState===WebSocket.OPEN?(this.ws?.send(t),this.netDebug?.(t,this.ndkRelay,"send")):this.debug(`Not connected to ${this.ndkRelay.url} (%d), not sending message ${t}`,this._status)}async auth(t){const e=new Promise(((e,n)=>{const r=this.openEventPublishes.get(t.id)??[];r.push({resolve:e,reject:n}),this.openEventPublishes.set(t.id,r)}));return this.send('["AUTH",'+JSON.stringify(t.rawEvent())+"]"),e}async publish(t){const e=new Promise(((e,n)=>{const r=this.openEventPublishes.get(t.id)??[];r.length>0&&console.warn("Duplicate event publishing detected, you are publishing event "+t.id+" twice"),r.push({resolve:e,reject:n}),this.openEventPublishes.set(t.id,r)}));return this.send('["EVENT",'+JSON.stringify(t)+"]"),e}async count(t,e){this.serial++;const n=e?.id||"count:"+this.serial,r=new Promise(((t,e)=>{this.openCountRequests.set(n,{resolve:t,reject:e})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(t).substring(1)),r}close(t,e){this.send('["CLOSE","'+t+'"]');const n=this.openSubs.get(t);this.openSubs.delete(t),n&&n.onclose(e)}req(t){this.send('["REQ","'+t.subId+'",'+JSON.stringify(t.executeFilters).substring(1)),this.openSubs.set(t.subId,t)}updateConnectionStats={connected:()=>{this._connectionStats.success++,this._connectionStats.connectedAt=Date.now()},disconnected:()=>{this._connectionStats.connectedAt&&(this._connectionStats.durations.push(Date.now()-this._connectionStats.connectedAt),this._connectionStats.durations.length>100&&this._connectionStats.durations.shift()),this._connectionStats.connectedAt=void 0},attempt:()=>{this._connectionStats.attempts++,this._connectionStats.connectedAt=Date.now()}};get connectionStats(){return this._connectionStats}get url(){return this.ndkRelay.url}get connected(){return this._status>=5&&this.ws?.readyState===WebSocket.OPEN}},Oe=class{ndkRelay;debug;constructor(t){this.ndkRelay=t,this.debug=t.debug.extend("publisher")}async publish(t,e=2500){let n;const r=()=>new Promise(((e,n)=>{try{this.publishEvent(t).then((n=>{this.ndkRelay.emit("published",t),t.emit("relay:published",this.ndkRelay),e(!0)})).catch(n)}catch(t){n(t)}})),i=new Promise(((t,r)=>{n=setTimeout((()=>{n=void 0,r(new Error("Timeout: "+e+"ms"))}),e)})),s=()=>{r().then((t=>o(t))).catch((t=>a(t)))};let o,a;const c=e=>{throw this.ndkRelay.debug("Publish failed",e,t.id),this.ndkRelay.emit("publish:failed",t,e),t.emit("relay:publish:failed",this.ndkRelay,e),e},h=()=>{n&&clearTimeout(n),this.ndkRelay.removeListener("connect",s)};return this.ndkRelay.status>=5?Promise.race([r(),i]).catch(c).finally(h):(this.ndkRelay.status<=1?(console.warn("Relay is disconnected, trying to connect to publish an event",this.ndkRelay.url),this.ndkRelay.connect()):console.warn("Relay not connected, waiting for connection to publish an event",this.ndkRelay.url),Promise.race([new Promise(((t,e)=>{o=t,a=e,this.ndkRelay.once("connect",s)})),i]).catch(c).finally(h))}async publishEvent(t){return this.ndkRelay.connectivity.publish(t.rawEvent())}};function De(t){const e=[],n={};return t.filter((t=>!!t.limit)).forEach((t=>e.push(t))),0===(t=t.filter((t=>!t.limit))).length?e:(t.forEach((t=>{Object.entries(t).forEach((([t,e])=>{Array.isArray(e)?void 0===n[t]?n[t]=[...e]:n[t]=Array.from(new Set([...n[t],...e])):n[t]=e}))})),[...e,n])}var $e=class{fingerprint;items=new Map;topSubscriptionManager;debug;status=0;onClose;relay;eosed=!1;executionTimer;fireTime;delayType;executeFilters;id=Math.random().toString(36).substring(7);constructor(t,e){this.relay=t,this.debug=t.debug.extend("subscription-"+this.id),this.fingerprint=e||Math.random().toString(36).substring(7)}_subId;get subId(){return this._subId||(this._subId=this.fingerprint.slice(0,15)),this._subId}subIdParts=new Set;addSubIdPart(t){this.subIdParts.add(t)}addItem(t,e){if(!this.items.has(t.internalId))switch(t.on("close",this.removeItem.bind(this,t)),this.items.set(t.internalId,{subscription:t,filters:e}),3!==this.status&&t.subId&&(!this._subId||this._subId.length<48)&&(0!==this.status&&1!==this.status||this.addSubIdPart(t.subId)),this.status){case 0:case 1:this.evaluateExecutionPlan(t);break;case 3:console.log("BUG: This should not happen: This subscription needs to catch up with a subscription that was already running",e);break;case 4:throw this.debug("Subscription is closed, cannot add new items %o (%o)",t,e),new Error("Cannot add new items to a closed subscription")}}removeItem(t){if(this.items.delete(t.internalId),0===this.items.size){if(!this.eosed)return;this.close()}}close(){if(4===this.status)return;const t=this.status;if(this.status=4,3===t)try{this.relay.close(this.subId)}catch(t){this.debug("Error closing subscription",t,this)}else this.debug("Subscription wanted to close but it wasn't running, this is probably ok",{subId:this.subId,prevStatus:t,sub:this});this.cleanup()}cleanup(){this.executionTimer&&clearTimeout(this.executionTimer),this.relay.off("ready",this.executeOnRelayReady),this.relay.off("authed",this.reExecuteAfterAuth),this.onClose&&this.onClose(this)}evaluateExecutionPlan(t){if(!t.isGroupable())return this.status=1,void this.execute();if(t.filters.find((t=>!!t.limit))&&(this.executeFilters=this.compileFilters(),this.executeFilters.length>=10))return this.status=1,void this.execute();const e=t.groupableDelay,n=t.groupableDelayType;if(!e)throw new Error("Cannot group a subscription without a delay");if(0===this.status)this.schedule(e,n);else{const t=this.delayType,r=this.fireTime-Date.now();if("at-least"===t&&"at-least"===n)r<e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,n));else if("at-least"===t&&"at-most"===n)r>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,n));else if("at-most"===t&&"at-most"===n)r>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,n));else{if("at-most"!==t||"at-least"!==n)throw new Error("Unknown delay type combination "+t+" "+n);r>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,n))}}}schedule(t,e){this.status=1;const n=Date.now();this.fireTime=n+t,this.delayType=e;const r=setTimeout(this.execute.bind(this),t);"at-least"===e&&(this.executionTimer=r)}executeOnRelayReady=()=>{2===this.status&&(this.status=1,this.execute())};finalizeSubId(){this.subIdParts.size>0?this._subId=Array.from(this.subIdParts).join("-"):this._subId=this.fingerprint.slice(0,15),this._subId+="-"+Math.random().toString(36).substring(2,7)}reExecuteAfterAuth=(()=>{const t=this.subId;this.debug("Re-executing after auth",this.items.size),this.eosed?this.relay.close(this.subId):this.debug("We are abandoning an opened subscription, once it EOSE's, the handler will close it",{oldSubId:t}),this._subId=void 0,this.status=1,this.execute(),this.debug("Re-executed after auth %s 👉 %s",t,this.subId)}).bind(this);execute(){if(1===this.status){if(!this.relay.connected)return this.status=2,void this.relay.once("ready",this.executeOnRelayReady);this.relay.status<8&&this.relay.once("authed",this.reExecuteAfterAuth),this.status=3,this.finalizeSubId(),this.executeFilters=this.compileFilters(),this.relay.req(this)}}onstart(){}onevent(t){this.topSubscriptionManager?.seenEvent(t.id,this.relay);for(const{subscription:e}of this.items.values())(0,i.XN)(e.filters,t)&&e.eventReceived(t,this.relay,!1)}oneose(t){if(this.eosed=!0,t!==this.subId)return this.debug("Received EOSE for an abandoned subscription",t,this.subId),void this.relay.close(t);0===this.items.size&&this.close();for(const{subscription:t}of this.items.values())t.eoseReceived(this.relay),t.closeOnEose&&this.removeItem(t)}onclose(t){this.status=4}onclosed(t){if(t)for(const{subscription:e}of this.items.values())e.closedReceived(this.relay,t)}compileFilters(){const t=[],e=Array.from(this.items.values()).map((t=>t.filters));e[0]||(this.debug("👀 No filters to merge",this.items),console.trace("No filters to merge"));const n=e[0].length;for(let r=0;r<n;r++){const n=e.map((t=>t[r]));t.push(...De(n))}return t}},Fe=class{relay;subscriptions;topSubscriptionManager;constructor(t,e){this.relay=t,this.subscriptions=new Map,this.topSubscriptionManager=e}addSubscription(t,e){let n;if(t.isGroupable()){const r=function(t,e){const n=[];for(const e of t){const t=Object.entries(e||{}).map((([t,e])=>["since","until"].includes(t)?t+":"+e:t)).sort().join("-");n.push(t)}let r=e?"+":"";return r+=n.join("|"),r}(e,t.closeOnEose);r&&(n=(this.subscriptions.get(r)||[]).find((t=>t.status<3))),n??=this.createSubscription(t,e,r)}else n=this.createSubscription(t,e);n.addItem(t,e)}createSubscription(t,e,n){const r=new $e(this.relay,n);r.topSubscriptionManager=this.topSubscriptionManager,r.onClose=this.onRelaySubscriptionClose.bind(this);const i=this.subscriptions.get(r.fingerprint)??[];return this.subscriptions.set(r.fingerprint,[...i,r]),r}onRelaySubscriptionClose(t){let e=this.subscriptions.get(t.fingerprint)??[];e?1===e.length?this.subscriptions.delete(t.fingerprint):(e=e.filter((e=>e.id!==t.id)),this.subscriptions.set(t.fingerprint,e),console.log("removing a subscription",{fingerprint:t.fingerprint,id:t.id,newSize:this.subscriptions.size})):console.warn("Unexpectedly did not find a subscription with fingerprint",t.fingerprint)}},Me=(t=>(t[t.DISCONNECTING=0]="DISCONNECTING",t[t.DISCONNECTED=1]="DISCONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.FLAPPING=3]="FLAPPING",t[t.CONNECTING=4]="CONNECTING",t[t.CONNECTED=5]="CONNECTED",t[t.AUTH_REQUESTED=6]="AUTH_REQUESTED",t[t.AUTHENTICATING=7]="AUTHENTICATING",t[t.AUTHENTICATED=8]="AUTHENTICATED",t))(Me||{}),ze=class t extends s.EventEmitter{url;scores;connectivity;subs;publisher;authPolicy;lowestValidationRatio;targetValidationRatio;validationRatioFn;validatedEventCount=0;nonValidatedEventCount=0;trusted=!1;complaining=!1;debug;static defaultValidationRatioUpdateFn=(t,e,n)=>{if(void 0===t.lowestValidationRatio||void 0===t.targetValidationRatio)return 1;let r=t.validationRatio;if(t.validationRatio>t.targetValidationRatio){const n=e/100;r=Math.max(t.lowestValidationRatio,t.validationRatio-n)}return r<t.validationRatio?r:t.validationRatio};constructor(e,n,r){super(),this.url=Ne(e),this.scores=new Map,this.debug=o(`ndk:relay:${e}`),this.connectivity=new Le(this,r),this.connectivity.netDebug=r?.netDebug,this.req=this.connectivity.req.bind(this.connectivity),this.close=this.connectivity.close.bind(this.connectivity),this.subs=new Fe(this,r?.subManager),this.publisher=new Oe(this),this.authPolicy=n,this.targetValidationRatio=r?.initialValidationRatio,this.lowestValidationRatio=r?.lowestValidationRatio,this.validationRatioFn=(r?.validationRatioFn??t.defaultValidationRatioUpdateFn).bind(this),this.updateValidationRatio(),r||console.trace("relay created without ndk")}updateValidationRatio(){setTimeout((()=>{this.updateValidationRatio()}),3e4)}get status(){return this.connectivity.status}get connectionStats(){return this.connectivity.connectionStats}async connect(t,e=!0){return this.connectivity.connect(t,e)}disconnect(){1!==this.status&&this.connectivity.disconnect()}subscribe(t,e){this.subs.addSubscription(t,e)}async publish(t,e=2500){return this.publisher.publish(t,e)}referenceTags(){return[["r",this.url]]}addValidatedEvent(){this.validatedEventCount++}addNonValidatedEvent(){this.nonValidatedEventCount++}get validationRatio(){return 0===this.nonValidatedEventCount?1:this.validatedEventCount/(this.validatedEventCount+this.nonValidatedEventCount)}shouldValidateEvent(){return!this.trusted&&(void 0===this.targetValidationRatio||this.validationRatio<this.targetValidationRatio)}get connected(){return this.connectivity.connected}req;close},He=class extends Error{errors;publishedToRelays;intendedRelaySet;constructor(t,e,n,r){super(t),this.errors=e,this.publishedToRelays=n,this.intendedRelaySet=r}get relayErrors(){const t=[];for(const[e,n]of this.errors)t.push(`${e.url}: ${n}`);return t.join("\n")}},Ke=class t{relays;debug;ndk;constructor(t,e){this.relays=t,this.ndk=e,this.debug=e.debug.extend("relayset")}addRelay(t){this.relays.add(t)}get relayUrls(){return Array.from(this.relays).map((t=>t.url))}static fromRelayUrls(e,n,r=!0){const i=new Set;for(const t of e){const s=n.pool.relays.get(Ne(t));if(s)s.status<5&&r&&s.connect(),i.add(s);else{const r=new ze(Ne(t),n?.relayAuthDefaultPolicy,n);n.pool.useTemporaryRelay(r,void 0,"requested from fromRelayUrls "+e),i.add(r)}}return new t(new Set(i),n)}async publish(t,e,n=1){const r=new Set,i=new Map,s=t.isEphemeral();t.publishStatus="pending";const o=Array.from(this.relays).map((n=>new Promise((o=>{n.publish(t,e).then((t=>{r.add(n),o()})).catch((t=>{s||i.set(n,t),o()}))}))));if(await Promise.all(o),r.size<n){if(!s){const e=new He("Not enough relays received the event",i,r,this);throw t.publishStatus="error",t.publishError=e,this.ndk.emit("event:publish-failed",t,e,this.relayUrls),e}}else t.emit("published",{relaySet:this,publishedToRelays:r});return r}get size(){return this.relays.size}},qe=o("ndk:outbox:calculate");function je(t,e,n){return function(t,e,n){const r=new Map,i=new Set;if(e.forEach((t=>{t.authors&&t.authors.forEach((t=>i.add(t)))})),i.size>0){const n=function(t,e,n=2){return Re(t,e,"write",{count:n})}(t,Array.from(i));for(const t of n.keys())r.set(t,[]);for(const t of e)if(t.authors)for(const[e,i]of n.entries()){const n=t.authors.filter((t=>i.includes(t)));r.set(e,[...r.get(e),{...t,authors:n}])}else for(const e of n.keys())r.set(e,[...r.get(e),t])}else t.explicitRelayUrls&&t.explicitRelayUrls.forEach((t=>{r.set(t,e)}));return 0===r.size&&n.permanentAndConnectedRelays().slice(0,5).forEach((t=>{r.set(t.url,e)})),r}(t,e,n)}async function We(t){return""}function Ve(){if(void 0===this.kind)throw new Error("Kind not set");return[0,3].includes(this.kind)||this.kind>=1e4&&this.kind<2e4||this.kind>=3e4&&this.kind<4e4}function Ge(){if(void 0===this.kind)throw new Error("Kind not set");return this.kind>=2e4&&this.kind<3e4}function Ze(){if(void 0===this.kind)throw new Error("Kind not set");return this.kind>=3e4&&this.kind<4e4}var Ye,Je="nip04";async function Qe(t,e,n=Je){if(!this.ndk)throw new Error("No NDK instance found!");if(e||(await this.ndk.assertSigner(),e=this.ndk.signer),!t){const e=this.getMatchingTags("p");if(1!==e.length)throw new Error("No recipient could be determined and no explicit recipient was provided");t=this.ndk.getUser({pubkey:e[0][1]})}this.content=await(e?.encrypt(t,this.content,n))}async function Xe(t,e,n=Je){if(!this.ndk)throw new Error("No NDK instance found!");e||(await this.ndk.assertSigner(),e=this.ndk.signer),t||(t=this.author),this.content=await(e?.decrypt(t,this.content,n))}function tn(t=5){let e=[];return this.onRelays.length>0?e=this.onRelays.map((t=>t.url)):this.relay&&(e=[this.relay.url]),e.length>t&&(e=e.slice(0,t)),this.isParamReplaceable()?i.Qe.naddrEncode({kind:this.kind,pubkey:this.pubkey,identifier:this.replaceableDTag(),relays:e}):e.length>0?i.Qe.neventEncode({id:this.tagId(),relays:e,author:this.pubkey}):i.Qe.noteEncode(this.tagId())}async function en(t=!0,e){if(!e&&t){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),e=this.ndk.signer}const n=new gn(this.ndk,{kind:(r=this,1===r.kind?6:16),content:""});var r;return n.tag(this),16===n.kind?n.tags.push(["k",`${this.kind}`]):n.content=JSON.stringify(this.rawEvent()),e&&await n.sign(e),t&&await n.publish(),n}function nn(t){return t.getMatchingTags("e").some((t=>t[3]))}async function rn(t,e){if(!this.ndk)throw new Error("NDK instance not found");const n=this.getMatchingTags(t,e);if(0===n.length)return;const[r,i,s]=n[0];return await this.ndk.fetchEvent(i,{},void 0)}async function sn(t){if(!this.ndk)throw new Error("NDK instance not found");const e=function(t,e){e??=t.tagType();const n=t.tags.find((t=>"root"===t[3]));if(!n){if(nn(t))return;const n=t.getMatchingTags(e);if(n.length<3)return n[0]}return n}(this);if(e)return this.ndk.fetchEventFromTag(e,this,t)}async function on(t){if(!this.ndk)throw new Error("NDK instance not found");const e=function(t,e){e??=t.tagType();let n=t.tags.find((t=>"reply"===t[3]));if(n)return n;if(n||(n=t.tags.find((t=>"root"===t[3]))),!n){if(nn(t))return;const n=t.getMatchingTags(e);if(1===n.length)return n[0];if(2===n.length)return n[1]}}(this);if(e)return this.ndk.fetchEventFromTag(e,this,t)}function an(t=!1,e=!1){const n=[0,this.pubkey,this.created_at,this.kind,this.tags,this.content];return t&&n.push(this.sig),e&&n.push(this.id),JSON.stringify(n)}var cn={},hn=/^[a-f0-9]{64}$/;function ln(){if("number"!=typeof this.kind)return!1;if("string"!=typeof this.content)return!1;if("number"!=typeof this.created_at)return!1;if("string"!=typeof this.pubkey)return!1;if(!this.pubkey.match(hn))return!1;if(!Array.isArray(this.tags))return!1;for(let t=0;t<this.tags.length;t++){const e=this.tags[t];if(!Array.isArray(e))return!1;for(let t=0;t<e.length;t++)if("object"==typeof e[t])return!1}return!0}var un=new oe.LRUCache({maxSize:1e3,entryExpirationTimeInMS:6e4});function dn(t){if("boolean"==typeof this.signatureVerified)return this.signatureVerified;const e=un.get(this.id);if(null!==e)return this.signatureVerified=!!e;try{if(!this.ndk?.asyncSigVerification){const t=R((new TextEncoder).encode(this.serialize())),e=se.verify(this.sig,t,this.pubkey);return e?un.set(this.id,this.sig):un.set(this.id,!1),this.signatureVerified=e}(async function(t){return new Promise((e=>{const n=t.serialize();let r=!1;cn[t.id]||(cn[t.id]={event:t,resolves:[]},r=!0),cn[t.id].resolves.push(e),r&&Ye.postMessage({serialized:n,id:t.id,sig:t.sig,pubkey:t.pubkey})}))})(this).then((e=>{t&&(this.signatureVerified=e,e&&un.set(this.id,this.sig)),e||(this.ndk.emit("event:invalid-sig",this),un.set(this.id,!1))}))}catch(t){return this.signatureVerified=!1}}function fn(){return t=this.serialize(),p(R((new TextEncoder).encode(t)));var t}var pn=[3],gn=class t extends s.EventEmitter{ndk;created_at;content="";tags=[];kind;id="";sig;pubkey="";signatureVerified;_author=void 0;relay;get onRelays(){let t=[];return this.ndk?t=this.ndk.subManager.seenEvents.get(this.id)||[]:this.relay&&t.push(this.relay),t}publishStatus="success";publishError;constructor(e,n){super(),this.ndk=e,this.created_at=n?.created_at,this.content=n?.content||"",this.tags=n?.tags||[],this.id=n?.id||"",this.sig=n?.sig,this.pubkey=n?.pubkey||"",this.kind=n?.kind,n instanceof t&&(this.relay&&(this.relay=n.relay,this.ndk?.subManager.seenEvent(n.id,this.relay)),this.publishStatus=n.publishStatus,this.publishError=n.publishError)}static deserialize(e,n){return new t(e,function(t){const e=JSON.parse(t),n={pubkey:e[1],created_at:e[2],kind:e[3],tags:e[4],content:e[5]};return 7===e.length&&(n.sig=e[6]),8===e.length&&(n.id=e[7]),n}(n))}rawEvent(){return{created_at:this.created_at,content:this.content,tags:this.tags,kind:this.kind,pubkey:this.pubkey,id:this.id,sig:this.sig}}set author(t){this.pubkey=t.pubkey,this._author=t,this._author.ndk??=this.ndk}get author(){if(this._author)return this._author;if(!this.ndk)throw new Error("No NDK instance found");const t=this.ndk.getUser({pubkey:this.pubkey});return this._author=t,t}tagExternal(t,e,n){let r=["i"],i=["k"];switch(e){case"url":const n=new URL(t);n.hash="",r.push(n.toString()),i.push(`${n.protocol}//${n.host}`);break;case"hashtag":r.push(`#${t.toLowerCase()}`),i.push("#");break;case"geohash":r.push(`geo:${t.toLowerCase()}`),i.push("geo");break;case"isbn":r.push(`isbn:${t.replace(/-/g,"")}`),i.push("isbn");break;case"podcast:guid":r.push(`podcast:guid:${t}`),i.push("podcast:guid");break;case"podcast:item:guid":r.push(`podcast:item:guid:${t}`),i.push("podcast:item:guid");break;case"podcast:publisher:guid":r.push(`podcast:publisher:guid:${t}`),i.push("podcast:publisher:guid");break;case"isan":r.push(`isan:${t.split("-").slice(0,4).join("-")}`),i.push("isan");break;case"doi":r.push(`doi:${t.toLowerCase()}`),i.push("doi");break;default:throw new Error(`Unsupported NIP-73 entity type: ${e}`)}n&&r.push(n),this.tags.push(r),this.tags.push(i)}tag(e,n,r,i){let s=[];if(void 0!==e.fetchProfile){i??="p";const t=[i,e.pubkey];n&&t.push("",n),s.push(t)}else if(e instanceof t){const t=e;r??=t?.pubkey===this.pubkey,s=t.referenceTags(n,r,i);for(const e of t.getMatchingTags("p"))e[1]!==this.pubkey&&(this.tags.find((t=>"p"===t[0]&&t[1]===e[1]))||this.tags.push(["p",e[1]]))}else{if(!Array.isArray(e))throw new Error("Invalid argument",e);s=[e]}this.tags=function(t,e){const n=new Map,r=(t,e)=>t.every(((t,n)=>t===e[n]));return t.concat(e).forEach((t=>{for(const[e,i]of n)if(r(i,t)||r(t,i))return void(t.length>=i.length&&n.set(e,t));n.set((t=>t.join(","))(t),t)})),Array.from(n.values())}(this.tags,s)}async toNostrEvent(t){if(!t&&""===this.pubkey){const t=await(this.ndk?.signer?.user());this.pubkey=t?.pubkey||""}this.created_at||(this.created_at=Math.floor(Date.now()/1e3));const{content:e,tags:n}=await this.generateTags();this.content=e||"",this.tags=n;try{this.id=this.getEventHash()}catch(t){}return this.rawEvent()}serialize=an.bind(this);getEventHash=fn.bind(this);validate=ln.bind(this);verifySignature=dn.bind(this);isReplaceable=Ve.bind(this);isEphemeral=Ge.bind(this);isParamReplaceable=Ze.bind(this);encode=tn.bind(this);encrypt=Qe.bind(this);decrypt=Xe.bind(this);getMatchingTags(t,e){const n=this.tags.filter((e=>e[0]===t));return void 0===e?n:n.filter((t=>t[3]===e))}hasTag(t,e){return this.tags.some((n=>n[0]===t&&(!e||n[3]===e)))}tagValue(t){const e=this.getMatchingTags(t);if(0!==e.length)return e[0][1]}get alt(){return this.tagValue("alt")}set alt(t){this.removeTag("alt"),t&&this.tags.push(["alt",t])}get dTag(){return this.tagValue("d")}set dTag(t){this.removeTag("d"),t&&this.tags.push(["d",t])}removeTag(t){const e=Array.isArray(t)?t:[t];this.tags=this.tags.filter((t=>!e.includes(t[0])))}async sign(t){t?this.author=await t.user():(this.ndk?.assertSigner(),t=this.ndk.signer);const e=await this.toNostrEvent();return this.sig=await t.sign(e),this.sig}async publishReplaceable(t,e,n){return this.id="",this.created_at=Math.floor(Date.now()/1e3),this.sig="",this.publish(t,e,n)}async publish(t,e,n){if(this.sig||await this.sign(),!this.ndk)throw new Error("NDKEvent must be associated with an NDK instance to publish");t||(t=this.ndk.devWriteRelaySet||await async function(t,e){const n=new Set,r=await async function(t,e,n="write"){if(t.outboxTracker)return t.outboxTracker.data.has(e)||await t.outboxTracker.trackUsers([e]),Se(t,e,n)}(t,e.pubkey);r&&r.forEach((e=>{const r=t.pool?.getRelay(e);r&&n.add(r)}));let i=e.tags.filter((t=>["a","e"].includes(t[0]))).map((t=>t[2])).filter((t=>t&&t.startsWith("wss://"))).filter((t=>{try{return new URL(t),!0}catch{return!1}})).map((t=>Ne(t)));i=Array.from(new Set(i)).slice(0,5),i.forEach((e=>{const r=t.pool?.getRelay(e,!0,!0);r&&(qe("Adding relay hint %s",e),n.add(r))}));const s=e.getMatchingTags("p").map((t=>t[1]));return s.length<5?Array.from(Re(t,s,"read",{preferredRelays:new Set(r)}).keys()).forEach((e=>{const r=t.pool?.getRelay(e,!1,!0);r&&(qe("Adding p-tagged relay %s",e),n.add(r))})):qe("Too many p-tags to consider %d",s.length),t.pool?.permanentAndConnectedRelays().forEach((t=>n.add(t))),new Ke(n,t)}(this.ndk,this)),5===this.kind&&this.ndk.cacheAdapter?.deleteEvent&&this.ndk.cacheAdapter.deleteEvent(this);const r=this.rawEvent();if(this.ndk.cacheAdapter?.addUnpublishedEvent)try{this.ndk.cacheAdapter.addUnpublishedEvent(this,t.relayUrls)}catch(t){console.error("Error adding unpublished event to cache",t)}this.ndk.subManager.subscriptions.forEach((t=>{t.filters.some((t=>(0,i.eA)(t,r)))&&t.eventReceived(this,void 0,!1,!0)}));const s=await t.publish(this,e,n);return s.forEach((t=>this.ndk?.subManager.seenEvent(this.id,t))),s}async generateTags(){let t=[];const e=await async function(t,e=[]){const n=[],r=t=>{e.find((e=>["q",t[0]].includes(e[0])&&e[1]===t[1]))||e.push(t)};return t=t.replace(/(@|nostr:)(npub|nprofile|note|nevent|naddr)[a-zA-Z0-9]+/g,(t=>{try{const e=t.split(/(@|nostr:)/)[2],{type:s,data:o}=i.Qe.decode(e);let a;switch(s){case"npub":a=["p",o];break;case"nprofile":a=["p",o.pubkey];break;case"note":n.push(new Promise((async t=>{r(["e",o,await We(),"mention"]),t()})));break;case"nevent":n.push(new Promise((async t=>{const{id:e,author:n}=o;let{relays:i}=o;i&&0!==i.length||(i=[await We()]),r(["e",e,i[0],"mention"]),n&&r(["p",n]),t()})));break;case"naddr":n.push(new Promise((async t=>{const e=[o.kind,o.pubkey,o.identifier].join(":");let n=o.relays??[];0===n.length&&(n=[await We()]),r(["a",e,n[0],"mention"]),r(["p",o.pubkey]),t()})));break;default:return t}return a&&r(a),`nostr:${e}`}catch(e){return t}})),await Promise.all(n),{content:t=t.replace(/(?<=\s|^)(#[^\s!@#$%^&*()=+./,[{\]};:'"?><]+)/g,((t,n)=>{const r=["t",n.slice(1)];return e.find((t=>t[0]===r[0]&&t[1]===r[1]))||e.push(r),t})),tags:e}}(this.content,this.tags),n=e.content;if(t=e.tags,this.kind&&this.isParamReplaceable()&&!this.getMatchingTags("d")[0]){const e=this.tagValue("title");let n=[...Array(e?6:16)].map((()=>Math.random().toString(36)[2])).join("");e&&e.length>0&&(n=e.replace(/[^a-z0-9]+/gi,"-").replace(/^-|-$/g,"")+"-"+n),t.push(["d",n])}if((this.ndk?.clientName||this.ndk?.clientNip89)&&pn.includes(this.kind)&&!this.tags.some((t=>"client"===t[0]))){const e=["client",this.ndk.clientName??""];this.ndk.clientNip89&&e.push(this.ndk.clientNip89),t.push(e)}return{content:n||"",tags:t}}muted(){const t=this.ndk?.mutedIds.get(this.pubkey);if(t&&"p"===t)return"author";const e=this.tagReference(),n=this.ndk?.mutedIds.get(e[1]);return n&&n===e[0]?"event":null}replaceableDTag(){if(this.kind&&this.kind>=3e4&&this.kind<=4e4){const t=this.getMatchingTags("d")[0];return t?t[1]:""}throw new Error("Event is not a parameterized replaceable event")}deduplicationKey(){return 0===this.kind||3===this.kind||this.kind&&this.kind>=1e4&&this.kind<2e4?`${this.kind}:${this.pubkey}`:this.tagId()}tagId(){return this.isParamReplaceable()?this.tagAddress():this.id}tagAddress(){if(!this.isParamReplaceable())throw new Error("This must only be called on replaceable events");const t=this.replaceableDTag();return`${this.kind}:${this.pubkey}:${t}`}tagType(){return this.isParamReplaceable()?"a":"e"}tagReference(t){let e;return e=this.isParamReplaceable()?["a",this.tagAddress()]:["e",this.tagId()],this.relay?e.push(this.relay.url):e.push(""),t&&e.push(t),e}referenceTags(t,e,n){let r=[];return r=this.isParamReplaceable()?[[n??"a",this.tagAddress()],[n??"e",this.id]]:[[n??"e",this.id]],this.relay?.url?r=r.map((t=>(t.push(this.relay?.url),t))):t&&(r=r.map((t=>(t.push(""),t)))),t&&r.forEach((e=>e.push(t))),r=[...r,...this.getMatchingTags("h")],e||r.push(...this.author.referenceTags()),r}filter(){return this.isParamReplaceable()?{"#a":[this.tagId()]}:{"#e":[this.tagId()]}}async delete(e,n=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const r=new t(this.ndk,{kind:5,content:e||""});return r.tag(this,void 0,!0),r.tags.push(["k",this.kind.toString()]),n&&await r.publish(),r}fetchTaggedEvent=rn.bind(this);fetchRootEvent=sn.bind(this);fetchReplyEvent=on.bind(this);repost=en.bind(this);async react(e,n=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const r=new t(this.ndk,{kind:7,content:e});return r.tag(this),n?await r.publish():await r.sign(),r}get isValid(){return this.validate()}};function yn(t){return!(!t.filter.ids||!function(t){const e=t.filter.ids;return!!e&&e.length===t.eventFirstSeen.size}(t))}function wn(t){let e;if(t.match(bn)){const[e,n,r]=t.split(":"),i={authors:[n],kinds:[parseInt(e)]};return r&&(i["#d"]=[r]),i}if(t.match(mn))try{switch(e=i.Qe.decode(t),e.type){case"nevent":{const t={ids:[e.data.id]};return e.data.author&&(t.authors=[e.data.author]),e.data.kind&&(t.kinds=[e.data.kind]),t}case"note":return{ids:[e.data]};case"naddr":const t={authors:[e.data.pubkey],kinds:[e.data.kind]};return e.data.identifier&&(t["#d"]=[e.data.identifier]),t}}catch(e){console.error("Error decoding",t,e)}return{ids:[t]}}var bn=/^(\d+):([0-9A-Fa-f]+)(?::(.*))?$/,mn=/^n(event|ote|profile|pub|addr)1[\d\w]+$/;var vn={closeOnEose:!1,cacheUsage:"CACHE_FIRST",groupable:!0,groupableDelay:100,groupableDelayType:"at-most"},En=class extends s.EventEmitter{subId;filters;opts;pool;skipVerification=!1;skipValidation=!1;relayFilters;relaySet;ndk;debug;eventFirstSeen=new Map;eosesSeen=new Set;lastEventReceivedAt;internalId;closeOnEose;poolMonitor;skipOptimisticPublishEvent=!1;constructor(t,e,n,r,i){if(super(),this.ndk=t,this.pool=n?.pool||t.pool,this.opts={...vn,...n||{}},this.filters=e instanceof Array?e:[e],this.subId=i||n?.subId,this.internalId=Math.random().toString(36).substring(7),this.relaySet=r,this.debug=t.debug.extend(`subscription[${n?.subId??this.internalId}]`),this.skipVerification=n?.skipVerification||!1,this.skipValidation=n?.skipValidation||!1,this.closeOnEose=n?.closeOnEose||!1,this.skipOptimisticPublishEvent=n?.skipOptimisticPublishEvent||!1,"ONLY_CACHE"===this.opts.cacheUsage&&!this.opts.closeOnEose)throw new Error("Cannot use cache-only options with a persistent subscription")}relaysMissingEose(){return this.relayFilters?Array.from(this.relayFilters.keys()).filter((t=>!this.eosesSeen.has(this.pool.getRelay(t,!1,!1)))):[]}get filter(){return this.filters[0]}get groupableDelay(){if(this.isGroupable())return this.opts?.groupableDelay}get groupableDelayType(){return this.opts?.groupableDelayType||"at-most"}isGroupable(){return this.opts?.groupable||!1}shouldQueryCache(){return"ONLY_RELAY"!==this.opts?.cacheUsage}shouldQueryRelays(){return"ONLY_CACHE"!==this.opts?.cacheUsage}shouldWaitForCache(){return this.opts.closeOnEose&&!!this.ndk.cacheAdapter?.locking&&"PARALLEL"!==this.opts.cacheUsage}async start(){let t;this.shouldQueryCache()&&(t=this.startWithCache(),this.shouldWaitForCache()&&(await t,yn(this)))?this.emit("eose",this):this.shouldQueryRelays()?(this.startWithRelays(),this.startPoolMonitor()):this.emit("eose",this)}startPoolMonitor(){this.debug.extend("pool-monitor"),this.poolMonitor=t=>{this.relayFilters?.has(t.url)||je(this.ndk,this.filters,this.pool).get(t.url)&&(this.relayFilters?.set(t.url,this.filters),t.subscribe(this,this.filters))},this.pool.on("relay:connect",this.poolMonitor)}stop(){this.emit("close",this),this.poolMonitor&&this.pool.off("relay:connect",this.poolMonitor),this.removeAllListeners()}hasAuthorsFilter(){return this.filters.some((t=>t.authors?.length))}async startWithCache(){if(this.ndk.cacheAdapter?.query){const t=this.ndk.cacheAdapter.query(this);this.ndk.cacheAdapter.locking&&await t}}startWithRelays(){if(this.relaySet&&0!==this.relaySet.relays.size){this.relayFilters=new Map;for(const t of this.relaySet.relays)this.relayFilters.set(t.url,this.filters)}else this.relayFilters=je(this.ndk,this.filters,this.pool);if(this.relayFilters&&0!==this.relayFilters.size)for(const[t,e]of this.relayFilters)this.pool.getRelay(t,!0,!0,e).subscribe(this,e)}eventReceived(t,e,n=!1,r=!1){const i=t.id,s=this.eventFirstSeen.has(i);let o;if(t instanceof gn&&(o=t),s){const n=Date.now()-(this.eventFirstSeen.get(i)||0);if(this.emit("event:dup",i,e,n,this),e){const n=un.get(i);n&&"string"==typeof n&&t.sig===n&&e.addValidatedEvent()}}else{if(o??=new gn(this.ndk,t),o.ndk=this.ndk,o.relay=e,!n&&!r){if(!this.skipValidation&&!o.isValid)return void this.debug("Event failed validation %s from relay %s",i,e?.url);if(e)if(!1!==e?.shouldValidateEvent()){if(!this.skipVerification){if(!o.verifySignature(!0)&&!this.ndk.asyncSigVerification)return void this.debug("Event failed signature validation",t);e&&e.addValidatedEvent()}}else e.addNonValidatedEvent();this.ndk.cacheAdapter&&this.ndk.cacheAdapter.setEvent(o,this.filters,e)}!n&&e&&this.ndk.emit("event",o,e),r&&!0===this.skipOptimisticPublishEvent||(this.emit("event",o,e,this),this.eventFirstSeen.set(i,Date.now()))}this.lastEventReceivedAt=Date.now()}closedReceived(t,e){this.emit("closed",t,e)}eoseTimeout;eosed=!1;eoseReceived(t){this.debug("EOSE received from %s",t.url),this.eosesSeen.add(t);let e=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0;const n=this.eosesSeen.size===this.relayFilters?.size,r=yn(this),i=t=>{this.debug("Performing EOSE: %s %d",t,this.eosed),this.eosed||(this.eoseTimeout&&clearTimeout(this.eoseTimeout),this.emit("eose",this),this.eosed=!0,this.opts?.closeOnEose&&this.stop())};if(r||n)i("query filled or seen all");else if(this.relayFilters){let t=1e3;const n=new Set(this.pool.connectedRelays().map((t=>t.url))),r=Array.from(this.relayFilters.keys()).filter((t=>n.has(t)));if(0===r.length)return;const s=this.eosesSeen.size/r.length;if(this.eosesSeen.size>=2&&s>=.5){if(t*=1-s,0===t)return void i("tiem to wait was 0");this.eoseTimeout&&clearTimeout(this.eoseTimeout);const n=()=>{e=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0,void 0!==e&&e<20?this.eoseTimeout=setTimeout(n,t):i("send eose timeout: "+t)};this.eoseTimeout=setTimeout(n,t)}}}};async function kn(t,e,n=3){if(!this.ndk)throw new Error("NDK not set");const r=await this.ndk.fetchEvent({kinds:[n],authors:[this.pubkey]},t||{groupable:!1});if(r){const t=new Set;return r.tags.forEach((e=>{"p"===e[0]&&t.add(e[1])})),e&&this.ndk?.outboxTracker?.trackUsers(Array.from(t)),[...t].reduce(((t,e)=>{const n=new In({pubkey:e});return n.ndk=this.ndk,t.add(n),t}),new Set)}return new Set}function _n(t){const e={};let n;try{n=JSON.parse(t.content)}catch(t){throw new Error(`Failed to parse profile event: ${t}`)}return e.created_at=t.created_at,e.profileEvent=JSON.stringify(t.rawEvent()),Object.keys(n).forEach((t=>{switch(t){case"name":e.name=n.name;break;case"display_name":e.displayName=n.display_name;break;case"image":case"picture":e.image=n.picture||n.image;break;case"banner":e.banner=n.banner;break;case"bio":e.bio=n.bio;break;case"nip05":e.nip05=n.nip05;break;case"lud06":e.lud06=n.lud06;break;case"lud16":e.lud16=n.lud16;break;case"about":e.about=n.about;break;case"zapService":e.zapService=n.zapService;break;case"website":e.website=n.website;break;default:e[t]=n[t]}})),e}function An(t){const e={};for(const[n,r]of Object.entries(t))switch(n){case"username":case"name":e.name=r;break;case"displayName":e.display_name=r;break;case"image":case"picture":e.picture=r;break;case"bio":case"about":e.about=r;break;default:e[n]=r}return JSON.stringify(e)}var xn=/^(?:([\w.+-]+)@)?([\w.-]+)$/;async function Sn(t,e,n=fetch,r={}){return await t.queuesNip05.add({id:e,func:async()=>{if(t.cacheAdapter&&t.cacheAdapter.loadNip05){const n=await t.cacheAdapter.loadNip05(e);if("missing"!==n){if(n){const e=new In({pubkey:n.pubkey,relayUrls:n.relays,nip46Urls:n.nip46});return e.ndk=t,e}if("no-cache"!==r.cache)return null}}const i=e.match(xn);if(!i)return null;const[s,o="_",a]=i;try{const i=await n(`https://${a}/.well-known/nostr.json?name=${o}`,r),{names:s,relays:c,nip46:h}=function(t){const e={names:{}};for(const[n,r]of Object.entries(t.names))"string"==typeof n&&"string"==typeof r&&(e.names[n.toLowerCase()]=r);if(t.relays){e.relays={};for(const[n,r]of Object.entries(t.relays))"string"==typeof n&&Array.isArray(r)&&(e.relays[n]=r.filter((t=>"string"==typeof t)))}if(t.nip46){e.nip46={};for(const[n,r]of Object.entries(t.nip46))"string"==typeof n&&Array.isArray(r)&&(e.nip46[n]=r.filter((t=>"string"==typeof t)))}return e}(await i.json()),l=s[o.toLowerCase()];let u=null;return l&&(u={pubkey:l,relays:c?.[l],nip46:h?.[l]}),t?.cacheAdapter&&t.cacheAdapter.saveNip05&&t.cacheAdapter.saveNip05(e,u),u}catch(n){return t?.cacheAdapter&&t.cacheAdapter.saveNip05&&t?.cacheAdapter.saveNip05(e,null),console.error("Failed to fetch NIP05 for",e,n),null}}})}var Rn=class t extends gn{static kind=10019;static kinds=[10019];_p2pk;constructor(t,e){super(t,e),this.kind??=10019}static from(e){return new t(e.ndk,e)}set relays(t){this.tags=this.tags.filter((t=>"relay"!==t[0]));for(const e of t)this.tags.push(["relay",e])}get relays(){const t=[];for(const e of this.tags)"relay"===e[0]&&t.push(e[1]);return t}set mints(t){this.tags=this.tags.filter((t=>"mint"!==t[0]));for(const e of t)this.tags.push(["mint",e])}get mints(){const t=[];for(const e of this.tags)"mint"===e[0]&&t.push(e[1]);return Array.from(new Set(t))}get p2pk(){return this._p2pk||(this._p2pk=this.tagValue("pubkey")??this.pubkey),this._p2pk}set p2pk(t){this._p2pk=t,this.removeTag("pubkey"),t&&this.tags.push(["pubkey",t])}get relaySet(){return Ke.fromRelayUrls(this.relays,this.ndk)}},Cn=o("ndk:zapper:ln");async function Nn({lud06:t,lud16:e},n){let r;if(e&&!e.startsWith("LNURL")){const[t,n]=e.split("@");r=`https://${n}/.well-known/lnurlp/${t}`}else if(t){const{words:e}=xe.decode(t,1e3),n=xe.fromWords(e);r=new TextDecoder("utf-8").decode(n)}if(!r)throw Cn("No zap endpoint found %o",{lud06:t,lud16:e}),new Error("No zap endpoint found");try{const t=n.httpFetch||fetch,e=await t(r);if(200!==e.status){const t=await e.text();throw new Error(`Unable to fetch zap endpoint ${r}: ${t}`)}return await e.json()}catch(t){throw new Error(`Unable to fetch zap endpoint ${r}: ${t}`)}}var In=class t{ndk;profile;_npub;_pubkey;relayUrls=[];nip46Urls=[];constructor(t){t.npub&&(this._npub=t.npub),t.hexpubkey&&(this._pubkey=t.hexpubkey),t.pubkey&&(this._pubkey=t.pubkey),t.relayUrls&&(this.relayUrls=t.relayUrls),t.nip46Urls&&(this.nip46Urls=t.nip46Urls)}get npub(){if(!this._npub){if(!this._pubkey)throw new Error("pubkey not set");this._npub=i.Qe.npubEncode(this.pubkey)}return this._npub}set npub(t){this._npub=t}get hexpubkey(){return this.pubkey}set hexpubkey(t){this._pubkey=t}get pubkey(){if(!this._pubkey){if(!this._npub)throw new Error("npub not set");this._pubkey=i.Qe.decode(this.npub).data}return this._pubkey}set pubkey(t){this._pubkey=t}async getZapInfo(t=!0,e=["nip61","nip57"]){if(!this.ndk)throw new Error("No NDK instance found");const n=[];if(e.includes("nip61")&&n.push(10019),e.includes("nip57")&&n.push(0),0===n.length)return[];let r=await this.ndk.fetchEvents({kinds:n,authors:[this.pubkey]},{cacheUsage:"ONLY_CACHE",groupable:!1});r.size<e.length&&(r=await this.ndk.fetchEvents({kinds:n,authors:[this.pubkey]},{cacheUsage:"ONLY_RELAY"}));const i=[],s=Array.from(r).find((t=>10019===t.kind)),o=Array.from(r).find((t=>0===t.kind));if(s){const e=Rn.from(s);if(e.mints.length>0&&i.push({type:"nip61",data:{mints:e.mints,relays:e.relays,p2pk:e.p2pk}}),!t)return i}if(o){const t=_n(o),{lud06:e,lud16:n}=t;try{const t=await Nn({lud06:e,lud16:n},this.ndk);t&&i.push({type:"nip57",data:t})}catch(t){console.error("Error getting NIP-57 zap spec",t)}}return i}async getZapConfiguration(t){if(t??=this.ndk,!t)throw new Error("No NDK instance found");return await t.queuesZapConfig.add({id:this.pubkey,func:async()=>{if(this.ndk?.cacheAdapter?.loadUsersLNURLDoc){const t=await this.ndk.cacheAdapter.loadUsersLNURLDoc(this.pubkey);if("missing"!==t){if(null===t)return;if(t)return t}}let e;try{if(await this.fetchProfile({groupable:!1}),this.profile){const{lud06:n,lud16:r}=this.profile;e=await Nn({lud06:n,lud16:r},t)}}catch{}if(this.ndk?.cacheAdapter?.saveUsersLNURLDoc&&this.ndk.cacheAdapter.saveUsersLNURLDoc(this.pubkey,e||null),e)return e}})}async getZapperPubkey(){const t=await this.getZapConfiguration();return t?.nostrPubkey}static async fromNip05(e,n,r=!1){if(!n)throw new Error("No NDK instance found");const i={};r&&(i.cache="no-cache");const s=await Sn(n,e,n?.httpFetch,i);if(s){const e=new t({pubkey:s.pubkey,relayUrls:s.relays,nip46Urls:s.nip46});return e.ndk=n,e}}async fetchProfile(t,e=!1){if(!this.ndk)throw new Error("NDK not set");this.profile||(this.profile={});let n=null;if(this.ndk.cacheAdapter&&this.ndk.cacheAdapter.fetchProfile&&"ONLY_RELAY"!==t?.cacheUsage){const t=await this.ndk.cacheAdapter.fetchProfile(this.pubkey);if(t)return this.profile=t,t}!t&&this.ndk.cacheAdapter&&this.ndk.cacheAdapter.locking&&(n=await this.ndk.fetchEvents({kinds:[0],authors:[this.pubkey]},{cacheUsage:"ONLY_CACHE",closeOnEose:!0,groupable:!1}),t={cacheUsage:"ONLY_RELAY",closeOnEose:!0,groupable:!0,groupableDelay:250}),n&&0!==n.size||(n=await this.ndk.fetchEvents({kinds:[0],authors:[this.pubkey]},t));const r=Array.from(n).sort(((t,e)=>t.created_at-e.created_at));if(0===r.length)return null;const i=r[0];return this.profile=_n(i),e&&(this.profile.profileEvent=JSON.stringify(i)),this.profile&&this.ndk.cacheAdapter&&this.ndk.cacheAdapter.saveProfile&&this.ndk.cacheAdapter.saveProfile(this.pubkey,this.profile),this.profile}follows=kn.bind(this);tagReference(){return["p",this.pubkey]}referenceTags(t){const e=[["p",this.pubkey]];return t?(e[0].push("",t),e):e}async publish(){if(!this.ndk)throw new Error("No NDK instance found");if(!this.profile)throw new Error("No profile available");this.ndk.assertSigner();const t=new gn(this.ndk,{kind:0,content:An(this.profile)});await t.publish()}async follow(t,e,n=3){if(!this.ndk)throw new Error("No NDK instance found");if(this.ndk.assertSigner(),e||(e=await this.follows(void 0,void 0,n)),e.has(t))return!1;e.add(t);const r=new gn(this.ndk,{kind:n});for(const t of e)r.tag(t);return await r.publish(),!0}async unfollow(t,e,n=3){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),e||(e=await this.follows(void 0,void 0,n));const r=new Set;let i=!1;for(const n of e)n.pubkey!==t.pubkey?r.add(n):i=!0;if(!i)return!1;const s=new gn(this.ndk,{kind:n});for(const t of r)s.tag(t);return await s.publish()}async validateNip05(t){if(!this.ndk)throw new Error("No NDK instance found");const e=await Sn(this.ndk,t);return null===e?null:e.pubkey===this.pubkey}async zap(t,e,n,r){return new Promise(((i,s)=>{if(!this.ndk)return void s("No NDK instance found");let o=this.ndk.walletConfig?.onLnPay;o??=async({pr:t})=>{i(t)},this.ndk.zap(this,t,{comment:e,tags:n,signer:r,onLnPay:o}).zap().then(i).catch(s)}))}},Bn=class t extends gn{_encryptedTags;encryptedTagsLength;constructor(t,e){super(t,e),this.kind??=30001}static from(e){return new t(e.ndk,e)}get title(){return this.tagValue("title")||this.tagValue("name")||(3===this.kind?"Contacts":1e4===this.kind?"Mute":10001===this.kind?"Pinned Notes":10002===this.kind?"Relay Metadata":10003===this.kind?"Bookmarks":10004===this.kind?"Communities":10005===this.kind?"Public Chats":10006===this.kind?"Blocked Relays":10007===this.kind?"Search Relays":10050===this.kind?"Direct Message Receive Relays":10015===this.kind?"Interests":10030===this.kind?"Emojis":this.tagValue("d"))}set title(t){this.removeTag(["title","name"]),t&&this.tags.push(["title",t])}get name(){return this.title}set name(t){this.title=t}get description(){return this.tagValue("description")}set description(t){this.removeTag("description"),t&&this.tags.push(["description",t])}get image(){return this.tagValue("image")}set image(t){this.removeTag("image"),t&&this.tags.push(["image",t])}isEncryptedTagsCacheValid(){return!(!this._encryptedTags||this.encryptedTagsLength!==this.content.length)}async encryptedTags(t=!0){if(t&&this.isEncryptedTagsCacheValid())return this._encryptedTags;if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const e=await this.ndk.signer.user();try{if(this.content.length>0)try{const t=await this.ndk.signer.decrypt(e,this.content),n=JSON.parse(t);return n&&n[0]?(this.encryptedTagsLength=this.content.length,this._encryptedTags=n):(this.encryptedTagsLength=this.content.length,this._encryptedTags=[])}catch(t){console.log(`error decrypting ${this.content}`)}}catch(t){}return[]}validateTag(t){return!0}getItems(t){return this.tags.filter((e=>e[0]===t))}get items(){return this.tags.filter((t=>!["d","L","l","title","name","description","published_at","summary","image","thumb","alt","expiration","subject","client"].includes(t[0])))}async addItem(t,e=void 0,n=!1,r="bottom"){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");let i;if(t instanceof gn)i=[t.tagReference(e)];else if(t instanceof In)i=t.referenceTags();else if(t instanceof ze)i=t.referenceTags();else{if(!Array.isArray(t))throw new Error("Invalid object type");i=[t]}if(e&&i[0].push(e),n){const t=await this.ndk.signer.user(),e=await this.encryptedTags();"top"===r?e.unshift(...i):e.push(...i),this._encryptedTags=e,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(e),await this.encrypt(t)}else"top"===r?this.tags.unshift(...i):this.tags.push(...i);this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItemByValue(t,e=!0){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const n=this.tags.findIndex((e=>e[1]===t));n>=0&&this.tags.splice(n,1);const r=await this.ndk.signer.user(),i=await this.encryptedTags(),s=i.findIndex((e=>e[1]===t));if(s>=0&&(i.splice(s,1),this._encryptedTags=i,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(i),await this.encrypt(r)),e)return this.publishReplaceable();this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItem(t,e){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");if(e){const e=await this.ndk.signer.user(),n=await this.encryptedTags();n.splice(t,1),this._encryptedTags=n,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(n),await this.encrypt(e)}else this.tags.splice(t,1);return this.created_at=Math.floor(Date.now()/1e3),this.emit("change"),this}has(t){return this.items.some((e=>e[1]===t))}filterForItems(){const t=new Set,e=new Map,n=[];for(const n of this.items)if("e"===n[0]&&n[1])t.add(n[1]);else if("a"===n[0]&&n[1]){const[t,r,i]=n[1].split(":");if(!t||!r)continue;const s=`${t}:${r}`,o=e.get(s)||[];o.push(i||""),e.set(s,o)}if(t.size>0&&n.push({ids:Array.from(t)}),e.size>0)for(const[t,r]of e.entries()){const[e,i]=t.split(":");n.push({kinds:[parseInt(e)],authors:[i],"#d":r})}return n}},Tn="read",Un="write",Pn=class t extends gn{constructor(t,e){super(t,e),this.kind??=10002}static from(e){return new t(e.ndk,e.rawEvent())}get readRelayUrls(){return this.tags.filter((t=>"r"===t[0]||"relay"===t[0])).filter((t=>!t[2]||t[2]&&t[2]===Tn)).map((t=>Ce(t[1]))).filter((t=>!!t))}set readRelayUrls(t){for(const e of t)this.tags.push(["r",e,Tn])}get writeRelayUrls(){return this.tags.filter((t=>"r"===t[0]||"relay"===t[0])).filter((t=>!t[2]||t[2]&&t[2]===Un)).map((t=>Ce(t[1]))).filter((t=>!!t))}set writeRelayUrls(t){for(const e of t)this.tags.push(["r",e,Un])}get bothRelayUrls(){return this.tags.filter((t=>"r"===t[0]||"relay"===t[0])).filter((t=>!t[2])).map((t=>t[1]))}set bothRelayUrls(t){for(const e of t)this.tags.push(["r",e])}get relays(){return this.tags.filter((t=>"r"===t[0]||"relay"===t[0])).map((t=>t[1]))}get relaySet(){if(!this.ndk)throw new Error("NDKRelayList has no NDK instance");return new Ke(new Set(this.relays.map((t=>this.ndk.pool.getRelay(t)))),this.ndk)}};function Ln(t,e){try{const n=JSON.parse(e.content),r=new Pn(t),i=new Set,s=new Set;for(let[t,e]of Object.entries(n)){try{t=Ne(t)}catch{continue}if(e){const n=e;n.write&&s.add(t),n.read&&i.add(t)}else i.add(t),s.add(t)}return r.readRelayUrls=Array.from(i),r.writeRelayUrls=Array.from(s),r}catch{}}var On=class t extends gn{debug;_proofs=[];static kind=9321;static kinds=[t.kind];constructor(t,e){super(t,e),this.kind??=9321,this.debug=t?.debug.extend("nutzap")??o("ndk:nutzap"),this.alt||(this.alt="This is a nutzap")}static from(t){const e=new this(t.ndk,t);try{const t=e.getMatchingTags("proof");t.length?e._proofs=t.map((t=>JSON.parse(t[1]))):e._proofs=JSON.parse(e.content)}catch{return}if(e._proofs&&e._proofs.length)return e}set comment(t){this.content=t??""}get comment(){return this.tagValue("comment")||this.content}set proofs(t){this._proofs=t,this.tags=this.tags.filter((t=>"proof"!==t[0]));for(const e of t)this.tags.push(["proof",JSON.stringify(e)]);this.removeTag("amount"),this.tags.push(["amount",this.amount.toString()])}get proofs(){return this._proofs}get p2pk(){const t=this.proofs[0];try{const e=JSON.parse(t.secret);let n={};if("string"==typeof e?(n=JSON.parse(e),this.debug("stringified payload",t.secret)):"object"==typeof e&&(n=e),"P2PK"===n[0]&&n[1]?.data){const t=n[1].data.slice(2,-1);if(t)return t}}catch(t){this.debug("error parsing p2pk pubkey",t,this.proofs[0])}}get mint(){return this.tagValue("u")}set mint(t){this.removeTag("u"),this.tag(["u",t])}get unit(){return this.tagValue("unit")??"msat"}set unit(t){this.removeTag("unit"),t&&this.tag(["unit",t])}get amount(){return 1e3*this.proofs.reduce(((t,e)=>t+e.amount),0)}sender=this.author;set target(t){this.tags=this.tags.filter((t=>"p"!==t[0])),t instanceof gn&&this.tags.push()}set recipientPubkey(t){this.removeTag("p"),this.tag(["p",t])}get recipientPubkey(){return this.tagValue("p")}get recipient(){const t=this.recipientPubkey;return this.ndk?this.ndk.getUser({pubkey:t}):new In({pubkey:t})}get isValid(){let t=0,e=0;for(const n of this.tags)"p"===n[0]&&t++,"u"===n[0]&&e++;return 1===t&&1===e&&this.proofs.length>0}};async function Dn(t){return await this.sendReq("pay_invoice",{invoice:t})}var $n=class t{_user;_privateKey;constructor(t){if(t){if("string"==typeof t)if(t.startsWith("nsec1")){const{type:e,data:n}=i.Qe.decode(t);"nsec"===e&&(this._privateKey=n)}else{if(64!==t.length)throw new Error("Invalid private key provided.");this._privateKey=y(t)}else this._privateKey=t;this._privateKey&&(this._user=new In({pubkey:(0,i.lG)(this._privateKey)}))}}get privateKey(){if(this._privateKey)return p(this._privateKey)}static generate(){const e=(0,i.Bq)();return new t(e)}async blockUntilReady(){if(!this._user)throw new Error("NDKUser not initialized");return this._user}async user(){return await this.blockUntilReady(),this._user}async sign(t){if(!this._privateKey)throw Error("Attempted to sign without a private key");return(0,i.pC)(t,this._privateKey).sig}getConversationKey(t){if(!this._privateKey)throw Error("Attempted to get conversation key without a private key");const e=t.pubkey;return i.Q5.getConversationKey(this._privateKey,e)}async nip44Encrypt(t,e){const n=this.getConversationKey(t);return await i.Q5.encrypt(e,n)}async nip44Decrypt(t,e){const n=this.getConversationKey(t);return await i.Q5.decrypt(e,n)}async encrypt(t,e,n=Je){return"nip44"===n?this.nip44Encrypt(t,e):this.nip04Encrypt(t,e)}async decrypt(t,e,n=Je){return"nip44"===n?this.nip44Decrypt(t,e):this.nip04Decrypt(t,e)}async nip04Encrypt(t,e){if(!this._privateKey)throw Error("Attempted to encrypt without a private key");const n=t.pubkey;return await i.sh.encrypt(this._privateKey,n,e)}async nip04Decrypt(t,e){if(!this._privateKey)throw Error("Attempted to decrypt without a private key");const n=t.pubkey;return await i.sh.decrypt(this._privateKey,n,e)}};async function Fn(t,e){const n=new gn(this.ndk,{kind:23194,tags:[["p",this.walletService.pubkey]],content:JSON.stringify({method:t,params:e})});return this.debug("Sending request",n.content),await n.encrypt(this.walletService,this.signer),await n.sign(this.signer),this.debug("Request encrypted and signed"),new Promise((async(e,r)=>{try{const i=n.tagId();if(!i)throw new Error("Failed to get e-tag");const s=t=>{this.off(i,s),this.off("event",s),this.debug("Received response",t);try{const n=JSON.parse(t);n.error&&r(n),e(n)}catch(t){this.debug("Failed to parse response",t),r({result_type:"error",error:{code:"failed_to_parse_response",message:t.message}})}},o=this.ndk.subscribe({kinds:[23195],"#e":[i],limit:1},{groupable:!1,subId:`nwc-${t}`},this.relaySet);o.on("event",(async t=>{await t.decrypt(t.author,this.signer),s(t.content),o.stop()})),this.once(i,s),this.once("event",s),this.debug("Sending request to relay",n.rawEvent()),await n.publish(this.relaySet)}catch(t){this.debug("Failed to send request",t,t.relayErrors),r({result_type:"error",error:{code:"failed_to_send_request",message:t.message}})}}))}async function Mn(){return await this.sendReq("get_balance",{})}async function zn(){return await this.sendReq("get_info",{})}var Hn=class t extends s.EventEmitter{ndk;debug;walletService;relaySet;signer;active=!1;constructor({ndk:t,pubkey:e,relayUrls:n,secret:r}){super(),this.ndk=t,this.walletService=t.getUser({pubkey:e}),this.relaySet=new Ke(new Set(n.map((e=>t.pool.getRelay(e)))),t),this.signer=new $n(r instanceof Uint8Array?r:y(r)),this.debug=t.debug.extend("nwc"),this.debug(`Starting with wallet service ${this.walletService.npub}`)}static async fromURI(e,n){const r=new URL(n);if("nostr+walletconnect:"!==r.protocol)throw new Error("Invalid protocol");return new t({ndk:e,pubkey:r.host??r.pathname,relayUrls:r.searchParams.getAll("relay")??[""],secret:r.searchParams.get("secret")??""})}async blockUntilReady(t){const e=await this.signer.user(),n=new Promise(((e,n)=>{setTimeout((()=>{n(new Error("Timeout"))}),t)})),r=[new Promise((t=>{const n=this.ndk.subscribe({kinds:[23195],"#p":[e.pubkey],limit:1},{groupable:!1,subId:"nwc"},this.relaySet);n.on("event",(async t=>{this.debug("received response",t.rawEvent());const e=t.tagValue("e");if(e){this.debug("received an event",e);try{await t.decrypt(t.author,this.signer),this.emit(e,t.content)}catch(t){return void this.debug("Failed to decrypt event",t)}}else this.debug("Received an event without an e-tag")})),n.on("eose",(()=>{this.debug("Subscription ready"),this.active=!0,t()})),n.on("close",(()=>{this.debug("Subscription closed"),this.active=!1}))}))];return t&&r.push(n),await Promise.race(r)}async sendReq(t,e){return await Fn.call(this,t,e)}async payInvoice(t){return await Dn.call(this,t)}async getInfo(){return await zn.call(this)}getBalance=Mn.bind(this)},Kn=class{_userPromise;nip04Queue=[];nip04Processing=!1;debug;waitTimeout;constructor(t=1e3){this.debug=o("ndk:nip07"),this.waitTimeout=t}async blockUntilReady(){await this.waitForExtension();const t=await window.nostr.getPublicKey();if(!t)throw new Error("User rejected access");return new In({pubkey:t})}async user(){return this._userPromise||(this._userPromise=this.blockUntilReady()),this._userPromise}async sign(t){return await this.waitForExtension(),(await window.nostr.signEvent(t)).sig}async relays(t){await this.waitForExtension();const e=await(window.nostr.getRelays?.())||{},n=[];for(const t of Object.keys(e))e[t].read&&e[t].write&&n.push(t);return n.map((e=>new ze(e,t?.relayAuthDefaultPolicy,t)))}async encrypt(t,e,n=Je){return"nip44"===n?this.nip44Encrypt(t,e):this.nip04Encrypt(t,e)}async decrypt(t,e,n=Je){return"nip44"===n?this.nip44Decrypt(t,e):this.nip04Decrypt(t,e)}async nip44Encrypt(t,e){return await this.waitForExtension(),await window.nostr.nip44.encrypt(t.pubkey,e)}async nip44Decrypt(t,e){return await this.waitForExtension(),await window.nostr.nip44.decrypt(t.pubkey,e)}async nip04Encrypt(t,e){await this.waitForExtension();const n=t.pubkey;return this.queueNip04("encrypt",n,e)}async nip04Decrypt(t,e){await this.waitForExtension();const n=t.pubkey;return this.queueNip04("decrypt",n,e)}async queueNip04(t,e,n){return new Promise(((r,i)=>{this.nip04Queue.push({type:t,counterpartyHexpubkey:e,value:n,resolve:r,reject:i}),this.nip04Processing||this.processNip04Queue()}))}async processNip04Queue(t,e=0){if(!t&&0===this.nip04Queue.length)return void(this.nip04Processing=!1);this.nip04Processing=!0;const{type:n,counterpartyHexpubkey:r,value:i,resolve:s,reject:o}=t||this.nip04Queue.shift();try{let t;t="encrypt"===n?await window.nostr.nip04.encrypt(r,i):await window.nostr.nip04.decrypt(r,i),s(t)}catch(s){if(s.message&&s.message.includes("call already executing")&&e<5)return this.debug("Retrying encryption queue item",{type:n,counterpartyHexpubkey:r,value:i,retries:e}),void setTimeout((()=>{this.processNip04Queue(t,e+1)}),50*e);o(s)}this.processNip04Queue()}waitForExtension(){return new Promise(((t,e)=>{if(window.nostr)return void t();let n;const r=setInterval((()=>{window.nostr&&(clearTimeout(n),clearInterval(r),t())}),100);n=setTimeout((()=>{clearInterval(r),e(new Error("NIP-07 extension not available"))}),this.waitTimeout)}))}};s.EventEmitter;async function qn(t,e,n=!1){const r=e.outboxPool||e.pool,i=new Set;for(const t of r.relays.values())i.add(t);const s=new Map,o=new Map,a=new Ke(i,e);if(e.cacheAdapter?.locking&&!n){const n=await e.fetchEvents({kinds:[3,10002],authors:t},{cacheUsage:"ONLY_CACHE"});for(const t of n)10002===t.kind&&s.set(t.pubkey,Pn.from(t));for(const t of n)if(3===t.kind){if(s.has(t.pubkey))continue;const n=Ln(e,t);n&&o.set(t.pubkey,n)}t=t.filter((t=>!s.has(t)&&!o.has(t)))}if(0===t.length)return s;const c=new Map,h=new Map;return new Promise((async n=>{const i=e.subscribe({kinds:[3,10002],authors:t},{closeOnEose:!0,pool:r,groupable:!0,cacheUsage:"ONLY_RELAY",subId:"ndk-relay-list-fetch"},a,!1);i.on("event",(t=>{if(10002===t.kind){const e=c.get(t.pubkey);if(e&&e.created_at>t.created_at)return;c.set(t.pubkey,t)}else if(3===t.kind){const e=h.get(t.pubkey);if(e&&e.created_at>t.created_at)return;h.set(t.pubkey,t)}})),i.on("eose",(()=>{for(const t of c.values())s.set(t.pubkey,Pn.from(t));for(const n of t){if(s.has(n))continue;const t=h.get(n);if(!t)continue;const r=Ln(e,t);r&&s.set(n,r)}n(s)})),i.start()}))}s.EventEmitter;var jn=class{type;relayUrlScores;readRelays;writeRelays;constructor(t){this.type=t,this.relayUrlScores=new Map,this.readRelays=new Set,this.writeRelays=new Set}},Wn=class extends s.EventEmitter{data;ndk;debug;constructor(t){super(),this.ndk=t,this.debug=t.debug.extend("outbox-tracker"),this.data=new oe.LRUCache({maxSize:1e5,entryExpirationTimeInMS:12e4})}async trackUsers(t,e=!1){const n=[];for(let r=0;r<t.length;r+=400){const i=t.slice(r,r+400).map((t=>Vn(t))).filter((t=>!this.data.has(t)));if(0!==i.length){for(const t of i)this.data.set(t,new jn("user"));n.push(new Promise((t=>{qn(i,this.ndk,e).then((t=>{for(const[e,n]of t){let t=this.data.get(e);if(t??=new jn("user"),n){t.readRelays=new Set(Ie(n.readRelayUrls)),t.writeRelays=new Set(Ie(n.writeRelayUrls));for(const e of t.readRelays)this.ndk.pool.blacklistRelayUrls.has(e)&&t.readRelays.delete(e);for(const e of t.writeRelays)this.ndk.pool.blacklistRelayUrls.has(e)&&t.writeRelays.delete(e);this.data.set(e,t)}}})).finally(t)})))}}return Promise.all(n)}track(t,e,n=!0){const r=Vn(t);e??=function(t){return t instanceof In?"user":"kind"}(t);let i=this.data.get(r);return i||(i=new jn(e),t instanceof In&&this.trackUsers([t])),i}};function Vn(t){return t instanceof In?t.pubkey:t}var Gn=class extends s.EventEmitter{_relays=new Map;autoConnectRelays=new Set;blacklistRelayUrls;debug;temporaryRelayTimers=new Map;flappingRelays=new Set;backoffTimes=new Map;ndk;constructor(t=[],e=[],n,r){super(),this.debug=r??n.debug.extend("pool"),this.ndk=n,this.relayUrls=t,this.blacklistRelayUrls=new Set(e)}get relays(){return this._relays}set relayUrls(t){this._relays.clear();for(const e of t){const t=new ze(e,void 0,this.ndk);t.connectivity.netDebug=this.ndk.netDebug,this.addRelay(t,!1)}}set name(t){this.debug=this.debug.extend(t)}useTemporaryRelay(t,e=3e4,n){const r=this.relays.has(t.url);r||(this.addRelay(t),this.debug("Adding temporary relay %s for filters %o",t.url,n));const i=this.temporaryRelayTimers.get(t.url);if(i&&clearTimeout(i),!r||i){const n=setTimeout((()=>{this.ndk.explicitRelayUrls?.includes(t.url)||this.removeRelay(t.url)}),e);this.temporaryRelayTimers.set(t.url,n)}}addRelay(t,e=!0){const n=this.relays.has(t.url),r=this.blacklistRelayUrls?.has(t.url),i=t.url.includes("/npub1");let s=!0;const o=t.url;if(n)return;if(r)return void this.debug(`Refusing to add relay ${o}: blacklisted`);if(i)return void this.debug(`Refusing to add relay ${o}: is a filter relay`);if(this.ndk.cacheAdapter?.getRelayStatus){const n=this.ndk.cacheAdapter.getRelayStatus(o);if(n&&n.dontConnectBefore){if(n.dontConnectBefore>Date.now()){const r=n.dontConnectBefore-Date.now();return this.debug(`Refusing to add relay ${o}: delayed connect for ${r}ms`),void setTimeout((()=>{this.addRelay(t,e)}),r)}s=!1}}const a=e=>this.emit("notice",t,e),c=()=>this.handleRelayConnect(o),h=()=>this.handleRelayReady(t),l=()=>this.emit("relay:disconnect",t),u=()=>this.handleFlapping(t),d=e=>this.emit("relay:auth",t,e),f=()=>this.emit("relay:authed",t);t.off("notice",a),t.off("connect",c),t.off("ready",h),t.off("disconnect",l),t.off("flapping",u),t.off("auth",d),t.off("authed",f),t.on("notice",a),t.on("connect",c),t.on("ready",h),t.on("disconnect",l),t.on("flapping",u),t.on("auth",d),t.on("authed",f),t.on("delayed-connect",(e=>{this.ndk.cacheAdapter?.updateRelayStatus&&this.ndk.cacheAdapter.updateRelayStatus(t.url,{dontConnectBefore:Date.now()+e})})),this.relays.set(o,t),e&&this.autoConnectRelays.add(o),e&&(this.emit("relay:connecting",t),t.connect(void 0,s).catch((t=>{this.debug(`Failed to connect to relay ${o}`,t)})))}removeRelay(t){const e=this.relays.get(t);if(e)return e.disconnect(),this.relays.delete(t),this.autoConnectRelays.delete(t),this.emit("relay:disconnect",e),!0;const n=this.temporaryRelayTimers.get(t);return n&&(clearTimeout(n),this.temporaryRelayTimers.delete(t)),!1}isRelayConnected(t){const e=Ne(t),n=this.relays.get(e);return!!n&&5===n.status}getRelay(t,e=!0,n=!1,r){let i=this.relays.get(Ne(t));return i||(i=new ze(t,void 0,this.ndk),i.connectivity.netDebug=this.ndk.netDebug,n?this.useTemporaryRelay(i,3e4,r):this.addRelay(i,e)),i}handleRelayConnect(t){this.emit("relay:connect",this.relays.get(t)),this.stats().connected===this.relays.size&&this.emit("connect")}handleRelayReady(t){this.emit("relay:ready",t)}async connect(t){const e=[];this.debug(`Connecting to ${this.relays.size} relays${t?`, timeout ${t}...`:""}`);const n=new Set(this.autoConnectRelays.keys());this.ndk.explicitRelayUrls?.forEach((t=>{const e=Ne(t);n.add(e)}));for(const r of n){const n=this.relays.get(r);if(!n)continue;const i=new Promise(((e,r)=>(this.emit("relay:connecting",n),n.connect(t).then(e).catch(r))));if(t){const r=new Promise(((e,n)=>{setTimeout((()=>n(`Timed out after ${t}ms`)),t)}));e.push(Promise.race([i,r]).catch((t=>{this.debug(`Failed to connect to relay ${n.url}: ${t??"No reason specified"}`)})))}else e.push(i)}t&&setTimeout((()=>{const t=this.stats().connected===this.relays.size,e=this.stats().connected>0;!t&&e&&this.emit("connect")}),t),await Promise.all(e)}checkOnFlappingRelays(){if(this.flappingRelays.size/this.relays.size>=.8)for(const t of this.flappingRelays)this.backoffTimes.set(t,0)}handleFlapping(t){this.debug(`Relay ${t.url} is flapping`);let e=this.backoffTimes.get(t.url)||5e3;e*=2,this.backoffTimes.set(t.url,e),this.debug(`Backoff time for ${t.url} is ${e}ms`),setTimeout((()=>{this.debug(`Attempting to reconnect to ${t.url}`),this.emit("relay:connecting",t),t.connect(),this.checkOnFlappingRelays()}),e),t.disconnect(),this.emit("flapping",t)}size(){return this.relays.size}stats(){const t={total:0,connected:0,disconnected:0,connecting:0};for(const e of this.relays.values())t.total++,5===e.status?t.connected++:1===e.status?t.disconnected++:4===e.status&&t.connecting++;return t}connectedRelays(){return Array.from(this.relays.values()).filter((t=>t.status>=5))}permanentAndConnectedRelays(){return Array.from(this.relays.values()).filter((t=>t.status>=5&&!this.temporaryRelayTimers.has(t.url)))}urls(){return Array.from(this.relays.keys())}};function Zn(t){if(!t||""===t)return!1;try{return new URL(t),!0}catch(t){return!1}}async function Yn(t,e,n,r={type:"timeout"}){const i=this.debug.extend("fetch-event-from-tag"),[s,o,a]=t;i("fetching event from tag",t,n={},r);const c=Se(this,e.pubkey);if(c&&c.size>0){i("fetching event from author relays %o",Array.from(c));const t=Ke.fromRelayUrls(Array.from(c),this),e=await this.fetchEvent(o,n,t);if(e)return e}else i("no author relays found for %s",e.pubkey,e);const h=je(this,[{ids:[o]}],this.pool);i("fetching event without relay hint",h);const l=await this.fetchEvent(o,n);if(l)return l;if(a&&""!==a){const t=await this.fetchEvent(o,n,this.pool.getRelay(a,!0,!0,[{ids:[o]}]));if(t)return t}let u;const d=Zn(a)?this.pool.getRelay(a,!1,!0,[{ids:[o]}]):void 0,f=new Promise((t=>{this.fetchEvent(o,n,d).then(t)}));if(!Zn(a)||"none"===r.type)return f;const p=new Promise((async t=>{const e=r.relaySet,s=r.timeout??1500,a=new Promise((t=>setTimeout(t,s)));"timeout"===r.type&&await a,u?t(u):(i("fallback fetch triggered"),t(await this.fetchEvent(o,n,e)))}));switch(r.type){case"timeout":return Promise.race([f,p]);case"eose":return u=await f,u||p}}var Jn=class{ndk;spec;url;nip98Required=!1;constructor(t,e){this.url=`https://${t}/.well-known/nostr/nip96.json`,this.ndk=e}async prepareUpload(t,e="POST"){if(this.validateHttpFetch(),this.spec||await this.fetchSpec(),!this.spec)throw new Error("Failed to fetch NIP96 spec");let n={};return this.nip98Required&&(n={Authorization:await this.generateNip98Header(this.spec.api_url,e,t)}),{url:this.spec.api_url,headers:n}}async xhrUpload(t,e){const n="POST",{url:r,headers:i}=await this.prepareUpload(e,n);t.open(n,r,!0),i.Authorization&&t.setRequestHeader("Authorization",i.Authorization);const s=new FormData;return s.append("file",e),new Promise(((e,n)=>{t.onload=function(){t.status>=200&&t.status<300?e(JSON.parse(t.responseText)):n(new Error(t.statusText))},t.onerror=function(){n(new Error("Network Error"))},t.send(s)}))}async upload(t){const e="POST",{url:n,headers:r}=await this.prepareUpload(t,e),i=new FormData;i.append("file",t);const s=await this.ndk.httpFetch(this.spec.api_url,{method:e,headers:r,body:i});if(200!==s.status)throw new Error(`Failed to upload file to ${n}`);const o=await s.json();if("success"!==o.status)throw new Error(o.message);return o}validateHttpFetch(){if(!this.ndk)throw new Error("NDK is required to fetch NIP96 spec");if(!this.ndk.httpFetch)throw new Error("NDK must have an httpFetch method to fetch NIP96 spec")}async fetchSpec(){this.validateHttpFetch();const t=await this.ndk.httpFetch(this.url);if(200!==t.status)throw new Error(`Failed to fetch NIP96 spec from ${this.url}`);const e=await t.json();if(!e)throw new Error(`Failed to parse NIP96 spec from ${this.url}`);this.spec=e,this.nip98Required=this.spec.plans.free.is_nip98_required}async generateNip98Header(t,e,n){const r=new gn(this.ndk,{kind:27235,tags:[["u",t],["method",e]]});if(["POST","PUT","PATCH"].includes(e)){const t=await this.calculateSha256(n);r.tags.push(["payload",t])}return await r.sign(),`Nostr ${btoa(JSON.stringify(r.rawEvent()))}`}async calculateSha256(t){const e=await t.arrayBuffer(),n=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(n)).map((t=>t.toString(16).padStart(2,"0"))).join("")}},Qn=class{queue=[];maxConcurrency;processing=new Set;promises=new Map;constructor(t,e){this.maxConcurrency=e}add(t){if(this.promises.has(t.id))return this.promises.get(t.id);const e=new Promise(((e,n)=>{this.queue.push({...t,func:()=>t.func().then((t=>(e(t),t)),(t=>{throw n(t),t}))}),this.process()}));return this.promises.set(t.id,e),e.finally((()=>{this.promises.delete(t.id),this.processing.delete(t.id),this.process()})),e}process(){if(this.processing.size>=this.maxConcurrency||0===this.queue.length)return;const t=this.queue.shift();t&&!this.processing.has(t.id)&&(this.processing.add(t.id),t.func())}clear(){this.queue=[]}clearProcessing(){this.processing.clear()}clearAll(){this.clear(),this.clearProcessing()}length(){return this.queue.length}},Xn=class{subscriptions;seenEvents=new Map;debug;constructor(t){this.subscriptions=new Map,this.debug=t.extend("sub-manager")}add(t){this.subscriptions.set(t.internalId,t),t.on("close",(()=>{this.subscriptions.delete(t.internalId)}))}seenEvent(t,e){const n=this.seenEvents.get(t)||[];n.push(e),this.seenEvents.set(t,n)}},tr=o("ndk:active-user");async function er(t){if(!this.autoConnectUserRelays)return;const e=await async function(t,e){return(await qn([t],e)).get(t)}(t.pubkey,this);if(e){for(const t of e.relays){let e=this.pool.relays.get(t);e||(e=new ze(t,this.relayAuthDefaultPolicy,this),this.pool.addRelay(e))}return e}}async function nr(t){const e=this.outboxPool||this.pool;e.connectedRelays.length>0?rr.call(this,t):e.once("connect",(()=>{rr.call(this,t)}))}async function rr(t){const e=await er.call(this,t),n=[{kinds:[10006],authors:[t.pubkey]}];this.autoFetchUserMutelist&&n[0].kinds.push(1e4);const r=e?e.relaySet:void 0,i=this.subscribe(n,{subId:"active-user-settings",closeOnEose:!0},r,!1),s=new Map;i.on("event",(t=>{const e=s.get(t.kind);e&&e.created_at>=t.created_at||s.set(t.kind,t)})),i.on("eose",(()=>{for(const t of s.values())ir.call(this,t)})),i.start()}async function ir(t){10006===t.kind?sr.call(this,t):1e4===t.kind&&or.call(this,t)}function sr(t){const e=Bn.from(t);for(const t of e.items)this.pool.blacklistRelayUrls.add(t[0]);tr("Added %d relays to relay blacklist",e.items.length)}function or(t){const e=Bn.from(t);for(const t of e.items)this.mutedIds.set(t[1],t[0]);tr("Added %d users to mute list",e.items.length)}async function ar(t,e,n,r,s,o,a,c,h){const l=n.callback,u=i._Y.makeZapRequest({profile:r,event:null,amount:s,comment:a||"",relays:o.slice(0,4)});if(t instanceof gn){const e=t.referenceTags().filter((t=>"p"!==t[0]));u.tags.push(...e)}u.tags.push(["lnurl",l]);const d=new gn(e,u);return c&&(d.tags=d.tags.concat(c)),d.tags=d.tags.filter((t=>"p"!==t[0])),d.tags.push(["p",r]),await d.sign(h),d}var cr=o("ndk:zapper"),hr=class extends s.EventEmitter{target;ndk;comment;amount;unit;tags;signer;zapMethod;onLnPay;onCashuPay;onComplete;maxRelays=3;constructor(t,e,n="msat",r,i,s,o){if(super(),this.target=t,this.ndk=i||t.ndk,!this.ndk)throw new Error("No NDK instance provided");this.amount=e,this.comment=r,this.unit=n,this.tags=s,this.signer=o}async zap(){const t=this.getZapSplits(),e=new Map;return await Promise.all(t.map((async t=>{let n;try{n=await this.zapSplit(t)}catch(t){n=t}this.emit("split:complete",t,n),e.set(t,n)}))),this.emit("complete",e),this.onComplete&&this.onComplete(e),e}async zapSplit(t){let e,n=await this.getZapMethods(this.ndk,t.pubkey);if(0===n.length)throw new Error("No zap method available for recipient");n=n.sort(((t,e)=>"nip61"===t.type?-1:"nip61"===e.type?1:0));const r=await this.relays(t.pubkey);for(const i of n){cr("Zapping to %s with %d %s using %s",t.pubkey,t.amount,this.unit,i.type);try{switch(i.type){case"nip61":{const n=i.data;let s;if(s=await this.onCashuPay({target:this.target,comment:this.comment,tags:this.tags,recipientPubkey:t.pubkey,amount:t.amount,unit:this.unit,...n}),cr("NIP-61 Zap result: %o",s),s instanceof Error)e=s;else if(s){const{proofs:e,mint:n}=s;if(!e||!n)throw new Error("Invalid zap confirmation: missing proofs or mint: "+s);const i=Ke.fromRelayUrls(r,this.ndk),o=new On(this.ndk);return o.tags=[...o.tags,...this.tags||[]],o.proofs=e,o.mint=n,o.comment=this.comment,o.unit=this.unit,o.recipientPubkey=t.pubkey,await o.sign(this.signer),await o.publish(i),o}break}case"nip57":{const n=i.data,s=await ar(this.target,this.ndk,n,t.pubkey,t.amount,r,this.comment,this.tags,this.signer);if(!s)throw cr("Unable to generate zap request"),new Error("Unable to generate zap request");const o=await this.getLnInvoice(s,t.amount,n);if(!o)throw cr("Unable to get payment request"),new Error("Unable to get payment request");e=await this.onLnPay({target:this.target,comment:this.comment,recipientPubkey:t.pubkey,amount:t.amount,unit:this.unit,pr:o});break}}}catch(n){e=n instanceof Error?n:new Error(n),cr("Error zapping to %s with %d %s using %s: %o",t.pubkey,t.amount,this.unit,i.type,n)}}if(e instanceof Error)throw e;return e}async getLnInvoice(t,e,n){const r=n.callback,i=JSON.stringify(t.rawEvent());cr(`Fetching invoice from ${r}?`+new URLSearchParams({amount:e.toString(),nostr:i}));const s=new URL(r);s.searchParams.append("amount",e.toString()),s.searchParams.append("nostr",i),cr(`Fetching invoice from ${s.toString()}`);const o=await fetch(s.toString());if(cr(`Got response from zap endpoint: ${r}`,{status:o.status}),200!==o.status){cr(`Received non-200 status from zap endpoint: ${r}`,{status:o.status,amount:e,nostr:i});const t=await o.text();throw new Error(`Unable to fetch zap endpoint ${r}: ${t}`)}return(await o.json()).pr}getZapSplits(){if(this.target instanceof In)return[{pubkey:this.target.pubkey,amount:this.amount}];const t=this.target.getMatchingTags("zap");if(0===t.length)return[{pubkey:this.target.pubkey,amount:this.amount}];const e=[],n=t.reduce(((t,e)=>t+parseInt(e[2])),0);for(const r of t){const t=r[1],i=Math.floor(parseInt(r[2])/n*this.amount);e.push({pubkey:t,amount:i})}return e}async getZapMethods(t,e){const n=[];n.push("nip61"),n.push("nip57");const r=t.getUser({pubkey:e}),i=await r.getZapInfo(!1,n);return cr("Zap info for %s: %o",r.npub,i),i}async relays(t){let e=[];if(this.ndk?.activeUser){const n=await qn([this.ndk.activeUser.pubkey,t],this.ndk),r=new Map;for(const t of n.values())for(const e of t.readRelayUrls){const t=r.get(e)||0;r.set(e,t+1)}e=Array.from(r.entries()).sort(((t,e)=>e[1]-t[1])).map((([t])=>t)).slice(0,this.maxRelays)}return this.ndk?.pool?.permanentAndConnectedRelays().length&&(e=this.ndk.pool.permanentAndConnectedRelays().map((t=>t.url))),e.length||(e=[]),e}},lr=["wss://purplepag.es/","wss://nos.lol/"],ur=["wss://brb.io/","wss://nostr.mutinywallet.com/"],dr=class extends s.EventEmitter{_explicitRelayUrls;pool;outboxPool;_signer;_activeUser;cacheAdapter;debug;devWriteRelaySet;outboxTracker;mutedIds;clientName;clientNip89;queuesZapConfig;queuesNip05;asyncSigVerification=!1;initialValidationRatio=1;lowestValidationRatio=1;validationRatioFn;subManager;publishingFailureHandled=!1;relayAuthDefaultPolicy;httpFetch;netDebug;autoConnectUserRelays=!0;autoFetchUserMutelist=!0;walletConfig;constructor(t={}){super(),this.debug=t.debug||o("ndk"),this.netDebug=t.netDebug,this._explicitRelayUrls=t.explicitRelayUrls||[],this.subManager=new Xn(this.debug),this.pool=new Gn(t.explicitRelayUrls||[],t.blacklistRelayUrls||ur,this),this.pool.name="main",this.pool.on("relay:auth",(async(t,e)=>{this.relayAuthDefaultPolicy&&await this.relayAuthDefaultPolicy(t,e)})),this.autoConnectUserRelays=t.autoConnectUserRelays??!0,this.autoFetchUserMutelist=t.autoFetchUserMutelist??!0,this.clientName=t.clientName,this.clientNip89=t.clientNip89,this.relayAuthDefaultPolicy=t.relayAuthDefaultPolicy,t.enableOutboxModel&&(this.outboxPool=new Gn(t.outboxRelayUrls||lr,t.blacklistRelayUrls||ur,this,this.debug.extend("outbox-pool")),this.outboxPool.name="outbox",this.outboxTracker=new Wn(this)),this.signer=t.signer,this.cacheAdapter=t.cacheAdapter,this.mutedIds=t.mutedIds||new Map,t.devWriteRelayUrls&&(this.devWriteRelaySet=Ke.fromRelayUrls(t.devWriteRelayUrls,this)),this.queuesZapConfig=new Qn("zaps",3),this.queuesNip05=new Qn("nip05",10),this.signatureVerificationWorker=t.signatureVerificationWorker,this.initialValidationRatio=t.initialValidationRatio||1,this.lowestValidationRatio=t.lowestValidationRatio||1;try{this.httpFetch=fetch}catch{}}set explicitRelayUrls(t){this._explicitRelayUrls=t,this.pool.relayUrls=t}get explicitRelayUrls(){return this._explicitRelayUrls||[]}set signatureVerificationWorker(t){this.asyncSigVerification=!!t,t&&((Ye=t).onmessage=t=>{const[e,n]=t.data,r=cn[e];if(r){delete cn[e];for(const t of r.resolves)t(n)}else console.error("No record found for event",e)})}addExplicitRelay(t,e,n=!0){let r;return r="string"==typeof t?new ze(t,e,this):t,this.pool.addRelay(r,n),this.explicitRelayUrls.push(r.url),r}toJSON(){return{relayCount:this.pool.relays.size}.toString()}get activeUser(){return this._activeUser}set activeUser(t){const e=this._activeUser?.pubkey!==t?.pubkey;this._activeUser=t,t&&e?nr.call(this,t):t||(this.mutedIds=new Map)}get signer(){return this._signer}set signer(t){this._signer=t,t&&this.emit("signer:ready",t),t?.user().then((t=>{t.ndk=this,this.activeUser=t}))}async connect(t){this._signer&&this.autoConnectUserRelays&&(this.debug("Attempting to connect to user relays specified by signer %o",await(this._signer.relays?.(this))),this._signer.relays)&&(await this._signer.relays(this)).forEach((t=>this.pool.addRelay(t)));const e=[this.pool.connect(t)];return this.outboxPool&&e.push(this.outboxPool.connect(t)),this.debug("Connecting to relays %o",{timeoutMs:t}),Promise.allSettled(e).then((()=>{}))}getUser(t){const e=new In(t);return e.ndk=this,e}async getUserFromNip05(t,e=!1){return In.fromNip05(t,this,e)}subscribe(t,e,n,r=!0){const i=new En(this,t,e,n);if(this.subManager.add(i),n)for(const t of n.relays)this.pool.useTemporaryRelay(t,void 0,i.filters);if(this.outboxPool&&i.hasAuthorsFilter()){const t=i.filters.filter((t=>t.authors&&t.authors?.length>0)).map((t=>t.authors)).flat();this.outboxTracker?.trackUsers(t)}return r&&setTimeout((()=>i.start()),0),i}async publish(t,e,n){return this.debug("Deprecated: Use `event.publish()` instead"),t.publish(e,n)}fetchEventFromTag=Yn.bind(this);async fetchEvent(t,e,n){let r,s;if(n instanceof ze?s=new Ke(new Set([n]),this):n instanceof Ke&&(s=n),!n&&"string"==typeof t&&null===t.match(bn)){const e=function(t,e){try{const n=i.Qe.decode(t);if(["naddr","nevent"].includes(n?.type)){const t=n.data;if(t?.relays)return t.relays.map((t=>new ze(t,e?.relayAuthDefaultPolicy,e)))}}catch(t){}return[]}(t,this);e.length>0&&(s=new Ke(new Set(e),this),s=function(t,e){const n=e.connectedRelays();if(!Array.from(t.relays).some((t=>n.map((t=>t.url)).includes(t.url))))for(const e of n)t.addRelay(e);if(0===n.length)for(const n of e.relays.values())t.addRelay(n);return t}(s,this.pool))}if(r="string"==typeof t?[wn(t)]:Array.isArray(t)?t:[t],0===r.length)throw new Error(`Invalid filter: ${JSON.stringify(t)}`);return new Promise((t=>{let n=null;const i=this.subscribe(r,{...e||{},closeOnEose:!0},s,!1),o=setTimeout((()=>{i.stop(),t(n)}),1e4);i.on("event",(e=>{e.ndk=this,e.isReplaceable()?(!n||n.created_at<e.created_at)&&(n=e):(clearTimeout(o),t(e))})),i.on("eose",(()=>{clearTimeout(o),t(n)})),i.start()}))}async fetchEvents(t,e,n){return new Promise((r=>{const i=new Map,s=this.subscribe(t,{...e||{},closeOnEose:!0},n,!1);s.on("event",(t=>{t instanceof gn||(t=new gn(void 0,t));const e=t.deduplicationKey(),n=i.get(e);var r,s;n&&(s=t,t=(r=n).created_at>s.created_at?r:s),t.ndk=this,i.set(e,t)})),s.on("eose",(()=>{r(new Set(i.values()))})),s.start()}))}assertSigner(){if(!this.signer)throw this.emit("signer:required"),new Error("Signer required")}getNip96(t){return new Jn(t,this)}async nwc(t,e=2e3){const n=await Hn.fromURI(this,t);return!1!==e&&await n.blockUntilReady(e),n}zap(t,e,{comment:n,unit:r,signer:i,tags:s,onLnPay:o,onCashuPay:a,onComplete:c}){i||this.assertSigner();const h=new hr(t,e,r,n,this,s,i);return!1!==o&&(h.onLnPay=o??this.walletConfig?.onLnPay),!1!==a&&(h.onCashuPay=a??this.walletConfig?.onCashuPay),h.onComplete=c??this.walletConfig?.onPaymentComplete,o&&h.zap(),h}}},5778:(t,e,n)=>{"use strict";n.d(e,{pC:()=>lr,Bq:()=>cr,lG:()=>hr,eA:()=>zi,XN:()=>Hi,sh:()=>us,Qe:()=>Yi,Q5:()=>Js,_Y:()=>lo});var r={};function i(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function s(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function o(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}n.r(r),n.d(r,{OG:()=>L,My:()=>S,Ph:()=>N,lX:()=>I,Id:()=>P,fg:()=>$,qj:()=>U,aT:()=>C,lq:()=>B,z:()=>T,Q5:()=>M});const a="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,c=t=>t instanceof Uint8Array,h=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),l=(t,e)=>t<<32-e|t>>>e;if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");function u(t){if("string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t)),!c(t))throw new Error("expected Uint8Array, got "+typeof t);return t}class d{clone(){return this._cloneInto()}}function f(t){const e=e=>t().update(u(e)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function p(t=32){if(a&&"function"==typeof a.getRandomValues)return a.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}class g extends d{constructor(t,e,n,r){super(),this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=h(this.buffer)}update(t){o(this);const{view:e,buffer:n,blockLen:r}=this,i=(t=u(t)).length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o!==r)n.set(t.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(e,0),this.pos=0);else{const e=h(t);for(;r<=i-s;s+=r)this.process(e,s)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){o(this),function(t,e){s(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}(t,this),this.finished=!0;const{buffer:e,view:n,blockLen:r,isLE:i}=this;let{pos:a}=this;e[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>r-a&&(this.process(n,0),a=0);for(let t=a;t<r;t++)e[t]=0;!function(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,h=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+h,a,r)}(n,r-8,BigInt(8*this.length),i),this.process(n,0);const c=h(t),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=l/4,d=this.get();if(u>d.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<u;t++)c.setUint32(4*t,d[t],i)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:n,length:r,finished:i,destroyed:s,pos:o}=this;return t.length=r,t.pos=o,t.finished=i,t.destroyed=s,r%e&&t.buffer.set(n),t}}const y=(t,e,n)=>t&e^t&n^e&n,w=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),b=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),m=new Uint32Array(64);class v extends g{constructor(){super(64,32,8,!1),this.A=0|b[0],this.B=0|b[1],this.C=0|b[2],this.D=0|b[3],this.E=0|b[4],this.F=0|b[5],this.G=0|b[6],this.H=0|b[7]}get(){const{A:t,B:e,C:n,D:r,E:i,F:s,G:o,H:a}=this;return[t,e,n,r,i,s,o,a]}set(t,e,n,r,i,s,o,a){this.A=0|t,this.B=0|e,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|s,this.G=0|o,this.H=0|a}process(t,e){for(let n=0;n<16;n++,e+=4)m[n]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=m[t-15],n=m[t-2],r=l(e,7)^l(e,18)^e>>>3,i=l(n,17)^l(n,19)^n>>>10;m[t]=i+m[t-7]+r+m[t-16]|0}let{A:n,B:r,C:i,D:s,E:o,F:a,G:c,H:h}=this;for(let t=0;t<64;t++){const e=h+(l(o,6)^l(o,11)^l(o,25))+((u=o)&a^~u&c)+w[t]+m[t]|0,d=(l(n,2)^l(n,13)^l(n,22))+y(n,r,i)|0;h=c,c=a,a=o,o=s+e|0,s=i,i=r,r=n,n=e+d|0}var u;n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,s=s+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(n,r,i,s,o,a,c,h)}roundClean(){m.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const E=f((()=>new v)),k=(BigInt(0),BigInt(1)),_=BigInt(2),A=t=>t instanceof Uint8Array,x=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function S(t){if(!A(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=x[t[n]];return e}function R(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);return BigInt(""===t?"0":`0x${t}`)}function C(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let e=0;e<n.length;e++){const r=2*e,i=t.slice(r,r+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");n[e]=s}return n}function N(t){return R(S(t))}function I(t){if(!A(t))throw new Error("Uint8Array expected");return R(S(Uint8Array.from(t).reverse()))}function B(t,e){return C(t.toString(16).padStart(2*e,"0"))}function T(t,e){return B(t,e).reverse()}function U(t,e,n){let r;if("string"==typeof e)try{r=C(e)}catch(n){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${n}`)}else{if(!A(e))throw new Error(`${t} must be hex string or Uint8Array`);r=Uint8Array.from(e)}const i=r.length;if("number"==typeof n&&i!==n)throw new Error(`${t} expected ${n} bytes, got ${i}`);return r}function P(...t){const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));let n=0;return t.forEach((t=>{if(!A(t))throw new Error("Uint8Array expected");e.set(t,n),n+=t.length})),e}const L=t=>(_<<BigInt(t-1))-k,O=t=>new Uint8Array(t),D=t=>Uint8Array.from(t);function $(t,e,n){if("number"!=typeof t||t<2)throw new Error("hashLen must be a number");if("number"!=typeof e||e<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");let r=O(t),i=O(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...t)=>n(i,r,...t),c=(t=O())=>{i=a(D([0]),t),r=a(),0!==t.length&&(i=a(D([1]),t),r=a())},h=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let t=0;const n=[];for(;t<e;){r=a();const e=r.slice();n.push(e),t+=r.length}return P(...n)};return(t,e)=>{let n;for(o(),c(t);!(n=e(h()));)c();return o(),n}}const F={bigint:t=>"bigint"==typeof t,function:t=>"function"==typeof t,boolean:t=>"boolean"==typeof t,string:t=>"string"==typeof t,stringOrUint8Array:t=>"string"==typeof t||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>"function"==typeof t&&Number.isSafeInteger(t.outputLen)};function M(t,e,n={}){const r=(e,n,r)=>{const i=F[n];if("function"!=typeof i)throw new Error(`Invalid validator "${n}", expected function`);const s=t[e];if(!(r&&void 0===s||i(s,t)))throw new Error(`Invalid param ${String(e)}=${s} (${typeof s}), expected ${n}`)};for(const[t,n]of Object.entries(e))r(t,n,!1);for(const[t,e]of Object.entries(n))r(t,e,!0);return t}const z=BigInt(0),H=BigInt(1),K=BigInt(2),q=BigInt(3),j=BigInt(4),W=BigInt(5),V=BigInt(8);function G(t,e){const n=t%e;return n>=z?n:e+n}function Z(t,e,n){if(n<=z||e<z)throw new Error("Expected power/modulo > 0");if(n===H)return z;let r=H;for(;e>z;)e&H&&(r=r*t%n),t=t*t%n,e>>=H;return r}function Y(t,e,n){let r=t;for(;e-- >z;)r*=r,r%=n;return r}function J(t,e){if(t===z||e<=z)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=G(t,e),r=e,i=z,s=H,o=H,a=z;for(;n!==z;){const t=r/n,e=r%n,c=i-o*t,h=s-a*t;r=n,n=e,i=o,s=a,o=c,a=h}if(r!==H)throw new Error("invert: does not exist");return G(i,e)}BigInt(9),BigInt(16);const Q=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function X(t,e){const n=void 0!==e?e:t.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function tt(t){if("bigint"!=typeof t)throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function et(t){const e=tt(t);return e+Math.ceil(e/2)}class nt extends d{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,function(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");i(t.outputLen),i(t.blockLen)}(t);const n=u(e);if(this.iHash=t.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,s=new Uint8Array(r);s.set(n.length>r?t.create().update(n).digest():n);for(let t=0;t<s.length;t++)s[t]^=54;this.iHash.update(s),this.oHash=t.create();for(let t=0;t<s.length;t++)s[t]^=106;this.oHash.update(s),s.fill(0)}update(t){return o(this),this.iHash.update(t),this}digestInto(t){o(this),s(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:n,finished:r,destroyed:i,blockLen:s,outputLen:o}=this;return t.finished=r,t.destroyed=i,t.blockLen=s,t.outputLen=o,t.oHash=e._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const rt=(t,e,n)=>new nt(t,e).update(n).digest();rt.create=(t,e)=>new nt(t,e);const it=BigInt(0),st=BigInt(1);function ot(t){return M(t.Fp,Q.reduce(((t,e)=>(t[e]="function",t)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),M(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...X(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const{Ph:at,aT:ct}=r,ht={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(t){const{Err:e}=ht;if(t.length<2||2!==t[0])throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(128&r[0])throw new e("Invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new e("Invalid signature integer: unnecessary leading zero");return{d:at(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=ht,n="string"==typeof t?ct(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||48!=n[0])throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:i,l:s}=ht._parseInt(n.subarray(2)),{d:o,l:a}=ht._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(t){const e=t=>8&Number.parseInt(t[0],16)?"00"+t:t,n=t=>{const e=t.toString(16);return 1&e.length?`0${e}`:e},r=e(n(t.s)),i=e(n(t.r)),s=r.length/2,o=i.length/2,a=n(s),c=n(o);return`30${n(o+s+4)}02${c}${i}02${a}${r}`}},lt=BigInt(0),ut=BigInt(1),dt=(BigInt(2),BigInt(3));function ft(t){const e=function(t){const e=ot(t);return M(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(t){return G(t,r)}function a(t){return J(t,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:h,weierstrassEquation:l,isWithinCurveOrder:u}=function(t){const e=function(t){const e=ot(t);M(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=e;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof n||"bigint"!=typeof n.beta||"function"!=typeof n.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}(t),{Fp:n}=e,r=e.toBytes||((t,e,r)=>{const i=e.toAffine();return P(Uint8Array.from([4]),n.toBytes(i.x),n.toBytes(i.y))}),i=e.fromBytes||(t=>{const e=t.subarray(1);return{x:n.fromBytes(e.subarray(0,n.BYTES)),y:n.fromBytes(e.subarray(n.BYTES,2*n.BYTES))}});function s(t){const{a:r,b:i}=e,s=n.sqr(t),o=n.mul(s,t);return n.add(n.add(o,n.mul(t,r)),i)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function o(t){return"bigint"==typeof t&&lt<t&&t<e.n}function a(t){if(!o(t))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(t){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:i,n:s}=e;if(n&&"bigint"!=typeof t){if(t instanceof Uint8Array&&(t=S(t)),"string"!=typeof t||!n.includes(t.length))throw new Error("Invalid key");t=t.padStart(2*r,"0")}let o;try{o="bigint"==typeof t?t:N(U("private key",t,r))}catch(e){throw new Error(`private key must be ${r} bytes, hex or bigint, not ${typeof t}`)}return i&&(o=G(o,s)),a(o),o}const h=new Map;function l(t){if(!(t instanceof u))throw new Error("ProjectivePoint expected")}class u{constructor(t,e,r){if(this.px=t,this.py=e,this.pz=r,null==t||!n.isValid(t))throw new Error("x required");if(null==e||!n.isValid(e))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required")}static fromAffine(t){const{x:e,y:r}=t||{};if(!t||!n.isValid(e)||!n.isValid(r))throw new Error("invalid affine point");if(t instanceof u)throw new Error("projective point not allowed");const i=t=>n.eql(t,n.ZERO);return i(e)&&i(r)?u.ZERO:new u(e,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(t){const e=n.invertBatch(t.map((t=>t.pz)));return t.map(((t,n)=>t.toAffine(e[n]))).map(u.fromAffine)}static fromHex(t){const e=u.fromAffine(i(U("pointHex",t)));return e.assertValidity(),e}static fromPrivateKey(t){return u.BASE.multiply(c(t))}_setWindowSize(t){this._WINDOW_SIZE=t,h.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:t,y:r}=this.toAffine();if(!n.isValid(t)||!n.isValid(r))throw new Error("bad point: x or y not FE");const i=n.sqr(r),o=s(t);if(!n.eql(i,o))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:t}=this.toAffine();if(n.isOdd)return!n.isOdd(t);throw new Error("Field doesn't support isOdd")}equals(t){l(t);const{px:e,py:r,pz:i}=this,{px:s,py:o,pz:a}=t,c=n.eql(n.mul(e,a),n.mul(s,i)),h=n.eql(n.mul(r,a),n.mul(o,i));return c&&h}negate(){return new u(this.px,n.neg(this.py),this.pz)}double(){const{a:t,b:r}=e,i=n.mul(r,dt),{px:s,py:o,pz:a}=this;let c=n.ZERO,h=n.ZERO,l=n.ZERO,d=n.mul(s,s),f=n.mul(o,o),p=n.mul(a,a),g=n.mul(s,o);return g=n.add(g,g),l=n.mul(s,a),l=n.add(l,l),c=n.mul(t,l),h=n.mul(i,p),h=n.add(c,h),c=n.sub(f,h),h=n.add(f,h),h=n.mul(c,h),c=n.mul(g,c),l=n.mul(i,l),p=n.mul(t,p),g=n.sub(d,p),g=n.mul(t,g),g=n.add(g,l),l=n.add(d,d),d=n.add(l,d),d=n.add(d,p),d=n.mul(d,g),h=n.add(h,d),p=n.mul(o,a),p=n.add(p,p),d=n.mul(p,g),c=n.sub(c,d),l=n.mul(p,f),l=n.add(l,l),l=n.add(l,l),new u(c,h,l)}add(t){l(t);const{px:r,py:i,pz:s}=this,{px:o,py:a,pz:c}=t;let h=n.ZERO,d=n.ZERO,f=n.ZERO;const p=e.a,g=n.mul(e.b,dt);let y=n.mul(r,o),w=n.mul(i,a),b=n.mul(s,c),m=n.add(r,i),v=n.add(o,a);m=n.mul(m,v),v=n.add(y,w),m=n.sub(m,v),v=n.add(r,s);let E=n.add(o,c);return v=n.mul(v,E),E=n.add(y,b),v=n.sub(v,E),E=n.add(i,s),h=n.add(a,c),E=n.mul(E,h),h=n.add(w,b),E=n.sub(E,h),f=n.mul(p,v),h=n.mul(g,b),f=n.add(h,f),h=n.sub(w,f),f=n.add(w,f),d=n.mul(h,f),w=n.add(y,y),w=n.add(w,y),b=n.mul(p,b),v=n.mul(g,v),w=n.add(w,b),b=n.sub(y,b),b=n.mul(p,b),v=n.add(v,b),y=n.mul(w,v),d=n.add(d,y),y=n.mul(E,v),h=n.mul(m,h),h=n.sub(h,y),y=n.mul(m,w),f=n.mul(E,f),f=n.add(f,y),new u(h,d,f)}subtract(t){return this.add(t.negate())}is0(){return this.equals(u.ZERO)}wNAF(t){return f.wNAFCached(this,h,t,(t=>{const e=n.invertBatch(t.map((t=>t.pz)));return t.map(((t,n)=>t.toAffine(e[n]))).map(u.fromAffine)}))}multiplyUnsafe(t){const r=u.ZERO;if(t===lt)return r;if(a(t),t===ut)return this;const{endo:i}=e;if(!i)return f.unsafeLadder(this,t);let{k1neg:s,k1:o,k2neg:c,k2:h}=i.splitScalar(t),l=r,d=r,p=this;for(;o>lt||h>lt;)o&ut&&(l=l.add(p)),h&ut&&(d=d.add(p)),p=p.double(),o>>=ut,h>>=ut;return s&&(l=l.negate()),c&&(d=d.negate()),d=new u(n.mul(d.px,i.beta),d.py,d.pz),l.add(d)}multiply(t){a(t);let r,i,s=t;const{endo:o}=e;if(o){const{k1neg:t,k1:e,k2neg:a,k2:c}=o.splitScalar(s);let{p:h,f:l}=this.wNAF(e),{p:d,f:p}=this.wNAF(c);h=f.constTimeNegate(t,h),d=f.constTimeNegate(a,d),d=new u(n.mul(d.px,o.beta),d.py,d.pz),r=h.add(d),i=l.add(p)}else{const{p:t,f:e}=this.wNAF(s);r=t,i=e}return u.normalizeZ([r,i])[0]}multiplyAndAddUnsafe(t,e,n){const r=u.BASE,i=(t,e)=>e!==lt&&e!==ut&&t.equals(r)?t.multiply(e):t.multiplyUnsafe(e),s=i(this,e).add(i(t,n));return s.is0()?void 0:s}toAffine(t){const{px:e,py:r,pz:i}=this,s=this.is0();null==t&&(t=s?n.ONE:n.inv(i));const o=n.mul(e,t),a=n.mul(r,t),c=n.mul(i,t);if(s)return{x:n.ZERO,y:n.ZERO};if(!n.eql(c,n.ONE))throw new Error("invZ was invalid");return{x:o,y:a}}isTorsionFree(){const{h:t,isTorsionFree:n}=e;if(t===ut)return!0;if(n)return n(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:t,clearCofactor:n}=e;return t===ut?this:n?n(u,this):this.multiplyUnsafe(e.h)}toRawBytes(t=!0){return this.assertValidity(),r(u,this,t)}toHex(t=!0){return S(this.toRawBytes(t))}}u.BASE=new u(e.Gx,e.Gy,n.ONE),u.ZERO=new u(n.ZERO,n.ONE,n.ZERO);const d=e.nBitLength,f=function(t,e){const n=(t,e)=>{const n=e.negate();return t?n:e},r=t=>({windows:Math.ceil(e/t)+1,windowSize:2**(t-1)});return{constTimeNegate:n,unsafeLadder(e,n){let r=t.ZERO,i=e;for(;n>it;)n&st&&(r=r.add(i)),i=i.double(),n>>=st;return r},precomputeWindow(t,e){const{windows:n,windowSize:i}=r(e),s=[];let o=t,a=o;for(let t=0;t<n;t++){a=o,s.push(a);for(let t=1;t<i;t++)a=a.add(o),s.push(a);o=a.double()}return s},wNAF(e,i,s){const{windows:o,windowSize:a}=r(e);let c=t.ZERO,h=t.BASE;const l=BigInt(2**e-1),u=2**e,d=BigInt(e);for(let t=0;t<o;t++){const e=t*a;let r=Number(s&l);s>>=d,r>a&&(r-=u,s+=st);const o=e,f=e+Math.abs(r)-1,p=t%2!=0,g=r<0;0===r?h=h.add(n(p,i[o])):c=c.add(n(g,i[f]))}return{p:c,f:h}},wNAFCached(t,e,n,r){const i=t._WINDOW_SIZE||1;let s=e.get(t);return s||(s=this.precomputeWindow(t,i),1!==i&&e.set(t,r(s))),this.wNAF(i,s,n)}}}(u,e.endo?Math.ceil(d/2):d);return{CURVE:e,ProjectivePoint:u,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:o}}({...e,toBytes(t,e,r){const i=e.toAffine(),s=n.toBytes(i.x),o=P;return r?o(Uint8Array.from([e.hasEvenY()?2:3]),s):o(Uint8Array.from([4]),s,n.toBytes(i.y))},fromBytes(t){const e=t.length,r=t[0],o=t.subarray(1);if(e!==i||2!==r&&3!==r){if(e===s&&4===r)return{x:n.fromBytes(o.subarray(0,n.BYTES)),y:n.fromBytes(o.subarray(n.BYTES,2*n.BYTES))};throw new Error(`Point of length ${e} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}{const t=N(o);if(!(lt<(a=t)&&a<n.ORDER))throw new Error("Point is not on curve");const e=l(t);let i=n.sqrt(e);return!(1&~r)!=((i&ut)===ut)&&(i=n.neg(i)),{x:t,y:i}}var a}}),d=t=>S(B(t,e.nByteLength));function f(t){return t>r>>ut}const p=(t,e,n)=>N(t.slice(e,n));class g{constructor(t,e,n){this.r=t,this.s=e,this.recovery=n,this.assertValidity()}static fromCompact(t){const n=e.nByteLength;return t=U("compactSignature",t,2*n),new g(p(t,0,n),p(t,n,2*n))}static fromDER(t){const{r:e,s:n}=ht.toSig(U("DER",t));return new g(e,n)}assertValidity(){if(!u(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!u(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(t){return new g(this.r,this.s,t)}recoverPublicKey(t){const{r,s:i,recovery:s}=this,h=m(U("msgHash",t));if(null==s||![0,1,2,3].includes(s))throw new Error("recovery id invalid");const l=2===s||3===s?r+e.n:r;if(l>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const u=1&s?"03":"02",f=c.fromHex(u+d(l)),p=a(l),g=o(-h*p),y=o(i*p),w=c.BASE.multiplyAndAddUnsafe(f,g,y);if(!w)throw new Error("point at infinify");return w.assertValidity(),w}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return C(this.toDERHex())}toDERHex(){return ht.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return C(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const y={isValidPrivateKey(t){try{return h(t),!0}catch(t){return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const t=et(e.n);return function(t,e,n=!1){const r=t.length,i=tt(e),s=et(e);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const o=G(n?N(t):I(t),e-H)+H;return n?T(o,i):B(o,i)}(e.randomBytes(t),e.n)},precompute:(t=8,e=c.BASE)=>(e._setWindowSize(t),e.multiply(BigInt(3)),e)};function w(t){const e=t instanceof Uint8Array,n="string"==typeof t,r=(e||n)&&t.length;return e?r===i||r===s:n?r===2*i||r===2*s:t instanceof c}const b=e.bits2int||function(t){const n=N(t),r=8*t.length-e.nBitLength;return r>0?n>>BigInt(r):n},m=e.bits2int_modN||function(t){return o(b(t))},v=L(e.nBitLength);function E(t){if("bigint"!=typeof t)throw new Error("bigint expected");if(!(lt<=t&&t<v))throw new Error(`bigint expected < 2^${e.nBitLength}`);return B(t,e.nByteLength)}const k={lowS:e.lowS,prehash:!1},_={lowS:e.lowS,prehash:!1};return c.BASE._setWindowSize(8),{CURVE:e,getPublicKey:function(t,e=!0){return c.fromPrivateKey(t).toRawBytes(e)},getSharedSecret:function(t,e,n=!0){if(w(t))throw new Error("first arg must be private key");if(!w(e))throw new Error("second arg must be public key");return c.fromHex(e).multiply(h(t)).toRawBytes(n)},sign:function(t,r,i=k){const{seed:s,k2sig:l}=function(t,r,i=k){if(["recovered","canonical"].some((t=>t in i)))throw new Error("sign() legacy options not supported");const{hash:s,randomBytes:l}=e;let{lowS:d,prehash:p,extraEntropy:y}=i;null==d&&(d=!0),t=U("msgHash",t),p&&(t=U("prehashed msgHash",s(t)));const w=m(t),v=h(r),_=[E(v),E(w)];if(null!=y){const t=!0===y?l(n.BYTES):y;_.push(U("extraEntropy",t))}const A=P(..._),x=w;return{seed:A,k2sig:function(t){const e=b(t);if(!u(e))return;const n=a(e),r=c.BASE.multiply(e).toAffine(),i=o(r.x);if(i===lt)return;const s=o(n*o(x+i*v));if(s===lt)return;let h=(r.x===i?0:2)|Number(r.y&ut),l=s;return d&&f(s)&&(l=function(t){return f(t)?o(-t):t}(s),h^=1),new g(i,l,h)}}}(t,r,i),d=e;return $(d.hash.outputLen,d.nByteLength,d.hmac)(s,l)},verify:function(t,n,r,i=_){const s=t;if(n=U("msgHash",n),r=U("publicKey",r),"strict"in i)throw new Error("options.strict was renamed to lowS");const{lowS:h,prehash:l}=i;let u,d;try{if("string"==typeof s||s instanceof Uint8Array)try{u=g.fromDER(s)}catch(t){if(!(t instanceof ht.Err))throw t;u=g.fromCompact(s)}else{if("object"!=typeof s||"bigint"!=typeof s.r||"bigint"!=typeof s.s)throw new Error("PARSE");{const{r:t,s:e}=s;u=new g(t,e)}}d=c.fromHex(r)}catch(t){if("PARSE"===t.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(h&&u.hasHighS())return!1;l&&(n=e.hash(n));const{r:f,s:p}=u,y=m(n),w=a(p),b=o(y*w),v=o(f*w),E=c.BASE.multiplyAndAddUnsafe(d,b,v)?.toAffine();return!!E&&o(E.x)===f},ProjectivePoint:c,Signature:g,utils:y}}function pt(t){return{hash:t,hmac:(e,...n)=>rt(t,e,function(...t){const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));let n=0;return t.forEach((t=>{if(!c(t))throw new Error("Uint8Array expected");e.set(t,n),n+=t.length})),e}(...n)),randomBytes:p}}BigInt(4);const gt=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),yt=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),wt=BigInt(1),bt=BigInt(2),mt=(t,e)=>(t+e/bt)/e;function vt(t){const e=gt,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),h=t*t*t%e,l=h*h*t%e,u=Y(l,n,e)*l%e,d=Y(u,n,e)*l%e,f=Y(d,bt,e)*h%e,p=Y(f,i,e)*f%e,g=Y(p,s,e)*p%e,y=Y(g,a,e)*g%e,w=Y(y,c,e)*y%e,b=Y(w,a,e)*g%e,m=Y(b,n,e)*l%e,v=Y(m,o,e)*p%e,E=Y(v,r,e)*h%e,k=Y(E,bt,e);if(!Et.eql(Et.sqr(k),t))throw new Error("Cannot find square root");return k}const Et=function(t,e,n=!1,r={}){if(t<=z)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:i,nByteLength:s}=X(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=function(t){if(t%j===q){const e=(t+H)/j;return function(t,n){const r=t.pow(n,e);if(!t.eql(t.sqr(r),n))throw new Error("Cannot find square root");return r}}if(t%V===W){const e=(t-W)/V;return function(t,n){const r=t.mul(n,K),i=t.pow(r,e),s=t.mul(n,i),o=t.mul(t.mul(s,K),i),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),n))throw new Error("Cannot find square root");return a}}return function(t){const e=(t-H)/K;let n,r,i;for(n=t-H,r=0;n%K===z;n/=K,r++);for(i=K;i<t&&Z(i,e,t)!==t-H;i++);if(1===r){const e=(t+H)/j;return function(t,n){const r=t.pow(n,e);if(!t.eql(t.sqr(r),n))throw new Error("Cannot find square root");return r}}const s=(n+H)/K;return function(t,o){if(t.pow(o,e)===t.neg(t.ONE))throw new Error("Cannot find square root");let a=r,c=t.pow(t.mul(t.ONE,i),n),h=t.pow(o,s),l=t.pow(o,n);for(;!t.eql(l,t.ONE);){if(t.eql(l,t.ZERO))return t.ZERO;let e=1;for(let n=t.sqr(l);e<a&&!t.eql(n,t.ONE);e++)n=t.sqr(n);const n=t.pow(c,H<<BigInt(a-e-1));c=t.sqr(n),h=t.mul(h,n),l=t.mul(l,c),a=e}return h}}(t)}(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:s,MASK:L(i),ZERO:z,ONE:H,create:e=>G(e,t),isValid:e=>{if("bigint"!=typeof e)throw new Error("Invalid field element: expected bigint, got "+typeof e);return z<=e&&e<t},is0:t=>t===z,isOdd:t=>(t&H)===H,neg:e=>G(-e,t),eql:(t,e)=>t===e,sqr:e=>G(e*e,t),add:(e,n)=>G(e+n,t),sub:(e,n)=>G(e-n,t),mul:(e,n)=>G(e*n,t),pow:(t,e)=>function(t,e,n){if(n<z)throw new Error("Expected power > 0");if(n===z)return t.ONE;if(n===H)return e;let r=t.ONE,i=e;for(;n>z;)n&H&&(r=t.mul(r,i)),i=t.sqr(i),n>>=H;return r}(a,t,e),div:(e,n)=>G(e*J(n,t),t),sqrN:t=>t*t,addN:(t,e)=>t+e,subN:(t,e)=>t-e,mulN:(t,e)=>t*e,inv:e=>J(e,t),sqrt:r.sqrt||(t=>o(a,t)),invertBatch:t=>function(t,e){const n=new Array(e.length),r=e.reduce(((e,r,i)=>t.is0(r)?e:(n[i]=e,t.mul(e,r))),t.ONE),i=t.inv(r);return e.reduceRight(((e,r,i)=>t.is0(r)?e:(n[i]=t.mul(e,n[i]),t.mul(e,r))),i),n}(a,t),cmov:(t,e,n)=>n?e:t,toBytes:t=>n?T(t,s):B(t,s),fromBytes:t=>{if(t.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${t.length}`);return n?I(t):N(t)}});return Object.freeze(a)}(gt,void 0,void 0,{sqrt:vt}),kt=function(t,e){const n=e=>ft({...t,...pt(e)});return Object.freeze({...n(e),create:n})}({a:BigInt(0),b:BigInt(7),Fp:Et,n:yt,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=yt,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-wt*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=mt(s*t,e),c=mt(-r*t,e);let h=G(t-a*n-c*i,e),l=G(-a*r-c*s,e);const u=h>o,d=l>o;if(u&&(h=e-h),d&&(l=e-l),h>o||l>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:u,k1:h,k2neg:d,k2:l}}}},E),_t=BigInt(0),At=t=>"bigint"==typeof t&&_t<t&&t<gt,xt={};function St(t,...e){let n=xt[t];if(void 0===n){const e=E(Uint8Array.from(t,(t=>t.charCodeAt(0))));n=P(e,e),xt[t]=n}return E(P(n,...e))}const Rt=t=>t.toRawBytes(!0).slice(1),Ct=t=>B(t,32),Nt=t=>G(t,gt),It=t=>G(t,yt),Bt=kt.ProjectivePoint;function Tt(t){let e=kt.utils.normPrivateKeyToScalar(t),n=Bt.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:It(-e),bytes:Rt(n)}}function Ut(t){if(!At(t))throw new Error("bad x: need 0 < x < p");const e=Nt(t*t);let n=vt(Nt(e*t+BigInt(7)));n%bt!==_t&&(n=Nt(-n));const r=new Bt(t,n,wt);return r.assertValidity(),r}function Pt(...t){return It(N(St("BIP0340/challenge",...t)))}function Lt(t){return Tt(t).bytes}function Ot(t,e,n=p(32)){const r=U("message",t),{bytes:i,scalar:s}=Tt(e),o=U("auxRand",n,32),a=Ct(s^N(St("BIP0340/aux",o))),c=St("BIP0340/nonce",a,i,r),h=It(N(c));if(h===_t)throw new Error("sign failed: k is zero");const{bytes:l,scalar:u}=Tt(h),d=Pt(l,i,r),f=new Uint8Array(64);if(f.set(l,0),f.set(Ct(It(u+d*s)),32),!Dt(f,r,i))throw new Error("sign: Invalid signature produced");return f}function Dt(t,e,n){const r=U("signature",t,64),i=U("message",e),s=U("publicKey",n,32);try{const t=Ut(N(s)),e=N(r.subarray(0,32));if(!At(e))return!1;const n=N(r.subarray(32,64));if(!("bigint"==typeof(h=n)&&_t<h&&h<yt))return!1;const l=Pt(Ct(e),Rt(t),i),u=(o=t,a=n,c=It(-l),Bt.BASE.multiplyAndAddUnsafe(o,a,c));return!(!u||!u.hasEvenY()||u.toAffine().x!==e)}catch(t){return!1}var o,a,c,h}const $t=(()=>({getPublicKey:Lt,sign:Ot,verify:Dt,utils:{randomPrivateKey:kt.utils.randomPrivateKey,lift_x:Ut,pointToBytes:Rt,numberToBytesBE:B,bytesToNumberBE:N,taggedHash:St,mod:G}}))(),Ft="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,Mt=t=>t instanceof Uint8Array,zt=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Ht=(t,e)=>t<<32-e|t>>>e;if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");const Kt=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function qt(t){if(!Mt(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=Kt[t[n]];return e}function jt(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let e=0;e<n.length;e++){const r=2*e,i=t.slice(r,r+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");n[e]=s}return n}function Wt(t){if("string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t)),!Mt(t))throw new Error("expected Uint8Array, got "+typeof t);return t}function Vt(...t){const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));let n=0;return t.forEach((t=>{if(!Mt(t))throw new Error("Uint8Array expected");e.set(t,n),n+=t.length})),e}class Gt{clone(){return this._cloneInto()}}function Zt(t){const e=e=>t().update(Wt(e)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function Yt(t=32){if(Ft&&"function"==typeof Ft.getRandomValues)return Ft.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function Jt(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function Qt(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}const Xt={number:Jt,bool:function(t){if("boolean"!=typeof t)throw new Error(`Expected boolean, not ${t}`)},bytes:Qt,hash:function(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");Jt(t.outputLen),Jt(t.blockLen)},exists:function(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")},output:function(t,e){Qt(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}};class te extends Gt{constructor(t,e,n,r){super(),this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=zt(this.buffer)}update(t){Xt.exists(this);const{view:e,buffer:n,blockLen:r}=this,i=(t=Wt(t)).length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o!==r)n.set(t.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(e,0),this.pos=0);else{const e=zt(t);for(;r<=i-s;s+=r)this.process(e,s)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){Xt.exists(this),Xt.output(t,this),this.finished=!0;const{buffer:e,view:n,blockLen:r,isLE:i}=this;let{pos:s}=this;e[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let t=s;t<r;t++)e[t]=0;!function(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,h=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+h,a,r)}(n,r-8,BigInt(8*this.length),i),this.process(n,0);const o=zt(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<c;t++)o.setUint32(4*t,h[t],i)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:n,length:r,finished:i,destroyed:s,pos:o}=this;return t.length=r,t.pos=o,t.finished=i,t.destroyed=s,r%e&&t.buffer.set(n),t}}const ee=(t,e,n)=>t&e^t&n^e&n,ne=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),re=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ie=new Uint32Array(64);class se extends te{constructor(){super(64,32,8,!1),this.A=0|re[0],this.B=0|re[1],this.C=0|re[2],this.D=0|re[3],this.E=0|re[4],this.F=0|re[5],this.G=0|re[6],this.H=0|re[7]}get(){const{A:t,B:e,C:n,D:r,E:i,F:s,G:o,H:a}=this;return[t,e,n,r,i,s,o,a]}set(t,e,n,r,i,s,o,a){this.A=0|t,this.B=0|e,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|s,this.G=0|o,this.H=0|a}process(t,e){for(let n=0;n<16;n++,e+=4)ie[n]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=ie[t-15],n=ie[t-2],r=Ht(e,7)^Ht(e,18)^e>>>3,i=Ht(n,17)^Ht(n,19)^n>>>10;ie[t]=i+ie[t-7]+r+ie[t-16]|0}let{A:n,B:r,C:i,D:s,E:o,F:a,G:c,H:h}=this;for(let t=0;t<64;t++){const e=h+(Ht(o,6)^Ht(o,11)^Ht(o,25))+((l=o)&a^~l&c)+ne[t]+ie[t]|0,u=(Ht(n,2)^Ht(n,13)^Ht(n,22))+ee(n,r,i)|0;h=c,c=a,a=o,o=s+e|0,s=i,i=r,r=n,n=e+u|0}var l;n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,s=s+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(n,r,i,s,o,a,c,h)}roundClean(){ie.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class oe extends se{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const ae=Zt((()=>new se));function ce(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function he(...t){const e=(t,e)=>n=>t(e(n)),n=Array.from(t).reverse().reduce(((t,n)=>t?e(t,n.encode):n.encode),void 0),r=t.reduce(((t,n)=>t?e(t,n.decode):n.decode),void 0);return{encode:n,decode:r}}function le(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("alphabet.encode input should be an array of numbers");return e.map((e=>{if(ce(e),e<0||e>=t.length)throw new Error(`Digit index outside alphabet: ${e} (alphabet: ${t.length})`);return t[e]}))},decode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("alphabet.decode input should be array of strings");return e.map((e=>{if("string"!=typeof e)throw new Error(`alphabet.decode: not string element=${e}`);const n=t.indexOf(e);if(-1===n)throw new Error(`Unknown letter: "${e}". Allowed: ${t}`);return n}))}}}function ue(t=""){if("string"!=typeof t)throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("join.encode input should be array of strings");for(let t of e)if("string"!=typeof t)throw new Error(`join.encode: non-string input=${t}`);return e.join(t)},decode:e=>{if("string"!=typeof e)throw new Error("join.decode input should be string");return e.split(t)}}}function de(t,e="="){if(ce(t),"string"!=typeof e)throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let t of n)if("string"!=typeof t)throw new Error(`padding.encode: non-string input=${t}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let t of n)if("string"!=typeof t)throw new Error(`padding.decode: non-string input=${t}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function fe(t){if("function"!=typeof t)throw new Error("normalize fn should be function");return{encode:t=>t,decode:e=>t(e)}}function pe(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const i=[],s=Array.from(t);for(s.forEach((t=>{if(ce(t),t<0||t>=e)throw new Error(`Wrong integer: ${t}`)}));;){let t=0,o=!0;for(let i=r;i<s.length;i++){const a=s[i],c=e*t+a;if(!Number.isSafeInteger(c)||e*t/e!==t||c-a!=e*t)throw new Error("convertRadix: carry overflow");if(t=c%n,s[i]=Math.floor(c/n),!Number.isSafeInteger(s[i])||s[i]*n+t!==c)throw new Error("convertRadix: carry overflow");o&&(s[i]?o=!1:r=i)}if(i.push(t),o)break}for(let e=0;e<t.length-1&&0===t[e];e++)i.push(0);return i.reverse()}Zt((()=>new oe));const ge=(t,e)=>e?ge(e,t%e):t,ye=(t,e)=>t+(e-ge(t,e));function we(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(ye(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${ye(e,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const r of t){if(ce(r),r>=2**e)throw new Error(`convertRadix2: invalid data word=${r} from=${e}`);if(i=i<<e|r,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=e)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function be(t,e=!1){if(ce(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(ye(8,t)>32||ye(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return we(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(we(n,t,8,e))}}}function me(t){if("function"!=typeof t)throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch(t){}}}he(be(4),le("0123456789ABCDEF"),ue("")),he(be(5),le("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),de(5),ue(""));const ve=(he(be(5),le("0123456789ABCDEFGHIJKLMNOPQRSTUV"),de(5),ue("")),he(be(5),le("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),ue(""),fe((t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),he(be(6),le("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),de(6),ue(""))),Ee=(he(be(6),le("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),de(6),ue("")),t=>{return he((ce(e=58),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return pe(Array.from(t),256,e)},decode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("radix.decode input should be array of strings");return Uint8Array.from(pe(t,e,256))}}),le(t),ue(""));var e}),ke=(Ee("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),Ee("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),Ee("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"),he(le("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),ue(""))),_e=[996825010,642813549,513874426,1027748829,705979059];function Ae(t){const e=t>>25;let n=(33554431&t)<<5;for(let t=0;t<_e.length;t++)1==(e>>t&1)&&(n^=_e[t]);return n}function xe(t,e,n=1){const r=t.length;let i=1;for(let e=0;e<r;e++){const n=t.charCodeAt(e);if(n<33||n>126)throw new Error(`Invalid prefix (${t})`);i=Ae(i)^n>>5}i=Ae(i);for(let e=0;e<r;e++)i=Ae(i)^31&t.charCodeAt(e);for(let t of e)i=Ae(i)^t;for(let t=0;t<6;t++)i=Ae(i);return i^=n,ke.encode(we([i%2**30],30,5,!1))}function Se(t){const e="bech32"===t?1:734539939,n=be(5),r=n.decode,i=n.encode,s=me(r);function o(t,n=90){if("string"!=typeof t)throw new Error("bech32.decode input should be string, not "+typeof t);if(t.length<8||!1!==n&&t.length>n)throw new TypeError(`Wrong string length: ${t.length} (${t}). Expected (8..${n})`);const r=t.toLowerCase();if(t!==r&&t!==t.toUpperCase())throw new Error("String must be lowercase or uppercase");const i=(t=r).lastIndexOf("1");if(0===i||-1===i)throw new Error('Letter "1" must be present between prefix and data only');const s=t.slice(0,i),o=t.slice(i+1);if(o.length<6)throw new Error("Data must be at least 6 characters long");const a=ke.decode(o).slice(0,-6),c=xe(s,a,e);if(!o.endsWith(c))throw new Error(`Invalid checksum in ${t}: expected "${c}"`);return{prefix:s,words:a}}return{encode:function(t,n,r=90){if("string"!=typeof t)throw new Error("bech32.encode prefix should be string, not "+typeof t);if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof n);const i=t.length+7+n.length;if(!1!==r&&i>r)throw new TypeError(`Length ${i} exceeds limit ${r}`);return`${t=t.toLowerCase()}1${ke.encode(n)}${xe(t,n,e)}`},decode:o,decodeToBytes:function(t){const{prefix:e,words:n}=o(t,!1);return{prefix:e,words:n,bytes:r(n)}},decodeUnsafe:me(o),fromWords:r,fromWordsUnsafe:s,toWords:i}}const Re=Se("bech32");Se("bech32m");function Ce(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function Ne(t){if("boolean"!=typeof t)throw new Error(`boolean expected, not ${t}`)}function Ie(t){return t instanceof Uint8Array||null!=t&&"object"==typeof t&&"Uint8Array"===t.constructor.name}function Be(t,...e){if(!Ie(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function Te(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Ue(t,e){Be(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}he(be(4),le("0123456789abcdef"),ue(""),fe((t=>{if("string"!=typeof t||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})));const Pe=t=>new Uint8Array(t.buffer,t.byteOffset,t.byteLength),Le=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),Oe=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");function De(t){if("string"==typeof t)t=function(t){if("string"!=typeof t)throw new Error("string expected, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t);else{if(!Ie(t))throw new Error("Uint8Array expected, got "+typeof t);t=t.slice()}return t}function $e(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return 0===n}const Fe=(t,e)=>(Object.assign(e,t),e);function Me(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,h=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+h,a,r)}const ze=16,He=new Uint8Array(16),Ke=Le(He),qe=t=>(t>>>0&255)<<24|(t>>>8&255)<<16|(t>>>16&255)<<8|t>>>24&255;class je{constructor(t,e){this.blockLen=ze,this.outputLen=ze,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,Be(t=De(t),16);const n=Oe(t);let r=n.getUint32(0,!1),i=n.getUint32(4,!1),s=n.getUint32(8,!1),o=n.getUint32(12,!1);const a=[];for(let t=0;t<128;t++)a.push({s0:qe(r),s1:qe(i),s2:qe(s),s3:qe(o)}),({s0:r,s1:i,s2:s,s3:o}={s3:(l=s)<<31|(u=o)>>>1,s2:(h=i)<<31|l>>>1,s1:(c=r)<<31|h>>>1,s0:c>>>1^225<<24&-(1&u)});var c,h,l,u;const d=(t=>t>65536?8:t>1024?4:2)(e||1024);if(![1,2,4,8].includes(d))throw new Error(`ghash: wrong window size=${d}, should be 2, 4 or 8`);this.W=d;const f=128/d,p=this.windowSize=2**d,g=[];for(let t=0;t<f;t++)for(let e=0;e<p;e++){let n=0,r=0,i=0,s=0;for(let o=0;o<d;o++){if(!(e>>>d-o-1&1))continue;const{s0:c,s1:h,s2:l,s3:u}=a[d*t+o];n^=c,r^=h,i^=l,s^=u}g.push({s0:n,s1:r,s2:i,s3:s})}this.t=g}_updateBlock(t,e,n,r){t^=this.s0,e^=this.s1,n^=this.s2,r^=this.s3;const{W:i,t:s,windowSize:o}=this;let a=0,c=0,h=0,l=0;const u=(1<<i)-1;let d=0;for(const f of[t,e,n,r])for(let t=0;t<4;t++){const e=f>>>8*t&255;for(let t=8/i-1;t>=0;t--){const n=e>>>i*t&u,{s0:r,s1:f,s2:p,s3:g}=s[d*o+n];a^=r,c^=f,h^=p,l^=g,d+=1}}this.s0=a,this.s1=c,this.s2=h,this.s3=l}update(t){t=De(t),Te(this);const e=Le(t),n=Math.floor(t.length/ze),r=t.length%ze;for(let t=0;t<n;t++)this._updateBlock(e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]);return r&&(He.set(t.subarray(n*ze)),this._updateBlock(Ke[0],Ke[1],Ke[2],Ke[3]),Ke.fill(0)),this}destroy(){const{t}=this;for(const e of t)e.s0=0,e.s1=0,e.s2=0,e.s3=0}digestInto(t){Te(this),Ue(t,this),this.finished=!0;const{s0:e,s1:n,s2:r,s3:i}=this,s=Le(t);return s[0]=e,s[1]=n,s[2]=r,s[3]=i,t}digest(){const t=new Uint8Array(ze);return this.digestInto(t),this.destroy(),t}}class We extends je{constructor(t,e){const n=function(t){t.reverse();const e=1&t[15];let n=0;for(let e=0;e<t.length;e++){const r=t[e];t[e]=r>>>1|n,n=(1&r)<<7}return t[0]^=225&-e,t}((t=De(t)).slice());super(n,e),n.fill(0)}update(t){t=De(t),Te(this);const e=Le(t),n=t.length%ze,r=Math.floor(t.length/ze);for(let t=0;t<r;t++)this._updateBlock(qe(e[4*t+3]),qe(e[4*t+2]),qe(e[4*t+1]),qe(e[4*t+0]));return n&&(He.set(t.subarray(r*ze)),this._updateBlock(qe(Ke[3]),qe(Ke[2]),qe(Ke[1]),qe(Ke[0])),Ke.fill(0)),this}digestInto(t){Te(this),Ue(t,this),this.finished=!0;const{s0:e,s1:n,s2:r,s3:i}=this,s=Le(t);return s[0]=e,s[1]=n,s[2]=r,s[3]=i,t.reverse()}}function Ve(t){const e=(e,n)=>t(n,e.length).update(De(e)).digest(),n=t(new Uint8Array(16),0);return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=(e,n)=>t(e,n),e}const Ge=Ve(((t,e)=>new je(t,e))),Ze=Ve(((t,e)=>new We(t,e))),Ye=16,Je=new Uint8Array(Ye);function Qe(t){return t<<1^283&-(t>>7)}function Xe(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(1&e),t=Qe(t);return n}const tn=(()=>{let t=new Uint8Array(256);for(let e=0,n=1;e<256;e++,n^=Qe(n))t[e]=n;const e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=255&(r^r>>4^r>>5^r>>6^r>>7^99)}return e})(),en=tn.map(((t,e)=>tn.indexOf(e))),nn=t=>t<<8|t>>>24;function rn(t,e){if(256!==t.length)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map(((n,r)=>e(t[r]))),r=n.map(nn),i=r.map(nn),s=i.map(nn),o=new Uint32Array(65536),a=new Uint32Array(65536),c=new Uint16Array(65536);for(let e=0;e<256;e++)for(let h=0;h<256;h++){const l=256*e+h;o[l]=n[e]^r[h],a[l]=i[e]^s[h],c[l]=t[e]<<8|t[h]}return{sbox:t,sbox2:c,T0:n,T1:r,T2:i,T3:s,T01:o,T23:a}}const sn=rn(tn,(t=>Xe(t,3)<<24|t<<16|t<<8|Xe(t,2))),on=rn(en,(t=>Xe(t,11)<<24|Xe(t,13)<<16|Xe(t,9)<<8|Xe(t,14))),an=(()=>{const t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=Qe(n))t[e]=n;return t})();function cn(t){Be(t);const e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:n}=sn,r=Le(t),i=r.length,s=t=>un(n,t,t,t,t),o=new Uint32Array(e+28);o.set(r);for(let t=i;t<o.length;t++){let e=o[t-1];t%i==0?e=s((a=e)<<24|a>>>8)^an[t/i-1]:i>6&&t%i==4&&(e=s(e)),o[t]=o[t-i]^e}var a;return o}function hn(t){const e=cn(t),n=e.slice(),r=e.length,{sbox2:i}=sn,{T0:s,T1:o,T2:a,T3:c}=on;for(let t=0;t<r;t+=4)for(let i=0;i<4;i++)n[t+i]=e[r-t-4+i];e.fill(0);for(let t=4;t<r-4;t++){const e=n[t],r=un(i,e,e,e,e);n[t]=s[255&r]^o[r>>>8&255]^a[r>>>16&255]^c[r>>>24]}return n}function ln(t,e,n,r,i,s){return t[n<<8&65280|r>>>8&255]^e[i>>>8&65280|s>>>24&255]}function un(t,e,n,r,i){return t[255&e|65280&n]|t[r>>>16&255|i>>>16&65280]<<16}function dn(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=sn;let c=0;e^=t[c++],n^=t[c++],r^=t[c++],i^=t[c++];const h=t.length/4-2;for(let s=0;s<h;s++){const s=t[c++]^ln(o,a,e,n,r,i),h=t[c++]^ln(o,a,n,r,i,e),l=t[c++]^ln(o,a,r,i,e,n),u=t[c++]^ln(o,a,i,e,n,r);e=s,n=h,r=l,i=u}return{s0:t[c++]^un(s,e,n,r,i),s1:t[c++]^un(s,n,r,i,e),s2:t[c++]^un(s,r,i,e,n),s3:t[c++]^un(s,i,e,n,r)}}function fn(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=on;let c=0;e^=t[c++],n^=t[c++],r^=t[c++],i^=t[c++];const h=t.length/4-2;for(let s=0;s<h;s++){const s=t[c++]^ln(o,a,e,i,r,n),h=t[c++]^ln(o,a,n,e,i,r),l=t[c++]^ln(o,a,r,n,e,i),u=t[c++]^ln(o,a,i,r,n,e);e=s,n=h,r=l,i=u}return{s0:t[c++]^un(s,e,i,r,n),s1:t[c++]^un(s,n,e,i,r),s2:t[c++]^un(s,r,n,e,i),s3:t[c++]^un(s,i,r,n,e)}}function pn(t,e){if(!e)return new Uint8Array(t);if(Be(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function gn(t,e,n,r,i){Be(n,Ye),Be(r),i=pn(r.length,i);const s=n,o=Le(s),a=Oe(s),c=Le(r),h=Le(i),l=e?0:12,u=r.length;let d=a.getUint32(l,e),{s0:f,s1:p,s2:g,s3:y}=dn(t,o[0],o[1],o[2],o[3]);for(let n=0;n+4<=c.length;n+=4)h[n+0]=c[n+0]^f,h[n+1]=c[n+1]^p,h[n+2]=c[n+2]^g,h[n+3]=c[n+3]^y,d=d+1>>>0,a.setUint32(l,d,e),({s0:f,s1:p,s2:g,s3:y}=dn(t,o[0],o[1],o[2],o[3]));const w=Ye*Math.floor(c.length/4);if(w<u){const t=new Uint32Array([f,p,g,y]),e=Pe(t);for(let t=w,n=0;t<u;t++,n++)i[t]=r[t]^e[n]}return i}function yn(t){if(Be(t),t.length%Ye!=0)throw new Error("aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size 16")}function wn(t,e,n){let r=t.length;const i=r%Ye;if(!e&&0!==i)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=Le(t);if(e){let t=Ye-i;t||(t=Ye),r+=t}const o=pn(r,n);return{b:s,o:Le(o),out:o}}function bn(t,e){if(!e)return t;const n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const i=t.subarray(0,-r);for(let e=0;e<r;e++)if(t[n-e-1]!==r)throw new Error("aes/pcks5: wrong padding");return i}function mn(t){const e=new Uint8Array(16),n=Le(e);e.set(t);const r=Ye-t.length;for(let t=Ye-r;t<Ye;t++)e[t]=r;return n}Fe({blockSize:16,nonceLength:16},(function(t,e){function n(n,r){const i=cn(t),s=e.slice(),o=function(t,e,n,r){Be(e,Ye),Be(n);const i=n.length;r=pn(i,r);const s=e,o=Le(s);let{s0:a,s1:c,s2:h,s3:l}=dn(t,o[0],o[1],o[2],o[3]);const u=Le(n),d=Le(r);for(let e=0;e+4<=u.length;e+=4){d[e+0]=u[e+0]^a,d[e+1]=u[e+1]^c,d[e+2]=u[e+2]^h,d[e+3]=u[e+3]^l;let n=1;for(let t=s.length-1;t>=0;t--)n=n+(255&s[t])|0,s[t]=255&n,n>>>=8;({s0:a,s1:c,s2:h,s3:l}=dn(t,o[0],o[1],o[2],o[3]))}const f=Ye*Math.floor(u.length/4);if(f<i){const t=new Uint32Array([a,c,h,l]),e=Pe(t);for(let t=f,s=0;t<i;t++,s++)r[t]=n[t]^e[s]}return r}(i,s,n,r);return i.fill(0),s.fill(0),o}return Be(t),Be(e,Ye),{encrypt:(t,e)=>n(t,e),decrypt:(t,e)=>n(t,e)}})),Fe({blockSize:16},(function(t,e={}){Be(t);const n=!e.disablePadding;return{encrypt:(e,r)=>{Be(e);const{b:i,o:s,out:o}=wn(e,n,r),a=cn(t);let c=0;for(;c+4<=i.length;){const{s0:t,s1:e,s2:n,s3:r}=dn(a,i[c+0],i[c+1],i[c+2],i[c+3]);s[c++]=t,s[c++]=e,s[c++]=n,s[c++]=r}if(n){const t=mn(e.subarray(4*c)),{s0:n,s1:r,s2:i,s3:o}=dn(a,t[0],t[1],t[2],t[3]);s[c++]=n,s[c++]=r,s[c++]=i,s[c++]=o}return a.fill(0),o},decrypt:(e,r)=>{yn(e);const i=hn(t),s=pn(e.length,r),o=Le(e),a=Le(s);for(let t=0;t+4<=o.length;){const{s0:e,s1:n,s2:r,s3:s}=fn(i,o[t+0],o[t+1],o[t+2],o[t+3]);a[t++]=e,a[t++]=n,a[t++]=r,a[t++]=s}return i.fill(0),bn(s,n)}}}));const vn=Fe({blockSize:16,nonceLength:16},(function(t,e,n={}){Be(t),Be(e,16);const r=!n.disablePadding;return{encrypt:(n,i)=>{const s=cn(t),{b:o,o:a,out:c}=wn(n,r,i),h=Le(e);let l=h[0],u=h[1],d=h[2],f=h[3],p=0;for(;p+4<=o.length;)l^=o[p+0],u^=o[p+1],d^=o[p+2],f^=o[p+3],({s0:l,s1:u,s2:d,s3:f}=dn(s,l,u,d,f)),a[p++]=l,a[p++]=u,a[p++]=d,a[p++]=f;if(r){const t=mn(n.subarray(4*p));l^=t[0],u^=t[1],d^=t[2],f^=t[3],({s0:l,s1:u,s2:d,s3:f}=dn(s,l,u,d,f)),a[p++]=l,a[p++]=u,a[p++]=d,a[p++]=f}return s.fill(0),c},decrypt:(n,i)=>{yn(n);const s=hn(t),o=Le(e),a=pn(n.length,i),c=Le(n),h=Le(a);let l=o[0],u=o[1],d=o[2],f=o[3];for(let t=0;t+4<=c.length;){const e=l,n=u,r=d,i=f;l=c[t+0],u=c[t+1],d=c[t+2],f=c[t+3];const{s0:o,s1:a,s2:p,s3:g}=fn(s,l,u,d,f);h[t++]=o^e,h[t++]=a^n,h[t++]=p^r,h[t++]=g^i}return s.fill(0),bn(a,r)}}}));function En(t,e,n,r,i){const s=t.create(n,r.length+(i?.length||0));i&&s.update(i),s.update(r);const o=new Uint8Array(16),a=Oe(o);return i&&Me(a,0,BigInt(8*i.length),e),Me(a,8,BigInt(8*r.length),e),s.update(o),s.digest()}Fe({blockSize:16,nonceLength:16},(function(t,e){function n(n,r,i){const s=cn(t),o=n.length;i=pn(o,i);const a=Le(n),c=Le(i),h=r?c:a,l=Le(e);let u=l[0],d=l[1],f=l[2],p=l[3];for(let t=0;t+4<=a.length;){const{s0:e,s1:n,s2:r,s3:i}=dn(s,u,d,f,p);c[t+0]=a[t+0]^e,c[t+1]=a[t+1]^n,c[t+2]=a[t+2]^r,c[t+3]=a[t+3]^i,u=h[t++],d=h[t++],f=h[t++],p=h[t++]}const g=Ye*Math.floor(a.length/4);if(g<o){({s0:u,s1:d,s2:f,s3:p}=dn(s,u,d,f,p));const t=Pe(new Uint32Array([u,d,f,p]));for(let e=g,r=0;e<o;e++,r++)i[e]=n[e]^t[r];t.fill(0)}return s.fill(0),i}return Be(t),Be(e,16),{encrypt:(t,e)=>n(t,!0,e),decrypt:(t,e)=>n(t,!1,e)}})),Fe({blockSize:16,nonceLength:12,tagLength:16},(function(t,e,n){if(Be(e),0===e.length)throw new Error("aes/gcm: empty nonce");function r(t,e,r){const i=En(Ge,!1,t,r,n);for(let t=0;t<e.length;t++)i[t]^=e[t];return i}function i(){const n=cn(t),r=Je.slice(),i=Je.slice();if(gn(n,!1,i,i,r),12===e.length)i.set(e);else{const t=Je.slice();Me(Oe(t),8,BigInt(8*e.length),!1),Ge.create(r).update(e).update(t).digestInto(i)}return{xk:n,authKey:r,counter:i,tagMask:gn(n,!1,i,Je)}}return{encrypt:t=>{Be(t);const{xk:e,authKey:n,counter:s,tagMask:o}=i(),a=new Uint8Array(t.length+16);gn(e,!1,s,t,a);const c=r(n,o,a.subarray(0,a.length-16));return a.set(c,t.length),e.fill(0),a},decrypt:t=>{if(Be(t),t.length<16)throw new Error("aes/gcm: ciphertext less than tagLen (16)");const{xk:e,authKey:n,counter:s,tagMask:o}=i(),a=t.subarray(0,-16),c=t.subarray(-16);if(!$e(r(n,o,a),c))throw new Error("aes/gcm: invalid ghash tag");const h=gn(e,!1,s,a);return n.fill(0),o.fill(0),e.fill(0),h}}}));const kn=(t,e,n)=>r=>{if(!Number.isSafeInteger(r)||e>r||r>n)throw new Error(`${t}: invalid value=${r}, must be [${e}..${n}]`)};Fe({blockSize:16,nonceLength:12,tagLength:16},(function(t,e,n){const r=kn("AAD",0,2**36),i=kn("plaintext",0,2**36),s=kn("nonce",12,12),o=kn("ciphertext",16,2**36+16);function a(){const n=t.length;if(16!==n&&24!==n&&32!==n)throw new Error(`key length must be 16, 24 or 32 bytes, got: ${n} bytes`);const r=cn(t),i=new Uint8Array(n),s=new Uint8Array(16),o=Le(e);let a=0,c=o[0],h=o[1],l=o[2],u=0;for(const t of[s,i].map(Le)){const e=Le(t);for(let t=0;t<e.length;t+=2){const{s0:n,s1:i}=dn(r,a,c,h,l);e[t+0]=n,e[t+1]=i,a=++u}}return r.fill(0),{authKey:s,encKey:cn(i)}}function c(t,r,i){const s=En(Ze,!0,r,i,n);for(let t=0;t<12;t++)s[t]^=e[t];s[15]&=127;const o=Le(s);let a=o[0],c=o[1],h=o[2],l=o[3];return({s0:a,s1:c,s2:h,s3:l}=dn(t,a,c,h,l)),o[0]=a,o[1]=c,o[2]=h,o[3]=l,s}function h(t,e,n){let r=e.slice();return r[15]|=128,gn(t,!0,r,n)}return Be(e),s(e.length),n&&(Be(n),r(n.length)),{encrypt:t=>{Be(t),i(t.length);const{encKey:e,authKey:n}=a(),r=c(e,n,t),s=new Uint8Array(t.length+16);return s.set(r,t.length),s.set(h(e,r,t)),e.fill(0),n.fill(0),s},decrypt:t=>{Be(t),o(t.length);const e=t.subarray(-16),{encKey:n,authKey:r}=a(),i=h(n,e,t.subarray(0,-16)),s=c(n,r,i);if(n.fill(0),r.fill(0),!$e(e,s))throw new Error("invalid polyval tag");return i}}}));const _n=(t,e)=>255&t[e++]|(255&t[e++])<<8;class An{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,Be(t=De(t),32);const e=_n(t,0),n=_n(t,2),r=_n(t,4),i=_n(t,6),s=_n(t,8),o=_n(t,10),a=_n(t,12),c=_n(t,14);this.r[0]=8191&e,this.r[1]=8191&(e>>>13|n<<3),this.r[2]=7939&(n>>>10|r<<6),this.r[3]=8191&(r>>>7|i<<9),this.r[4]=255&(i>>>4|s<<12),this.r[5]=s>>>1&8190,this.r[6]=8191&(s>>>14|o<<2),this.r[7]=8065&(o>>>11|a<<5),this.r[8]=8191&(a>>>8|c<<8),this.r[9]=c>>>5&127;for(let e=0;e<8;e++)this.pad[e]=_n(t,16+2*e)}process(t,e,n=!1){const r=n?0:2048,{h:i,r:s}=this,o=s[0],a=s[1],c=s[2],h=s[3],l=s[4],u=s[5],d=s[6],f=s[7],p=s[8],g=s[9],y=_n(t,e+0),w=_n(t,e+2),b=_n(t,e+4),m=_n(t,e+6),v=_n(t,e+8),E=_n(t,e+10),k=_n(t,e+12),_=_n(t,e+14);let A=i[0]+(8191&y),x=i[1]+(8191&(y>>>13|w<<3)),S=i[2]+(8191&(w>>>10|b<<6)),R=i[3]+(8191&(b>>>7|m<<9)),C=i[4]+(8191&(m>>>4|v<<12)),N=i[5]+(v>>>1&8191),I=i[6]+(8191&(v>>>14|E<<2)),B=i[7]+(8191&(E>>>11|k<<5)),T=i[8]+(8191&(k>>>8|_<<8)),U=i[9]+(_>>>5|r),P=0,L=P+A*o+x*(5*g)+S*(5*p)+R*(5*f)+C*(5*d);P=L>>>13,L&=8191,L+=N*(5*u)+I*(5*l)+B*(5*h)+T*(5*c)+U*(5*a),P+=L>>>13,L&=8191;let O=P+A*a+x*o+S*(5*g)+R*(5*p)+C*(5*f);P=O>>>13,O&=8191,O+=N*(5*d)+I*(5*u)+B*(5*l)+T*(5*h)+U*(5*c),P+=O>>>13,O&=8191;let D=P+A*c+x*a+S*o+R*(5*g)+C*(5*p);P=D>>>13,D&=8191,D+=N*(5*f)+I*(5*d)+B*(5*u)+T*(5*l)+U*(5*h),P+=D>>>13,D&=8191;let $=P+A*h+x*c+S*a+R*o+C*(5*g);P=$>>>13,$&=8191,$+=N*(5*p)+I*(5*f)+B*(5*d)+T*(5*u)+U*(5*l),P+=$>>>13,$&=8191;let F=P+A*l+x*h+S*c+R*a+C*o;P=F>>>13,F&=8191,F+=N*(5*g)+I*(5*p)+B*(5*f)+T*(5*d)+U*(5*u),P+=F>>>13,F&=8191;let M=P+A*u+x*l+S*h+R*c+C*a;P=M>>>13,M&=8191,M+=N*o+I*(5*g)+B*(5*p)+T*(5*f)+U*(5*d),P+=M>>>13,M&=8191;let z=P+A*d+x*u+S*l+R*h+C*c;P=z>>>13,z&=8191,z+=N*a+I*o+B*(5*g)+T*(5*p)+U*(5*f),P+=z>>>13,z&=8191;let H=P+A*f+x*d+S*u+R*l+C*h;P=H>>>13,H&=8191,H+=N*c+I*a+B*o+T*(5*g)+U*(5*p),P+=H>>>13,H&=8191;let K=P+A*p+x*f+S*d+R*u+C*l;P=K>>>13,K&=8191,K+=N*h+I*c+B*a+T*o+U*(5*g),P+=K>>>13,K&=8191;let q=P+A*g+x*p+S*f+R*d+C*u;P=q>>>13,q&=8191,q+=N*l+I*h+B*c+T*a+U*o,P+=q>>>13,q&=8191,P=(P<<2)+P|0,P=P+L|0,L=8191&P,P>>>=13,O+=P,i[0]=L,i[1]=O,i[2]=D,i[3]=$,i[4]=F,i[5]=M,i[6]=z,i[7]=H,i[8]=K,i[9]=q}finalize(){const{h:t,pad:e}=this,n=new Uint16Array(10);let r=t[1]>>>13;t[1]&=8191;for(let e=2;e<10;e++)t[e]+=r,r=t[e]>>>13,t[e]&=8191;t[0]+=5*r,r=t[0]>>>13,t[0]&=8191,t[1]+=r,r=t[1]>>>13,t[1]&=8191,t[2]+=r,n[0]=t[0]+5,r=n[0]>>>13,n[0]&=8191;for(let e=1;e<10;e++)n[e]=t[e]+r,r=n[e]>>>13,n[e]&=8191;n[9]-=8192;let i=(1^r)-1;for(let t=0;t<10;t++)n[t]&=i;i=~i;for(let e=0;e<10;e++)t[e]=t[e]&i|n[e];t[0]=65535&(t[0]|t[1]<<13),t[1]=65535&(t[1]>>>3|t[2]<<10),t[2]=65535&(t[2]>>>6|t[3]<<7),t[3]=65535&(t[3]>>>9|t[4]<<4),t[4]=65535&(t[4]>>>12|t[5]<<1|t[6]<<14),t[5]=65535&(t[6]>>>2|t[7]<<11),t[6]=65535&(t[7]>>>5|t[8]<<8),t[7]=65535&(t[8]>>>8|t[9]<<5);let s=t[0]+e[0];t[0]=65535&s;for(let n=1;n<8;n++)s=(t[n]+e[n]|0)+(s>>>16)|0,t[n]=65535&s}update(t){Te(this);const{buffer:e,blockLen:n}=this,r=(t=De(t)).length;for(let i=0;i<r;){const s=Math.min(n-this.pos,r-i);if(s!==n)e.set(t.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===n&&(this.process(e,0,!1),this.pos=0);else for(;n<=r-i;i+=n)this.process(t,i)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(t){Te(this),Ue(t,this),this.finished=!0;const{buffer:e,h:n}=this;let{pos:r}=this;if(r){for(e[r++]=1;r<16;r++)e[r]=0;this.process(e,0,!0)}this.finalize();let i=0;for(let e=0;e<8;e++)t[i++]=n[e]>>>0,t[i++]=n[e]>>>8;return t}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}}const xn=function(t){const e=(e,n)=>t(n).update(De(e)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=e=>t(e),e}((t=>new An(t))),Sn=t=>Uint8Array.from(t.split("").map((t=>t.charCodeAt(0)))),Rn=Sn("expand 16-byte k"),Cn=Sn("expand 32-byte k"),Nn=Le(Rn),In=Le(Cn);function Bn(t,e){return t<<e|t>>>32-e}function Tn(t){return t.byteOffset%4==0}In.slice();const Un=2**32-1,Pn=new Uint32Array;function Ln(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=function(t,e){if(null==e||"object"!=typeof e)throw new Error("options must be defined");return Object.assign({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e)}(0,e);if("function"!=typeof t)throw new Error("core must be a function");return Ce(i),Ce(o),Ne(s),Ne(n),(e,a,c,h,l=0)=>{Be(e),Be(a),Be(c);const u=c.length;if(h||(h=new Uint8Array(u)),Be(h),Ce(l),l<0||l>=Un)throw new Error("arx: counter overflow");if(h.length<u)throw new Error(`arx: output (${h.length}) is shorter than data (${u})`);const d=[];let f,p,g=e.length;if(32===g)f=e.slice(),d.push(f),p=In;else{if(16!==g||!n)throw new Error(`arx: invalid 32-byte key, got length=${g}`);f=new Uint8Array(32),f.set(e),f.set(e,16),p=Nn,d.push(f)}Tn(a)||(a=a.slice(),d.push(a));const y=Le(f);if(r){if(24!==a.length)throw new Error("arx: extended nonce must be 24 bytes");r(p,y,Le(a.subarray(0,16)),y),a=a.subarray(16)}const w=16-i;if(w!==a.length)throw new Error(`arx: nonce must be ${w} or 16 bytes`);if(12!==w){const t=new Uint8Array(12);t.set(a,s?0:12-a.length),a=t,d.push(a)}const b=Le(a);for(function(t,e,n,r,i,s,o,a){const c=i.length,h=new Uint8Array(64),l=Le(h),u=Tn(i)&&Tn(s),d=u?Le(i):Pn,f=u?Le(s):Pn;for(let p=0;p<c;o++){if(t(e,n,r,l,o,a),o>=Un)throw new Error("arx: counter overflow");const g=Math.min(64,c-p);if(u&&64===g){const t=p/4;if(p%4!=0)throw new Error("arx: invalid block position");for(let e,n=0;n<16;n++)e=t+n,f[e]=d[e]^l[n];p+=64}else{for(let t,e=0;e<g;e++)t=p+e,s[t]=i[t]^h[e];p+=g}}}(t,p,y,b,c,h,l,o);d.length>0;)d.pop().fill(0);return h}}function On(t,e,n,r,i,s=20){let o=t[0],a=t[1],c=t[2],h=t[3],l=e[0],u=e[1],d=e[2],f=e[3],p=e[4],g=e[5],y=e[6],w=e[7],b=i,m=n[0],v=n[1],E=n[2],k=o,_=a,A=c,x=h,S=l,R=u,C=d,N=f,I=p,B=g,T=y,U=w,P=b,L=m,O=v,D=E;for(let t=0;t<s;t+=2)k=k+S|0,P=Bn(P^k,16),I=I+P|0,S=Bn(S^I,12),k=k+S|0,P=Bn(P^k,8),I=I+P|0,S=Bn(S^I,7),_=_+R|0,L=Bn(L^_,16),B=B+L|0,R=Bn(R^B,12),_=_+R|0,L=Bn(L^_,8),B=B+L|0,R=Bn(R^B,7),A=A+C|0,O=Bn(O^A,16),T=T+O|0,C=Bn(C^T,12),A=A+C|0,O=Bn(O^A,8),T=T+O|0,C=Bn(C^T,7),x=x+N|0,D=Bn(D^x,16),U=U+D|0,N=Bn(N^U,12),x=x+N|0,D=Bn(D^x,8),U=U+D|0,N=Bn(N^U,7),k=k+R|0,D=Bn(D^k,16),T=T+D|0,R=Bn(R^T,12),k=k+R|0,D=Bn(D^k,8),T=T+D|0,R=Bn(R^T,7),_=_+C|0,P=Bn(P^_,16),U=U+P|0,C=Bn(C^U,12),_=_+C|0,P=Bn(P^_,8),U=U+P|0,C=Bn(C^U,7),A=A+N|0,L=Bn(L^A,16),I=I+L|0,N=Bn(N^I,12),A=A+N|0,L=Bn(L^A,8),I=I+L|0,N=Bn(N^I,7),x=x+S|0,O=Bn(O^x,16),B=B+O|0,S=Bn(S^B,12),x=x+S|0,O=Bn(O^x,8),B=B+O|0,S=Bn(S^B,7);let $=0;r[$++]=o+k|0,r[$++]=a+_|0,r[$++]=c+A|0,r[$++]=h+x|0,r[$++]=l+S|0,r[$++]=u+R|0,r[$++]=d+C|0,r[$++]=f+N|0,r[$++]=p+I|0,r[$++]=g+B|0,r[$++]=y+T|0,r[$++]=w+U|0,r[$++]=b+P|0,r[$++]=m+L|0,r[$++]=v+O|0,r[$++]=E+D|0}const Dn=Ln(On,{counterRight:!1,counterLength:4,allowShortKeys:!1}),$n=Ln(On,{counterRight:!1,counterLength:8,extendNonceFn:function(t,e,n,r){let i=t[0],s=t[1],o=t[2],a=t[3],c=e[0],h=e[1],l=e[2],u=e[3],d=e[4],f=e[5],p=e[6],g=e[7],y=n[0],w=n[1],b=n[2],m=n[3];for(let t=0;t<20;t+=2)i=i+c|0,y=Bn(y^i,16),d=d+y|0,c=Bn(c^d,12),i=i+c|0,y=Bn(y^i,8),d=d+y|0,c=Bn(c^d,7),s=s+h|0,w=Bn(w^s,16),f=f+w|0,h=Bn(h^f,12),s=s+h|0,w=Bn(w^s,8),f=f+w|0,h=Bn(h^f,7),o=o+l|0,b=Bn(b^o,16),p=p+b|0,l=Bn(l^p,12),o=o+l|0,b=Bn(b^o,8),p=p+b|0,l=Bn(l^p,7),a=a+u|0,m=Bn(m^a,16),g=g+m|0,u=Bn(u^g,12),a=a+u|0,m=Bn(m^a,8),g=g+m|0,u=Bn(u^g,7),i=i+h|0,m=Bn(m^i,16),p=p+m|0,h=Bn(h^p,12),i=i+h|0,m=Bn(m^i,8),p=p+m|0,h=Bn(h^p,7),s=s+l|0,y=Bn(y^s,16),g=g+y|0,l=Bn(l^g,12),s=s+l|0,y=Bn(y^s,8),g=g+y|0,l=Bn(l^g,7),o=o+u|0,w=Bn(w^o,16),d=d+w|0,u=Bn(u^d,12),o=o+u|0,w=Bn(w^o,8),d=d+w|0,u=Bn(u^d,7),a=a+c|0,b=Bn(b^a,16),f=f+b|0,c=Bn(c^f,12),a=a+c|0,b=Bn(b^a,8),f=f+b|0,c=Bn(c^f,7);let v=0;r[v++]=i,r[v++]=s,r[v++]=o,r[v++]=a,r[v++]=y,r[v++]=w,r[v++]=b,r[v++]=m},allowShortKeys:!1}),Fn=new Uint8Array(16),Mn=(t,e)=>{t.update(e);const n=e.length%16;n&&t.update(Fn.subarray(n))},zn=new Uint8Array(32);function Hn(t,e,n,r,i){const s=t(e,n,zn),o=xn.create(s);i&&Mn(o,i),Mn(o,r);const a=new Uint8Array(16),c=Oe(a);Me(c,0,BigInt(i?i.length:0),!0),Me(c,8,BigInt(r.length),!0),o.update(a);const h=o.digest();return s.fill(0),h}const Kn=t=>(e,n,r)=>(Be(e,32),Be(n),{encrypt:(i,s)=>{const o=i.length,a=o+16;s?Be(s,a):s=new Uint8Array(a),t(e,n,i,s,1);const c=Hn(t,e,n,s.subarray(0,-16),r);return s.set(c,o),s},decrypt:(i,s)=>{const o=i.length,a=o-16;if(o<16)throw new Error("encrypted data must be at least 16 bytes");s?Be(s,a):s=new Uint8Array(a);const c=i.subarray(0,-16);if(!$e(i.subarray(-16),Hn(t,e,n,c,r)))throw new Error("invalid tag");return t(e,n,c,s,1),s}});Kn(Dn),Kn($n);class qn extends Gt{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,Xt.hash(t);const n=Wt(e);if(this.iHash=t.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?t.create().update(n).digest():n);for(let t=0;t<i.length;t++)i[t]^=54;this.iHash.update(i),this.oHash=t.create();for(let t=0;t<i.length;t++)i[t]^=106;this.oHash.update(i),i.fill(0)}update(t){return Xt.exists(this),this.iHash.update(t),this}digestInto(t){Xt.exists(this),Xt.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:n,finished:r,destroyed:i,blockLen:s,outputLen:o}=this;return t.finished=r,t.destroyed=i,t.blockLen=s,t.outputLen=o,t.oHash=e._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const jn=(t,e,n)=>new qn(t,e).update(n).digest();jn.create=(t,e)=>new qn(t,e);const Wn=new Uint8Array([0]),Vn=new Uint8Array;var Gn=Object.defineProperty,Zn=(t,e)=>{for(var n in e)Gn(t,n,{get:e[n],enumerable:!0})},Yn=Symbol("verified");function Jn(t){if(!(t instanceof Object))return!1;if("number"!=typeof t.kind)return!1;if("string"!=typeof t.content)return!1;if("number"!=typeof t.created_at)return!1;if("string"!=typeof t.pubkey)return!1;if(!t.pubkey.match(/^[a-f0-9]{64}$/))return!1;if(!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let t=0;t<n.length;t++)if("object"==typeof n[t])return!1}return!0}Zn({},{Queue:()=>sr,QueueNode:()=>ir,binarySearch:()=>rr,insertEventIntoAscendingList:()=>nr,insertEventIntoDescendingList:()=>er,normalizeURL:()=>tr,utf8Decoder:()=>Qn,utf8Encoder:()=>Xn});var Qn=new TextDecoder("utf-8"),Xn=new TextEncoder;function tr(t){-1===t.indexOf("://")&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),("80"===e.port&&"ws:"===e.protocol||"443"===e.port&&"wss:"===e.protocol)&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}function er(t,e){const[n,r]=rr(t,(t=>e.id===t.id?0:e.created_at===t.created_at?-1:t.created_at-e.created_at));return r||t.splice(n,0,e),t}function nr(t,e){const[n,r]=rr(t,(t=>e.id===t.id?0:e.created_at===t.created_at?-1:e.created_at-t.created_at));return r||t.splice(n,0,e),t}function rr(t,e){let n=0,r=t.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),s=e(t[i]);if(0===s)return[i,!0];s<0?r=i-1:n=i+1}return[n,!1]}var ir=class{value;next=null;prev=null;constructor(t){this.value=t}},sr=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new ir(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const t=this.first;return this.first=null,this.last=null,t.value}const t=this.first;return this.first=t.next,t.value}};function or(t){return qt(ae(Xn.encode(function(t){if(!Jn(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}(t))))}var ar=new class{generateSecretKey(){return $t.utils.randomPrivateKey()}getPublicKey(t){return qt($t.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=qt($t.getPublicKey(e)),n.id=or(n),n.sig=qt($t.sign(or(n),e)),n[Yn]=!0,n}verifyEvent(t){if("boolean"==typeof t[Yn])return t[Yn];const e=or(t);if(e!==t.id)return t[Yn]=!1,!1;try{const n=$t.verify(t.sig,e,t.pubkey);return t[Yn]=n,n}catch(e){return t[Yn]=!1,!1}}},cr=ar.generateSecretKey,hr=ar.getPublicKey,lr=ar.finalizeEvent,ur=ar.verifyEvent;function dr(t){return 1e3<=t&&t<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(t)}function fr(t){return[0,3].includes(t)||1e4<=t&&t<2e4}function pr(t){return 2e4<=t&&t<3e4}function gr(t){return 3e4<=t&&t<4e4}function yr(t){return dr(t)?"regular":fr(t)?"replaceable":pr(t)?"ephemeral":gr(t)?"parameterized":"unknown"}function wr(t,e){const n=e instanceof Array?e:[e];return Jn(t)&&n.includes(t.kind)||!1}Zn({},{Application:()=>Ni,BadgeAward:()=>Sr,BadgeDefinition:()=>ki,BlockedRelaysList:()=>ri,BookmarkList:()=>ti,Bookmarksets:()=>mi,Calendar:()=>Oi,CalendarEventRSVP:()=>Di,ChannelCreation:()=>Ir,ChannelHideMessage:()=>Ur,ChannelMessage:()=>Tr,ChannelMetadata:()=>Br,ChannelMuteUser:()=>Pr,ClassifiedListing:()=>Ti,ClientAuth:()=>ui,CommunitiesList:()=>ei,CommunityDefinition:()=>Mi,CommunityPostApproval:()=>Kr,Contacts:()=>Er,CreateOrUpdateProduct:()=>xi,CreateOrUpdateStall:()=>Ai,Curationsets:()=>vi,Date:()=>Pi,DirectMessageRelaysList:()=>ai,DraftClassifiedListing:()=>Ui,DraftLong:()=>Ri,Emojisets:()=>Ci,EncryptedDirectMessage:()=>kr,EventDeletion:()=>_r,FileMetadata:()=>Dr,FileServerPreference:()=>ci,Followsets:()=>yi,GenericRepost:()=>Nr,Genericlists:()=>wi,GiftWrap:()=>Or,HTTPAuth:()=>gi,Handlerinformation:()=>Fi,Handlerrecommendation:()=>$i,Highlights:()=>Yr,InterestsList:()=>si,Interestsets:()=>_i,JobFeedback:()=>Wr,JobRequest:()=>qr,JobResult:()=>jr,Label:()=>Hr,LightningPubRPC:()=>li,LiveChatMessage:()=>$r,LiveEvent:()=>Ii,LongFormArticle:()=>Si,Metadata:()=>br,Mutelist:()=>Jr,NWCWalletInfo:()=>hi,NWCWalletRequest:()=>di,NWCWalletResponse:()=>fi,NostrConnect:()=>pi,OpenTimestamps:()=>Lr,Pinlist:()=>Qr,PrivateDirectMessage:()=>Cr,ProblemTracker:()=>Fr,ProfileBadges:()=>Ei,PublicChatsList:()=>ni,Reaction:()=>xr,RecommendRelay:()=>vr,RelayList:()=>Xr,Relaysets:()=>bi,Report:()=>Mr,Reporting:()=>zr,Repost:()=>Ar,Seal:()=>Rr,SearchRelaysList:()=>ii,ShortTextNote:()=>mr,Time:()=>Li,UserEmojiList:()=>oi,UserStatuses:()=>Bi,Zap:()=>Zr,ZapGoal:()=>Vr,ZapRequest:()=>Gr,classifyKind:()=>yr,isEphemeralKind:()=>pr,isKind:()=>wr,isParameterizedReplaceableKind:()=>gr,isRegularKind:()=>dr,isReplaceableKind:()=>fr});var br=0,mr=1,vr=2,Er=3,kr=4,_r=5,Ar=6,xr=7,Sr=8,Rr=13,Cr=14,Nr=16,Ir=40,Br=41,Tr=42,Ur=43,Pr=44,Lr=1040,Or=1059,Dr=1063,$r=1311,Fr=1971,Mr=1984,zr=1984,Hr=1985,Kr=4550,qr=5999,jr=6999,Wr=7e3,Vr=9041,Gr=9734,Zr=9735,Yr=9802,Jr=1e4,Qr=10001,Xr=10002,ti=10003,ei=10004,ni=10005,ri=10006,ii=10007,si=10015,oi=10030,ai=10050,ci=10096,hi=13194,li=21e3,ui=22242,di=23194,fi=23195,pi=24133,gi=27235,yi=3e4,wi=30001,bi=30002,mi=30003,vi=30004,Ei=30008,ki=30009,_i=30015,Ai=30017,xi=30018,Si=30023,Ri=30024,Ci=30030,Ni=30078,Ii=30311,Bi=30315,Ti=30402,Ui=30403,Pi=31922,Li=31923,Oi=31924,Di=31925,$i=31989,Fi=31990,Mi=34550;function zi(t,e){if(t.ids&&-1===t.ids.indexOf(e.id))return!1;if(t.kinds&&-1===t.kinds.indexOf(e.kind))return!1;if(t.authors&&-1===t.authors.indexOf(e.pubkey))return!1;for(let n in t)if("#"===n[0]){let r=t[`#${n.slice(1)}`];if(r&&!e.tags.find((([t,e])=>t===n.slice(1)&&-1!==r.indexOf(e))))return!1}return!(t.since&&e.created_at<t.since||t.until&&e.created_at>t.until)}function Hi(t,e){for(let n=0;n<t.length;n++)if(zi(t[n],e))return!0;return!1}function Ki(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,i=t.slice(r).indexOf('"')+r+1;return t.slice(i,i+64)}function qi(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,i=t.slice(r),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function ji(t){let e=t.slice(0,22).indexOf('"EVENT"');if(-1===e)return null;let n=t.slice(e+7+1).indexOf('"');if(-1===n)return null;let r=e+7+1+n,i=t.slice(r+1,80).indexOf('"');if(-1===i)return null;let s=r+1+i;return t.slice(r+1,s)}function Wi(t,e){return e===Ki(t,"id")}function Vi(t,e){return e===Ki(t,"pubkey")}function Gi(t,e){return e===qi(t,"kind")}function Zi(t,e){return{kind:ui,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}Zn({},{getHex64:()=>Ki,getInt:()=>qi,getSubscriptionId:()=>ji,matchEventId:()=>Wi,matchEventKind:()=>Gi,matchEventPubkey:()=>Vi}),Zn({},{makeAuthEvent:()=>Zi});try{WebSocket}catch{}try{WebSocket}catch{}var Yi={};Zn(Yi,{BECH32_REGEX:()=>Xi,Bech32MaxSize:()=>Qi,NostrTypeGuard:()=>Ji,decode:()=>ts,encodeBytes:()=>os,naddrEncode:()=>hs,neventEncode:()=>cs,noteEncode:()=>is,nprofileEncode:()=>as,npubEncode:()=>rs,nsecEncode:()=>ns});var Ji={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},Qi=5e3,Xi=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function ts(t){let{prefix:e,words:n}=Re.decode(t,Qi),r=new Uint8Array(Re.fromWords(n));switch(e){case"nprofile":{let t=es(r);if(!t[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(32!==t[0][0].length)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:qt(t[0][0]),relays:t[1]?t[1].map((t=>Qn.decode(t))):[]}}}case"nevent":{let t=es(r);if(!t[0]?.[0])throw new Error("missing TLV 0 for nevent");if(32!==t[0][0].length)throw new Error("TLV 0 should be 32 bytes");if(t[2]&&32!==t[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(t[3]&&4!==t[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:qt(t[0][0]),relays:t[1]?t[1].map((t=>Qn.decode(t))):[],author:t[2]?.[0]?qt(t[2][0]):void 0,kind:t[3]?.[0]?parseInt(qt(t[3][0]),16):void 0}}}case"naddr":{let t=es(r);if(!t[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!t[2]?.[0])throw new Error("missing TLV 2 for naddr");if(32!==t[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(!t[3]?.[0])throw new Error("missing TLV 3 for naddr");if(4!==t[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Qn.decode(t[0][0]),pubkey:qt(t[2][0]),kind:parseInt(qt(t[3][0]),16),relays:t[1]?t[1].map((t=>Qn.decode(t))):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:qt(r)};default:throw new Error(`unknown prefix ${e}`)}}function es(t){let e={},n=t;for(;n.length>0;){let t=n[0],r=n[1],i=n.slice(2,2+r);if(n=n.slice(2+r),i.length<r)throw new Error(`not enough data to read on TLV ${t}`);e[t]=e[t]||[],e[t].push(i)}return e}function ns(t){return os("nsec",t)}function rs(t){return os("npub",jt(t))}function is(t){return os("note",jt(t))}function ss(t,e){let n=Re.toWords(e);return Re.encode(t,n,Qi)}function os(t,e){return ss(t,e)}function as(t){return ss("nprofile",ls({0:[jt(t.pubkey)],1:(t.relays||[]).map((t=>Xn.encode(t)))}))}function cs(t){let e;return void 0!==t.kind&&(e=function(t){const e=new Uint8Array(4);return e[0]=t>>24&255,e[1]=t>>16&255,e[2]=t>>8&255,e[3]=255&t,e}(t.kind)),ss("nevent",ls({0:[jt(t.id)],1:(t.relays||[]).map((t=>Xn.encode(t))),2:t.author?[jt(t.author)]:[],3:e?[new Uint8Array(e)]:[]}))}function hs(t){let e=new ArrayBuffer(4);return new DataView(e).setUint32(0,t.kind,!1),ss("naddr",ls({0:[Xn.encode(t.identifier)],1:(t.relays||[]).map((t=>Xn.encode(t))),2:[jt(t.pubkey)],3:[new Uint8Array(e)]}))}function ls(t){let e=[];return Object.entries(t).reverse().forEach((([t,n])=>{n.forEach((n=>{let r=new Uint8Array(n.length+2);r.set([parseInt(t)],0),r.set([n.length],1),r.set(n,2),e.push(r)}))})),Vt(...e)}var us={};async function ds(t,e,n){const r=t instanceof Uint8Array?qt(t):t,i=ps(kt.getSharedSecret(r,"02"+e));let s=Uint8Array.from(Yt(16)),o=Xn.encode(n),a=vn(i,s).encrypt(o);return`${ve.encode(new Uint8Array(a))}?iv=${ve.encode(new Uint8Array(s.buffer))}`}async function fs(t,e,n){const r=t instanceof Uint8Array?qt(t):t;let[i,s]=n.split("?iv="),o=ps(kt.getSharedSecret(r,"02"+e)),a=ve.decode(s),c=ve.decode(i),h=vn(o,a).decrypt(c);return Qn.decode(h)}function ps(t){return t.slice(1,33)}Zn(us,{decrypt:()=>fs,encrypt:()=>ds}),Zn({},{NIP05_REGEX:()=>ys,isNip05:()=>ws,isValid:()=>Es,queryProfile:()=>vs,searchDomain:()=>ms,useFetchImplementation:()=>bs});var gs,ys=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,ws=t=>ys.test(t||"");try{gs=fetch}catch(t){}function bs(t){gs=t}async function ms(t,e=""){try{const n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await gs(n,{redirect:"manual"});if(200!==r.status)throw Error("Wrong response code");return(await r.json()).names}catch(t){return{}}}async function vs(t){const e=t.match(ys);if(!e)return null;const[,n="_",r]=e;try{const t=`https://${r}/.well-known/nostr.json?name=${n}`,e=await gs(t,{redirect:"manual"});if(200!==e.status)throw Error("Wrong response code");const i=await e.json(),s=i.names[n];return s?{pubkey:s,relays:i.relays?.[s]}:null}catch(t){return null}}async function Es(t,e){const n=await vs(e);return!!n&&n.pubkey===t}function ks(t){const e={reply:void 0,root:void 0,mentions:[],profiles:[]},n=[];for(const r of t.tags)"e"===r[0]&&r[1]&&n.push(r),"p"===r[0]&&r[1]&&e.profiles.push({pubkey:r[1],relays:r[2]?[r[2]]:[]});for(let t=0;t<n.length;t++){const r=n[t],[i,s,o,a]=r,c={id:s,relays:o?[o]:[]},h=0===t,l=t===n.length-1;"root"!==a?"reply"!==a?"mention"!==a?h?e.root=c:l?e.reply=c:e.mentions.push(c):e.mentions.push(c):e.reply=c:e.root=c}return e}Zn({},{parse:()=>ks}),Zn({},{fetchRelayInformation:()=>As,useFetchImplementation:()=>_s});try{fetch}catch{}function _s(t){}async function As(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}function xs(t){let e=0;for(let n=0;n<64;n+=8){const r=parseInt(t.substring(n,n+8),16);if(0!==r){e+=Math.clz32(r);break}e+=32}return e}function Ss(t,e){let n=0;const r=t,i=["nonce",n.toString(),e.toString()];for(r.tags.push(i);;){const t=Math.floor((new Date).getTime()/1e3);if(t!==r.created_at&&(n=0,r.created_at=t),i[1]=(++n).toString(),r.id=Rs(r),xs(r.id)>=e)break}return r}function Rs(t){return qt(ae(Xn.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}function Cs(t,e,n,r){return lr({kind:Ar,tags:[...t.tags??[],["e",e.id,n],["p",e.pubkey]],content:""===t.content?"":JSON.stringify(e),created_at:t.created_at},r)}function Ns(t){if(t.kind!==Ar)return;let e,n;for(let r=t.tags.length-1;r>=0&&(void 0===e||void 0===n);r--){const i=t.tags[r];i.length>=2&&("e"===i[0]&&void 0===e?e=i:"p"===i[0]&&void 0===n&&(n=i))}return void 0!==e?{id:e[1],relays:[e[2],n?.[2]].filter((t=>"string"==typeof t)),author:n?.[1]}:void 0}function Is(t,{skipVerification:e}={}){const n=Ns(t);if(void 0===n||""===t.content)return;let r;try{r=JSON.parse(t.content)}catch(t){return}return r.id===n.id&&(e||ur(r))?r:void 0}Zn({},{fastEventHash:()=>Rs,getPow:()=>xs,minePow:()=>Ss}),Zn({},{finishRepostEvent:()=>Cs,getRepostedEvent:()=>Is,getRepostedEventPointer:()=>Ns}),Zn({},{NOSTR_URI_REGEX:()=>Bs,parse:()=>Us,test:()=>Ts});var Bs=new RegExp(`nostr:(${Xi.source})`);function Ts(t){return"string"==typeof t&&new RegExp(`^${Bs.source}$`).test(t)}function Us(t){const e=t.match(new RegExp(`^${Bs.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:ts(e[1])}}function Ps(t,e,n){const r=e.tags.filter((t=>t.length>=2&&("e"===t[0]||"p"===t[0])));return lr({...t,kind:xr,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function Ls(t){if(t.kind!==xr)return;let e,n;for(let r=t.tags.length-1;r>=0&&(void 0===e||void 0===n);r--){const i=t.tags[r];i.length>=2&&("e"===i[0]&&void 0===e?e=i:"p"===i[0]&&void 0===n&&(n=i))}return void 0!==e&&void 0!==n?{id:e[1],relays:[e[2],n[2]].filter((t=>void 0!==t)),author:n[1]}:void 0}Zn({},{finishReactionEvent:()=>Ps,getReactedEventPointer:()=>Ls}),Zn({},{matchAll:()=>Ds,regex:()=>Os,replaceAll:()=>$s});var Os=()=>new RegExp(`\\b${Bs.source}\\b`,"g");function*Ds(t){const e=t.matchAll(Os());for(const t of e)try{const[e,n]=t;yield{uri:e,value:n,decoded:ts(n),start:t.index,end:t.index+e.length}}catch(t){}}function $s(t,e){return t.replaceAll(Os(),((t,n)=>e({uri:t,value:n,decoded:ts(n)})))}Zn({},{channelCreateEvent:()=>Fs,channelHideMessageEvent:()=>Hs,channelMessageEvent:()=>zs,channelMetadataEvent:()=>Ms,channelMuteUserEvent:()=>Ks});var Fs=(t,e)=>{let n;if("object"==typeof t.content)n=JSON.stringify(t.content);else{if("string"!=typeof t.content)return;n=t.content}return lr({kind:Ir,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},Ms=(t,e)=>{let n;if("object"==typeof t.content)n=JSON.stringify(t.content);else{if("string"!=typeof t.content)return;n=t.content}return lr({kind:Br,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},zs=(t,e)=>{const n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),lr({kind:Tr,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},Hs=(t,e)=>{let n;if("object"==typeof t.content)n=JSON.stringify(t.content);else{if("string"!=typeof t.content)return;n=t.content}return lr({kind:Ur,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},Ks=(t,e)=>{let n;if("object"==typeof t.content)n=JSON.stringify(t.content);else{if("string"!=typeof t.content)return;n=t.content}return lr({kind:Pr,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)};Zn({},{EMOJI_SHORTCODE_REGEX:()=>js,matchAll:()=>Vs,regex:()=>Ws,replaceAll:()=>Gs});var qs,js=/:(\w+):/,Ws=()=>new RegExp(`\\B${js.source}\\B`,"g");function*Vs(t){const e=t.matchAll(Ws());for(const t of e)try{const[e,n]=t;yield{shortcode:e,name:n,start:t.index,end:t.index+e.length}}catch(t){}}function Gs(t,e){return t.replaceAll(Ws(),((t,n)=>e({shortcode:t,name:n})))}Zn({},{useFetchImplementation:()=>Zs,validateGithub:()=>Ys});try{qs=fetch}catch{}function Zs(t){qs=t}async function Ys(t,e,n){try{return await(await qs(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch(t){return!1}}var Js={};Zn(Js,{decrypt:()=>so,encrypt:()=>io,getConversationKey:()=>to,v2:()=>oo});var Qs=1,Xs=65535;function to(t,e){const n=kt.getSharedSecret(t,"02"+e).subarray(1,33);return r=ae,i=n,s="nip44-v2",Xt.hash(r),void 0===s&&(s=new Uint8Array(r.outputLen)),jn(r,Wt(s),Wt(i));var r,i,s}function eo(t,e){const n=function(t,e,n,r=32){if(Xt.hash(t),Xt.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/t.outputLen);void 0===n&&(n=Vn);const s=new Uint8Array(i*t.outputLen),o=jn.create(t,e),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let e=0;e<i;e++)Wn[0]=e+1,a.update(0===e?Vn:c).update(n).update(Wn).digestInto(c),s.set(c,t.outputLen*e),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),Wn.fill(0),s.slice(0,r)}(ae,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function no(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;const e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function ro(t,e,n){if(32!==n.length)throw new Error("AAD associated data must be 32 bytes");const r=Vt(n,e);return jn(ae,t,r)}function io(t,e,n=Yt(32)){const{chacha_key:r,chacha_nonce:i,hmac_key:s}=eo(e,n),o=function(t){const e=Xn.encode(t),n=e.length;return Vt(function(t){if(!Number.isSafeInteger(t)||t<Qs||t>Xs)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t,!1),e}(n),e,new Uint8Array(no(n)-n))}(t),a=Dn(r,i,o),c=ro(s,a,n);return ve.encode(Vt(new Uint8Array([2]),n,a,c))}function so(t,e){const{nonce:n,ciphertext:r,mac:i}=function(t){if("string"!=typeof t)throw new Error("payload must be a valid string");const e=t.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if("#"===t[0])throw new Error("unknown encryption version");let n;try{n=ve.decode(t)}catch(t){throw new Error("invalid base64: "+t.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const i=n[0];if(2!==i)throw new Error("unknown encryption version "+i);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}(t),{chacha_key:s,chacha_nonce:o,hmac_key:a}=eo(e,n);if(!$e(ro(a,r,n),i))throw new Error("invalid MAC");return function(t){const e=new DataView(t.buffer).getUint16(0),n=t.subarray(2,2+e);if(e<Qs||e>Xs||n.length!==e||t.length!==2+no(e))throw new Error("invalid padding");return Qn.decode(n)}(Dn(s,o,r))}var oo={utils:{getConversationKey:to,calcPaddedLen:no},encrypt:io,decrypt:so};function ao(t){const{pathname:e,searchParams:n}=new URL(t),r=e,i=n.get("relay"),s=n.get("secret");if(!r||!i||!s)throw new Error("invalid connection string");return{pubkey:r,relay:i,secret:s}}async function co(t,e,n){const r={method:"pay_invoice",params:{invoice:n}},i=await ds(e,t,JSON.stringify(r)),s={kind:di,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",t]]};return lr(s,e)}Zn({},{makeNwcRequestEvent:()=>co,parseConnectionString:()=>ao});var ho,lo={};Zn(lo,{getZapEndpoint:()=>fo,makeZapReceipt:()=>yo,makeZapRequest:()=>po,useFetchImplementation:()=>uo,validateZapRequest:()=>go});try{ho=fetch}catch{}function uo(t){ho=t}async function fo(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(n){let{words:t}=Re.decode(n,1e3),r=Re.fromWords(t);e=Qn.decode(r)}else{if(!r)return null;{let[t,n]=r.split("@");e=new URL(`/.well-known/lnurlp/${t}`,`https://${n}`).toString()}}let i=await ho(e),s=await i.json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch(t){}return null}function po({profile:t,event:e,amount:n,relays:r,comment:i=""}){if(!n)throw new Error("amount not given");if(!t)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",t],["amount",n.toString()],["relays",...r]]};return e&&s.tags.push(["e",e]),s}function go(t){let e;try{e=JSON.parse(t)}catch(t){return"Invalid zap request JSON."}if(!Jn(e))return"Zap request is not a valid Nostr event.";if(!ur(e))return"Invalid signature on zap request.";let n=e.tags.find((([t,e])=>"p"===t&&e));if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find((([t,e])=>"e"===t&&e));return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find((([t,e])=>"relays"===t&&e))?null:"Zap request doesn't have a 'relays' tag."}function yo({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let i=JSON.parse(t),s=i.tags.filter((([t])=>"e"===t||"p"===t||"a"===t)),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",n],["description",t]]};return e&&o.tags.push(["preimage",e]),o}Zn({},{createRumor:()=>ko,createSeal:()=>_o,createWrap:()=>Ao,unwrapEvent:()=>Ro,unwrapManyEvents:()=>Co,wrapEvent:()=>xo,wrapManyEvents:()=>So});var wo=()=>Math.round(Date.now()/1e3),bo=()=>Math.round(wo()-172800*Math.random()),mo=(t,e)=>to(t,e),vo=(t,e,n)=>io(JSON.stringify(t),mo(e,n)),Eo=(t,e)=>JSON.parse(so(t.content,mo(e,t.pubkey)));function ko(t,e){const n={created_at:wo(),content:"",tags:[],...t,pubkey:hr(e)};return n.id=or(n),n}function _o(t,e,n){return lr({kind:Rr,content:vo(t,e,n),created_at:bo(),tags:[]},e)}function Ao(t,e){const n=cr();return lr({kind:Or,content:vo(t,n,e),created_at:bo(),tags:[["p",e]]},n)}function xo(t,e,n){return Ao(_o(ko(t,e),e,n),n)}function So(t,e,n){if(!n||0===n.length)throw new Error("At least one recipient is required.");const r=hr(e),i=[xo(t,e,r)];return n.forEach((n=>{i.push(xo(t,e,n))})),i}function Ro(t,e){const n=Eo(t,e);return Eo(n,e)}function Co(t,e){let n=[];return t.forEach((t=>{n.push(Ro(t,e))})),n.sort(((t,e)=>t.created_at-e.created_at)),n}Zn({},{getToken:()=>Io,hashPayload:()=>Do,unpackEventFromToken:()=>To,validateEvent:()=>Fo,validateEventKind:()=>Po,validateEventMethodTag:()=>Oo,validateEventPayloadTag:()=>$o,validateEventTimestamp:()=>Uo,validateEventUrlTag:()=>Lo,validateToken:()=>Bo});var No="Nostr ";async function Io(t,e,n,r=!1,i){const s={kind:gi,tags:[["u",t],["method",e]],created_at:Math.round((new Date).getTime()/1e3),content:""};i&&s.tags.push(["payload",Do(i)]);const o=await n(s);return(r?No:"")+ve.encode(Xn.encode(JSON.stringify(o)))}async function Bo(t,e,n){const r=await To(t).catch((t=>{throw t}));return await Fo(r,e,n).catch((t=>{throw t}))}async function To(t){if(!t)throw new Error("Missing token");t=t.replace(No,"");const e=Qn.decode(ve.decode(t));if(!e||0===e.length||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function Uo(t){return!!t.created_at&&Math.round((new Date).getTime()/1e3)-t.created_at<60}function Po(t){return t.kind===gi}function Lo(t,e){const n=t.tags.find((t=>"u"===t[0]));return!!n&&n.length>0&&n[1]===e}function Oo(t,e){const n=t.tags.find((t=>"method"===t[0]));return!!n&&n.length>0&&n[1].toLowerCase()===e.toLowerCase()}function Do(t){return qt(ae(Xn.encode(JSON.stringify(t))))}function $o(t,e){const n=t.tags.find((t=>"payload"===t[0]));if(!n)return!1;const r=Do(e);return n.length>0&&n[1]===r}async function Fo(t,e,n,r){if(!ur(t))throw new Error("Invalid nostr event, signature invalid");if(!Po(t))throw new Error("Invalid nostr event, kind invalid");if(!Uo(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!Lo(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!Oo(t,n))throw new Error("Invalid nostr event, method tag invalid");if(Boolean(r)&&"object"==typeof r&&Object.keys(r).length>0&&!$o(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var n=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t].call(n.exports,n,n.exports,__webpack_require__),n.exports}__webpack_require__.d=(t,e)=>{for(var n in e)__webpack_require__.o(e,n)&&!__webpack_require__.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var __webpack_exports__={};__webpack_require__(3437),__webpack_require__(4080),__webpack_require__(7226),__webpack_require__(58),__webpack_require__(9446),__webpack_require__(5228),__webpack_require__(6455),__webpack_require__(5919),__webpack_require__(4042),__webpack_require__(1372),__webpack_require__(5384)})();